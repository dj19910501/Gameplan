@using RevenuePlanner.Helpers
<div id="header" class="span12">
    @* @Html.Partial("_nav") /*Navigation */ *@

    @* Header top section *@
    <div class="header-top clearfix">
        <div class="header-left">
            @if (Sessions.User.UserApplicationId != null && Sessions.User.UserApplicationId.Count() > 0)
            {
                if (Sessions.User.UserApplicationId.Where(o => o.ApplicationTitle == Enums.ApplicationCode.MRP.ToString()).Any())
                {
                    <a id="aPlan" class="hive9modules hvr-grow active" href="@Url.Action("Index", "Home")">
                        <svg xml:space="preserve" style="enable-background:new 0 0 32 32;" viewBox="0 0 32 32" y="0px" x="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" id="Layer_1" version="1.1">
                        <g id="XMLID_581_">
                        <g>
                        <g id="XMLID_165_">
                        <path d="M24.9,31L7.1,31c-0.5,0-1-0.4-1-1l0-24.2c0-0.3,0.1-0.5,0.3-0.7C6.6,5,6.8,4.9,7.1,4.9
				        l5.1,0l0,0.9l-5.1,0h0c0,0-0.1,0-0.1,0c0,0,0,0,0,0.1L7,30c0,0,0,0.1,0.1,0.1l17.8,0c0,0,0.1,0,0.1-0.1l0-24.2c0,0,0-0.1-0.1-0.1
				        l-5.7,0l0-0.9l5.7,0c0.5,0,1,0.4,1,1l0,24.2C25.9,30.6,25.4,31,24.9,31z" class="st0" id="XMLID_177_" />
                    <g id="XMLID_175_">
                    <polygon points="24.2,29.1 7.9,29.1 7.9,6.5 12.2,6.5 12.2,7.3 8.8,7.3 8.8,28.2 23.3,28.2
					        23.3,7.3 19.1,7.3 19.1,6.5 24.2,6.5 				" class="st0" id="XMLID_176_" />
                            </g>
                    <g id="XMLID_166_">
                    <path d="M16.6,4.2l-0.4-0.7c0.2-0.2,0.3-0.4,0.3-0.7c0-0.5-0.4-0.9-0.9-0.9c-0.5,0-0.9,0.4-0.9,0.9
					        c0,0.3,0.1,0.5,0.3,0.7l-0.4,0.7l-1,1.7l2,0l2,0L16.6,4.2z M15.6,3.2c-0.2,0-0.4-0.2-0.4-0.4c0-0.2,0.2-0.4,0.4-0.4
					        c0.2,0,0.4,0.2,0.4,0.4C16,3,15.8,3.2,15.6,3.2z" class="st0" id="XMLID_172_" />
                    <g id="XMLID_167_">
                    <path d="M15.6,1.9L15.6,1.9c0.5,0,0.9,0.4,0.9,0.9c0,0.3-0.1,0.5-0.3,0.7l0.4,0.7l0.2,0.3l1.9,0
						        l0,2.6l-6,0l0-2.6l1.7,0l0.2-0.3L15,3.4c-0.2-0.2-0.3-0.4-0.3-0.7C14.7,2.3,15.1,1.9,15.6,1.9 M15.6,3.2C15.8,3.2,16,3,16,2.8
						        c0-0.2-0.2-0.4-0.4-0.4c-0.2,0-0.4,0.2-0.4,0.4C15.1,3,15.3,3.2,15.6,3.2 M15.6,1L15.6,1L15.6,1L15.6,1c-1,0-1.8,0.8-1.8,1.8
						        c0,0.2,0.1,0.5,0.1,0.7l-0.1,0.2l-1.2,0l-0.9,0l0,0.9l0,2.6l0,0.9l0.9,0l6,0l0.9,0l0-0.9l0-2.6l0-0.9l-0.9,0l-1.4,0l-0.1-0.2
						        c0.1-0.2,0.1-0.5,0.1-0.7C17.3,1.8,16.5,1,15.6,1L15.6,1z" class="st0" id="XMLID_168_" />
                              </g>
                            </g>
                          </g>
                    <g id="XMLID_162_">
                    <rect height="3.8" width="0.9" class="st0" transform="matrix(0.7071 0.7071 -0.7071 0.7071 21.9557 -6.2066)" y="21.5" x="18" id="XMLID_164_" />
                    <rect height="0.9" width="3.8" class="st0" transform="matrix(0.7071 0.7072 -0.7072 0.7071 21.9592 -6.2062)" y="23" x="16.6" id="XMLID_163_" />
                          </g>
                    <path d="M12.7,16.2c-1.2,0-2.2-1-2.2-2.2c0-1.2,1-2.2,2.2-2.2c1.2,0,2.2,1,2.2,2.2
			        C15,15.2,14,16.2,12.7,16.2z M12.7,12.5c-0.8,0-1.4,0.6-1.4,1.4c0,0.8,0.6,1.4,1.4,1.4c0.8,0,1.4-0.6,1.4-1.4
			        C14.1,13.2,13.5,12.5,12.7,12.5z" class="st0" id="XMLID_159_" />
                    <g id="XMLID_156_">
                    <polygon points="20.9,13.6 19,11.7 17.1,13.6 16.5,13 19,10.5 21.5,13 			" class="st0" id="XMLID_158_" />
                    <path d="M10.1,21.7v-0.9c4.7,0,8.6-3.8,8.6-8.4c0-0.3,0-0.6,0-0.9l0.9-0.1c0,0.3,0,0.6,0,1
				        C19.5,17.5,15.3,21.7,10.1,21.7z" class="st0" id="XMLID_157_" />
                          </g>
                        </g>
                      </g>
                    </svg>
                        <span>Plan</span>
                    </a>
                }
            }
            <a id="aMeasure" class="hive9modules hvr-grow " href="@Url.Action("MeasureReport", "Report")">
                <svg xml:space="preserve" style="enable-background:new 0 0 32 32;" viewBox="0 0 32 32" y="0px" x="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" id="Layer_1" version="1.1">
                <g id="XMLID_132_">
                <g id="XMLID_133_">
                <g>
                <path d="M19.5,14.9c-1.1,0-1.9-0.9-1.9-1.9c0-1.1,0.9-1.9,1.9-1.9c1.1,0,1.9,0.9,1.9,1.9
				C21.4,14.1,20.5,14.9,19.5,14.9z M19.5,12c-0.6,0-1,0.5-1,1s0.5,1,1,1c0.6,0,1-0.5,1-1S20,12,19.5,12z" class="st0" id="XMLID_228_" />
                <rect height="7.4" width="0.9" class="st0" transform="matrix(0.6906 0.7232 -0.7232 0.6906 14.005 -13.8592)" y="5.8" x="22.8" id="XMLID_227_" />
                <rect height="0.9" width="5.3" class="st0" transform="matrix(0.8682 0.4962 -0.4962 0.8682 7.5369 -6.4364)" y="10.5" x="13.2" id="XMLID_226_" />
                <rect height="7.5" width="0.9" class="st0" transform="matrix(0.7232 0.6906 -0.6906 0.7232 11.1176 -2.4619)" y="8.9" x="8.2" id="XMLID_225_" />
                <path d="M15.3,28h-6V13.5h6V28z M10.2,27.1h4.2V14.4h-4.2V27.1z" class="st0" id="XMLID_222_" />
                <path d="M22.6,28h-6V16.5h6V28z M17.5,27.1h4.2v-9.8h-4.2V27.1z" class="st0" id="XMLID_219_" />
                <path d="M8.1,28h-6v-7.8h6V28z M3,27.1h4.2v-6H3V27.1z" class="st0" id="XMLID_216_" />
                <rect height="0.9" width="29.5" class="st0" y="27.1" x="1.3" id="XMLID_215_" />
                <path d="M5,18.3c-1.1,0-1.9-0.9-1.9-1.9c0-1.1,0.9-1.9,1.9-1.9c1.1,0,1.9,0.9,1.9,1.9
				C6.9,17.5,6,18.3,5,18.3z M5,15.4c-0.6,0-1,0.5-1,1c0,0.6,0.5,1,1,1c0.6,0,1-0.5,1-1C6,15.8,5.6,15.4,5,15.4z" class="st0" id="XMLID_212_" />
                <path d="M12.2,10.8c-1.1,0-1.9-0.9-1.9-1.9c0-1.1,0.9-1.9,1.9-1.9c1.1,0,1.9,0.9,1.9,1.9
				C14.1,9.9,13.3,10.8,12.2,10.8z M12.2,7.8c-0.6,0-1,0.5-1,1c0,0.6,0.5,1,1,1c0.6,0,1-0.5,1-1C13.3,8.3,12.8,7.8,12.2,7.8z" class="st0" id="XMLID_209_" />
                <path d="M26.9,7.8c-1.1,0-1.9-0.9-1.9-1.9S25.8,4,26.9,4c1.1,0,1.9,0.9,1.9,1.9S27.9,7.8,26.9,7.8z
				 M26.9,4.9c-0.6,0-1,0.5-1,1s0.5,1,1,1c0.6,0,1-0.5,1-1S27.4,4.9,26.9,4.9z" class="st0" id="XMLID_206_" />
                <path d="M29.8,28h-6V9.8h6V28z M24.7,27.1h4.2V10.7h-4.2V27.1z" class="st0" id="XMLID_203_" />
                  </g>
                </g>
              </g>
            </svg>
                <span>Measure</span>
            </a>
        </div>

        <div class="home-header">
            @*<span class="hive9-logo">
                <img src="/Images/hiv9_logo.png">
            </span>*@ 
            <span class="hive9Logo-wrap">
                @*<span class="mrp-logo"></span>*@
                <img src="~/Content/images/hiv9_logo.png" />
            </span>
                <span class="hive9-name">
    @if (Sessions.User != null)
    {
                        <span class="title">@Sessions.User.Client</span>/*changed - added by uday #559*/
    }
    else
    {
                        <span class="title">Hive9 @Sessions.ApplicationName</span>/*changed - added by uday #559*/
    }
                </span>
        </div>

        <div class="header-right">
            @*<span>  // Commented by Bhumika for #2457, #2522 change - Profile view 
                <a href="#" id="ContactSupport">Support</a>
                
            </span>
            <span>
                <a href="@Url.Action("LogOff", "Login")">Sign Out</a>
            </span>*@

            @if (Sessions.User != null)
            {
                <div class="info-user cf user_title dropdown ">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" >
                        <div class=" proflie_pic">
                        <img class="avatar-user img-circle" src="@Url.Action("UserPhoto", "Home")" alt="User avatar" />
                        </div>
                        <div class="username" title="@Sessions.User.FirstName @Sessions.User.LastName">
                            @Sessions.User.FirstName @Sessions.User.LastName
                        </div>
                    </a>
                        <ul class="dropdown-menu">
                            <p class="ul-top clearfix"><span class="pull-left">Profile</span> <a href="#" id="ContactSupport" class="pull-right">Support</a></p>
                            <li><a href="@Url.Action("Edit", "User")">My Account</a></li>  @* Modified by Viral Kadiya on 11/04/2014 for PL Ticket #917*@
                            <li><a href="@Url.Action("ChangePassword", "User")">Change Password</a></li> 
                            <li><a href="http://www.hive9.com/apidae/release-notes" target="_blank">Updates</a></li>
                            <li><a href="@Url.Action("LogOff", "Login")">Sign Out</a></li>
                        </ul>
                </div>
            }
            @*Added by Bhumika for #2468 - alert & Notification dropdown*@
            @if (Sessions.IsAlertPermission) //added by devanshi #2476 : client permission for Alert 
            {
              <div class="aler-list dropdown pull-right" id="divAlertSummary">
                <span class="count" id="spnAlertCnt" style="display:none"></span>
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Alerts" ><i class="fa fa-bell-o" aria-hidden="true"></i></a>
                <ul class="dropdown-menu UlAlertList" id="UlAlertsummary">
                    <p class="ul-top clearfix"><span class="pull-left">Alerts</span> <a href="@Url.Action("Alerts", "User")" class="pull-right">Settings</a></p>

                </ul>
            </div>
             }
            
            <div class="notify-list dropdown pull-right"  >
                <span class="count" id="spnNotificationCnt" style="display:none"></span>
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="divNotificationSummary" title="Notifications"><i class="fa fa-globe" aria-hidden="true"></i></a>
                <ul class="dropdown-menu" id="ulNotificationlisting" >
                    <p class="ul-top clearfix"><span class="pull-left">Notifications</span> <a href="@Url.Action("Notifications", "User")" class="pull-right">Settings</a></p>
                </ul>
            </div>

        </div>
    </div>

    @* Header Navigation section *@
    <div class="navigation clearfix">
        @Html.Partial("_nav")

   @* @if (Sessions.User != null)
    {
        <div class="info-user cf user_title">
                <p class="username">
                    @Sessions.User.FirstName @Sessions.User.LastName
                </p>
                <span class="proflie_pic">
                    <img class="avatar-user img-circle" src="@Url.Action("UserPhoto", "Home")" alt="User avatar" />
                </span>
            </div>*@
            @*<div class="dropdown-info-user" style="display: none;">
            <ul class="drop-down-menu">
                    <li><a href="@Url.Action("Edit", "User")">Preferences</a></li>  @* Modified by Viral Kadiya on 11/04/2014 for PL Ticket #917
                <li><a href="#" id="ContactSupport">Support</a></li>
                <li><a href="@Url.Action("LogOff", "Login")">Sign Out</a></li>
                    
            </ul>
            </div>*@ @*/* Commented for #2219 - Bhumika */
    }*@
</div>

</div>

<script type="text/javascript">
    
    $(document).ready(function () {
        $("#spnAlertCnt").css('display', 'none');
        BindAlertNotificationSummary();
               
        $("#divAlertSummary").click(function (e) {
            var alertType = '@Enums.AlertNotification.Alert.ToString()';
            var alertcnt = $("#spnAlertCnt").html();
            if (alertcnt!=null && parseInt(alertcnt) > 0) {
                $("#spnAlertCnt").html('');
                $("#spnAlertCnt").css('display', 'none');
                
                $.ajax({
                    type: 'POST',
                    async: true,
                    url: '@Url.Action("UpdateAlertNotification", "User")',
                    data: { type: alertType },
                    success: function (data) {
                    }
                });
            }
            else {
                $("#UlAlertsummary").css('display', 'none');
                var url = '@Url.Action("ViewAlertNotification", "User")';
                url = url + "?type=" + alertType;
                window.location = url;
            }


		   });

        $("#divNotificationSummary").click(function (e) {
            var alertType = '@Enums.AlertNotification.Notification.ToString()';
            var Noticnt = $("#spnNotificationCnt").html();
            if (Noticnt != null && parseInt(Noticnt) > 0) {
                $("#spnNotificationCnt").html('');
                $("#spnNotificationCnt").css('display', 'none');

                $.ajax({
                    type: 'POST',
                    async: true,
                    url: '@Url.Action("UpdateAlertNotification", "User")',
                    data: { type: alertType },
                    success: function (data) {
                    }
                });
            }
            else {
                $('#ulNotificationlisting').css('display', 'none');
                var url = '@Url.Action("ViewAlertNotification", "User")';
                url = url + "?type=" + alertType;
                window.location = url;
            }
        });   
    });

    function BindAlertNotificationSummary()
    {
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetAlertNotificationSummary", "User")',
            success: function (data) {
                if (data.Success != null && data.Success == true && data.Alertcount != null) {
                    var cnt = data.Alertcount;
                    if (cnt > 0) {
                        $("#spnAlertCnt").css('display', 'block');

                        $("#spnAlertCnt").html(data.Alertcount);
                        var cList = $('ul.UlAlertList');
                        if (data.Alertsummary != null) {
                            $.each(data.Alertsummary, function (i, item) {

                                $(cList).append('<li style="cursor:pointer" title="' + item.Description + '"><span class="dd-left">' + item.Description + '</span><span class="dd-right">' + item.AlertCreatedDate + '</span></li>');
                            });
                            var url = '@Url.Action("ViewAlertNotification", "User")';
                            url = url + "?type="+'@Enums.AlertNotification.Alert.ToString()'
                            $(cList).append('<li title="All"><a href="' + url + '">See All</a></li>');
                        }
                    }
                    else
                    {
                        $("#spnAlertCnt").html('');
                        $("#spnAlertCnt").css('display', 'none');
                        $("#UlAlertsummary").css('display', 'none');
                    }
                   
                   
                }
                if (data.Success != null && data.Success == true && data.NotificationsData != 'undefined' && data.NotificationsData != null && data.NotificationsData.length > 0) {
                    var htmlstring = "";            // Contains html for promotion tactics
                    var htmlstringForRequests = "";
                    var cnt = data.Noticount;
                    if (cnt > 0) {
                        $("#spnNotificationCnt").css('display', 'block');
                        $("#spnNotificationCnt").html(data.Noticount);
                        var url = '@Url.Action("ViewAlertNotification", "User")';
                        url = url + "?type=" + '@Enums.AlertNotification.Notification.ToString()'
                        $.each(data.NotificationsData, function (i, Item) {
                            if (Item.ActionName == '@Enums.TacticStatusValues[Enums.TacticStatus.Submitted.ToString()].ToString().ToLower()') {
                                if (Item.RequestCount == '1') {
                                    htmlstringForRequests += '<li style="cursor:pointer" id="Request" PlanId= "' + Item.ComponentId + '" onclick="RequestItemClick(this)" title="You have ' + Item.RequestCount + ' new approval request for plan ' + Item.PlanTitle + '"><span class="dd-left">You have ' + Item.RequestCount + ' new approval request for plan ' + Item.PlanTitle + '</span><span class="dd-right">' + Item.NotificationCreatedDate + '</span></li>';
                                }
                                else {
                                    htmlstringForRequests += '<li style="cursor:pointer" id="Request" PlanId= "' + Item.ComponentId + '" onclick="RequestItemClick(this)" title="You have ' + Item.RequestCount + ' new approval requests for plan ' + Item.PlanTitle + '"><span class="dd-left">You have ' + Item.RequestCount + ' new approval requests for plan ' + Item.PlanTitle + '</span><span class="dd-right">' + Item.NotificationCreatedDate + '</span></li>';
                                }
                            }
                            else {
                                htmlstring += '<li id="Notification" style="cursor:pointer" title="' + Item.Description + '" onclick="RequestItemClick(this)" ><span class="dd-left">' + Item.Description + '</span><span class="dd-right">' + Item.NotificationCreatedDate + '</span></li>';
                            }
                        });
                        $('#ulNotificationlisting').append(htmlstringForRequests + htmlstring);
                        $('#ulNotificationlisting').append('<li  title="All"><a href="' + url + '">See All</a></li>');
                    }
                }
                else {
                    $("#spnNotificationCnt").html('');
                    $("#spnNotificationCnt").css('display', 'none');
                    $("#ulNotificationlisting").css('display', 'none');
                }
            }
        });
    }	
 

    function RequestItemClick(e) {
        var Id = $(e).attr("id");
        var queryStringArr = [];
        if (Id == "Request")
        {
            var PlanId = $(e).attr("PlanId");
            if (PlanId != null) {
               

                queryStringArr.push(
                    {
                        key: 'currentPlanId',
                        Value: PlanId
                    });

                queryStringArr.push(
                 {
                     key: 'IsRequest',
                     Value: "true"
                 });

                formSubmitEvent('@Url.Content("~/Home/Index")', queryStringArr);
            }
        }
        else
        {
            queryStringArr.push(
              {
                  key: 'type',
                  Value: '@Enums.AlertNotification.Notification.ToString()'
              });

            formSubmitEvent('@Url.Action("ViewAlertNotification", "User")', queryStringArr);
        }


    }

</script>
