@model IEnumerable<RevenuePlanner.Models.BoostImprovementTacticModel>
@using RevenuePlanner.Helpers

<script src="@Url.Content("~/Scripts/jquery.validate.js")"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.js")"></script>

@{
    ViewBag.Title = "Improvement Tactics";
    ViewBag.ActiveMenu = RevenuePlanner.Helpers.Enums.ActiveMenu.Boost;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Sidebar {
    <div class="padding-content2">
        <h4 class="text-shadow-black source-sans-prolight">Boost Summary</h4>
    </div>
    <ul class="nav nav-list nav-gray">
        <li class="item active">
            <a class="source-sans-probold inputs tactics"  href="#"><span></span>TACTICS</a>
        </li>
        <li class="item">
            <a class="source-sans-probold organization" href="#" id="aBiclink"><span class="trophy"></span>BEST IN CLASS</a>
        </li>
    </ul>
}
@*@section Sidebar {
    <div class="padding-content2">
        <h4 class="text-shadow-black source-sans-prolight">Boost Summary</h4>
    </div>
    <ul class="nav nav-list nav-gray">
        <li class="item active">
            <a class="source-sans-probold inputs tactics"><span></span>TACTICS</a>
        </li>
        <li class="item">
            <a class="source-sans-probold organization" id="aBiclink"><span class="trophy"></span>BEST IN CLASS</a>
        </li>
    </ul>
}*@

<div id="successMessage" class="alert hide alert-success message-position">
    <a class="close">×</a>
    <div id="cSuccess">@Html.Raw(HttpUtility.HtmlDecode((string)TempData["SuccessMessage"]))</div>
</div>
<div id="errorMessage" class="alert alert-error hide message-position">
    <a class="close">×</a>
    <div id="cError">@Html.Raw(HttpUtility.HtmlDecode((string)TempData["ErrorMessage"]))</div>
</div>
<!--error message-->

<ul class="nav nav-tabs">
    <li class="source-sans-proregular">
        <h2 class="title-header">Improvement Tactics</h2>
    </li>
</ul>
<div class="padding-content padding-top0 cf source-sans-proregular">

    <table id="table_boost" class="table table-striped table-hover boost-table">
        <thead>
            <tr>
                <th class="border-r width340">Tactic Type</th>
                <th class="border-r width452">Improvement Target</th>
                <th class="border-r width65px">Cost</th>
                <th class="width65px">Active</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <button id="create_new_tactic" data-slidepanel="panel" class="btn btn-blue btn-large text-shadow-blue source-sans-proregular pull-left font-size14" type="button">Create New Tactic</button>
</div>


<!--End sidebar-->

<script type="text/javascript">
    var improvementTactics = null;
    $(document).ready(function () {
        $("#aBiclink").click(function () {
            url = '@Url.Content("~/Boost/BestInClass")';
            window.location.href = url;
        });
        LoadTactics();
        if ($('#cError').html() != '') {
            alert($('#cError').html());
            $("#errorMessage").slideDown(1200);
        }
        if ($('#cSuccess').html() != '') {
            $('#cSuccess').html('<strong>Success.</strong> ' + $('#cSuccess').html())
            $("#successMessage").slideDown(1200);
            $("#successMessage").slideUp(3000);
        }
        $("#content_wraper").removeClass("span10 all-height").addClass("span10 padding-top40");
    });
    function LoadTactics() {
        $.ajax({
            type: 'get',
            url: '@Url.Content("~/Boost/ImprovementTacticList")',
            dataType: "json",
            success: function (r) {
                improvementTactics = r;
                fillTacticsTable();
                myApp.hidePleaseWait();
            }
        });
    }
    $("#create_new_tactic").click(function () {
        var id = 0;
        $("#slidepanel").css("display", "block");
        var url = '@Url.Content("~/Boost/DetailImprovementTacticData")';
    $('#slidepanel-container').load(url + '?id=' + id);
    $("#slidepanel").css("right", "0px");
});
$(document).on('click', '#table_boost tbody tr', function (e) {
    var id = $(this).attr("id");
    $("#slidepanel").css("display", "block");
    var url = '@Url.Content("~/Boost/DetailImprovementTacticData")';
        $('#slidepanel-container').load(url + '?id=' + id);
        $("#slidepanel").css("right", "0px");
    });
    //fill tactics table with data from json
    function fillTacticsTable() {
        if (improvementTactics != 'undefined') {
            if (improvementTactics.length) {
                for (i in improvementTactics) {
                    addRowTactic(i, improvementTactics[i].Id, improvementTactics[i].Title, improvementTactics[i].Cost, improvementTactics[i].TargetStage, improvementTactics[i].IsDeployed);
                }
            } else {
                $('#table_boost > tbody').append('<tr><td colspan="8" class="gray">No saved improvement tactics to display.</td></tr>');
            }
        }
    }
    //add row in tactics table
    function addRowTactic(_index, _id, _Title, _Cost, _TargetStage, _IsDeployed) {
        var $table_boost = $('#table_boost > tbody');
        var $html = "";
        $html += '<tr data-slidepanel="panel" id="' + _id + '" data-index="' + _index + '">' +
                  '<td class="border-r">' + _Title + '</td>';
        $html += '<td class="border-r">';
        if (typeof _TargetStage != 'undefined') {
            if (_TargetStage.length > 0) {
                for (i in _TargetStage) {

                    if ((_TargetStage[i].Active) == true) {
                        $html += '<span class="improve-trget active">' + _TargetStage[i].Stages + '</span>';
                    }
                    else {
                        $html += '<span class="improve-trget">' + _TargetStage[i].Stages + '</span>';
                    }
                }
            }
        }
        else {
            $html += '<span class="improve-trget">SUS</span>';
            $html += '<span class="improve-trget">INQ</span>';
            $html += '<span class="improve-trget">AQL</span>';
            $html += '<span class="improve-trget">TAL</span>';
            $html += '<span class="improve-trget">TQL</span>';
            $html += '<span class="improve-trget">SAL</span>';
            $html += '<span class="improve-trget">SQL</span>';
            $html += '<span class="improve-trget">ADS</span>';
        }
        $html += '</td>';
        $html += ' <td class="border-r">$' + _Cost + '</td>';
        if (_IsDeployed != true) {
            $html += '<td><span class="circle-check-icon"></span></td>';
        }
        else {
            $html += '<td><span class="circle-check-icon-blue"></span></td>';
        }
        $html += '</tr>';
        $table_boost.append($html);
    }

</script>

