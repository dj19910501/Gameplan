@model RevenuePlanner.Models.HomePlanModel
@using RevenuePlanner.Helpers
@{
    ViewBag.Title = ViewBag.ActiveMenu;
    string activeMenu = Convert.ToString(ViewBag.ActiveMenu);
    string isViewOnly = ViewBag.IsViewOnly;
    int showInspectForPlanTacticId = ViewBag.ShowInspectForPlanTacticId;
    int showInspectForPlanCampaignId = ViewBag.ShowInspectForPlanCampaignId; // variable added to show campagin popup from email url link click when email sent to user when comapign shared
    int showInspectForPlanProgramId = ViewBag.ShowInspectForPlanProgramId; // variable added to show program popup from email url link click when email sent to user when program shared
    int ShowInspectForPlanLineItemId = ViewBag.ShowInspectForPlanLineItemId; // variable added to show Plan LineItem popup from Finance page when user click on View button of LineItem Grid
    //// Modified By Maninder Singh Wadhva PL Ticket#47
    bool isImprovement = Convert.ToBoolean(ViewBag.IsImprovement);
    int CurrentPlanId = Sessions.PlanId;/*changed by Nirav for plan consistency on 14 apr 2014*/
    string FilterName = Sessions.FilterPresetName;
    bool IsPlanCreateAuthorized = (bool)ViewBag.IsPlanCreateAuthorized;
    bool IsTacticActualsAddEditAuthorized = (bool)ViewBag.IsTacticActualsAddEditAuthorized;
    bool IsPlanEditable = (bool)ViewBag.IsPlanEditable; //Added By Komal Rawal for new homepage UI
    bool IsPlanPublished = (bool)ViewBag.IsPublished;
    var CreatedStatus = Enums.TacticStatusValues[Enums.TacticStatus.Created.ToString()];
    var SubmittedStatus = Enums.TacticStatusValues[Enums.TacticStatus.Submitted.ToString()];
    var ApprovedStatus = Enums.TacticStatusValues[Enums.TacticStatus.Approved.ToString()];
    var InProgressStatus = Enums.TacticStatusValues[Enums.TacticStatus.InProgress.ToString()];
    var CompleteStatus = Enums.TacticStatusValues[Enums.TacticStatus.Complete.ToString()];
    var DeclineStatus = Enums.TacticStatusValues[Enums.TacticStatus.Decline.ToString()];
    var ViewYearList = (List<SelectListItem>)ViewBag.ViewYear;
    var Successmsgduplicate = (string)ViewBag.SuccessMessageDuplicatePlan;
    var errormsgduplicate = (string)ViewBag.ErrorMessageDuplicatePlan;
    var ListBudgetingPlan = Model.objplanhomemodelheader != null ? Model.objplanhomemodelheader.plans : new List<SelectListItem>(); //Added By Komal Rawal for new homepage UI
    var IsGridView = (bool)ViewBag.GridView;
    var IsPlanSelector = (bool)ViewBag.IsPlanSelector;
    var RedirectToRequest = (bool)ViewBag.IsRequest;
    //   var IsSavedPlan = (string)ViewBag.LastSavedPlanIDs;
    var PreviousPlanID = (int)ViewBag.PreviousPlanID;

    var TacticTaskColor = (string)ViewBag.TacticTaskColor;  //Added by Komal Rawal for #2358 show all tactics in package even if they are not filtered
    //Added by Ravindra for  PL Ticket #1411 date 07/07/2015
    string RequestedModule = ViewBag.RedirectType != null ? ViewBag.RedirectType : "";
    var CalledFromBudget = (!string.IsNullOrEmpty(RequestedModule) ? (RequestedModule == Enums.InspectPopupRequestedModules.Budgeting.ToString() ? "Budegting" : "") : "");

    List<RevenuePlanner.Models.CustomFieldsForFilter> customfiledList = Model.lstCustomFields != null ? Model.lstCustomFields : new List<RevenuePlanner.Models.CustomFieldsForFilter>();
    List<RevenuePlanner.Models.CustomFieldsForFilter> customfiledOptionList = Model.lstCustomFieldOptions != null ? Model.lstCustomFieldOptions : new List<RevenuePlanner.Models.CustomFieldsForFilter>();
    List<RevenuePlanner.Models.OwnerModel> ownerList = Model.lstOwner != null ? Model.lstOwner : new List<RevenuePlanner.Models.OwnerModel>();
    List<RevenuePlanner.Models.TacticTypeModel> tacticTypeList = Model.lstTacticType != null ? Model.lstTacticType : new List<RevenuePlanner.Models.TacticTypeModel>();
    List<RevenuePlanner.Models.PlanListModel> planList = Model.lstPlan != null ? Model.lstPlan : new List<RevenuePlanner.Models.PlanListModel>();

    //#2327 boost section loads based on permission - zz
    bool isBoostAuthorized = AuthorizeUserAttribute.IsAuthorized(Enums.ApplicationActivity.BoostImprovementTacticCreateEdit);
}
@Html.Hidden("IsViewOnly")
@Html.Hidden("hdnshowInspectForPlanTacticId", showInspectForPlanTacticId)
@Html.Hidden("hdnshowInspectForPlanCampaignId", showInspectForPlanCampaignId)
@Html.Hidden("hdnshowInspectForPlanProgramId", showInspectForPlanProgramId)
@Html.Hidden("hdnSelectedPlanIds", 0, new { id = "hdnSelectedPlanIds" })
@Html.Hidden("hdnShowInspectForPlanLineItemId", ShowInspectForPlanLineItemId)

<!--Modified By Maninder Singh Wadhva PL Ticket#47-->
@Html.Hidden("hdnIsImprovement", isImprovement)
@Html.Hidden("CurrentPlanId", CurrentPlanId)
@Html.Hidden("IsGridView", IsGridView)
@Html.Hidden("IsPlanSelector", IsPlanSelector)
@Html.Hidden("FilterName", FilterName)
@Html.Hidden("IsTacticActualsAddEditAuthorized", IsTacticActualsAddEditAuthorized)


<link href="@Url.Content("~/Content/css/dhtmlxchart_1.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/css/DHTMLX/dhtmlxtreegrid2_min.css")" rel="stylesheet" type="text/css" />
@*<script type="text/javascript" src="@Url.Content("~/Scripts/dhtmlxchart.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/js/ganttExportapi.js")"></script>*@
<style type="text/css">
    .pull-right > span {
        /*margin-right: -15px !important;*/ /* Commented because it creates global rule for all span and badley affect allover application. Use class hirarchy for this style */
    }

    .dhx_chart {
        color: #000000;
        font-family: 'source_sans_prolight',Arial,"sans-serif";
        font-size: 9px;
    }

    .chkbxfilter {
        float: right; /*#2055 again removed top margin for allignment 21-3-2016 */
        /* #1951 - sidebar design */
    }

    .sbOptions li a {
        color: #333 !important;
    }

    .sbSelector {
        color: #6d6d6d !important;
    }

    #accordion-SelectedFilter .accordion-group {
        margin-bottom: 0 !important;
    }
</style>
@*@if (activeMenu.ToLower() == "plan")*@
@*<script type="text/javascript" src="@Url.Content("~/Scripts/js/bootstrap2-toggle.min.js")"></script>
    <link rel="stylesheet" href="@Url.Content("~/Content/css/bootstrap2-toggle.min.css")">*@

<link href="~/Content/css/jquery.mCustomScrollbar-new.css" rel="stylesheet" />
<script src="~/Scripts/js/jquery.mCustomScrollbar.concat.min-new.js"></script>

@section nlFormContent{
    <link rel="stylesheet" href="@Url.Content("~/Content/css/NaturalLanguageForm/default.css")" type="text/css" />
    <link rel="stylesheet" href="@Url.Content("~/Content/css/NaturalLanguageForm/component.css")" type="text/css" />
    <script type="text/javascript" src="@Url.Content("~/Scripts/js/NaturalLanguageForm/modernizr.custom.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/js/NaturalLanguageForm/nlform.js")"></script>
}

@Html.Hidden("ActiveMenu", activeMenu)
@Html.HiddenFor(m => m.PlanId)

@*
    @section PlanHeader{

        <div class="light-blue-chart cf full-width-header" id="planHeader">
            @Html.Partial("~/Views/Shared/_planheader.cshtml", Model.objplanhomemodelheader)
        </div>
    }*@ @*/* Commented for #2219 - Bhumika */*@

    @section Sidebar{
        <script type="text/javascript">
            var GetLastview = true;
            var pageIsScroll = false;
            var state0 = 0;
            //Added By komal rawal for #1283
            //  var isTacticExist = false;
            function LoadTacticTypelist(data) {
                if (data.TacticTypelist != 'undefined' && data.TacticTypelist != null) {
                    TactictypeCount = data.TacticTypelist.length;
                    if (TactictypeCount > 0) {
                        $("#TacticTypeAllModule").css("display", "block");
                        $("#NoTTFound").hide();
                        $('#ulTacticType li').remove();
                        $.each(data.TacticTypelist, function (i, TactictypeItem) {
                            //Added by Rahul Shah on 28/10/2015 for PL #1438 to checked Dropdown all option on default view
                            //var checked = "";
                            //var checkedclass = "";

                            var checkedclass = "";
                            var checked = "";
                            //if (tacids.indexOf(TactictypeItem.TacticTypeId.toString()) >= 0) {
                            //    checked = "checked"
                            //    checkedclass = "close-list"
                            //}
                            //if (tacids.length == 0 && IsDeselectAllTactics == false) {
                            //    checked = "checked"
                            //    checkedclass = "close-list"
                            //}
                            checked = "checked"
                            checkedclass = "close-list"
                            ////Added by Maitri Gandhi for #1952
                            //if (Array.isArray(tacids) && tacids.length > 0) {
                            //    if (tacids.indexOf(TactictypeItem.TacticTypeId.toString()) >= 0) {
                            //        checked = ""
                            //        checkedclass = ""
                            //    }
                            //}
                            //Modified BY Komal for #2058 tactic not displayed
                            if (filters.tempTacticTypeIds.length > 0) {
                                if (filters.tempTacticTypeIds.indexOf(TactictypeItem.TacticTypeId.toString()) >= 0) {
                                    checked = "";
                                    checkedclass = "";
                                    $('#ulTacticType').append('<li class="accordion-inner ' + checkedclass + '" title="' + TactictypeItem.Title + ' (' + TactictypeItem.Number + ')" id="liTT' + TactictypeItem.TacticTypeId + '"><span class="sidebarliwidth">' + TactictypeItem.Title + " " + '(<span class="font-size14 TacticNumber" Previousvalue= ' + TactictypeItem.Number + '>' + TactictypeItem.Number + '</span>) </span><input type="checkbox" class="chkbxfilter" TacticTypeTitle="' + TactictypeItem.Title + '" onchange="toggleTacticType(this)" id="CbTT' + TactictypeItem.TacticTypeId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                }
                                else {
                                    $('#ulTacticType').append('<li class="accordion-inner ' + checkedclass + '" title="' + TactictypeItem.Title + ' (' + TactictypeItem.Number + ')" id="liTT' + TactictypeItem.TacticTypeId + '"><span class="sidebarliwidth">' + TactictypeItem.Title + " " + '(<span class="font-size14 TacticNumber" Previousvalue= ' + TactictypeItem.Number + '>' + TactictypeItem.Number + '</span>) </span><input type="checkbox" class="chkbxfilter" TacticTypeTitle="' + TactictypeItem.Title + '" onchange="toggleTacticType(this)" id="CbTT' + TactictypeItem.TacticTypeId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                }

                            }
                            else {
                                $('#ulTacticType').append('<li class="accordion-inner ' + checkedclass + '" title="' + TactictypeItem.Title + ' (' + TactictypeItem.Number + ')" id="liTT' + TactictypeItem.TacticTypeId + '"><span class="sidebarliwidth">' + TactictypeItem.Title + " " + '(<span class="font-size14 TacticNumber" Previousvalue= ' + TactictypeItem.Number + '>' + TactictypeItem.Number + '</span>) </span><input type="checkbox" class="chkbxfilter" TacticTypeTitle="' + TactictypeItem.Title + '" onchange="toggleTacticType(this)" id="CbTT' + TactictypeItem.TacticTypeId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                            }

                        });


                        selectedFilters.tacticTypeTitle = [];
                        $("#ulTacticType li input[type=checkbox]:checked").each(function () {

                            //if (selectedFilters.tacticTypeTitle.indexOf($(this).attr('tactictypetitle').toString()) == -1)
                            //{
                            selectedFilters.tacticTypeTitle.push($(this).attr('tactictypetitle').toString());
                            //}
                        });

                        if (selectedFilters.tacticTypeTitle.length == 0) {
                            $('#lstTType').text(FiltersNone);
                        }
                        else if ($("#ulTacticType li").length == selectedFilters.tacticTypeTitle.length) {

                            $('#lstTType').text(FiltersAll);
                        }
                        else {
                            $('#lstTType').text(selectedFilters.tacticTypeTitle.join(", "));
                        }
                        //End
                    }
                    else {
                        $("#TacticTypeAllModule").css("display", "none");
                        $("#NoTTFound").show();
                    }
                }
            }
            var currentRequestforTactics = null;  //Added By Komal Rawal for #1992 to abort previous ajax if any request is called before completion of previou request.
            function GetTacticTypelist(Planids, async, OnPlanChange) {

                var asyncval = false;
                if (async != undefined && async != 'undefined' && async != '' && async != null) {
                    asyncval = async;
                }
                else {
                    asyncval = false;
                }


                //Commented By Maitri Gandhi on 24/2/2016 For #2014
                //var tacids = [];
                //$('#ulTacticType li').each(function () {

                //    if ($(this).hasClass("close-list") == false) {
                //        var id = $(this).attr('id').replace('liTT', '')
                //        var Index = tacids.indexOf(id);
                //        if (Index == -1) {
                //            tacids.push(id);
                //        }
                //    }
                //});
                $('#ulTacticType').html('');

                filters.TacticTypeids = [];

                currentRequestforTactics = $.ajax({
                    beforeSend: function (x) {
                        if (!asyncval) {
                            myApp.showPleaseWait();
                        }
                        //Added By Komal Rawal for #1992 to abort previous ajax if any request is called before completion of previou request.
                        if (currentRequestforTactics != null) {
                            currentRequestforTactics.abort();
                        }
                        //End
                    },
                    type: "GET",
                    cache: false,
                    async: asyncval,
                    url: '@Url.Action("GetTacticTypeListForFilter", "Home")',
                    data: {
                        PlanId: Planids.toString()
                    },
                    dataType: "json",
                    success: function (data) {

                        if (data.returnURL != 'undefined' && data.returnURL == '#') {
                            window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                        }
                        else {
                            if (data.isSuccess == true) {
                                LoadTacticTypelist(data);
                            }
                            else {
                                $("#TacticTypeAllModule").css("display", "none");
                                $("#NoTTFound").show();
                            }
                            TactictypeCount = $("#ulTacticType li").length;
                            checkedTTcount = $("#ulTacticType li input:checkbox:checked").length;
                            $('#tTTcount').text('/' + TactictypeCount);
                            $('#cTTcount').text(checkedTTcount);

                            filters.tempTacticTypeIds = [];
                            //if (GetLastview == true) {
                            //    LastSetofTT();
                            //}

                            async = true;
                            currentRequestforTactics = null; //Added By Komal Rawal for #1992 to abort previous ajax if any request is called before completion of previou request.
                        }
                    }
                });

            }

            //  var TacticDeselectAll = false;
            function BulkTTOperation(selection) {
                GetLastview = false;
                filters.TacticTypeids = [];
                if (selection) {
                    $("#ulTacticType li").each(function (i) {
                        $(this).addClass("close-list");
                        var chkid = $(this).find("input[type=checkbox]").attr("id");
                        $("#" + chkid).attr("checked", "checked");
                        filters.TacticTypeids.push(chkid.replace("CbTT", ""));

                    });

                }
                else {
                    //    TacticDeselectAll = true;
                    $("#ulTacticType li").each(function (i) {
                        $(this).removeClass("close-list");
                        var chkid = $(this).find("input[type=checkbox]").attr("id");
                        $("#" + chkid).removeAttr("checked");
                    });

                }
                checkedTTcount = $("#ulTacticType li input:checkbox:checked").length;
                $('#cTTcount').text(checkedTTcount);
            }

            var SelectedCustomFieldOption;
            function toggleTacticType(obj) {
                GetLastview = false;
                var id = $(obj).attr('id').toString().replace("CbTT", "");
                if ($(obj).is(':checked')) {
                    $("#liTT" + id).addClass("close-list");
                }
                else {
                    $("#liTT" + id).removeClass("close-list");
                }

                filters.TacticTypeids = [];
                $("#ulTacticType li input[type=checkbox]").each(function () {
                    var chkid = $(this).attr("id");
                    if ($(this).is(':checked')) {
                        filters.TacticTypeids.push(chkid.replace("CbTT", ""));
                    }
                });
                checkedTTcount = $("#ulTacticType li input:checkbox:checked").length;
                $('#cTTcount').text(checkedTTcount);


            }

            //End
            // Edited to add PlanYear option.
            var Currenttime = "thisquarter";

            $(document).ready(function () {
                $('#aPlan').addClass('active');
                $('#aMeasure').removeClass('active');
                var isRender;       //// Added by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
                //  $("#nl-form2").hide();
                //Added by Nirav for Custom Dropdown - 388

                var listCheckbox = $("#ulSelectedYear").find("input[type=checkbox]");
                var years = "";
                $.each(listCheckbox, function () {
                    if ($(this).attr("checked")) {
                        years += $(this).attr('yearValue') + ",";
                    }
                });
                years = years.slice(0, -1);
                //Modified By Komal Rawal on 19-02-16 to get time frame range when we log out and come back
                var CheckedSelectedPlans = [];
                $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                    if ($(this).attr('checked') == 'checked') {
                        var chkid = $(this).attr("id");
                        if (chkid != undefined && chkid != 'undefined') {
                            CheckedSelectedPlans.push(chkid);
                        }
                    }
                });

                if (CheckedSelectedPlans.length == 0 || CheckedSelectedPlans == null || activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()')
                {
                    CheckedSelectedPlans = pid
                }
                //End
                $('#DivloadPlan').load('@Url.Action("HomePlan", "Home")' + '?currentPlanId=' + CheckedSelectedPlans + '&fltrYears=' + years, function (response, status, xhr) {
                    if (response == '{"serviceUnavailable":"~/Login/ServiceUnavailable"}') {
                        //// Call function to redirect on service unavailibility.
                        //// Added By: Maninder Singh Wadhva on 11/24/2014.
                        //// Ticket: 942 Exception handeling in Gameplan.
                        window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                    }
                });//activeMenu parameter added

                switch ($('#ActiveMenu').val().toLowerCase()) {
                    case 'home':
                        //$("#DivButtonsHome").show();  //Commented By Maitri Gandhi on 23/2/2016 For #2014
                        $("#DivButtonsPlanSummary").hide();
                        break;
                    case 'plan':
                        //$("#DivButtonsHome").hide(); // Commented By Maitri Gandhi on 23/2/2016 For #2014
                        $("#DivButtonsPlanSummary").show();
                        break;
                }
                $("#modalMainContainer").hide();

                //   if ($('#ActiveMenu').val().toLowerCase() == 'plan') { //// Added by Sohel Pathan on 16/07/2014 for PL ticket #556 to hide "Showstatus" feature on home screen
                //// Start - Added by Sohel on 12/05/2014 for PL #425 to Show status of tactics on Home and Plan screen
                $('.toggleStatus').click(function () {
                    logMixpanelTrack("Show Status Enabled."); // log Show Status event to mixpanel.
                    $(this).hide();
                    $('.toggle-status div').show();
                    showTacticStatus = true;
                    //RefreshCurrentTab();
                    gantt.refreshData();
                    GlobalSearch();

                });

                $('.toggleStatusHide').click(function () {
                    $('.toggleStatus').show();
                    $('.toggle-status div').hide();
                    showTacticStatus = false;
                    //RefreshCurrentTab();
                    gantt.refreshData();
                    GlobalSearch();
                });
                //// End - Added by Sohel on 12/05/2014 for PL #425 to Show status of tactics on Home and Plan screen

                $('.gantt-padding').removeClass('padding-top0');
                $('#DivloadPlan').removeClass('no-bottom-border');
                // }
                // else {
                //      $('.gantt-padding').addClass('padding-top0');
                //     $('#DivloadPlan').addClass('no-bottom-border');
                // }


                // #1780
                // Created funtion to Select or Clear Plan/Campaign/Program/Tactic
                // Added By Ashish Mistry On 27-11-2015

                $(document).on("click", ".honeycombbox-icon-gantt", function (e) {
                    if ($('#IsGridView').val().toLowerCase() == "true") { //Added By Komal Rawal for #2355 on 14-07-16
                        return false;
                    }
                    CloseClick = false;

                    var entityType = $(this).attr('id').toUpperCase().toString();
                    var task_id = $(this).attr('name1');
                    //gantt.open(task_id);
                    switch (entityType) {
                        case 'PLAN':
                            if ($(this).hasClass("honeycombbox-icon-gantt-Active")) {
                                $(this).removeClass("honeycombbox-icon-gantt-Active");
                                var index = ExportSelectedIds.TaskID.indexOf($(this).attr('name1'));
                                if (index >= 0) {
                                    ExportSelectedIds.TaskID.splice(index, 1);
                                    ExportSelectedIds.Title.splice(index, 1);
                                    ExportSelectedIds.OwnerName.splice(index, 1);
                                    ExportSelectedIds.TacticType.splice(index, 1);
                                    ExportSelectedIds.ColorCode.splice(index, 1);
                                    ExportSelectedIds.PlanFlag.splice(index, 1);
                                    ExportSelectedIds.ROITacticType.splice(index, 1);
                                    ExportSelectedIds.CalendarEntityType.splice(index, 1);
                                    ExportSelectedIds.AnchorTacticId.splice(index, 1);
                                }
                                //var innertask = gantt.getChildren(task_id);
                                //gantt.eachTask(function (task) {

                                //    var tId = task.id;

                                //    var index = innertask.indexOf(tId);
                                //    if (index >= 0 || tId == task_id) {
                                //        task.$open = true;
                                //    }
                                //});
                                // gantt.render();
                            }
                            else {
                                logMixpanelTrack("User has added Plan entity to honeycomb list."); // log entity to added to Honeycomb event to mixpanel. Added by Viral regarding PL ticket #2434.
                                $(this).addClass("honeycombbox-icon-gantt-Active");
                                ExportSelectedIds.TaskID.push($(this).attr('name1'));
                                ExportSelectedIds.Title.push($(this).attr('aria-label'));
                                ExportSelectedIds.OwnerName.push($(this).attr('ownername'));
                                ExportSelectedIds.TacticType.push($(this).attr('tactictype'));
                                ExportSelectedIds.ColorCode.push($(this).attr('colorcode'));
                                ExportSelectedIds.PlanFlag.push('Calender');
                                ExportSelectedIds.ROITacticType.push($(this).attr('roitactictype'));
                                ExportSelectedIds.CalendarEntityType.push($(this).attr('id'));
                                ExportSelectedIds.AnchorTacticId.push($(this).attr('anchortacticid'));
                                //var innertask = gantt.getChildren(task_id);
                                //gantt.eachTask(function (task) {

                                //    var tId = task.id;

                                //    var index = innertask.indexOf(tId);
                                //    if (index >= 0 || tId == task_id) {
                                //        task.$open = true;
                                //    }
                                //});
                                // gantt.render();
                            }
                            break;
                        case 'CAMPAIGN':
                            if ($(this).hasClass("honeycombbox-icon-gantt-Active")) {
                                //var innertask = gantt.getChildren($(this).attr('name1'));
                                //gantt.eachTask(function (task) {
                                //    var tId = task.id;

                                //    var index = innertask.indexOf(tId);
                                //    if (index >= 0 || tId == task_id) {
                                //        task.$open = true;
                                //    }
                                //});
                                // gantt.render();
                                $(this).removeClass("honeycombbox-icon-gantt-Active");
                                var index = ExportSelectedIds.TaskID.indexOf($(this).attr('name1'));
                                if (index >= 0) {
                                    ExportSelectedIds.TaskID.splice(index, 1);
                                    ExportSelectedIds.Title.splice(index, 1);
                                    ExportSelectedIds.OwnerName.splice(index, 1);
                                    ExportSelectedIds.TacticType.splice(index, 1);
                                    ExportSelectedIds.ColorCode.splice(index, 1);
                                    ExportSelectedIds.PlanFlag.splice(index, 1);
                                    ExportSelectedIds.ROITacticType.splice(index, 1);
                                    ExportSelectedIds.CalendarEntityType.splice(index, 1);
                                    ExportSelectedIds.AnchorTacticId.splice(index, 1);
                                }

                            }
                            else {
                                logMixpanelTrack("User has added Campaign entity to honeycomb list."); // log entity to added to Honeycomb event to mixpanel. Added by Viral regarding PL ticket #2434.
                                $(this).addClass("honeycombbox-icon-gantt-Active");
                                ExportSelectedIds.TaskID.push($(this).attr('name1'));
                                ExportSelectedIds.Title.push($(this).attr('aria-label'));
                                ExportSelectedIds.OwnerName.push($(this).attr('ownername'));
                                ExportSelectedIds.TacticType.push($(this).attr('tactictype'));
                                ExportSelectedIds.ColorCode.push($(this).attr('colorcode'));
                                ExportSelectedIds.PlanFlag.push('Calender');
                                ExportSelectedIds.ROITacticType.push($(this).attr('roitactictype'));
                                ExportSelectedIds.CalendarEntityType.push($(this).attr('id'));
                                ExportSelectedIds.AnchorTacticId.push($(this).attr('anchortacticid'));
                                //var innertask = gantt.getChildren($(this).attr('name1'));
                                //gantt.eachTask(function (task) {
                                //    var tId = task.id;

                                //    var index = innertask.indexOf(tId);
                                //    if (index >= 0 || tId == task_id) {

                                //        task.$open = true;
                                //    }
                                //});
                                //  gantt.render();
                            }
                            break;
                        case 'PROGRAM':
                            if ($(this).hasClass("honeycombbox-icon-gantt-Active")) {
                                //gantt.open($(this).attr('name1'));

                                //gantt.render();
                                $(this).removeClass("honeycombbox-icon-gantt-Active");
                                var index = ExportSelectedIds.TaskID.indexOf($(this).attr('name1'));
                                if (index >= 0) {
                                    ExportSelectedIds.TaskID.splice(index, 1);
                                    ExportSelectedIds.Title.splice(index, 1);
                                    ExportSelectedIds.OwnerName.splice(index, 1);
                                    ExportSelectedIds.TacticType.splice(index, 1);
                                    ExportSelectedIds.ColorCode.splice(index, 1);
                                    ExportSelectedIds.PlanFlag.splice(index, 1);
                                    ExportSelectedIds.ROITacticType.splice(index, 1);
                                    ExportSelectedIds.CalendarEntityType.splice(index, 1);
                                    ExportSelectedIds.AnchorTacticId.splice(index, 1);
                                }
                            }
                            else {
                                logMixpanelTrack("User has added Program entity to honeycomb list."); // log entity to added to Honeycomb event to mixpanel. Added by Viral regarding PL ticket #2434.
                                $(this).addClass("honeycombbox-icon-gantt-Active");
                                ExportSelectedIds.TaskID.push($(this).attr('name1'));
                                ExportSelectedIds.Title.push($(this).attr('aria-label'));
                                ExportSelectedIds.OwnerName.push($(this).attr('ownername'));
                                ExportSelectedIds.TacticType.push($(this).attr('tactictype'));
                                ExportSelectedIds.ColorCode.push($(this).attr('colorcode'));
                                ExportSelectedIds.PlanFlag.push('Calender');
                                ExportSelectedIds.ROITacticType.push($(this).attr('roitactictype'));
                                ExportSelectedIds.CalendarEntityType.push($(this).attr('id'));
                                ExportSelectedIds.AnchorTacticId.push($(this).attr('anchortacticid'));
                                //gantt.open($(this).attr('name1'));
                            }
                            break;
                        case 'TACTIC':
                            if ($(this).hasClass("honeycombbox-icon-gantt-Active")) {
                                var IsAssetTactic = $(this).attr('roitactictype');
                                var AssetTacId = $(this).attr('anchortacticid');
                                var EntityId = $(this).attr('taskid');
                                if (IsPackageView && PackageAnchorId == EntityId && IsAssetTactic == '@Enums.AssetType.Asset' && AssetTacId == EntityId)
                                {
                                    ShowMessage(true, "@RevenuePlanner.Helpers.Common.objCached.DeselectAssetFromPackage", 3000);
                                    $('html,body').scrollTop(0);
                                    return false;
                                }
                                $(this).removeClass("honeycombbox-icon-gantt-Active");
                                var index = ExportSelectedIds.TaskID.indexOf($(this).attr('name1'));
                                if (index >= 0) {
                                    ExportSelectedIds.TaskID.splice(index, 1);
                                    ExportSelectedIds.Title.splice(index, 1);
                                    ExportSelectedIds.OwnerName.splice(index, 1);
                                    ExportSelectedIds.TacticType.splice(index, 1);
                                    ExportSelectedIds.ColorCode.splice(index, 1);
                                    ExportSelectedIds.PlanFlag.splice(index, 1);
                                    ExportSelectedIds.ROITacticType.splice(index, 1);
                                    ExportSelectedIds.CalendarEntityType.splice(index, 1);
                                    ExportSelectedIds.AnchorTacticId.splice(index, 1);

                                }
                                $(this).addClass("honeycombbox-icon-gantt");
                            }
                            else {
                                logMixpanelTrack("User has added Tactic entity to honeycomb list."); // log entity to added to Honeycomb event to mixpanel. Added by Viral regarding PL ticket #2434.
                                $(this).addClass("honeycombbox-icon-gantt-Active");
                                ExportSelectedIds.TaskID.push($(this).attr('name1'));
                                ExportSelectedIds.Title.push($(this).attr('aria-label'));
                                ExportSelectedIds.OwnerName.push($(this).attr('ownername'));
                                ExportSelectedIds.TacticType.push($(this).attr('tactictype'));
                                ExportSelectedIds.ColorCode.push($(this).attr('colorcode'));
                                ExportSelectedIds.PlanFlag.push('Calender');
                                ExportSelectedIds.ROITacticType.push($(this).attr('roitactictype'));
                                ExportSelectedIds.CalendarEntityType.push($(this).attr('id'));
                                ExportSelectedIds.AnchorTacticId.push($(this).attr('anchortacticid'));
                            }
                            break;
                    }

                    //if ($('.honeycombbox-icon-gantt-Active').length == 0) {
                    //    $(".honeycombbox").hide();
                    //}
                    //else {

                    //    $("#totalEntity").text($('.honeycombbox-icon-gantt-Active').length);
                    //    $(".honeycombbox").show();
                    //}
                    if (ExportSelectedIds.TaskID.length == 0 && task_id != undefined && task_id != 'undefined' && task_id != null) {
                        $(".honeycombbox").hide();
                        // Added by Arpita Soni for Ticket #2354 on 07/11/2016
                        IsPackageView = false;
                    }
                    else {

                        $("#totalEntity").text(ExportSelectedIds.TaskID.length);
                        $(".honeycombbox").show();
                    }
                    //$("#totalEntity").text($('.honeycombbox-icon-gantt-Active').length);
                });

            });

            function onClickPlanTitle() {
                $("#SuccessMsg").css("display", "none");
                $("#spanMsgSuccess").empty();
                var IsSavedPlan = null;


                $('#nl-form2 > div[class="nl-field nl-dd"]').find('li').click(function (e) {
                    //Added by Maitri Gandhi for #2040 on 31/3/2016
                    var cookie = document.cookie;
                    if (cookie.indexOf("gridOpengridbox") > -1) {
                        var cookies = cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            if (cookies[i].indexOf("gridOpengridbox") > -1) {
                                cookies[i] = "gridOpengridbox=plan.1";
                            }
                        }
                        //document.cookie = cookies.join(';');
                        document.cookie = "gridOpengridbox=plan.1";
                    }
                    else {
                        //cookie += "; gridOpen=plan.1";
                        document.cookie = "gridOpengridbox=plan.1";
                    }

                    CurrentPlanId = $(this).attr('value');
                    IsSavedPlan = $("#CurrentPlanId").val();

                    $("#CurrentPlanId").val(CurrentPlanId);
                    SelectedPlanTitle = $(this).text();
                    if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                        //Added by Rahul Shah on 22/01/2016 for PL #1898
                        IsDropdownChange = true;
                        //Added by Rahul Shah for PL #1898

                        if ((IsSavedPlan.indexOf(CurrentPlanId.toString()) <= -1 || IsSavedPlan == null)) {
                            // Modified By Rahul Shah
                            // Desc :: To resolve the #1952 code review points to mismatch customfield selection count on plan change
                            $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                                var id = 0, CheckedCounter = 0;
                                $(this).find("input[type=checkbox]").each(function () {
                                    $(this).parent().addClass("close-list");
                                    $(this).attr("checked", "checked");
                                });
                                //Modified to optimize the code by Maitri Gandhi
                                CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                                id = this.id;
                                if (id != null && id != "" && id.indexOf("-") > -1) {
                                    id = this.id.split("-")[1];
                                    $("#SelectedCustomFilter_" + id).text(CheckedCounter);
                                }
                            });

                            $("#accordion-Year li input:checkbox:checked").each(function () {
                                $(this).removeAttr("checked");
                                $(this).parent().removeClass("close-list");
                            });

                            GetTacticTypelist(CurrentPlanId, false);
                            // Modified By Rahul Shah
                            // Desc :: To resolve the #1952 code review points to mismatch Tactic Type selection count on plan change.
                            $('#ulTacticType li input:checkbox').each(function () {
                                $(this).attr("checked", "checked");
                                $(this).parent().addClass("close-list");
                            });
                            //Modified By Maitri Gandhi on 24/2/2016 For #2014
                            GetOwnerListForFilter(CurrentPlanId, false);
                            $('#ulStatus li input:checkbox').each(function () {
                                $(this).attr("checked", "checked");
                                $(this).parent().addClass("close-list");
                            });
                        }


                        SaveLastSetofViews();
                        UpdateSelectedFilters();
                        if (CurrentPlanId > 0) {
                            if ($('#IsGridView').val().toLowerCase() == "true") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                                //EditPlanHome();
                                var pid = $("#CurrentPlanId").val();

                                var url = '@Url.Content("~/Home/Index?ActiveMenu=")' + '@Enums.ActiveMenu.Plan' + '&currentPlanId=' + pid + '&isGridView=' + "True";
                                window.location.href = url;
                            }
                            else {
                                var url = '@Url.Content("~/Home/Index?ActiveMenu=")' + '@Enums.ActiveMenu.Plan' + '&currentPlanId=' + CurrentPlanId;
                                window.location.href = url;
                            }
                        }

                    }

                });


                if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()' && $('#IsPlanSelector').val().toLowerCase() == "true") {

                    //Added by Rahul Shah for PL #1898


                    IsSavedPlan = '@PreviousPlanID.ToString()';

                    if (IsSavedPlan.indexOf(CurrentPlanId.toString()) <= -1 || IsSavedPlan == null) {

                        // Modified By Rahul Shah
                        // Desc :: To resolve the #1952 code review points to mismatch customfield selection count on plan change
                        $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                            var id = 0, CheckedCounter = 0;
                            $(this).find("input[type=checkbox]").each(function () {
                                $(this).parent().addClass("close-list");
                                $(this).attr("checked", "checked");
                            });
                            //Modified to optimize the code by Maitri Gandhi
                            CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                            id = this.id;
                            if (id != null && id != "" && id.indexOf("-") > -1) {
                                id = this.id.split("-")[1];
                                $("#SelectedCustomFilter_" + id).text(CheckedCounter);
                            }
                        });
                        $("#accordion-Year li input:checkbox:checked").each(function () {
                            $(this).removeAttr("checked");
                            $(this).parent().removeClass("close-list");
                        });

                        GetTacticTypelist(CurrentPlanId, false);
                        // Modified By Rahul Shah
                        // Desc :: To resolve the #1952 code review points to mismatch Tactic Type selection count on plan change.
                        $('#ulTacticType li input:checkbox').each(function () {
                            $(this).attr("checked", "checked");
                            $(this).parent().addClass("close-list");
                        });
                        //Modified By Maitri Gandhi on 24/2/2016 For #2014
                        GetOwnerListForFilter(CurrentPlanId, false);

                        $('#ulStatus li input:checkbox').each(function () {
                            $(this).attr("checked", "checked");
                            $(this).parent().addClass("close-list");
                        });

                    }
                    IsPlanChange = true;
                    SaveLastSetofViews();
                    UpdateSelectedFilters();
                }

            }

            var ids = [];
            var IsDeselectAll = false
            var currentRequest = null;   //Added By Komal Rawal for #1992 to abort previous ajax if any request is called before completion of previou request.
            function GetOwnerListForFilter(Planids, async, OnPlanChange) {
                var asyncval = false;
                if (async != undefined && async != 'undefined' && async != '' && async != null) {
                    asyncval = async;
                }
                else {
                    asyncval = false;
                }
                //Commented By Maitri Gandhi on 24/2/2016 For #2014
                //Modified by komal Rawal to deselect all Owners if there are no plans selected.
                //var SelectedPlanCount = 0;

                //$('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                //    if ($(this).attr('checked') == 'checked') {
                //        SelectedPlanCount++;

                //    }
                //});


                //if (SelectedPlanCount == 0) {
                //    IsDeselectAll = true;
                //}
                //else if (SelectedPlanCount > 1 && filters.OwnerIds != "") {
                //    IsDeselectAll = false;
                //}
                //End

                //Added by Rahul Shah on 06/01/2016 for PL #1854
                //if (IsDeselectAll == true) {
                //    ids = [];
                //}

                //$('#ulSelectedOwner li').each(function () {
                //    if ($(this).hasClass("close-list")) {
                //        var id = $(this).attr('id').replace('liOwner', '')
                //        var Index = ids.indexOf(id);
                //        if (Index == -1) {
                //            ids.push(id);
                //        }
                //    }

                //});
                //if (filters.OwnerIds != "" || OnPlanChange != true || ids != "") {

                //    filters.OwnerIds = [];
                //}
                //End
                $('#ulSelectedOwner').html('');
                filters.OwnerIds = [];

                currentRequest = $.ajax({
                    beforeSend: function (x) {
                        if (!asyncval) {
                            myApp.showPleaseWait();
                        }
                        //Added By Komal Rawal for #1992 to abort previous ajax if any request is called before completion of previou request.
                        if (currentRequest != null) {
                            currentRequest.abort();
                        }
                    },
                    type: "GET",
                    cache: false,
                    async: asyncval,
                    url: '@Url.Action("GetOwnerListForFilter", "Home")',
                    data: {
                        PlanId: Planids.toString(),
                        ViewBy: type,
                        ActiveMenu: $('#ActiveMenu').val()
                    },
                    dataType: "json",
                    success: function (data) {
                        if (data.returnURL != 'undefined' && data.returnURL == '#') {
                            window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                        }
                        else {
                            if (data.isSuccess == true) {
                                var LoggedInOwner = data.LoggedInUser.OwnerId;
                                if (data.AllowedOwner != 'undefined' && data.AllowedOwner != null) {
                                    OwnerCount = data.AllowedOwner.length;
                                    if (OwnerCount > 0) {
                                        var IsOwnerPresent = false;
                                        var checked = "";
                                        var checkedclass = "";
                                        $("#ulOwnerAllModule").css("display", "block");
                                        $("#NoOwnerFound").hide();
                                        $('#ulSelectedOwner li').remove();
                                        $.each(data.AllowedOwner, function (i, OwnerItem) {
                                            //Added by Rahul Shah on 28/10/2015 for PL #1438 to checked Dropdown all option on default view
                                            //checked = "";
                                            //checkedclass = "";

                                            if (OwnerItem.OwnerId == LoggedInOwner) {

                                                IsOwnerPresent = true;
                                                //    //Modified BY komal when logged in owner deselect and change plan it should come deselected
                                                //    if (filters.OwnerIds != "" || OnPlanChange != true || ids.indexOf(OwnerItem.OwnerId) >= 0) {
                                                //        checked = "checked"
                                                //        checkedclass = "close-list"
                                                //    }
                                            }
                                            //Added by Rahul Shah on 06/01/2016 for PL #1854
                                            //if (ids.indexOf(OwnerItem.OwnerId) >= 0) {
                                            checked = "checked"
                                            checkedclass = "close-list"
                                            //}
                                            //Modified BY Komal for #2058 tactic not displayed
                                            if (filters.tempOwnerIds.length > 0) {
                                                if (filters.tempOwnerIds.indexOf(OwnerItem.OwnerId.toString()) >= 0) {
                                                    checked = "";
                                                    checkedclass = "";
                                                    $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + OwnerItem.Title + '" id="liOwner' + OwnerItem.OwnerId + '"><span class="sidebarliwidth">' + OwnerItem.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + OwnerItem.Title + '" onchange="toggleOwner(this)" id="' + OwnerItem.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                                }
                                                else {
                                                    $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + OwnerItem.Title + '" id="liOwner' + OwnerItem.OwnerId + '"><span class="sidebarliwidth">' + OwnerItem.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + OwnerItem.Title + '" onchange="toggleOwner(this)" id="' + OwnerItem.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                                }

                                            }
                                            else {
                                                $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + OwnerItem.Title + '" id="liOwner' + OwnerItem.OwnerId + '"><span class="sidebarliwidth">' + OwnerItem.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + OwnerItem.Title + '" onchange="toggleOwner(this)" id="' + OwnerItem.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                            }

                                            // filters.OwnerIds.push(OwnerItem.OwnerId);
                                        });



                                        //Modified by Nishant to bring the owner name in the list even if they dont own any tactic
                                        if (IsOwnerPresent == false) {

                                            // Modified By Nishant Sheth
                                            // Desc:: To resolve the #1790 observation
                                            //Modified by Komal rawal to check if logged in owner is deselected then dont select.
                                            //f (filters.OwnerIds != "" || OnPlanChange != true || ids.indexOf(LoggedInOwner) >= 0) {
                                            checked = "checked"
                                            checkedclass = "close-list"
                                            // }
                                            //Modified BY Komal for #2058 tactic not displayed
                                            if (filters.tempOwnerIds.indexOf(LoggedInOwner.toString()) >= 0) {
                                                checked = "";
                                                checkedclass = "";
                                                $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + data.LoggedInUser.Title + '" id="liOwner' + data.LoggedInUser.OwnerId + '"><span class="sidebarliwidth">' + data.LoggedInUser.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + data.LoggedInUser.Title + '" onchange="toggleOwner(this)" id="' + data.LoggedInUser.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                            }
                                            else {
                                                $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + data.LoggedInUser.Title + '" id="liOwner' + data.LoggedInUser.OwnerId + '"><span class="sidebarliwidth">' + data.LoggedInUser.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + data.LoggedInUser.Title + '" onchange="toggleOwner(this)" id="' + data.LoggedInUser.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                            }

                                        }

                                        //Added By Komal Rawal for #1984 to resolve issue of owner deselection on plan change.
                                        //var OwnerIds = [];
                                        //$('#ulSelectedOwner li').each(function () {
                                        //    var id = $(this).attr('id').replace('liOwner', '')
                                        //    OwnerIds.push(id);
                                        //});
                                        //var listofindex = [];
                                        //for (i = 0; i < ids.length; i++) {
                                        //    var index = OwnerIds.indexOf(ids[i]);
                                        //    if (!(index >= 0)) {
                                        //        listofindex.push(ids[i]);

                                        //    }
                                        //}
                                        //$.each(listofindex, function (i) {
                                        //    var Index = ids.indexOf(listofindex[i])
                                        //    if (Index >= 0) {
                                        //        ids.splice(Index, 1);
                                        //    }
                                        //});

                                        //End

                                    }
                                    else {
                                        $("#ulOwnerAllModule").css("display", "none");
                                        $("#NoOwnerFound").show();
                                    }
                                }
                                else {
                                    $("#ulOwnerAllModule").css("display", "none");
                                    $("#NoOwnerFound").show();
                                }
                                checkedOwnercount = $("#ulSelectedOwner li input:checkbox:checked").length;
                                TotalOwnercount = $("#ulSelectedOwner li").length;
                                $('#tOwnercount').text('/' + TotalOwnercount);
                                $('#cOwnercount').text(checkedOwnercount);
                            }

                            //Modified BY Komal for #2058 tactic not displayed
                            selectedFilters.ownerName = [];
                            $("#ulSelectedOwner li input[type=checkbox]:checked").each(function () {
                                selectedFilters.ownerName.push($(this).attr('ownertitle').toString());

                            });
                            if (selectedFilters.ownerName.length == 0) {
                                $('#lstOwner').text(FiltersNone);
                            }
                            else if ($("#ulSelectedOwner li").length == selectedFilters.ownerName.length) {
                                $('#lstOwner').text(FiltersAll);
                            }
                            else {
                                $('#lstOwner').text(selectedFilters.ownerName.join(", "));
                            }
                            //if (GetLastview == true)
                            //{
                            //    LastSetofowners();
                            //}
                            filters.tempOwnerIds = [];

                        }
                        async = true;
                        currentRequest = null;
                    }

                });
            }

            function populateNFActivity(items, id) {
                var $dropdown = $("#" + id);
                var $html = '';
                if (items.length > 0) {
                    $.each(items, function (index, time) {

                        if (time.Selected) {
                            $html += '<option value="' + time.Value + '" selected>' + time.Text + '</option>';
                            Currenttime = time.Value;
                        } else {
                            $html += '<option value="' + time.Value + '">' + time.Text + '</option>';
                        }
                    });
                }
                $dropdown.append($html);
            }

            function populateNF(items, id) {
                var $dropdown = $("#" + id);
                var $html = '';
                if (items.length > 0) {
                    $.each(items, function (index, plan) {
                        if (plan.Selected) {
                            SelectedPlanTitle = plan.Text;
                            $html += '<option value="' + plan.Value + '" selected>' + plan.Text + '</option>';
                            CurrentPlanId = plan.Value;
                            $("#CurrentPlanId").val(CurrentPlanId);
                        } else {
                            $html += '<option value="' + plan.Value + '">' + plan.Text + '</option>';
                        }
                    });
                } else {
                    $html += '<option value=' + 0 + ' selected>' + "Plan Title" + '</option>';
                    CurrentPlanId = 0;
                    $("#CurrentPlanId").val(CurrentPlanId);
                }
                $dropdown.append($html);
            }


        </script>

        <!--success message-->
        <div class="save-filter">
            <!--error message-->
            <div id="errorMessageMainSidebar" class="alert hide alert-error">
                <a class="close">×</a>
                <strong></strong><span id="spanErrorMessageRole"></span>
            </div>

            <!--error message-->
            <div id="successMessageLoadPreset" class="alert hide alert-success">
                <a class="close">×</a>
                <div id="cSuccess"><span id="spanSuccessMessageRole"></span></div>
            </div>
            <div id="content_SaveFilters" class="sidebar-preset scroll-section" style="display:none">

                <h2>Save As Preset</h2>
                <label for="Preset">Please enter a name for preset</label>
                <input type="text" id="txtPresetName" />
                <input type="button" class="btn btn-blue text-shadow-blue source-sans-proregular" title="Proceed" value="Proceed" id="btnSaveProceed" onclick="javascript: SavePreset()" />
                <input type="button" class="btn btn-link" title="Cancel" value="Cancel" id="btnSaveCancel" onclick="javascript: CancelSavePreset()" />
            </div>
            <div id="DefaultFilters" style="display:none"></div>
        </div>
        <div id="PlanModulesSection" class="plan-mod-section sidebar-main">
            <div class="padding-content padding-bottom0 sidebar-toogle-wrapper">
                <div class="sidebar-toogle">
                    <a href="#"><<&nbsp;<span>hide</span></a>
                </div>
            </div>
            @*Commented by Maitri Gandhi on 20/2/2016 For #2014*@
            <!--<div class="padding-content padding-bottom0 hide sidebar-toogle-wrapper" id="DivButtonsHome">

                <h4 class="text-shadow-black source-sans-prolight">Actions</h4>
                <div class="wraper-btns cf">

                    @*<div id="divAddPlan">
                        <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" onclick="window.location.href='@Url.Action("CreatePlan", "Plan")'" style="min-width:90%">Create New Plan</button>
                        </div>*@

                    <div >
                        <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" onclick="EditPlanHome()" style="min-width: 90%">Edit Plan</button>
                    </div>
                    <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" style="min-width:90%" id="btnHomeReport" onclick='CallPDF()'>
                        Export to .pdf
                    </button>
                </div>
            </div>-->

            <div class="padding-content padding-bottom0 hide sidebar-toogle-wrapper" id="DivButtonsPlanSummary">

                <h4 class="text-shadow-black source-sans-prolight">Actions</h4>
                <div class="wraper-btns cf">

                    <div>
                        @if (IsPlanEditable && !IsPlanPublished)
                        {
                            <button id="BtnPublishPlan" class="btn btn-blue text-shadow-blue source-sans-proregular publish-plan-btn" type="button" style="min-width: 90%">
                                Publish Plan
                            </button>
                        }
                        <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" onclick="AddActuals()" style="min-width:90%">
                            Add Actuals
                        </button>
                        @if (IsPlanEditable)
                        {
                            <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" onclick="EditPlan()" style="min-width: 90%">
                                Edit Plan Definition
                            </button>
                        }
                        @*Modified by Komal Rawal for 2013 Home/Plan Layout changes*@
                            @*<button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" onclick="CallBudget()" style="min-width:90%">
                                Edit Plan Budget & Cost
                                </button>
                                <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" style="min-width:90%" id="btnPlanReport" onclick='CallPDF()'>
                                Export to .pdf
                                </button>*@
                        </div>
                    </div>
                </div>

            </div>
            @*<input value="Export to PDF" type="button" onclick='CallPDF()'>*@
            <div id="testdiv" style="display:none;">
                <div style="display:block;width:100%;margin:0 auto;">
                    <div style="width: 100%; background-color: rgb(36, 133, 186); color: rgb(255, 255, 255); font-size: 16px;">
                        <div style="padding: 20px 14px; height: 23px;">
                            <div style="float: left;  margin-top: -5px;font-size:19px">
                                Hive9™
                            </div>
                            <div style="float: right; height: 31px;margin-top: -4px;">
                                @*  <img src="@Url.Content("~/Content/images/game-plan-logo.png")" style="height: 100%; width: auto;">*@
                                <img id="imglogopdf" src="" style="height: 100%; width: auto;">
                            </div>
                        </div>
                    </div>
                    <div style="background-color:#fff;padding: 20px 14px;" id="filterdiv">
                        <h2 style="color: #040707; margin: 0 0 7px;">Marketing Calendar</h2>
                    </div>
                    <div id="mainpdfdiv" style="padding:4px;margin-left: 8px;">
                        @*<div style="border:1px solid #E7E8E8;width:22.3% ;margin-right:2.5%;text-align: center;background:url('@Url.Content(" ~ />Content/images/bullhorn-bg.png")') no-repeat bottom right;display: inline-block;height:100px;vertical-align:top;    border-radius: 4px;">*@
                        <div id="mqlmaindiv" style="border:2px solid #E7E8E8;width:22.3%;margin-right:2.5%;text-align: center;display: inline-block;height:100px;vertical-align:top;    border-radius: 5px;">
                            <span style="color:#918E89;font-size:15px;  font-weight: 600;" id="mqllabeltest">
                                Projected MQLs
                            </span>
                            <p style="margin-top:20px;word-break:break-all">
                                <span style="font-size: 30px; color: rgb(123, 122, 124);" id="mqlspanvalue">270</span>
                            </p>
                            <p style="font-size: 13px; margin: -15px 0px 0px; font-weight: 600;word-break: break-all;" id="mqlspanpercentage">+8.0%</p>
                            <p></p>
                        </div>
                        <div id="budgetmaindiv" style="border:2px solid #E7E8E8;width:22.3%;margin-right:2.5%;text-align: center;display: inline-block;height:100px;vertical-align:top;   border-radius: 5px; ">
                            <span style="color:#918E89;font-size:15px;  font-weight: 600;" id="budgetlabeltest">
                                Budget
                            </span>
                            <p style="margin-top:20px;word-break:break-all">
                                <span style="font-size: 30px; color: rgb(123, 122, 124);" id="budgetspanvalue">$800,000</span>
                            </p>
                            <p></p>
                        </div>
                        <div style="border:2px solid #E7E8E8;width:22.3%;margin-right:2.5%;text-align: center;display: inline-block;height:100px;vertical-align:top;   border-radius: 5px;">
                            <span style="color:#918E89;font-size:15px;  font-weight: 600;">
                                Tactics
                            </span>
                            <p style="margin-top:20px;word-break:break-all">
                                <span style="font-size: 30px; color: rgb(123, 122, 124);" id="ptacticcounttest">36</span>
                            </p>

                            <p></p>
                        </div>
                        <div style="display:none; border:2px solid #E7E8E8;width:22.3%;margin-right:2.5%;text-align: center;display: inline-block;height:100px;vertical-align:top;  margin-right: 0;   border-radius: 5px;">
                            <span style="color:#918E89;font-size:15px;  font-weight: 600;">
                                Activity Distribution
                            </span>
                            @*<p style="margin: 13px 4px 0;word-break: break-all;word-break:break-all">
                                </p>*@
                            <div id="chartCanvas" style="width:140px;height:85px;position: absolute;margin-left: 55px;margin-top: -10px;display:none;">
                                <div id="JAN" style="margin-left:3px; margin-top: 69.5px;overflow: hidden;position: absolute;text-align: center;white-space: nowrap;">J</div>
                                <div id="APR" style="margin-left: 35px; margin-top: 69.5px;overflow: hidden;position: absolute;text-align: center;white-space: nowrap;">A</div>
                                <div id="JUL" style="margin-left: 69px; margin-top: 69.5px;overflow: hidden;position: absolute;text-align: center;white-space: nowrap;">J</div>
                                <div id="OCT" style="margin-left: 101px; margin-top: 69.5px;overflow: hidden;position: absolute;text-align: center;white-space: nowrap;">O</div>
                                <div id="DEC" style="margin-left: 123px; margin-top: 69.5px;overflow: hidden;position: absolute;text-align: center;white-space: nowrap;">D</div>
                                <div id="border" style="border: 1px solid; width: 100%; float: left; margin-top: 63px;margin-left:-5px;"></div>
                            </div>
                            <div id="AttachChartCanvas" style="width:140px;height:85px;position: absolute;margin-left: 55px;margin-top: -10px;">
                            </div>
                            <div id="chartCanvasmultiyear" style="width: 270px; height: 85px; position: absolute; margin-left: 66px; margin-top: -10px; display: none;">
                                <div id="Q1" style="margin-left: 3px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q1</div>
                                <div id="Q2" style="margin-left: 17px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q2</div>
                                <div id="Q3" style="margin-left: 32px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q3</div>
                                <div id="Q4" style="margin-left: 47px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q4</div>
                                <div id="Q5" style="margin-left: 64px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q1</div>
                                <div id="Q6" style="margin-left: 79px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q2</div>
                                <div id="Q7" style="margin-left: 94px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q3</div>
                                <div id="Q8" style="margin-left: 109px; margin-top: 69.5px; overflow: hidden; position: absolute; text-align: center; white-space: nowrap; font-size: 10px">Q4</div>
                                <div id="bordermultiyear" style="border: 1px solid; width: 100%; float: left; margin-top: 63px; margin-left: -5px;"></div>
                            </div>
                            <div id="AttachChartCanvasmultiyear" style="width: 135px; height: 85px; position: absolute; margin-left: 155px; margin-top: -10px;">
                            </div>

                            <div id="legendchart" style="display: block; position: absolute; margin-top: -228px;margin-left: 495px;">
                                <div style="position: absolute; right: 42px; font-size: 10px; top:231px">
                                    <span id="firstyear"></span><div style="display: inline-block; margin-left: -2px;margin-top:4px; height: 10px; width: 25px; border-radius: 10px 10px 0 0; -moz-border-radius: 10px 10px 0 0; -webkit-border-radius: 10px 10px 0 0; background: #C633C9; -ms-transform: rotate(-90deg); -webkit-transform: rotate(-90deg); transform: rotate(-90deg);"></div>
                                </div>
                                <div style="position: absolute; right: 42px; font-size: 10px; top: 260px;">
                                    <span id="secondyear"></span><div style="display: inline-block; margin-left: -2px;margin-top:6px; height: 10px; width: 25px; border-radius: 10px 10px 0 0; -moz-border-radius: 10px 10px 0 0; -webkit-border-radius: 10px 10px 0 0; background: #407B22; -ms-transform: rotate(-90deg); -webkit-transform: rotate(-90deg); transform: rotate(-90deg);"></div>
                                </div>
                            </div>
                        </div>
                        @*<div style="display:none; border:2px solid #E7E8E8;width:22.3%;margin-right:2.5%;text-align: center;display: inline-block;height:100px;vertical-align:top;  margin-right: 0;   border-radius: 5px;">
                            <span style="color:#918E89;font-size:15px;  font-weight: 600;">
                                Tactic Distribution
                            </span>
                                    <p style="  margin: 13px 4px 0;word-break: break-all;;word-break:break-all">
                                        <img style="width:100%" src="images/graph-chart-small.jpg">
                                    </p>

                                    <p></p>
                                </div>*@
                    </div>
                    <br />
                </div>
            </div>
            <!-- Sidebar Block Starts -->
            <div id="Filtersidebar" class="span2 sidebar">
                @*Commented By Maitri Gandhi on 23/2/2016 For #2014*@
                @*<div class="WelcomeMessageBorder"></div>
                    <div class="padding-content padding-bottom0 sidebar-toogle-wrapper update-btn">
                        <div class="wraper-btns cf">
                            <button class="btn btn-blue text-shadow-blue source-sans-proregular squares-icon" style="min-width: 90%" type="button" id="UpdateResult" onclick="UpdateResult()">
                                Update Results
                            </button>
                        </div>
                    </div>*@
                <!--success message-->
                <div class="error-msg-filter">
                    <div id="successMessageSidebar" class="alert hide alert-success">
                        <a class="close">×</a>
                        <div id="cSuccess"><span id="spanSuccessMessageRole"></span></div>
                    </div>
                    <!--error message-->

                </div>
                <!--error message-->
                <div class="sidebar-section scroll-section">
                    <div class="float-left filter-preset">
                        <div class="width50 float-left filter-title ">
                            <span class="filter-header">@Enums.FilterLabel.Filters.ToString()</span> @*Edited By Maitri Gandhi on 23/2/2016 For #2014*@
                        </div>
                        <div class="dropdown" style="float:right;">
                            <button id="dropdownMenu1" class="btn btn-default dropdown-toggle" aria-expanded="true" data-toggle="dropdown" type="button">
                                <i class="fa fa-bars"></i>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" role="menu">
                                <li onclick="SaveAsPreset()" role="presentation">
                                    <a id="saveaslink" tabindex="-1" role="menuitem">Save Current Filters</a>
                                </li>
                                @*Modified by Maitri Gandhi on 1/3/2016 to resolve the scenario of more than one plan in saved preset*@
                                @if (activeMenu.ToLower() == Enums.ActiveMenu.Home.ToString().ToLower())
                                {
                                    <li onclick="LoadPreset()" role="presentation">
                                        <a tabindex="-1" role="menuitem">Load Saved Filters</a>
                                    </li>
                                }
                                <li onclick="ClearAllPreset()" role="presentation">
                                    <a tabindex="-1" role="menuitem">Clear All</a>
                                </li>
                            </ul>
                        </div>
                        @*<div class="width50 float-left filter-btn">
                                    <button class="btn btn-blue text-shadow-blue source-sans-proregular squares-icon" type="button" id="UpdateResult" onclick="UpdateResult()">
                                        Update Results
                                    </button>
                            </div>*@
                    </div>
                    @* Modified By Maitri Gandhi on 23/2/2016 For #2014 *@


                    <div style="clear: both;"></div>
                    @if (activeMenu.ToLower() == Enums.ActiveMenu.Home.ToString().ToLower())
                    {
                        <div id="accordion-SelectedPlanFilter" class="dropdown-section accordion">
                            <div class="accordion-group">
                                <div class="accordion-heading">
                                    <h2 id="PlanFilterHeader" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-SelectedPlanFilter" href="#accordion-element-SelectedPlanFilter">@Enums.FilterLabel.Active_Plans.ToString().Replace("_", " ")<i class="indicator fa fa-angle-up pull-right"></i>@*<i class="indicator glyphicon glyphicon-chevron-up pull-right"></i> tkt#1951 *@</h2>
                                </div>
                                <div id="accordion-element-SelectedPlanFilter" class="accordion-body in collapse">
                                    <ul class="scroll-list singleselect" id="ulSelectedPlanFilter">
                                        @{
                        List<string> SelectedYearText = new List<string>();
                        List<string> SelectedPlanTitle = new List<string>();
                                        }
                                        @if (activeMenu.ToLower() == Enums.ActiveMenu.Home.ToString().ToLower())
                                        {

                                            <li class="accordion-inner" title="Year">
                                                <span class="sidebarliwidthSelected-left">Year - </span>
                                                @{
                                            foreach (SelectListItem item in ViewYearList)
                                            {
                                                if (item.Selected == true)
                                                {
                                                    SelectedYearText.Add(item.Text);
                                                }
                                            }
                                            if (ViewYearList.Count == SelectedYearText.Count())
                                            {
                                                SelectedYearText.Clear();
                                                SelectedYearText.Add("All");
                                            }
                                                }
                                                <span id="lstYearActive" class="sidebarliwidthSelected-right">@string.Join(", ", SelectedYearText).ToString()</span>
                                            </li>

                                            <li class="accordion-inner" title="Plan">
                                                <span class="sidebarliwidthSelected-left">Plan -  </span>
                                                @{
                                            foreach (var objplan in planList)
                                            {
                                                if (objplan.Checked == "checked")
                                                {
                                                    SelectedPlanTitle.Add(objplan.Title);
                                                }
                                            }
                                            if (planList.Count == SelectedPlanTitle.Count())
                                            {
                                                SelectedPlanTitle.Clear();
                                                SelectedPlanTitle.Add("All");
                                            }

                                                }
                                                <span id="lstPlanActive" class="sidebarliwidthSelected-right">@string.Join(", ", SelectedPlanTitle).ToString()</span>

                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="padding-content padding-bottom0 sidebar-toogle-wrapper update-btn">
                            <div class="wraper-btns cf">
                                <button class="btn btn-blue text-shadow-blue source-sans-proregular squares-icon" style="min-width: 90%" type="button" id="UpdatePlan" onclick="UpdatePlan()">
                                    @Enums.FilterLabel.Update_Plans.ToString().Replace("_", " ")
                                </button>
                            </div>
                        </div>


                                        //Modified By komal Rawal for 1911 add year filter on home page
                                        <div id="accordion-Year" class="dropdown-section accordion">
                                            <div class="accordion-group">
                                                <div class="accordion-heading">
                                                    <h2 id="aYear" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-Year" href="#accordion-element-Year">Year<i class="indicator fa fa-angle-down pull-right"></i><span id="tYearcount" class="filter-count">/@ViewYearList.Count</span><span id="cYearcount" class="filter-count"></span></h2>
                                                </div>
                                                <div id="accordion-element-Year" class="accordion-body collapse">
                                                    <ul class="scroll-list singleselect" id="ulSelectedYear">
                                                        @{
                                        string ddlYearId, YearText;
                                        ddlYearId = YearText = string.Empty;
                                        foreach (SelectListItem item in ViewYearList)
                                        {
                                            ddlYearId = "liYear" + item.Value;
                                            YearText = item.Text;

                                            if (item.Selected == true)
                                            {

                                                <li class="accordion-inner close-list" title="@YearText" id="@ddlYearId" yearvalue="@item.Value">
                                                    <span class="sidebarliwidth">@YearText</span>
                                                    <input type="checkbox" class="chkbxfilter" checked="checked" id="@ddlYearId" onchange="OnYearChange(this);" yearvalue="@item.Value" autocomplete="off"></input>   @*Modified by komal Rawal for 2319 to avoid maintaing state of checkbox on F5*@
                                                    @*<span class="chkbx-icon"> <input type="checkbox" class="chkbxfilter" checked="checked" id="@ddlYearId" onchange="OnYearChange(this);" yearvalue="@item.Value"></input></span>  @*#1951 - sidebar design  checkbox styling*@
                                                </li>
                                            }
                                            else
                                            {
                                                <li class="accordion-inner" title="@YearText" id="@ddlYearId" yearvalue="@item.Value">
                                                    <span class="sidebarliwidth">@YearText</span>
                                                    <input type="checkbox" class="chkbxfilter" id="@ddlYearId" onchange="OnYearChange(this);" yearvalue="@item.Value" autocomplete="off"></input>
                                                    @*<span class="chkbx-icon"> <input type="checkbox" class="chkbxfilter" id="@ddlYearId" onchange="OnYearChange(this);" yearvalue="@item.Value"></input></span> @*#1951 - sidebar design  checkbox styling*@
                                                </li>
                                            }
                                        }
                                                        }
                                                    </ul>
                                                    @if (ViewYearList == null)
                                                    {
                                                        <div class="list-tab">
                                                            <div id="NoYearFound" class="NoDataFoundFilter">No Year Found</div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                                    //End
                                                    <div id="accordion-2" class="dropdown-section accordion">
                                                        <div class="accordion-group">
                                                            <div class="accordion-heading">
                                                                <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-2" href="#accordion-element-Plan">
                                                                    Plan
                                                                    <i class="indicator fa fa-angle-down pull-right"></i>
                                                                    <span id="tPlancount" class="filter-count"></span><span id="cPlancount" class="filter-count">/@planList.Count()</span>
                                                                </h2>
                                                            </div>
                                                            <div id="accordion-element-Plan" class="accordion-body collapse">
                                                                <ul class="scroll-list" id="ulSelectedPlans">
                                                                    @{
                                                    string liPlanid;
                                                    foreach (var objplan in planList)
                                                    {
                                                        liPlanid = "liPlan" + objplan.PlanId;
                                                        if (objplan.Checked == "checked")
                                                        // if(objplan.PlanId == CurrentPlanId)
                                                        {
                                                            <li class="accordion-inner close-list" title="@objplan.Title" id="@liPlanid">
                                                                <span class="sidebarliwidth">@objplan.Title</span>
                                                                <input type="checkbox" class="chkbxfilter" plantitle="@objplan.Title" onchange="togglePlan(this)" id="@objplan.PlanId" checked="checked" autocomplete="off">
                                                                </input>
                                                                @*<span class="chkbx-icon"></span> #1951 - sidebar design  checkbox styling*@
                                                            </li>
                                                        }
                                                        else
                                                        {
                                                            <li class="accordion-inner" title="@objplan.Title" id="@liPlanid">
                                                                <span class="sidebarliwidth">@objplan.Title</span><input type="checkbox" class="chkbxfilter" plantitle="@objplan.Title" onchange="togglePlan(this)" id="@objplan.PlanId" autocomplete="off"></input>
                                                                @*<span class="chkbx-icon"></span> #1951 - sidebar design  checkbox styling*@
                                                            </li>
                                                        }
                                                    }
                                                                    }

                                                                </ul>
                                                                <div class="list-tab">
                                                                    @if (planList != null && planList.Count > 0)
                                                                    {
                                                                        <ul id="PlanAllModule">
                                                                            <li><a onclick="BulkPlanOperation(true)">select all</a></li>
                                                                            <li>|</li>
                                                                            <li><a onclick="BulkPlanOperation(false)">@*deselect all*@clear</a></li>
                                                                        </ul>
                                                                        <div id="NoPlanFound" class="NoDataFoundFilter" style="display: none;">No Plan Found</div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <ul id="PlanAllModule" style="display: none;">
                                                                            <li><a onclick="BulkPlanOperation(true)">select all</a></li>
                                                                            <li>|</li>
                                                                            <li><a onclick="BulkPlanOperation(false)">@*deselect all*@clear</a></li>
                                                                        </ul>
                                                                        <div id="NoPlanFound" class="NoDataFoundFilter">No Plan Found</div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                    }

                    <div id="accordion-SelectedFilter" class="dropdown-section accordion">
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <h2 id="aYear" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-SelectedFilter" href="#accordion-element-SelectedFilter">@Enums.FilterLabel.Active_Attributes.ToString().Replace("_", " ")<i class="indicator fa fa-angle-up pull-right"></i>@*<i class="indicator glyphicon glyphicon-chevron-up pull-right"></i> tkt#1951 *@</h2>
                            </div>
                            <div id="accordion-element-SelectedFilter" class="accordion-body in collapse">
                                <ul class="scroll-list singleselect" id="ulSelectedFilter">
                                    @* @{
                                            List<string> YearText1 = new List<string>();
                                            List<string> PlanTitle = new List<string>();
                                            List<string> OwnerName = new List<string>();
                                            List<string> StatusTitle = new List<string>();
                                        }
                                        @if (activeMenu.ToLower() == Enums.ActiveMenu.Home.ToString().ToLower())
                                        {

                                            <li class="accordion-inner" title="Year">
                                                <span class="sidebarliwidthSelected-left">Year - </span>
                                                @{
                                            foreach (SelectListItem item in ViewYearList)
                                            {
                                                if (item.Selected == true)
                                                {
                                                    YearText1.Add(item.Text);
                                                }
                                            }
                                            if (ViewYearList.Count == YearText1.Count())
                                            {
                                                YearText1.Clear();
                                                YearText1.Add("All");
                                            }
                                                }
                                                <span id="lstYear" class="sidebarliwidthSelected-right">@string.Join(", ", YearText1).ToString()</span>
                                            </li>

                                            <li class="accordion-inner" title="Plan">
                                                <span class="sidebarliwidthSelected-left">Plan -  </span>
                                                @{
                                            foreach (var objplan in planList)
                                            {
                                                if (objplan.Checked == "checked")
                                                {
                                                    PlanTitle.Add(objplan.Title);
                                                }
                                            }
                                            if (planList.Count == PlanTitle.Count())
                                            {
                                                PlanTitle.Clear();
                                                PlanTitle.Add("All");
                                            }

                                                }
                                                <span id="lstPlan" class="sidebarliwidthSelected-right">@string.Join(", ", PlanTitle).ToString()</span>

                                            </li>
                                        }*@
                                    @{
                                        foreach (var custField in customfiledList)
                                        {
                                            <li class="accordion-inner" title='@custField.Title'>
                                                <div id="CustomFields">
                                                    <span class="sidebarliwidthSelected-left">@custField.Title - </span>
                                                    <span id="lstCustomFieldSelected_@custField.CustomFieldId" class="sidebarliwidthSelected-right">All</span>
                                                </div>
                                            </li>
                                        }
                                    }

                                    <li class="accordion-inner" title="Owner">
                                        <span class="sidebarliwidthSelected-left">Owner - </span>
                                        <span id="lstOwner" class="sidebarliwidthSelected-right"></span>

                                    </li>

                                    <li class="accordion-inner" title="TacticType">
                                        <span class="sidebarliwidthSelected-left">Tactic Type - </span>
                                        <span id="lstTType" class="sidebarliwidthSelected-right"></span>
                                    </li>
                                    <li class="accordion-inner" title="Status">
                                        <span class="sidebarliwidthSelected-left">Status - </span>
                                        <span id="lstStatus" class="sidebarliwidthSelected-right"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="padding-content padding-bottom0 sidebar-toogle-wrapper update-btn">
                        <div class="wraper-btns cf">
                            <button class="btn btn-blue text-shadow-blue source-sans-proregular squares-icon" style="min-width: 90%" type="button" id="ApplyFilters" onclick="ApplyFilters()">
                                @Enums.FilterLabel.Update_Attributes.ToString().Replace("_", " ")
                            </button>
                        </div>
                    </div>
                    <div id="divCustomFieldsFilter">
                        @{
                            string acordionId, acordionParentId, acordionElementId, acordionElementHref, liCustom, ulCustom, allCustom, noCustom, cutomoptioninputid;
                            acordionId = acordionParentId = acordionElementId = acordionElementHref = liCustom = ulCustom = allCustom = noCustom = string.Empty;
                            List<SelectListItem> lstCutomFieldOptions = new List<SelectListItem>();
                            int custFieldCount = 0;
                            foreach (var custField in customfiledList)
                            {
                                lstCutomFieldOptions = customfiledOptionList.Where(_option => custField.CustomFieldId == _option.CustomFieldId).OrderBy(custfieldoptions => custfieldoptions.Title).ToList().Select(custfieldoptions => new SelectListItem { Text = custfieldoptions.Title, Value = custfieldoptions.CustomFieldOptionId.ToString(), Selected = true }).ToList();
                                acordionId = "accordion-" + custField.CustomFieldId;
                                acordionParentId = "#" + acordionId;
                                acordionElementId = "accordion-element-" + custField.CustomFieldId;
                                acordionElementHref = "#" + acordionElementId;
                                ulCustom = "ulSelected" + custField.CustomFieldId;
                                allCustom = custField.CustomFieldId + "AllModule";
                                noCustom = "No" + custField.CustomFieldId + "Found";

                                <div id="@acordionId" class="dropdown-section accordion">
                                    <div class="accordion-group">
                                        <div class="accordion-heading">
                                            <h2 class="accordion-toggle" data-toggle="collapse" data-parent="@acordionParentId" href="@acordionElementHref"><span class="sidebar_label tipsyclassTitle">@custField.Title</span><i class="indicator fa fa-angle-down pull-right"></i><span class="filter-count"><span id="SelectedCustomFilter_@custField.CustomFieldId">@lstCutomFieldOptions.Count()</span>/@lstCutomFieldOptions.Count()</span></h2>
                                        </div>
                                        <div id="@acordionElementId" class="accordion-body collapse">
                                            <ul class="scroll-list" id="@ulCustom">
                                                @{
                                foreach (SelectListItem item in (System.Collections.IEnumerable)lstCutomFieldOptions)
                                {

                                    liCustom = "li_" + custField.CustomFieldId + "_" + item.Value;
                                    cutomoptioninputid = custField.CustomFieldId + "_" + item.Value;

                                    <li class="accordion-inner" title="@item.Text" id="@liCustom"><span class="sidebarliwidth">@item.Text</span><input type="checkbox" class="chkbxfilter" customfieldtitle="@item.Text" onchange="toggleCustomFields(this,@custField.CustomFieldId,@custFieldCount)" id="@cutomoptioninputid"></input> @*<span class="chkbx-icon"> </span> #1951 - sidebar design  checkbox styling*@</li>
                                }
                                                }
                                            </ul>
                                            <div class="list-tab">
                                                @if (lstCutomFieldOptions != null && lstCutomFieldOptions.Count > 0)
                                                {
                                                    <ul id="@allCustom">
                                                        <li><a onclick="BulkCustomFieldOperation(true, '@custField.CustomFieldId','@lstCutomFieldOptions.Count()')">select all</a></li>
                                                        <li>|</li>
                                                        <li><a onclick="BulkCustomFieldOperation(false, '@custField.CustomFieldId','@lstCutomFieldOptions.Count()')">@*deselect all*@clear</a></li>
                                                    </ul>
                                                }
                                                else
                                                {
                                                    <div id="@noCustom" class="NoDataFoundFilter">No @custField.Title Found</div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                                custFieldCount++;
                            }
                        }
                    </div>
                    <div id="accordion-Owner" class="dropdown-section accordion">
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-Owner" href="#accordion-element-Owner">Owner<i class="indicator fa fa-angle-down pull-right"></i>@*#1951 - sidebar design  checkbox styling*@<span id="tOwnercount" class="filter-count"></span><span id="cOwnercount" class="filter-count"></span></h2>
                            </div>
                            <div id="accordion-element-Owner" class="accordion-body collapse">
                                <ul class="scroll-list" id="ulSelectedOwner">
                                    @{
                                        string liid;
                                        foreach (var owner in ownerList)
                                        {
                                            liid = "liOwner" + owner.OwnerId;
                                            <li class="accordion-inner" title="@owner.Title + '" id="@liid">
                                                <span class="sidebarliwidth">@owner.Title</span>
                                                <input type="checkbox" class="chkbxfilter" ownertitle="@owner.Title" onchange="toggleOwner(this)" id="@owner.OwnerId"></input> @*<span class="chkbx-icon"></span> #1951 - sidebar design  checkbox styling*@
                                            </li>
                                        }
                                    }
                                </ul>
                                <div class="list-tab">
                                    @if (ownerList != null && ownerList.Count > 0)
                                    {
                                        <ul id="ulOwnerAllModule">
                                            <li><a onclick="BulkOwnerOperation(true)">select all</a></li>
                                            <li>|</li>
                                            <li><a onclick="BulkOwnerOperation(false)">@*deselect all*@clear</a></li>
                                        </ul>
                                        <div id="NoOwnerFound" class="NoDataFoundFilter" style="display: none;">No Owner Found</div>
                                    }
                                    else
                                    {
                                        <ul id="ulOwnerAllModule" style="display: none;">
                                            <li><a onclick="BulkOwnerOperation(true)">select all</a></li>
                                            <li>|</li>
                                            <li><a onclick="BulkOwnerOperation(false)">@*deselect all*@clear</a></li>
                                        </ul>
                                        <div id="NoOwnerFound" class="NoDataFoundFilter">No Owner Found</div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="accordion-TacticType" class="dropdown-section accordion">
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-TacticType" href="#accordion-element-TacticType">Tactic Type<i class="indicator fa fa-angle-down pull-right"></i><span id="tTTcount" class="filter-count"></span><span id="cTTcount" class="filter-count"></span></h2>
                            </div>
                            <div id="accordion-element-TacticType" class="accordion-body collapse">
                                <ul class="scroll-list" id="ulTacticType">
                                    @{
                                        string litacticid, titielwithbracket, lastbracket, cbttid;
                                        foreach (var tactictype in tacticTypeList)
                                        {
                                            litacticid = "liTT" + tactictype.TacticTypeId;
                                            titielwithbracket = tactictype.Title + " (";
                                            lastbracket = ")";
                                            cbttid = "CbTT" + tactictype.TacticTypeId;
                                            <li class="accordion-inner" title="@titielwithbracket@tactictype.Number@lastbracket" id="@litacticid">
                                                <span class="sidebarliwidth">@titielwithbracket<span class="font-size14 TacticNumber" previousvalue='@tactictype.Number'>@tactictype.Number</span>@lastbracket </span>
                                                <input type="checkbox" class="chkbxfilter" tactictypetitle="@tactictype.Title" onchange="toggleTacticType(this)" id="@cbttid"></input> @*<span class="chkbx-icon"> </span>#1951 - sidebar design  checkbox styling*@
                                            </li>
                                        }
                                    }



                                </ul>
                                <div class="list-tab">
                                    @if (tacticTypeList != null && tacticTypeList.Count > 0)
                                    {
                                        <ul id="TacticTypeAllModule">
                                            <li><a onclick="BulkTTOperation(true)">select all</a></li>
                                            <li>|</li>
                                            <li><a onclick="BulkTTOperation(false)">@*deselect all*@clear</a></li>
                                        </ul>
                                        <div id="NoTTFound" class="NoDataFoundFilter" style="display: none;">No Tactic Type Found</div>
                                    }
                                    else
                                    {
                                        <ul id="TacticTypeAllModule" style="display: none;">
                                            <li><a onclick="BulkTTOperation(true)">select all</a></li>
                                            <li>|</li>
                                            <li><a onclick="BulkTTOperation(false)">@*deselect all*@clear</a></li>
                                        </ul>
                                        <div id="NoTTFound" class="NoDataFoundFilter">No Tactic Type Found</div>
                                    }


                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="accordion-Status" class="dropdown-section accordion">
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-Status" href="#accordion-element-Status">Status<i class="indicator fa fa-angle-down pull-right"></i><span id="tStatuscount" class="filter-count"></span><span id="cStatuscount" class="filter-count"></span></h2>
                            </div>
                            <div id="accordion-element-Status" class="accordion-body collapse">
                                <ul class="scroll-list" id="ulStatus">
                                    @*//Modified by Rahul Shah on 28/10/2015 for PL #1438 to checked Dropdown all option on default view*@
                                    <li class="accordion-inner " id="liStatusCreated"><span class="sidebarliwidth">@CreatedStatus</span><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@CreatedStatus" /> </li>
                                    <li class="accordion-inner " id="liStatusSubmitted"><span class="sidebarliwidth">@SubmittedStatus</span><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@SubmittedStatus" /></li>
                                    <li class="accordion-inner " id="liStatusApproved"><span class="sidebarliwidth">@ApprovedStatus</span><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@ApprovedStatus" /></li>
                                    <li class="accordion-inner " id="liStatusInProgress"><span class="sidebarliwidth">@InProgressStatus</span><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@InProgressStatus" /></li>
                                    <li class="accordion-inner " id="liStatusComplete"><span class="sidebarliwidth">@CompleteStatus</span><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@CompleteStatus" /></li>
                                    <li class="accordion-inner" id="liStatusDecline"><span class="sidebarliwidth">@DeclineStatus</span><span class="chkbx-icon"><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@DeclineStatus" /></li>

                                    @*#1951 - sidebar design  checkbox styling*@
                                    @*<li class="accordion-inner " id="liStatusCreated"><span class="sidebarliwidth">@CreatedStatus</span><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@CreatedStatus" /> </span> </li>
                                        <li class="accordion-inner " id="liStatusSubmitted"><span class="sidebarliwidth">@SubmittedStatus</span><span class="chkbx-icon"><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@SubmittedStatus" /></span></li>
                                        <li class="accordion-inner " id="liStatusApproved"><span class="sidebarliwidth">@ApprovedStatus</span><span class="chkbx-icon"><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@ApprovedStatus" /></span></li>
                                        <li class="accordion-inner " id="liStatusInProgress"><span class="sidebarliwidth">@InProgressStatus</span><span class="chkbx-icon"><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@InProgressStatus" /></span></li>
                                        <li class="accordion-inner " id="liStatusComplete"><span class="sidebarliwidth">@CompleteStatus</span><span class="chkbx-icon"><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@CompleteStatus" /></span></li>
                                        <li class="accordion-inner" id="liStatusDecline"><span class="sidebarliwidth">@DeclineStatus</span><span class="chkbx-icon"><input type="checkbox" class="chkbxfilter" onchange="toggleStatus(this)" id="@DeclineStatus" /></span></li>*@
                                </ul>
                                <div class="list-tab">
                                    <ul id="StatusAllModule">
                                        <li><a onclick="BulkStatusOperation(true)">select all</a></li>
                                        <li>|</li>
                                        <li><a onclick="BulkStatusOperation(false)">@*deselect all*@clear</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                @if (activeMenu.ToLower() == Enums.ActiveMenu.Home.ToString().ToLower())
                {
            <!--First Static Accordion-->
            <!--Modified By Maninder Singh Wadhva PL Ticket#47-->
                    <div class="accordion colors left-nav margin-bottom10" id="marketing-activities" style="display: none;">

                        <div class="accordion-group source-sans-proregular">
                            <div class="accordion-heading">
                                <a href="#DivAccordionMarketingActivities" data-parent="marketing-activities" data-toggle="collapse" class="accordion-toggle item-741f98 collapsed">
                                    <div class="cf source-sans-prosemibold ">Marketing Activities</div>
                                </a>
                            </div>
                            <div class="scrolled_div" style="position: relative; overflow: hidden; max-height: 230px;">
                                <div class="accordion-body in collapse" id="DivAccordionMarketingActivities">
                                </div>
                            </div>
                        </div>
                    </div>
            <!--First Static Accordion END-->
            <!--Second Static Accordion-->
                    <div class="accordion colors left-nav improvements margin-bottom10" id="improvements" style="display:none">
                        @*// added by dashrath prajapati for pl #1955 H9_QA: Improvement tactics label visisble under filters*@
                        <div class="accordion-group source-sans-proregular">
                            <div class="accordion-heading">
                                <a href="#DivAccordionImprovementActivities" data-parent="improvements" data-toggle="collapse" class="accordion-toggle item-741f98 collapsed">
                                    <div class="cf source-sans-prosemibold">Improvements</div>
                                </a>
                            </div>
                            <div class="accordion-body collapse" id="DivAccordionImprovementActivities">
                            </div>
                        </div>
                    </div>
            <!--Second Static Accordion END-->
                }
            </div>
            <!--End sidebar-->
    }

    @*<!--success message-->
        <div id="successMessageDuplicatePlan" class="alert hide alert-success message-position">
            <a class="close">×</a>
            <div id="cSuccessDuplicatePlan">@Html.Raw(HttpUtility.HtmlDecode((string)ViewBag.SuccessMessageDuplicatePlan))</div>
        </div>
        <!--success message-->
        <!--error message-->
        <div id="errorMessageDuplicatePlan" class="alert hide alert-error message-position">
            <a class="close">×</a>
            <div id="cErrorDuplicatePlan">@Html.Raw(HttpUtility.HtmlDecode((string)ViewBag.ErrorMessageDuplicatePlan))</div>
        </div>*@
    <!--error message-->
    @* Start - Added by Sohel Pathan on 11/12/2014 for PL ticket #1021 *@
    <!--error message Inspect Popup-->
    <div id="errorMessageInspectPopup" class="alert hide alert-error message-position">
        <a class="close">×</a>
        <div id="cErrorInspectPopup"></div>
    </div>
    <!--error message Inspect Popup-->
    @* End - Added by Sohel Pathan on 11/12/2014 for PL ticket #1021 *@

    <div id="dvCopyEntity"></div>

    <script>
        var pid = $('#PlanId').val();
        var CurrentPlanId = pid;
        var isDataModified = false; // Added by Sohel Pathan on 13/11/2014 for PL ticket #933.
        var GanttTaskData;// Added By Nishant Sheth #1533 for color bar
    </script>

    @*Commented by Komal Rawal for 2013 Home/Plan Layout changes*@
    @*<div class="calender-view-nav" style="display:none;" id="divcalenderandgridtab">
            <ul class="nav nav-tabs new-margin no-position" id="PlanTab">
                <li class="active pull-left" id="liCalender">
                    <a>CALENDAR VIEW</a>
                </li>
                <li class="pull-left" id="liGrid">
                    <a>GRID VIEW</a>
                </li>
            </ul>
        </div>*@

    @* Planheader is added for design change #2219 - Bhumika *@


    <div class="light-blue-chart cf full-width-header" id="planHeader">
        @*This was added to handle the null case of objplanhomemodelheader to resolve the below issue*@
        @*The model item passed into the dictionary is of type 'RevenuePlanner.Models.HomePlanModel', but this dictionary requires a model item of type 'RevenuePlanner.Models.HomePlanModelHeader'.*@
        @if (Model.objplanhomemodelheader == null)
        {
            Model.objplanhomemodelheader = new RevenuePlanner.Models.HomePlanModelHeader();
            try
            {
                var lstPlanAll = Common.GetPlan();
                List<SelectListItem> planList1 = new List<SelectListItem>();
                if (lstPlanAll.Count > 0)
                {
                    planList1 = lstPlanAll.Select(plan => new SelectListItem() { Text = plan.Title, Value = plan.PlanId.ToString() }).OrderBy(plan => plan.Text).ToList();

                    var objexists = planList1.Where(plan => plan.Value == CurrentPlanId.ToString()).ToList();
                    if (objexists.Count != 0)
                    {
                        planList1.Single(plan => plan.Value.Equals(CurrentPlanId.ToString())).Selected = true;
                    }
                    else
                    {
                        planList1.FirstOrDefault().Selected = true;
                    }

                    //// Set Plan dropdown values
                    if (planList1 != null)
                    {
                        planList1 = planList1.Where(plan => !string.IsNullOrEmpty(plan.Text)).OrderBy(plan => plan.Text, new AlphaNumericComparer()).ToList();
                    }
                }
                Model.objplanhomemodelheader.plans = planList1;
            }
            catch (Exception){}
        }
        @Html.Partial("~/Views/Shared/_planheader.cshtml", Model.objplanhomemodelheader)
    </div>

    @*  #2219 - Bhumika End *@

    <div id="DivloadPlan" class="no-bottom-border margin-top">
    </div>
    <div id="divgridview" class="task-tbl" style="display: none;">
        @*// Add By Nishant Sheth
            // Desc:: #1818 display message with filter*@
        <div id="NodatawithfilterGrid" style="display:none;">
            <span class="pull-left margin_t30 bold " style="margin-left: 20px;">No data exists. Please check the filters or grouping applied.</span>
        </div>
    </div>
    @*Added by Komal Rawal for #1432
        <div id="ImprovementGrid" style="display: none;" class="improvement-grid-wrapper">
        </div>*@
    <div class="market-activity-main">
        <div class="btn-dropdwn" style="display: none; position: absolute; top: 40px; z-index: 11;" id="popupType">
        </div>
    </div>
    <div id="CalenderView" class="tab-content all-height cf" style="padding-right: 18px;">
        @*// Add By Nishant Sheth
            // Desc:: #1818 display message with filter*@
        <div id="NodatawithfilterCalendar" style="display:none;">
            <span class="pull-left margin_t30 bold " style="margin-left: 20px;">No data exists. Please check the filters or grouping applied.</span>
        </div>
        <div class="tab-pane active all-height" id="panel-656352">
            <div class=" pl20 cf">
                <div class="calendar-table-top clearfix">
                    @*div added by Bhumika #2112*@
                    <div id="scroll-Collaborator" class="">
                        @*div added by Bhumika #2112*@
                        <div id="divCollaborator" style="display:none;">
                            <!-- position:relative = added by kapil -->
                        </div>
                    </div>
                    <div id="divCollaboratorCount" style="display:none;" class="xxx">
                        <!-- Added for #2112-->

                    </div>

                    @* Start - Added by Sohel on 12/05/2014 for PL #425 to Show status of tactics on Home and Plan screen *@
                    <div class="pull-right toggle-status source-sans-proregular">
                        <div class="pull-left">
                            @*pull-right Changed by #2015 Bhumika*@
                            <a href="#" class="toggleStatusHide">Hide Status</a>
                            <span class="status-created"><i class="fa fa-circle" aria-hidden="true"></i>Created</span>@*Fontawsome class added by Bhumika #2312 *@
                            <span class="status-submitted"><i class="fa fa-circle" aria-hidden="true"></i>Submitted</span>
                            <span class="status-approved"><i class="fa fa-circle" aria-hidden="true"></i>Approved</span>
                            <span class="status-rejected"><i class="fa fa-circle" aria-hidden="true"></i>Declined</span>
                        </div>
                        <a href="#" class="toggleStatus">Show Status</a>
                        @*<a href="#" onclick='CallPDF()' class="pdfExport"><i class="fa fa-external-link"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>Export.pdf</span></a> //Modified by Komal Rawal for 2013 Home/Plan Layout changes//*@ @*Export link hide and moved at _plandropdown.cshtml for #2312 - Bhumika*@
                    </div>
                </div>
                @* End - Added by Sohel on 12/05/2014 for PL #425 to Show status of tactics on Home and Plan screen *@

                <div class="calendar-gant-table">
                    <div class="gantt-padding market-activity-main  cf lenght-div" style="min-height: 720px;">
                        @*"gantt-padding" class removed by Bhumika to remove 40px-top & 5px-left padding for #2112*@
                        @* Modified by : Sohel Pathan on 29/10/2014 for PL ticket #899 *@

                        <div id="gantt_here"></div>
                        <div id="gantt_honey"></div>
                        @*<div class="btn-dropdwn" style="display: none; position: absolute; top: 40px; z-index: 1;" id="popupType">
                            </div>*@

                    </div>
                    <div class="shadow-scroll-gantt"></div>
                    <div class="table-row">
                        <table id="table_activities" class="table table-striped table-hover bold" style="display:none">
                            <thead>
                                <tr>
                                    <th class="border-r show-modal">Title</th>
                                    <th class="show-modal">@Html.LabelForINQ("INQ")</th>
                                    <th class="show-modal">@Html.LabelForMQL("MQL")</th>
                                    <th class="show-modal">Revenue</th>
                                    <th class="border-r show-modal">Cost</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!--tr elements are add dinamically with javascript-->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="Notabcontent" style="display: none;">
        @if (activeMenu.ToLower() == Enums.ActiveMenu.Home.ToString().ToLower())
        {
            <span class="pull-left bold " style="margin-left: 20px;">No Plan exists.</span> @* Modified by Sohel Pathan on 29/09/2014 for PL ticket #787 *@
        }
        else
        {
            <span class="pull-left margin_t30 bold " style="margin-left: 20px;">No Plan exists.</span> @* Modified by Sohel Pathan on 29/09/2014 for PL ticket #787 *@
        }
    </div>
    @*// Inspect Popup Div
        // Added By Bhavesh
    *@
    <div class="container-fluid all-height" id="modalMainContainer">
        <div class="row-fluid calc-height content-wrapper-main">
            <div class="container-fluid">
                <div class="row-fluid ">
                    <div class="span12">
                        @*<div id="modal-container-186470" class="modal-inspect-review hide fade modal-full-view" role="dialog" aria-labelledby="myModalLabel" aria- hidden="true" style="display: none; position: fixed; overflow: hidden;">*@
                        <div id="modal-container-186470" class="modal-inspect-review hide fade modal-full-view" role="dialog" aria-labelledby="myModalLabel" aria- hidden="true" style="display: none; position: fixed; overflow: hidden;" data-backdrop="static" data-keyboard="false">
                            <div class="partial_wrapper">
                                @* Modified for #1318*@
                                <div id="successMessage" class="alert alert-success messagewidth">
                                    <a class="close">×</a>
                                    <strong>Success.</strong> <span id="spanMessageSuccess"></span>
                                </div>
                                <div id="errorMessage" class="alert alert-error hide messagewidth">
                                    <a class="close">×</a>
                                    <strong>Error!</strong> <span id="spanMessageError">@Common.objCached.ValidateForEmptyField</span>
                                </div>
                                <div id="divPartial" class="partial_wrapper">
                                </div>
                            </div>
                        </div>
                        <div id="divResubmission"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="honeycombbox" style="display:none" id="divhoneycombbox">
        <span id="totalEntity" class="badge">0</span>
        <!-- honeycomb svg -->
        <svg id="honeycomb" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
             viewBox="0 0 100 100" style="enable-background:new 0 0 100 100;" xml:space="preserve">
        <style type="text/css">

</style>
        <g>
        <g>
	                       
        <image style="overflow:visible;opacity:0.25;" width="84" height="84" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAACXBIWXMAAAsSAAALEgHS3X78AAAA
	        GXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB8xJREFUeNrsnQt32kYQhXclAQaD
	        nSZ2mkfdPPr//1KbNnbSJI7jGAzGNqjSOXeSy3T1RGBA0jlzkDEC8enOzO5od7FmMzZb0fuEu/JF
	        lvlcS3/bJUGGCmq4y0A1NA/7Hu3bEucUks1hsq9hr3wL1gxSwPnYD8h8BbYIzBjeLLJ7MnmO4a4c
	        rF3xe1ulQh/wWpG1I+tEtof9Nv6XFyrDjAHewm4im2L/Dv+bKfWGqwJr1wDSB8AWAMbWjawXWT+y
	        fex38ZogR0xlN74HuElk48iuIxthfwK4U7zmjuCuBGywItf2CSQDjOENYAdkfbymQ66fZxO3ngJe
	        DPKKbAi7VoAF7KzqUBBUrEpPgewRvEfKDmEHAN2F25cBegtY1wD5HXapTCCPFdh5VVCDCmFKfGSQ
	        MbgnsKPIHsMekVL7iKMdSk5FkpIkoyni54iUGUO8gJ1H9hV2qcDek1rDh4yhrMo2VNYHsBjg08h+
	        xeMxYB4CZI/cvGhCSktMU4qnQyg1Bvolss+RfcLjOcCO8PpbFV/XrlBLTZ8O3PYQaowBPo/sRWTP
	        FMx9yuytJZpMaU2nO8r417i4R+Qlh7jwn6HY73jdlJpc4TqBCswW4PRxogLyJew5YP5CqhSQPrl3
	        2Ua9hhrg/SXhSEtiAIgcvzkZSuwe4SLclYUaVABzgCsfw/stshM8CsxHSpV+Qs/ILukt3JTyqL3L
	        TbV9QOxTk42B8jmUghosCfMAMGM1voL9DphPoISeI+HYimJ4UrMtpO4tN+G4M9GD7SmgS0ENloR5
	        DJivI3sDoC8AeeBoClmznvqBhmsdPbWOiuNJ51cIalARzLd4fAmYB3hdSxU/Hqqy5eq9BaTerPPL
	        DTUoADNQMVNg/pEB0z4gTNf3sBlmHKXAMG/2D3JeXR8u0lcwWZnHBDPYMJjGUTpspYB0lQXDPKXA
	        ICfMNjLiYyScV4iZLpitB3bxoiEgq107Uw3+1B5VlkLF1bvI2E/RJJKMnubmm75xXsgqCd5S9zRU
	        RZVcQF2u/gTqPEHT6MUWw0yCGhKwOzTyJ6pKNU8rpqQBlbZbD43zp1CkNNqPEmLmtm066YZUwdL1
	        1anjbsDC5md8QBfdRombb/H4DM9LV9IrUHLbVKjGkUjnpFSxW4Jq8gD1yNUHUOYJYL4hV+9TQdhu
	        qTqzEpYuYE+orz8zjoq/n6LOHmV16QmdoBwnru5vsaunlTJ5XxewJ8r1TRZQVucxYqZ0K5+Tq7cK
	        FoO3SaHcbZ0T0BFB1dX+H+6t38xTyeiI6pmDHUhCZXqGj8HgCEx6ST1BLyV+SuVdblscUBLydxSm
	        9tQ2vvOBWbx9w/nDy1JoQEVjASoV7vaOJaG8vcQ+GDBQ8VSnQi3F1BaaS3KT7ZBcvbXDrp5VYeOq
	        v5QmW5SHrFao55D5Yc1cPY/ru5h4SS4v8XOfDtZXw9ZIodbhtTyWoKNF5iVkNgE6oAODGsF05RUR
	        2oCA/q/F46nmEh8oN7K6NXV3l9t3zeINvo4Car2EgsgeDu66DqqhQllswmXP1bnxEg6Uu4PtGsM0
	        Zdh4CUFYW11hFmbjZVRbbAOzGBsvx8HNVoCN1/CpdmuANkAboA3QZmuANkDrBnSls822fEtl46W8
	        OGzAFmfjOQ6YOazuUHOz8dQBer4PDzupK9RCbLRCk0ad1RWqhpk2JOeHQl0HyYgzPcusrgrl4TjC
	        xTVRLGSXF6Ay+0wmmvKBdVUoC20INtdgtTD23uXyU7M4q3doFsfy1AWqHnw7MT/njl6R0GaupGTM
	        4lTpMQG9wt91dPswJ5O5K8sbx9W4JJUuNQdyS2HygFtR56XDa02Sy4cUR0fm53zz7/j7tiZuHyp1
	        jszPaeIyJfzGlVd0T4lH7DLQi5q5vsvVLxTQqckYHxoqmY9xcDxR/wvebOjKbDvq6vfk6rKAgSxa
	        MFbh7wcH1whmhs0395NWr9mlm3k84esGyowXKXgf2Ts8foL737g8NWkWiDzKcD4ZhiLToV3rg9gd
	        iZtzCnmxIj8A5jvsn6PJ5EzQfsaH6BETMkRnF0eV6HD3LbJ/I/s7sr/yqDMNqE2B2iGV6unbdgdg
	        3gBa7Or/AKao88IRP01ehYYJUF2T9/0thqqT0BUS0CnBPMVzQ9UNN0WAusDqVREEaLClStXKvEKM
	        PANI7eqTrBaOnxE/dcBmsAyXVbotUPPAjOPnR7g6J6LELa9CXetzCnTfLC454ZnkWWmbWONkN2eY
	        Eje/qoZ8ai/RL3EiekI+rzzjO5S6SVDDHMr8E49neH6ksnq4rEJdJ6OhWgdYPc3PboiLF4FZuGfo
	        l7zCrqUjuDWQtgSwfUBVSp1ijCTjcvMzPH9VpsLmL3GCAlSvIJvU6zJrhBs6zvWOqmjf0M48dcA8
	        LwuzLFB9ovcO08rNc0K2Yoi8uOCUqkZfkbml0S7Z/INy81K1X78iV+IVEcWS1j/OvWRPyXPh85G7
	        lENS5Rl1J6Xg8ZGy+VKFdL+CLzInl5J71rKcxDQBsI6/y9hcnYN8/phAfgG098rFT9Fov1BF47Uv
        d6m7bPo29NgsVrmbBVkLQtXBn2OWKGQblgxe+tZOVVl2Fxa1ruQ+2arW79ymZdcr/WmL5ocBKr4v
	        1vx0xQq+9Kq3TflxlbX8ak3z8z9bDDTpc5sfqNrg83jwgRf/CTAA07ZHMZMcRAcAAAAASUVORK5C
	        YII=" transform="matrix(1 0 0 1 8 10)">
	                        </image>
        <g>
        <circle class="st0" cx="50" cy="50" r="36" />
	                        </g>
	                </g>
        <g>
        <g>
        <path class="st1" d="M54.7,58.2h-9.5L40.4,50l4.8-8.2h9.5l4.8,8.2L54.7,58.2z M46,56.8h7.8l3.9-6.8l-3.9-6.8H46L42.1,50L46,56.8z
	                                        " />
	                        </g>
        <g>
        <path class="st1" d="M67.8,65.8h-9.5l-4.8-8.2l4.8-8.2h9.5l4.8,8.2L67.8,65.8z M59.1,64.2h7.8l3.9-6.8l-3.9-6.8h-7.8l-3.9,6.8
	                                        L59.1,64.2z" />
	                        </g>
        <g>
        <path class="st1" d="M67.8,50.8h-9.5l-4.8-8.2l4.8-8.2h9.5l4.8,8.2L67.8,50.8z M59.1,49.2h7.8l3.9-6.8l-3.9-6.8h-7.8l-3.9,6.8
	                                        L59.1,49.2z" />
                        </g>
        <g>
        <path class="st1" d="M54.7,43.2h-9.5L40.4,35l4.8-8.2h9.5l4.8,8.2L54.7,43.2z M46,41.8h7.8l3.9-6.8l-3.9-6.8H46L42.1,35L46,41.8z
	                                        " />
	                        </g>
        <g>
        <path class="st1" d="M41.7,65.8h-9.5l-4.8-8.2l4.8-8.2h9.5l4.8,8.2L41.7,65.8z M33.1,64.2h7.8l3.9-6.8l-3.9-6.8h-7.8l-3.9,6.8
	                                        L33.1,64.2z" />
	                        </g>
        <g>
        <path class="st1" d="M41.7,50.8h-9.5l-4.8-8.2l4.8-8.2h9.5l4.8,8.2L41.7,50.8z M33.1,49.2h7.8l3.9-6.8l-3.9-6.8h-7.8l-3.9,6.8
	                                        L33.1,49.2z" />
	                        </g>
        <g>
        <path class="st1" d="M54.7,73.2h-9.5L40.4,65l4.8-8.2h9.5l4.8,8.2L54.7,73.2z M46,71.8h7.8l3.9-6.8l-3.9-6.8H46L42.1,65L46,71.8z
	                                        " />
	                        </g>	                </g>
	        </g>
	        </svg>

        <div class="hidden" id="honeycomb_content">
            <div id="errorMsgHoneyComb" class="alert alert-error hide message-position-small">
                <a class="close">×</a>
                <strong>Unable to package.  </strong><span id="spanMsgErrorHoneyComb"></span>
            </div>
            <div class="hc-controls" id="hc-controlsdiv">
                <div class="dropup pull-left">
                <button class="btn btn-lg dropdown-toggle" type="button" id="exportMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Export"><i class="fa fa-external-link"></i></button>
                    <ul class="dropdown-menu" aria-labelledby="exportMenu1">
                        <li><a href="#" id="ExportPDFVHoneyComb" onclick='CallPdfHoneyComb()'>Export .pdf</a></li>
                        <li><a href="#" id="ExportCSVHoneyComb" style="display:none" onclick="ExportCSVHoneyCombSp()">Export .csv</a></li>
                    </ul>
                </div>
                <!-- Added by Arpita Soni for Ticket #2354 on 07/12/2016 -->
                <div class="dropup pull-left">
                <button class="btn btn-lg dropdown-toggle" type="button" id="packageMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Package"><i class="fa fa-object-group"></i></button>
                    <ul class="dropdown-menu" aria-labelledby="packageMenu">
                        <li><a href="#" id="PackageHoneyComb" onclick='CallPackageHoneyComb()'>Package</a></li>
                        <li><a href="#" id="UnpackageHoneyComb" onclick="CallUnPackageHoneyComb()">Unpackage</a></li>
                    </ul>
                </div>
            <button class="btn btn-lg pull-right" onclick='RemoveAllHoneyCombData();' data-toggle="tooltip" title="Close"><i class="fa fa-close"></i></button>
            </div>

        </div>
    </div>


    <div id="divBackground" class="modal-backdrop fade in" style="display: none; z-index: 2502 !important;"></div>

    <script type="text/javascript">
        var isBoostAuthorized = @(isBoostAuthorized? "true" : "false");
        var IslineItemDelete = false;   //Added By Maitri for #2040 Observation
        var scrollstate = 0;
        var bodyscrollpos = 0;
        var divPartial = "#divPartial";
        var GetLastview = true;
        var InspectSuccMsg = "";
        var SelectedPlanTitle = "";
        var isCalenderView = true;
        //Added By Komal Rawal on 25/2/2016 For #2013
        var GridId = "liGrid";
        var CalendarId = "liCalender";

        var IsPackageView = false;
        var PackageAnchorId = 0;
        var currentPkgIds = [];
        var filters = {
            parentCustomFieldsIds: [],
            customFieldIds: [],
            PlanIDs: [],
            SelectedPlans: [],
            PlanTitles: [],
            OwnerIds: [],
            TacticTypeids: [],
            tempTacticTypeIds: [],
            tempOwnerIds: [],
            StatusIds: [],
            SelectedYears: []

        };

        //Added By Maitri Gandhi for #1952 on 18/2/2016
        var FiltersAll = "All";
        var FiltersNone = "None";

        var selectedFilters = {
            yearIds: [],
            planName: [],
            ownerName: [],
            tacticTypeTitle: [],
            StatusIds: []
        };
        var PdfFilters = {
            customFieldIds: [],
            PlanIDs: [],
            SelectedPlans: [],
            PlanTitles: [],
            OwnerIds: [],
            TacticTypeids: [],
            StatusIds: []
        };


        var ExportSelectedIds = {
            TaskID: [],
            Title: [],
            ColorCode: [],
            OwnerName: [],
            TacticType: [],
            PlanFlag: [],
            CsvId: [],
            ROITacticType: [],
            CalendarEntityType: [],
            DhtmlxRowId: [],
            AnchorTacticId: [],
        };
        var ExportSelectedIdsafterSearch = {
            TaskID: [],
        }

        var AddRemovePackageItems = {
            RemoveId : [],
            AddItemId : [],
        }
        var gridSearchFlag = 0;
        var PlanCount = 0, OwnerCount = 0;
        var isCopyTactic = 0;
        var isEditTactic = 0;
        var isCopyTacticHomeGrid = 0;
        var isEditTacticHomeGrid = 0;
        var inspectCloseFocus = "";
        var TotalStatus = 0;
        var checkedOwnercount = 0;
        var checkedTTcount = 0;
        var checkedStatuscount = 0;
        var checkedPlancount = 0;
        var checkedYearcount = 0;
        var linkItemId = 0;
        checkedYearcount = $('#ulSelectedYear li input:checked').length;
        $('#cYearcount').text(checkedYearcount);
        //Added By Komal Rawal for #1376
        function toggleStatus(obj) {
            GetLastview = false;
            var id = $(obj).attr('id');
            var liID = $(obj).parent().attr('id');
            if ($(obj).is(':checked')) {
                $('#' + liID).addClass("close-list");
            }
            else {
                $('#' + liID).removeClass("close-list");
            }
            filters.StatusIds = [];
            $("#ulStatus li input[type=checkbox]").each(function () {
                var chkid = $(this).attr("id");
                if ($(this).is(':checked')) {
                    filters.StatusIds.push(chkid);
                }
            });
            checkedStatuscount = $("#ulStatus li input:checkbox:checked").length;
            $('#cStatuscount').text(checkedStatuscount);
        }
        // var DeselectAllStatus = false;
        function BulkStatusOperation(selection) {
            GetLastview = false;
            filters.StatusIds = [];
            if (selection) {
                $("#ulStatus li").each(function (i) {
                    $(this).addClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).attr("checked", "checked");
                    filters.StatusIds.push(chkid);
                });
            }
            else {
                //   DeselectAllStatus = true;
                $("#ulStatus li").each(function (i) {
                    $(this).removeClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).removeAttr("checked");
                });
            }
            checkedStatuscount = $("#ulStatus li input:checkbox:checked").length;
            $('#cStatuscount').text(checkedStatuscount);
        }

        TotalStatus = $("#ulStatus li").length;
        $('#tStatuscount').text('/' + TotalStatus);
        $('#cStatuscount').text(checkedStatuscount);
        // $("#liGrid,#liCalender").click(function (){
        //Modified by Komal Rawal for 2013 Home/Plan Layout changes
        function ChangeTabView(TabName) {
            ExportSelectedIds = {
                TaskID: [],
                Title: [],
                ColorCode: [],
                OwnerName: [],
                TacticType: [],
                PlanFlag: [],
                CsvId: [],
                ROITacticType: [],
                CalendarEntityType: [],
                DhtmlxRowId: [],
                AnchorTacticId: [],
            };
            //#1780

            AddRemovePackageItems = {
                RemoveId : [],
                AddItemId : [],
            }

            IsPackageView = false;
            PreventUnPackageClick = true;

            $("#totalEntity").text(0);
            $(".honeycombbox-icon-gantt-Active").removeClass();
            //#1780
            var activeTab = $("#PlanTab li.active a").parent(this).attr('id');
            $('#' + activeTab).removeClass("active");
            $(this).removeClass("pull-left");
            $(this).addClass("active pull-left");
            var ID = CalendarId;
            //   var id = $(this).attr('id');
            if (TabName == "liCalender") {

                $('#IsGridView').val("False");
                $("#CalenderView").show();
                $("#divgridview").hide();
                $("#ImprovementGrid").hide();
                $("#divupcomingact").show();
                $("#liplanrequest").show();
                $('.nav').removeClass('no-bottom-border');
                //$("#btnPlanReport").css("display", "block");
                //modified by Rahul Shah on 22/02/2016 for PL #1905. to set focus after link tactic
                scrollstate = 0;
                GetCollaborators(CurrentPlanId);
                RefreshCurrentTab();

                // 1762
                Currenttime = $('#ddlUpComingActivites').val(); //Modified by Komal Rawal for proper HuD when we change tab
                $('.dropdown-menu').find('a#ExportCSVHoneyComb').css("display", "none");
                $('.dropdown-menu').find('a#ExportPDFVHoneyComb').css("display", "block");

            }
            else {
                ID = GridId;
                $('#btngrid').addClass('request-btn-active');
                $('.new-btn-plan').removeClass('request-btn-active');
                $('.dropdown-menu').find('a#ExportCSVHoneyComb').css("display", "block");
                $('.dropdown-menu').find('a#ExportPDFVHoneyComb').css("display", "none");
                $('#IsGridView').val("True");
                $("#CalenderView").hide();
                $("#divgridview").show();
                if (isBoostAuthorized) $("#ImprovementGrid").show();
                //     $("#btnPlanReport").css("display", "none");
                //Call the function for grid view
                isCopyTactic = 0;
                isEditTactic = 0;
                LoadPlanGrid();
                $("#divupcomingact").hide();
                $("#RequestTab").hide();
                GetHealderData(filters.SelectedPlans, filters.customFieldIds, filters.OwnerIds, filters.TacticTypeids, filters.StatusIds, ID); //Modified by Nishant Sheth for perfomance to make it call only for grid view

            }
            // Add by Nishant Sheth
            // Desc:: To resolve the header data issue
            // Modified By Nishant Sheth Desc header value wrong with plan tab
            // Commented By Nishant Sheth
            // Desc :: For performance issue
            //GetHealderData(filters.SelectedPlans, filters.customFieldIds, filters.OwnerIds, filters.TacticTypeids, filters.StatusIds, $(this).attr('id'));
            GetNumberOfActivityPerMonByPlanIdPer(filters.SelectedPlans, Currenttime, filters.customFieldIds, filters.OwnerIds, filters.TacticTypeids, filters.StatusIds, ID); //Added BY Komal rawal for #1929 proper Hud chart and count
        };

        //End
        //Added by Komal Rawal for new homepage UI to publish plan
        $('#BtnPublishPlan').click(function () {
            publishPlan();
        });

        function publishPlan() {
            var uId = $(window).attr('name');
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/PublishPlan/")',
                data: 'UserId=' + uId,
                success: function (data) {
                    if (data.returnURL != 'undefined' && data.returnURL == '#') {
                        window.location = '@Url.Content("~/Login/Index")';
                    }
                    else {
                        if (data.errorMessage != undefined) {
                            isError = true;
                            ShowMessage(isError, data.errorMessage, 3000);
                            // $('#cErrorDuplicatePlan').html('<strong>Error! </strong>' + data.errorMessage);
                            //$('#errorMsg').slideDown(3000);
                        }
                        else if (data.activeMenu != undefined && data.currentPlanId != undefined) {
                            var url = '@Url.Content("~/Home/Index")';

                            var queryStringArr = [];

                            queryStringArr.push(
                             {
                                 key: 'ActiveMenu',
                                 Value: data.activeMenu
                             });

                            queryStringArr.push(
                             {
                                 key: 'currentPlanId',
                                 Value: data.currentPlanId
                             });

                            formSubmitEvent(url, queryStringArr);
                        }

                        SaveLastSetofViews(); // Added by Komal Rawal to make a draft plan default if we publish that plan as we can show it now on home page if we publish it.
                    }
                }
            });
        }

        //End
        var isFiltered = false;
        var IsUpdate = false;
        var SavePresetValue = false;
        function UpdateResult() {
            IsUpdate = true;
            isRequest = false;
            // added by devanshi for #1431
            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                if ($('#IsGridView').val().toLowerCase() == "true") {

                    var SelectedPlanIds = CurrentPlanId;

                    filters.customFieldIds = [];

                    $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                        if ($(this).attr('checked') == 'checked') {
                            var chkid = $(this).attr("id");
                            if (chkid != undefined && chkid != 'undefined') {
                                filters.customFieldIds.push(chkid);
                            }
                        }
                    });
                    //Added for "Select All" case of #1953 and #1993 By Maitri Gandhi on 16/2/2016
                    var CheckedCounter = 0, AllCounter = 0, id = null, UncheckedCounter = 0;
                    $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                        if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                            AllCounter = $(this).find("input[type=checkbox]").length;
                            CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                            UncheckedCounter = AllCounter - CheckedCounter;
                            if (AllCounter == UncheckedCounter) {
                                var Id = $(this).attr("id");
                                if (Id.indexOf("-") >= 0) {
                                    Id = Id.split('-')[1];
                                    var CustomId = Id + "_null";
                                    filters.customFieldIds.push(CustomId);

                                }
                            }
                            else if (AllCounter == CheckedCounter) {
                                id = this.id;
                                if (id != null && id != "" && id.indexOf("-") > -1) {
                                    id = this.id.split("-")[1];
                                }
                                var i = 0, customfieldid;
                                for (i = 0; i < filters.customFieldIds.length; i++) {
                                    if (filters.customFieldIds[i].indexOf("_") > -1) {
                                        customfieldid = filters.customFieldIds[i].split("_")[0];
                                        if (id == customfieldid) {
                                            filters.customFieldIds.splice(i, 1);
                                            i--;
                                        }
                                    }
                                }
                            }
                        }
                    });        ////End

                    var CustomFieldId = filters.customFieldIds;
                    var OwnerIds = filters.OwnerIds;
                    var TacticTypeids = filters.TacticTypeids;
                    var StatusIds = filters.StatusIds;

                    $("#CalenderView").hide();
                    $("#divgridview").show();
                    if (isBoostAuthorized) $("#ImprovementGrid").show();
                    LoadPlanGrid();
                    //Modified By Komal Rawal for #1447 - to Change the header data according to the filter selected.
                    GetHealderDataPer(SelectedPlanIds, CustomFieldId, OwnerIds, TacticTypeids, StatusIds, GridId);// Modified By Nishant Sheth Desc header value wrong with plan tab
                    GetNumberOfActivityPerMonByPlanIdPer(SelectedPlanIds, Currenttime, CustomFieldId, OwnerIds, TacticTypeids, StatusIds, GridId); //Modified BY Komal rawal for #1929 proper Hud chart and count
                    //End

                    $("#totalEntity").text(ExportSelectedIds.TaskID.length);

                }
                else {
                    UpdateCalenderView();
                }
            }
            else {
                UpdateCalenderView();
            }
            UpdateSelectedFilters();
            if (SavePresetValue == false) {
                SaveLastSetofViews();
            }
            SavePresetValue = false;
        }
        //Added By Maitri Gandhi on 23/2/2016 For #2014
        var isFiltered = false;
        var IsUpdate = false;
        var SavePresetValue = false;
        function UpdatePlan() {
            //Added by Maitri Gandhi for #2040 on 31/3/2016

            var cookie = document.cookie;
            if (cookie.indexOf("gridOpengridbox") > -1) {
                var cookies = cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    if (cookies[i].indexOf("gridOpengridbox") > -1) {
                        cookies[i] = "gridOpengridbox=plan.1";
                    }
                }
                //document.cookie = cookies.join(';');
                document.cookie = "gridOpengridbox=plan.1";
            }
            else {
                //cookie += "; gridOpen=plan.1";
                document.cookie = "gridOpengridbox=plan.1";
            }
            IsUpdate = true;
            isRequest = false;

            //Checked All Filters and Load Owner nd tactic type
            var planids = [];
            $('#ulSelectedPlans').find("input[type=checkbox]:checked").each(function () {
                var chkid = $(this).attr("id");
                if (chkid != undefined && chkid != 'undefined') {
                    planids.push(chkid);
                }
            });
            if (planids.length > 0) {
                $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                    $(this).attr('checked', 'checked');
                    $(this).parent().addClass("close-list");
                });
                $('#accordion-Status').find("input[type=checkbox]").each(function () {
                    $(this).attr('checked', 'checked');
                    $(this).parent().addClass("close-list");
                });
            } else {
                $('#divCustomFieldsFilter').find("input[type=checkbox]:checked").each(function () {
                    $(this).removeAttr('checked');
                    $(this).parent().removeClass("close-list");
                });
                $('#accordion-Status').find("input[type=checkbox]:checked").each(function () {
                    $(this).removeAttr('checked');
                    $(this).parent().removeClass("close-list");
                });
            }
            GetTacticTypelist(planids, false);
            GetOwnerListForFilter(planids, false);
            UpdateSelectedFilters();
            UpdateResult();
        }
        //Added By Maitri Gandhi on 24/2/2016 For #2014
        function ApplyFilters() {
            //Modified to set cache values
            $.ajax({
                url: '@Url.Content("~/Home/GetCacheValue/")',
                async:false,
                data: {
                },
                success: function (result) {
                }
            });
            //End
            UpdateResult();
        }
        ////Added to set filters count and selected filters name : 1952 By Maitri Gandhi
        function UpdateSelectedFilters() {
            //Set Custom Field Filters
            $("#ulSelectedFilter").find("li #CustomFields .sidebarliwidthSelected-right").text("");
            var CheckedCounter = 0, AllCounter = 0, CurrentText = "", id = null;
            $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                CheckedCounter = 0; AllCounter = 0; CurrentText = ""; id = null;
                if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                    AllCounter = $(this).find("input[type=checkbox]").length;
                    CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                    $(this).find("input[type=checkbox]:checked").each(function () {

                        CurrentText = CurrentText + ", " + $($(this).parent()).find("span.sidebarliwidth").text();
                    });
                }
                id = this.id;
                if (id != null && id != "" && id.indexOf("-") > -1) {
                    id = this.id.split("-")[1];
                }
                if (CheckedCounter == AllCounter) {
                    $("#ulSelectedFilter").find("#lstCustomFieldSelected_" + id).text(FiltersAll);
                    $("#SelectedCustomFilter_" + id).text(CheckedCounter);
                }
                else {
                    if (CheckedCounter == 0) {
                        $("#ulSelectedFilter").find("#lstCustomFieldSelected_" + id).text(FiltersNone);
                        $("#SelectedCustomFilter_" + id).text("0");

                    }
                    else {
                        CurrentText = CurrentText.substring(1);
                        $("#ulSelectedFilter").find("#lstCustomFieldSelected_" + id).text(CurrentText);
                        $("#SelectedCustomFilter_" + id).text(CheckedCounter);
                    }
                }
            });


            //Set Static-Default Field Filters
            selectedFilters.StatusIds = [];
            selectedFilters.ownerName = [];
            selectedFilters.tacticTypeTitle = [];
            selectedFilters.yearIds = [];
            selectedFilters.planName = [];

            $("#ulSelectedYear li input[type=checkbox]:checked").each(function () {
                selectedFilters.yearIds.push($(this).attr("yearvalue"));
            });
            if (selectedFilters.yearIds.length == 0) {
                //$('#lstYear').text(FiltersNone);
                $('#lstYearActive').text(FiltersNone);
            }
            else if ($("#ulSelectedYear li").length == selectedFilters.yearIds.length) {
                //$('#lstYear').text(FiltersAll);
                $('#lstYearActive').text(FiltersAll);
            }

            else {
                //$('#lstYear').text(selectedFilters.yearIds.join(", "));
                $('#lstYearActive').text(selectedFilters.yearIds.join(", "));
            }

            $("#ulSelectedPlans li input[type=checkbox]:checked").each(function () {
                selectedFilters.planName.push($(this).parent().attr("title"));
            });

            if (selectedFilters.planName.length == 0) {
                //$('#lstPlan').text(FiltersNone);
                $('#lstPlanActive').text(FiltersNone);
            }
            else if ($("#ulSelectedPlans li").length == selectedFilters.planName.length) {
                //$('#lstPlan').text(FiltersAll);
                $('#lstPlanActive').text(FiltersAll);
            }
            else {
                //$('#lstPlan').text(selectedFilters.planName.join(", "));
                $('#lstPlanActive').text(selectedFilters.planName.join(", "));
            }
            checkedYearcount = selectedFilters.yearIds.length;
            $('#cYearcount').text(checkedYearcount);
            checkedPlancount = selectedFilters.planName.length;
            $('#cPlancount').text(checkedPlancount);
            $('#tPlancount').text("/" + $("#ulSelectedPlans li").length.toString());

            $("#ulStatus li input[type=checkbox]:checked").each(function () {
                selectedFilters.StatusIds.push($(this).attr('id'));
            });
            if (selectedFilters.StatusIds.length == 0) {
                $('#lstStatus').text(FiltersNone);
            }
            else if ($('#ulStatus li').length == selectedFilters.StatusIds.length) {
                $('#lstStatus').text(FiltersAll);
            }
            else {
                $('#lstStatus').text(selectedFilters.StatusIds.join(", "));
            }


            $("#ulSelectedOwner li input[type=checkbox]:checked").each(function () {
                selectedFilters.ownerName.push($(this).attr('ownertitle').toString());

            });
            if (selectedFilters.ownerName.length == 0) {
                $('#lstOwner').text(FiltersNone);
            }
            else if ($("#ulSelectedOwner li").length == selectedFilters.ownerName.length) {
                $('#lstOwner').text(FiltersAll);
            }
            else {
                $('#lstOwner').text(selectedFilters.ownerName.join(", "));
            }
            $("#ulTacticType li input[type=checkbox]:checked").each(function () {

                selectedFilters.tacticTypeTitle.push($(this).attr('tactictypetitle').toString());
            });

            if (selectedFilters.tacticTypeTitle.length == 0) {
                $('#lstTType').text(FiltersNone);
            }
            else if ($("#ulTacticType li").length == selectedFilters.tacticTypeTitle.length) {

                $('#lstTType').text(FiltersAll);
            }
            else {
                $('#lstTType').text(selectedFilters.tacticTypeTitle.join(", "));
            }

            checkedTTcount = selectedFilters.tacticTypeTitle.length;
            $('#cTTcount').text(checkedTTcount);

            checkedOwnercount = selectedFilters.ownerName.length;
            $('#cOwnercount').text(checkedOwnercount);


            checkedStatuscount = selectedFilters.StatusIds.length;
            $('#cStatuscount').text(checkedStatuscount);
        }

        var IsPlanChange = false;
        function SaveLastSetofViews(ViewName) {

            filters.customFieldIds = [];

            filters.TacticTypeids = [];
            filters.StatusIds = [];
            // Add By Dashrath Prajapati
            // Desc :: to owner resolve filter issue after login
            filters.OwnerIds = [];
            filters.parentCustomFieldsIds = [];
            $("#ulSelectedOwner li input:checkbox:checked").map(function () {
                filters.OwnerIds.push($(this).attr("id"));
            });
            // End by Dashrath Prajapati
            $("#ulTacticType li input[type=checkbox]").each(function () {

                var chkid = $(this).attr("id");
                if ($(this).is(':checked')) {
                    filters.TacticTypeids.push(chkid.replace("CbTT", ""));
                }
            });
            $('#divCustomFieldsFilter').children().each(function () {
                filters.parentCustomFieldsIds.push($(this).attr('id').split('-')[1])
            });
            $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.customFieldIds.push(chkid);
                    }
                }
            });
            filters.SelectedPlans = [];
            $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.SelectedPlans.push(chkid);
                    }
                }
            });

            //Commented By Komal Rawal on 17-02-2016 to resolve issue of dropdown change from Edit plan
            //if (filters.SelectedPlans.length == 1) {
            //    CurrentPlanId = filters.SelectedPlans[0].toString();
            //    $("#CurrentPlanId").val(filters.SelectedPlans[0].toString());

            //}
            //End

            $("#ulStatus li input[type=checkbox]").each(function () {
                var chkid = $(this).attr("id");
                if ($(this).is(':checked')) {
                    filters.StatusIds.push(chkid);
                }
            });

            filters.SelectedYears = [];
            var listCheckbox = $("#ulSelectedYear").find("input[type=checkbox]");
            years = "";
            $.each(listCheckbox, function () {
                if ($(this).attr("checked")) {
                    years += $(this).attr('yearValue') + ",";
                }
            });
            years = years.slice(0, -1);
            if (years != null && years != "") {
                filters.SelectedYears.push(years);
            }

            //Add by Nishant For "if all selected then no record inserted for user default view"
            // Modified By Nishant Sheth
            // Desc:: To resolve the #1790 observation
            //var ulStatus = $("#ulStatus li");
            //var ulTacticType = $("#ulTacticType li");
            //if (ulStatus.length == filters.StatusIds.length) {
            //    filters.StatusIds = [];
            //}
            //if (ulTacticType.length == filters.TacticTypeids.length) {
            //    filters.TacticTypeids = [];
            //}
            // End By Nishant Sheth

            //Added By Komal rawal to maintain the owner and tactic on plan change
            //if (IsPlanChange && !IsUpdate) {

            //    var Count = 0;
            //    filters.TacticTypeids = PreviousListFilter.TacticTypeIds;
            //    //$.each($("#ulTacticType li input[type=checkbox]"), function () {

            //    //    var id = $(this).attr('id').replace("CbTT", "");
            //    //    var index = PreviousListFilter.TacticTypeIds.indexOf(id);
            //    //    if (index >= 0) {
            //    //        Count++;
            //    //    }
            //    //});
            //    //if (Count == 0) {
            //    //    $("#ulTacticType li input[type=checkbox]").attr('checked', 'checked');
            //    //    $("#ulTacticType li ").addClass("close-list");

            //    //}

            //    filters.OwnerIds = PreviousListFilter.OwnerIds;

            //}


            //if (DeselectAllStatus) {
            //    filters.StatusIds.push(0);
            //}
            //if (TacticDeselectAll) {
            //    filters.TacticTypeids.push(0);
            //}

            var Planid = filters.SelectedPlans;
            var CustomFieldId = filters.customFieldIds;
            var OwnerIds = filters.OwnerIds;
            var TacticTypeids = filters.TacticTypeids; //Modified for #1283
            var GetSelectedPlanNo = filters.SelectedPlans.length;
            var StatusIds = filters.StatusIds;
            var ParentCustomFieldsIds = filters.parentCustomFieldsIds;
            //Modified by komal rawal for #2301 on 28-06-2016
            if (filters.TacticTypeids.length != 0 && $("#ulTacticType li input[type=checkbox]").length == filters.TacticTypeids.length) {
                TacticTypeids = 'All';
            }
            if (filters.OwnerIds.length != 0 && $("#ulSelectedOwner li input[type=checkbox]").length == filters.OwnerIds.length) {
                OwnerIds = 'All';
            }
            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                // #838 Showing Multiple Plans on Plan Page : Kalpesh Sharma
                Planid = CurrentPlanId;
                GetSelectedPlanNo = 1;
            }
            $.ajax({
                type: "POST", //Modified BY Komal Rawal for #1991 to solve json length problem in passing query string.
                cache: false,
                async: false,
                url: '@Url.Action("SaveLastSetofViews", "Home")',
                data: {
                    PlanId: Planid.toString(),
                    customFieldIds: CustomFieldId.toString(),
                    ownerIds: OwnerIds.toString(),
                    TacticTypeid: TacticTypeids.toString(),
                    StatusIds: filters.StatusIds.toString(),
                    ViewName: ViewName,
                    SelectedYears: filters.SelectedYears.toString(),
                    ParentCustomFieldsIds: filters.parentCustomFieldsIds.toString()

                },
                dataType: "json",
                success: function (data) {
                    if (data.isSuccess == true) {

                        if (data.ViewName != null && data.ViewName != "" && data.ViewName != undefined) {
                            $("#content_SaveFilters").css("display", "none");
                            $("#PlanModulesSection").css("display", "block");
                            $("#Filtersidebar").css("display", "block");
                            $("#errorMessageMainSidebar").css("display", "none");
                            $('div[id=successMessageSidebar]').each(function () {
                                if ($(this).parent().is(':visible')) {
                                    $(this).show();
                                    $(this).find("span[id=spanSuccessMessageRole]").text('@Common.objCached.SavePresetSuccess');
                                    // $(this).slideDown(600);
                                    //$(this).slideDown(600).delay(3000).slideUp(600);
                                }
                            });

                            $("#txtPresetName").val('');
                        }
                    }
                    else {
                        $("#successMessageSidebar").css("display", "none");
                        $('div[id=errorMessageMainSidebar]').each(function () {
                            if ($(this).parent().is(':visible')) {
                                $(this).show();
                                $(this).find("span[id=spanErrorMessageRole]").text(data.msg);
                                // $(this).slideDown(600);
                                //$(this).slideDown(600).delay(3000).slideUp(600);
                            }
                        });
                    }
                }
            });
        }

        //Modified By komal Rawal
        function UpdateCalenderView() {
            requestPlanActiveTab(false);
            var SelectedPlanIds;

            filters.customFieldIds = [];
            //Add by Nishant For "if all selected then no record inserted for user default view"
            //var ulStatus = $("#ulStatus li");
            //var ulTacticType = $("#ulTacticType li");
            //if (ulStatus.length == filters.StatusIds.length) {
            //    filters.StatusIds = [];
            //}
            //if (ulTacticType.length == filters.TacticTypeids.length) {
            //    filters.TacticTypeids = [];
            //}
            // Desc ::  to resolve the owner filter issue

            filters.OwnerIds = [];
            $("#ulSelectedOwner li input:checkbox:checked").map(function () {
                filters.OwnerIds.push($(this).attr("id"));
            });
            // End By Nishant Sheth
            $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.customFieldIds.push(chkid);
                    }
                }
            });
            filters.SelectedPlans = [];
            $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.SelectedPlans.push(chkid);
                    }
                }
            });


            if (filters.SelectedPlans.length == 1) {
                CurrentPlanId = filters.SelectedPlans[0].toString();
                $("#CurrentPlanId").val(filters.SelectedPlans[0].toString());
            }

            //Added for "Select All" case of #1953 and #1993 By Maitri Gandhi on 16/2/2016
            var CheckedCounter = 0, AllCounter = 0, id = null, UncheckedCounter = 0;
            $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                    AllCounter = $(this).find("input[type=checkbox]").length;
                    CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                    UncheckedCounter = AllCounter - CheckedCounter;
                    if (AllCounter == UncheckedCounter) {
                        var Id = $(this).attr("id");
                        if (Id.indexOf("-") >= 0) {
                            Id = Id.split('-')[1];
                            var CustomId = Id + "_null";
                            filters.customFieldIds.push(CustomId);

                        }
                    }
                    else if (AllCounter == CheckedCounter) {
                        id = this.id;
                        if (id != null && id != "" && id.indexOf("-") > -1) {
                            id = this.id.split("-")[1];
                        }
                        var i = 0, customfieldid;
                        for (i = 0; i < filters.customFieldIds.length; i++) {
                            if (filters.customFieldIds[i].indexOf("_") > -1) {
                                customfieldid = filters.customFieldIds[i].split("_")[0];
                                if (id == customfieldid) {
                                    filters.customFieldIds.splice(i, 1);
                                    i--;
                                }
                            }
                        }
                    }
                }
            });        ////End
            var CustomFieldId = filters.customFieldIds;
            var OwnerIds = filters.OwnerIds;
            var TacticTypeids = filters.TacticTypeids;
            var StatusIds = filters.StatusIds;

            if (activeMenu == '@Enums.ActiveMenu.Home.ToString().ToLower()') {
                SelectedPlanIds = filters.SelectedPlans.toString();
            }
            else {
                SelectedPlanIds = CurrentPlanId;
            }

            SetAttributeData();

            $('#hdnSelectedPlanIds').val(SelectedPlanIds);

            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Home/SetSessionPlan/")',
                dataType: "json",
                async: false,
                data: {
                    planids: SelectedPlanIds
                },
                success: function (data) {
                    if (data.isSuccess == true) {
                        $("#CurrentPlanId").val(data.id);
                        if (activeMenu == '@Enums.ActiveMenu.Home.ToString().ToLower()') {
                            BindUpcomingActivites(SelectedPlanIds);
                        }
                        Currenttime = $('#ddlUpComingActivites').val(); // Comment By Bhavesh //Uncomment By Komal as on update result takes wrong time frame.
                        isQuater = Currenttime;
                        SetBudget("#pbudget");
                        SetPriceValue("#pMQLs");
                        getViewByList = true;
                        RefreshCurrentTab();
                        //Modified By Komal Rawal for #1447 - to Change the header data according to the filter selected.
                        // Commented By Nishant Sheth
                        // Desc :: For performance issue
                        //GetHealderData(SelectedPlanIds, CustomFieldId, OwnerIds, TacticTypeids, StatusIds);
                        GetNumberOfActivityPerMonByPlanIdPer(SelectedPlanIds, Currenttime, CustomFieldId, OwnerIds, TacticTypeids, StatusIds);
                        //End
                    }
                }
            });
            $("#content_wraper").removeClass("span10 padding-top40").addClass("span10 all-height");
            $('#errorMessageInspectPopup').slideUp(400);


        }

        //Added By Komal Rawal for #1432
        //Update by Bhavesh 05-Nov-2015.
        function LoadImprovementGrid(PlanID) {
            $.ajax({
                beforeSend: function (x) {
                    myApp.hidePleaseWait();
                },
                url: '@Url.Content("~/Plan/LoadImprovementGrid/")',
                data: {
                    id: PlanID
                },
                success: function (result) {
                    $("#ImprovementGrid").html('');
                    $("#ImprovementGrid").html(result);
                }
            });
        }
        //End

        // modify by devanshi
        function LoadPlanGrid() {
            //  $("#btnPlanReport").css("display", "none");// Add By Nishant Sheth
            filters.SelectedPlans = [];
            $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.SelectedPlans.push(chkid);
                    }
                }
            });
            if (filters.SelectedPlans.length == 1) {
                CurrentPlanId = filters.SelectedPlans[0].toString();
                $("#CurrentPlanId").val(filters.SelectedPlans[0].toString());

            }
            if (activeMenu == '@Enums.ActiveMenu.Home.ToString().ToLower()') {
                SelectedPlanIds = filters.SelectedPlans.toString();
            }
            else {
                SelectedPlanIds = CurrentPlanId;
            }
            filters.customFieldIds = [];

            $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.customFieldIds.push(chkid);
                    }
                }
            });
            //Added for "Select All" case of #1953 and #1993 By Maitri Gandhi on 16/2/2016
            var CheckedCounter = 0, AllCounter = 0, id = null, UncheckedCounter = 0;
            $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                    AllCounter = $(this).find("input[type=checkbox]").length;
                    CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                    UncheckedCounter = AllCounter - CheckedCounter;
                    if (AllCounter == UncheckedCounter) {
                        var Id = $(this).attr("id");
                        if (Id.indexOf("-") >= 0) {
                            Id = Id.split('-')[1];
                            var CustomId = Id + "_null";
                            filters.customFieldIds.push(CustomId);

                        }
                    }
                    else if (AllCounter == CheckedCounter) {
                        id = this.id;
                        if (id != null && id != "" && id.indexOf("-") > -1) {
                            id = this.id.split("-")[1];
                        }
                        var i = 0, customfieldid;
                        for (i = 0; i < filters.customFieldIds.length; i++) {
                            if (filters.customFieldIds[i].indexOf("_") > -1) {
                                customfieldid = filters.customFieldIds[i].split("_")[0];
                                if (id == customfieldid) {
                                    filters.customFieldIds.splice(i, 1);
                                    i--;
                                }
                            }
                        }
                    }
                }
            });        ////End
            //// End - Added by Sohel Pathan on 19/01/2015 for PL ticket #1134
            //commented by Rahul Shah on 22/02/2016 for PL #1905. to set focus after link tactic
            // state0 = 0;

            var CustomFieldId = filters.customFieldIds;
            var OwnerIds = filters.OwnerIds;
            var TacticTypeids = filters.TacticTypeids; //Modified for #1283

            var StatusIds = filters.StatusIds;

            $.ajax({
                url: '@Url.Content("~/Plan/LoadHomeGrid/")',
                data: {
                    planId: SelectedPlanIds.toString(),
                    ownerIds: OwnerIds.toString(),
                    TacticTypeid: TacticTypeids.toString(),
                    StatusIds: StatusIds.toString(),
                    customFieldIds: CustomFieldId.toString()
                },
                success: function (result) {
                    // Add By Nishant Sheth
                    // Desc :: #1818
                    var gridhtml = '<div id="NodatawithfilterGrid" style="display:none;">' +
            '<span class="pull-left margin_t30 bold " style="margin-left: 20px;">No data exists. Please check the filters or grouping applied.</span>' +
        '<br/></div>';
                    gridhtml += result;
                    $("#divgridview").html('');
                    $("#divgridview").html(gridhtml);

                    $("div[id^='LinkIcon']").each(function () {

                        bootstrapetitle($(this), 'This tactic is linked to ' + "<U>" + htmlDecode($(this).attr('linkedplanname') + "</U>"), "tipsy-innerWhite");
                    });

                    if (isBoostAuthorized) LoadImprovementGrid(CurrentPlanId);
                }
            });

        }
        //Added BY Komal Rawal for adding year filter on home page
        function OnYearChange(obj) {
            filters.SelectedYears = [];
            var id = $(obj).attr('id');
            if ($(obj).is(':checked')) {
                $("#" + id).addClass("close-list");
            }
            else {
                $("#" + id).removeClass("close-list");
            }
            checkedYearcount = $("#ulSelectedYear li input:checkbox:checked").length;
            $('#cYearcount').text(checkedYearcount);
            var listCheckbox = $("#ulSelectedYear").find("input[type=checkbox]");
            years = "";
            $.each(listCheckbox, function () {
                if ($(this).attr("checked")) {
                    years += $(this).attr('yearValue') + ",";
                }
            });
            years = years.slice(0, -1);
            if (years != null && years != "") {
                filters.SelectedYears.push(years);
            }

            LoadPlanData(years);

        }
        //// Load Plan data based on selected year
        var _item;
        function LoadPlanData(years) {
            var strYear = years;
            // Start
            // Desc  :: #1842 code review - When we select the year from Year filter, plan selection is removed, It should not
            var selectedPlanIds = [];
            var listofselectedplan = $("#accordion-element-Plan").find("ul").find("li").find("input[type='checkbox']:checked");
            $.each(listofselectedplan, function () {

                var pid = $(this).attr('id').split('_')[0];
                selectedPlanIds.push(pid);
            });
            // End
            var isListPlan = false;
            $.ajax({
                beforeSend: function (x) {
                    myApp.hidePleaseWait();
                },
                type: 'POST',
                url: '@Url.Content("~/Report/GetBudgetPlanBasedOnYear/")',
                data: {
                    Year: strYear,
                    activemenu: '@Enums.ActiveMenu.Home.ToString().ToLower()'
                },
                success: function (data) {
                    $('#ulSelectedPlans').html('');
                    if (data != 'undefined' && data != null) {
                        PlanCount = data.length;
                        if (PlanCount > 0) {
                            $("#PlanAllModule").css("display", "block");
                            $("#NoPlanFound").hide();
                            $.each(data, function (index, item) {
                                _item = item.Value.replace(/'/g, "&#39;"); //PL #1556 Reports: Clustered Plan Names - Dashrath Prajapati
                                $('#ulSelectedPlans').append('<li class="accordion-inner" title="' + item.Text + '" id="liPlan' + item.Value + '"><span class="sidebarliwidth">' + item.Text + '</span><input type="checkbox" class="chkbxfilter" onchange="togglePlan(this)" id="' + _item + '"></input></li>');
                            });
                        }
                        else {
                            $("#PlanAllModule").css("display", "none");
                            $("#NoPlanFound").show();
                        }
                    }
                    else {
                        $("#PlanAllModule").css("display", "none");
                        $("#NoPlanFound").show();
                    }
                    checkedPlancount = $("#ulSelectedPlans li input:checkbox:checked").length;
                    var TotalPlancount = $("#ulSelectedPlans li").length;
                    $('#tPlancount').text('/' + TotalPlancount);
                    $('#cPlancount').text(checkedPlancount);
                    // Start
                    // Desc  :: #1842 code review - When we select the year from Year filter, plan selection is removed, It should not
                    var listofplan = $("#accordion-element-Plan").find("ul").find("li").find("input[type='checkbox']");
                    $.each(listofplan, function () {

                        var pid = $(this).attr('id').split('_')[0];
                        var indexofplan = $.inArray(pid, selectedPlanIds);
                        if (indexofplan > -1) {
                            $(this).attr("checked", "checked");
                            togglePlan($(this), true);
                        }
                    });
                    // End
                    var planids = [];
                    $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                        if ($(this).attr('checked') == 'checked') {
                            var chkid = $(this).attr("id");
                            if (chkid != undefined && chkid != 'undefined') {
                                planids.push(chkid);
                            }
                        }
                    });
                    //GetTacticTypelist(planids, true, true);
                    //GetOwnerListForFilter(planids, true, true);
                }
            });
        }
        //End
        //// Modified By Viral Kadiya PL Ticket#886 to Replace Select and X with check boxes for filters
        function togglePlan(obj, isLstPlan) {
            var IsLstPlan = false;
            if (isLstPlan != null && isLstPlan != 'undefined' && isLstPlan != '' && isLstPlan)
                IsLstPlan = true;
            GetLastview = false;
            var id = $(obj).attr('id');
            if ($(obj).is(':checked')) {
                $("#liPlan" + id).addClass("close-list");
            }
            else {
                $("#liPlan" + id).removeClass("close-list");
            }
            var planids = [];
            $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        planids.push(chkid);
                    }
                }
            });
            checkedPlancount = $("#ulSelectedPlans li input:checkbox:checked").length;
            $('#cPlancount').text(checkedPlancount);
            //$("#ulStatus li input[type=checkbox]").attr('checked', 'checked');
            //$("#ulStatus li ").addClass("close-list");
            //$('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
            //    if ($(this).attr('checked') == 'checked') {
            //        $(this).removeAttr('checked');
            //        $(this).parent().removeClass("close-list");
            //    }
            //});
            if (!IsLstPlan) {
                //Commented By Maitri Gandhi on 23/2/2016 For #2014
                //GetTacticTypelist(planids, true, true);
                //GetOwnerListForFilter(planids, true, true);
            }
        }

        //// Modified By Viral Kadiya PL Ticket#886 to Replace Select and X with check boxes for filters

        function toggleCustomFields(obj, CustFieldId, count) {
            var SelectedCustomFields = parseInt($("#SelectedCustomFilter_" + CustFieldId).text());
            GetLastview = false;
            var id = $(obj).attr('id');
            if ($(obj).is(':checked')) {
                $("#li_" + id).addClass("close-list");
                SelectedCustomFields++;
                $("#SelectedCustomFilter_" + CustFieldId).text(SelectedCustomFields);
            }
            else {
                $("#li_" + id).removeClass("close-list");
                SelectedCustomFields--;
                $("#SelectedCustomFilter_" + CustFieldId).text(SelectedCustomFields);
            }
        }

        //// Modified By Viral Kadiya PL Ticket#886 to Replace Select and X with check boxes for filters
        function toggleOwner(obj) {
            GetLastview = false;
            var id = $(obj).attr('id');
            if ($(obj).is(':checked')) {
                $("#liOwner" + id).addClass("close-list");
            }
            else {
                $("#liOwner" + id).removeClass("close-list");
                //var Index = ids.indexOf(id)
                //if (Index >= 0) {
                //    ids.splice(Index, 1);
                //}
            }
            filters.OwnerIds = [];
            $("#ulSelectedOwner li input[type=checkbox]").each(function () {
                var chkid = $(this).attr("id");
                if ($(this).is(':checked')) {
                    filters.OwnerIds.push(chkid);
                }
            });
            checkedOwnercount = $("#ulSelectedOwner li input:checkbox:checked").length;
            $('#cOwnercount').text(checkedOwnercount);
        }

        function GetCollaborators(planId) {
            if (planId != null && planId > 0) {
                planId = parseInt(planId);
                $.ajax({
                    type: "GET",
                    cache: false,
                    url: '@Url.Action("GetCollaboratorDetails", "Plan")',
                    data: { currentPlanId: planId },
                    dataType: "json",
                    async:false,
                    success: function (data) {
                        if (data.serviceUnavailable != 'undefined' && data.serviceUnavailable == '#') {
                            window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                        }
                        else {
                            // Set collaborator details
                            //Added by kausha somaiya for ticket no #1869
                            if ($('#gantt_here').html().length > 0)
                                $("#divCollaborator").css("display", "block");
                            $('#divCollaborator').empty(); // Clear collaborators div content
                            $("#divCollaboratorCount").css("display", "inline-block");// Added for #2112
                            $('#divCollaboratorCount').empty(); // Added for #2112 - Bhumika
                            ////  set collaborator's image
                            if (data.collaboratorsImage != null && data.collaboratorsImage != 'undefined') {
                                $.each(data.collaboratorsImage.Data, function () {
                                    SetCollaboratorImage(this, appendtag);//#416
                                });
                                //var tempHTML = '<a href="#" class="profile-info" title="" data-toggle="tooltip" data-original-title="hello hello"><img class="avatar-user img-border align_avatar_image" src="data:image/jpg;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMMSURBVEhLpdZZqE1RHMfxYyZCpsyZikd58yKEeCDzlFmGJ0nmhBBCiQhvogxvplCSJ5lnIjJmSshU8mD4fnf3nvbdd52178mvPnXOvt29zl77v/5rFWqQWmiNgViP47iK2xX8fAIbMRhtUBv/lfZYiCt4gjNw8FmYWGEm1uIUHuM6lqITyk59TMBlPIQ37oF6cAay8Zp/64aVuAd/wDQ0RI3SDD7VK+xAF5SbDtiKl9iGloimMfbCf5juhUwaoA+c4sVYhOGwBkJx1p7hAJp7IRSndwNeYJgXMvHmq+GP+ptxCBZWE2QzANaHs+eDVcskvMHk5Fv1rMFvZAet9B2r4ANkMwLeey6qVLwV6LLwfYRiYd1CaMC0d+iHUNbB5dcz+UbqYgmsxHZeCGQMvGlosLRfWIZQWuEG/AHWSnLhGpymUnGtfkFosCxXRKkswF247AqD8BzFKQjE9/8RoYHSYk9sLFD7whS/2OrOwgZQKv1hZYYGS3uPcYjlMHb7wd7rvMfSGRcRGiztDnohFtuprTdpbb7DWNwgniI0WNpbjEQs4+EKKTzCWD9E4jqsSVV/gvUQy1C4mSQDu1xiaYGjiDWQP3CHcluMpTiwUz3DDznpi9h0O82+krwUp/okbId5qYNj8Mmyg3rtPJLGkBObVVJcW+AU2cHyMgSvkR3Yd5u3jCpzEHv84E7kFHb3S07c8D0cZAe2KTRFXqyV+0hercXgnDsFeXG6PQaFBi6536YyDw7sppN0rOW4ibZeiKQ33NizA9ux3Hdj8RRyCe75xeNQRzjw5uRb9bjHetK4gFBxyZlwWYYOA8ZDhDtglT3BzdnG7btONwB/5VTsxweEBkxzBzuC2UhvsTYg7z0f1YrYC5vg4vasNAen8Q2hQWJ+4hx8p6PxALvQCMFYmfvgL/+B0E3L4T0+wyWUe9L0YLAdsfZYDh8kr2iLcUp855Z+6GY14SvzXZcqtmi6wvOzJxSrOW+TkMffFUjW6v/EpuFyG4WdsHO5IXyFhecadqPxVGHb9NAQO82QQuEfoahY8wOVq8kAAAAASUVORK5CYII="></a>';
                                //$("#divCollaborator").html($("#divCollaborator").html() + tempHTML); // commented by Bhumika #2112
                                $('#divCollaboratorCount').append('<span class="bold margin_left6 position_absolute">' + data.collaboratorsImage.Data.length + ' Collaborator(s) </span>');
                                $('#divCollaboratorCount').append('<span class="font_size10 margin_left6 updated-text-align">Last updated ' + data.lastUpdateDate + '</span>'); // Changed ID for #2112

                                // Function Added for #2112 to show tooltip - Bhumika
                                $(function () {
                                    $(".profile-info").tooltip({
                                        placement: "bottom",
                                        trigger: 'hover',
                                        container: 'body',
                                    });
                                });
                                // #2112 Custome scrollbar for div - Bhumika
                                $("#scroll-Collaborator").mCustomScrollbar({
                                    axis: "x",
                                    horizontalScroll: true,
                                    scrollButtons: { enable: true },
                                    theme: "light-3",
                                    advanced: { autoExpandHorizontalScroll: true, updateOnContentResize: true }
                                });

                            }
                            //added by uday for #416
                            //ProfileAttachToolTip();//function written in scripts.js
                        }
                    }
                });
            }
        }

        function SetCollaboratorImage(collaborator, appendtag) {

            // Get collaborator image
            var imgs = collaborator.imageBytes;
            var username = collaborator.name;
            var title = collaborator.jobTitle;//uday#416

            // Set collaborator image
            var collaboratorImage = "<img class=\"avatar-user img-border align_avatar_image\""
             + "src='" + "data:image/jpg;base64,"
             + imgs + "'/>";
            // uday for ticket #416

            var referencestart = "<a href='#' class=\"profile-info\" title=\""+ username + ", " + title +"\" data-toggle=\"tooltip\">"; //Modified by Maitri Gandhi on 25/4/2016 for #2122
            //var referencenew = "<div class=\"profile-tooltip\">	<div class=\"profile-tooltip-arrow\"></div> <div class=\"profile-tooltip-inner\"> " +
            //                                     " " + username + ', ' + title + "<br /></div> </div>"; //Commented by Bhumika for #2112
            var endreference = "</a>";
            appendtag += referencestart;
            appendtag += collaboratorImage;
            //appendtag += referencenew;
            appendtag += endreference;
            $("#divCollaborator").html($("#divCollaborator").html() + appendtag);
        }

        function SetAttributeData() {
            var planIds = 0;
            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                filters.SelectedPlans = [];
                filters.SelectedPlans.push(CurrentPlanId);
            }

            planIds = filters.SelectedPlans;

            if (planIds.length > 0) {
                $('#DivloadPlan').show();
                $('.tab-content').show();
                $('#ptacticcount').show();
                $('#chart2').show();
                $('#pbudget').show();
                $('#pMQLs').show();
                $('.changes').show();
                $('#Notabcontent').hide();
            }
            else {
                $('#DivloadPlan').hide();
                $('.tab-content').hide();
                $('#ptacticcount').hide();
                $('#chart2').hide();
                $('#pbudget').hide();
                $('#pMQLs').hide();
                $('.changes').hide();
                $('#Notabcontent').show();
                $('#divhoneycombbox').hide();// Add By Nishant Sheth Desc :: To hide the honey comb icon with no data exist
                // Start - Added by Sohel Pathan on 16/07/2014 for Internal Functional Review Points #63
                $('#marketing-activities').hide();
                $('#improvements').hide();
                // End - Added by Sohel Pathan on 16/07/2014 for Internal Functional Review Points #63
            }
        }

        function ResetControlsBeforeOtherAttributes() {
            filters.customFieldIds = [];
            filters.OwnerIds = [];
            filters.TacticTypeids = [];
            filters.StatusIds = [];
            $('#divCustomFieldsFilter').html('');
            $('#ulSelectedOwner').html('');
        }

        function BindOtherAttributes() {
            ResetControlsBeforeOtherAttributes();
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Home/GetCustomAttributes/")',
                dataType: "json",
                async: false,
                success: function (data) {
                    if (data.serviceUnavailable != 'undefined' && data.serviceUnavailable == '#') {
                        window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                    }
                    else {
                        if (data.isSuccess == true) {
                            RenderCustomFieldSearchFilters(data);   // Added by Sohel Pathan on 19/01/2015 for PL ticket #1134
                        }
                    }
                }
            });
        }

        // Start - Added by Sohel Pathan on 19/01/2015 for PL ticket #1134
        function RenderCustomFieldSearchFilters(data) {
            if (data.lstCustomFields != 'undefined' && data.lstCustomFields != null) {
                customFieldsCount = data.lstCustomFields.length;
                var html = '';
                if (customFieldsCount > 0) {
                    $("#divCustomFieldsFilter").css("display", "block");
                    $.each(data.lstCustomFields, function (i, customFielditem) {
                        var customFieldId = customFielditem.CustomFieldId.toString();
                        var customFieldName = customFielditem.Title;
                        html += '<div id="accordion-' + customFieldId + '" class="dropdown-section accordion">';
                        html += '<div class="accordion-group">';
                        html += '<div class="accordion-heading">';
                        html += '<h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-' + customFieldId + '" href="#accordion-element-' + customFieldId + '"><span class="sidebar_label tipsyclassTitle">' + customFieldName + '</span><i class="indicator fa fa-angle-down pull-right"></i></h2> ';
                        html += '</div>'
                        html += '<div id="accordion-element-' + customFieldId + '" class="accordion-body collapse">';
                        html += '<ul class="scroll-list" id="ulSelected' + customFieldId + '">';
                        var customFieldSpecificOptions = 0;
                        if (data.lstCustomFieldOptions != 'undefined' && data.lstCustomFieldOptions != null) {
                            customFieldOptionsCount = data.lstCustomFieldOptions.length;
                            if (customFieldOptionsCount > 0) {
                                $.each(data.lstCustomFieldOptions, function (i, optionitem) {
                                    if (parseInt(optionitem.CustomFieldId) == customFieldId) {
                                        html += '<li class="accordion-inner " title="' + optionitem.Title + '" id="li_' + optionitem.CustomFieldId + '_' + optionitem.CustomFieldOptionId + '"><span class="sidebarliwidth">' + optionitem.Title + '</span><input type="checkbox" class="chkbxfilter"  customFieldTitle="' + optionitem.Title + '" onchange="toggleCustomFields(this)" id="' + optionitem.CustomFieldId + '_' + optionitem.CustomFieldOptionId + '"></input></li>';
                                        customFieldSpecificOptions = customFieldSpecificOptions + 1;
                                    }
                                });
                            }
                        }

                        html += '</ul><div class="list-tab">';
                        if (customFieldSpecificOptions > 0) {
                            html += '<ul id="' + customFieldId + 'AllModule">';
                        }
                        else {
                            html += '<ul id="' + customFieldId + 'AllModule" style="display:none;">';
                        }
                        html += '<li><a onclick="BulkCustomFieldOperation(true, ' + customFieldId + ')">select all</a></li><li>|</li>';
                        html += '<li><a onclick="BulkCustomFieldOperation(false, ' + customFieldId + ')">@*deselect all*@clear</a></li></ul>';
                        if (customFieldSpecificOptions > 0) {
                            html += '<div id="No' + customFieldId + 'Found" class="NoDataFoundFilter" style="display:none;">No ' + customFieldName + ' Found</div>';
                        }
                        else {
                            html += '<div id="No' + customFieldId + 'Found" class="NoDataFoundFilter">No ' + customFieldName + ' Found</div>';
                        }
                        html += '</div></div></div></div>';
                    });
                }

                $('#divCustomFieldsFilter').html(html);
            }
            else {
                $('#divCustomFieldsFilter').html('');
            }
        }
        // End - Added by Sohel Pathan on 19/01/2015 for PL ticket #1134

        function BindUpcomingActivites(SelectedPlanIds) {

            // Start - #1942
            var listCheckbox = $("#ulSelectedYear").find("input[type=checkbox]");
            var years = "";
            $.each(listCheckbox, function () {
                if ($(this).attr("checked")) {
                    years += $(this).attr('yearValue') + ",";
                }
            });
            years = years.slice(0, -1);
            // End - #1942
            //Modified by Komal Rawal for maintaining time fram when we change time frame and add a tactic
            var currentval = $("#ddlUpComingActivites").val();
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Home/BindUpcomingActivitesValues/")',
                async: false,// Comment by bhavesh // Uncomment By Nishant Sheth Desc :: Due to selected min year records display
                data: {
                    planids: SelectedPlanIds,
                    fltrYears: years
                },
                success: function (data) {
                    BindUpcomingActivies(data);
                    var upcomingvalues = [];
                    $.each($("#ddlUpComingActivites option"), function () {
                        upcomingvalues.push(this.value.toString());
                    });
                    if (upcomingvalues.indexOf(currentval) > 0) {
                        $.each($("#ddlUpComingActivites option"), function () {
                            $(this).removeAttr('selected');
                        });
                        $("#ddlUpComingActivites option[value='"+currentval+"']").attr('selected', 'selected');
                        $("#ddlUpComingActivites").selectbox('detach');
                        $("#ddlUpComingActivites").selectbox("attach");
                    }
                    //End
                }
            });
        }

        function BindUpcomingActivies(items) {
            var $dropdown = $("#ddlUpComingActivites");
            $dropdown.html('');
            var $html = '';
            if (items.length > 0) {
                $.each(items, function (index, pvalues) {
                    if (pvalues.Selected) {
                        $html += '<option value="' + pvalues.Value + '" selected="selected">' + pvalues.Text + '</option>';
                    } else {
                        $html += '<option value="' + pvalues.Value + '">' + pvalues.Text + '</option>';
                    }
                });
            }
            $dropdown.append($html);
            Currenttime = $("#ddlUpComingActivites").val();
            $("#ddlUpComingActivites").selectbox('detach');
            $("#ddlUpComingActivites").selectbox("attach");
        }

        //// Modified By Viral Kadiya PL Ticket#886 to Replace Select and X with check boxes for filters
        function BulkPlanOperation(selection) {
            GetLastview = false;
            var planids = [];

            if (selection) {
                $("#ulSelectedPlans li").each(function (i) {
                    $(this).addClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).attr("checked", "checked");
                    planids.push(chkid);
                });
            }
            else {
                IsDeselectAll = true;
                $("#ulSelectedPlans li").each(function (i) {
                    $(this).removeClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).removeAttr("checked");
                });
            }
            checkedPlancount = $("#ulSelectedPlans li input:checkbox:checked").length;
            $('#cPlancount').text(checkedPlancount);
            //$("#ulStatus li input[type=checkbox]").attr('checked', 'checked');
            //$("#ulStatus li ").addClass("close-list");
            //$('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
            //    if ($(this).attr('checked') == 'checked') {
            //        $(this).removeAttr('checked');
            //        $(this).parent().removeClass("close-list");
            //    }
            //});

            //if (activeMenu.toLowerCase() == 'home') {
            //    GetOwnerListForFilter(planids, true, true);
            //    GetTacticTypelist(planids, true, true);
            //}

        }

        //// Modified By Viral Kadiya PL Ticket#886 to Replace Select and X with check boxes for filters
        function BulkCustomFieldOperation(selection, customFieldId, TotalCount) {
            GetLastview = false;
            if (selection) {
                $('#ulSelected' + customFieldId + ' li').each(function (i) {
                    $(this).addClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).attr("checked", "checked");
                });
                $("#SelectedCustomFilter_" + customFieldId).text(TotalCount);
            }
            else {
                $('#ulSelected' + customFieldId + ' li').each(function (i) {
                    $(this).removeClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).removeAttr("checked");
                });
                $("#SelectedCustomFilter_" + customFieldId).text("0");
            }
        }

        //// Modified By Viral Kadiya PL Ticket#886 to Replace Select and X with check boxes for filters
        function BulkOwnerOperation(selection) {
            GetLastview = false;
            filters.OwnerIds = [];
            if (selection) {
                $("#ulSelectedOwner li").each(function (i) {
                    $(this).addClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).attr("checked", "checked");
                    filters.OwnerIds.push(chkid);
                });
            }
            else {
                IsDeselectAll = true;
                $("#ulSelectedOwner li").each(function (i) {
                    $(this).removeClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).removeAttr("checked");
                });
            }
            checkedOwnercount = $("#ulSelectedOwner li input:checkbox:checked").length;
            $('#cOwnercount').text(checkedOwnercount);
        }

        // Added by KAPIL - #454 - to resolve extra space
        function CalGanntHeight() {
            var contentWraper = $('#content_wraper').parent().height();
            var positionGannt = $('.gantt-padding').position();
            $('.gantt-padding').height(contentWraper - positionGannt.top);
        }

        //Added By Komal Rawal for #1498
        function EditPlanHome() {
            @*var pid = $("#CurrentPlanId").val();
        var url = '@Url.Content("~/Home/Index?ActiveMenu=")' + '@Enums.ActiveMenu.Plan' + '&currentPlanId=' + pid + '&isGridView=' + "True";
        window.location.href = url;*@
            var currentplanid = $("#CurrentPlanId").val();// Add By Nishant Sheth #1981 export pdf issue for plan tab.
            $("#lblMarkringActivitiesTitle").hide();
            $("#nl-form2").show();
            //$("#DivButtonsHome").hide();  //Commented By Maitri Gandhi on 23/2/2016 For #2014
            $("#DivButtonsPlanSummary").show();
            $('#ActiveMenu').val("@Enums.ActiveMenu.Plan");
            activeMenu = $('#ActiveMenu').val().toLowerCase();
            //$("#divcalenderandgridtab").css("display", "block");
            $("#accordion-2").css("display", "none");
            $("#accordion-Year").css("display", "none");
            $("#accordion-SelectedPlanFilter").css("display", "none"); //Added By Maitri Gandhi on 24/2/2016 For #2014
            $("#UpdatePlan").css("display", "none"); //Added By Maitri Gandhi on 24/2/2016 For #2014
            $("#CalenderView").hide();
            $("#dropdown-plan-title").val(currentplanid);// Add By Nishant Sheth #1981 export pdf issue for plan tab.
            $("#nl-form2 .nl-dd-checked").removeClass("nl-dd-checked");
            $("#nl-form2").find("li[value=" + currentplanid + "]").addClass("nl-dd-checked");
            $("#nl-form2 .nl-field-toggle").html($("#nl-form2").find("li[value=" + currentplanid + "]").attr("originalvalue"));//Modified by Nishant :: Set variable instead of jquey element
            $('.plan').addClass('active');
            $('.home').removeClass('active');
            $('html head title').html("Plan");
            ChangeTabView(GridId); //Modified by Komal Rawal for 2013 Home/Plan Layout changes
            @*Added by Maitri Gandhi on 1/3/2016 to resolve the scenario of more than one plan in saved preset*@
            $(".dropdown ul li").each(function () {
                if ($(this).find("a").text() == "Load Saved Filters") {
                    $(this).css("display", "none");
                }
            });
        }

        function CallPDF() {
            //  $("#gantt_here").css("Width", $("#testdiv").width());
            var isAvailablerecord = false;
            // Modified By Nishant Sheth
            // Desc :: To resolve the #1981 code review points to resolve click on clear filters and
            if (PdfFilters.SelectedPlans.toString().trim().length > 0 && activeMenu == 'home') {
                isAvailablerecord = true;
            } else {
                if ($("#CurrentPlanId").val() > 0 && activeMenu != 'home') {
                    isAvailablerecord = true;
                }
            }
            if ($("#NodatawithfilterCalendar").css('display') == "block") {
                return false;
            }
            if (isAvailablerecord) {
                // If condition added by Rahul Shah for Export only filtered data after performing global search.
                if ($('#txtGlobalSearch').val().trim() != undefined && $('#txtGlobalSearch').val().trim() != null && $('#txtGlobalSearch').val().trim() != "") {
                    //$(gantt.$grid_data).find('.gantt_row').each(function () {
                    //    ExportSelectedIdsafterSearch.TaskID.push($(this).attr('task_id'));
                    //});

                    $(GanttTaskData.data).each(function () {
                        if ($('#searchCriteria').val().replace(" ", "").toUpperCase() == '@Enums.GlobalSearch.ActivityName.ToString().ToUpper()') {
                            if (this.text.toLowerCase().indexOf($('#txtGlobalSearch').val().trim().toLowerCase()) > -1) {
                                ExportSelectedIdsafterSearch.TaskID.push(this.id);
                            }

                        }
                        if ($('#searchCriteria').val().replace(" ", "").toUpperCase() == '@Enums.GlobalSearch.ExternalName.ToString().ToUpper()') {
                            if (this.machineName.toLowerCase().indexOf($('#txtGlobalSearch').val().trim().toLowerCase()) > -1) {
                                ExportSelectedIdsafterSearch.TaskID.push(this.id);
                            }

                        }
                    });

                }
                if (ExportSelectedIdsafterSearch.TaskID.length > 0) {
                    CallPdfHoneyComb();
                    ExportSelectedIdsafterSearch.TaskID = [];
                    RemoveAllHoneyCombData();
                }
                else {
                    $.each(GanttTaskData.data, function () {
                        this.color = '#' + this.colorcode;
                    });

                    gantt.init("gantt_here");
                    gantt.parse(GanttTaskData);
                    var htmltestdiv = '';
                    htmltestdiv += '<h2 style="color: #040707; margin: 0 0 10px;">Marketing Calendar</h2>';
                    htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                    htmltestdiv += '<label style="color:#050708;font-weight: 600;">Time Frame: </label>';
                    htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                    htmltestdiv += isQuater + '</span>';
                    htmltestdiv += '</p>';

                    var innerfiltervalueplan = "";
                    var isselectedplan = true;
                    var DropDownPlan = true;
                    $("#ulSelectedPlans").find("input[type=checkbox]").each(function () {
                        if ($(this).attr('checked') == 'checked') {
                            isselectedplan = true;
                        }
                    });



                    if (activeMenu == 'home') {
                        if (PdfFilters.SelectedPlans.toString().trim().length > 0) {
                            $.each(PdfFilters.SelectedPlans, function () {
                                //if (activeMenu == "plan") {
                                //    innerfiltervalueplan += " " + $(".nl-field.nl-dd").find("a").text();
                                //}
                                //else {
                                //innerfiltervalueplan += " " + $('#' + this).parent().parent("#ulSelectedPlans").children().children('#' + this).attr("plantitle") + ",";
                                // Modified By Nishant Sheth
                                // Des :: #1981 export pdf issue for plan name display undefined
                                innerfiltervalueplan += " " + $("#" + this).parent().parent("#ulSelectedPlans").children().children("#" + this).parent().attr('title') + ",";
                                //}
                                //$("#5820").parent().parent("#ulSelectedPlans").children().children("#5820").attr("plantitle");
                            });
                        }
                    }
                    else {
                        // Modified By Nishant Sheth
                        // Desc :: #1981 export pdf issue for plan name display undefined
                        innerfiltervalueplan += " " + $("#dropdown-plan-title option:selected").text() + ",";
                    }

                    //var isAvailablerecord = false;
                    //// Modified By Nishant Sheth
                    //// Desc :: To resolve the #1981 code review points to resolve click on clear filters and
                    //if (PdfFilters.SelectedPlans.toString().trim().length > 0 && activeMenu == 'home') {
                    //    isAvailablerecord = true;
                    //} else {
                    //    if ($("#CurrentPlanId").val() > 0 && activeMenu != 'home') {
                    //        isAvailablerecord = true;
                    //    }
                    //}
                    //if (isAvailablerecord) {
                    if (PdfFilters.SelectedPlans.toLocaleString().trim().length > 0) {
                        DropDownPlan = false;
                    }

                    if (innerfiltervalueplan != undefined && innerfiltervalueplan != 'undefined' && innerfiltervalueplan != '') {
                        htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                        htmltestdiv += '<label style="color:#050708;font-weight: 600;">Plan: </label>';
                        htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                        innerfiltervalueplan = DropDownPlan == true ? innerfiltervalueplan : innerfiltervalueplan.substring(0, innerfiltervalueplan.length - 1);
                        htmltestdiv += innerfiltervalueplan + '</span>';
                        htmltestdiv += '</p>';
                    }
                    var Parentid = "";
                    $.each($('#divCustomFieldsFilter').find('.dropdown-section'), function () {

                        var headertitle = $(this).find("h2 span").text();
                        var innerfiltervalue = "";

                        Parentid = this.id;
                        var sl = Parentid.lastIndexOf('-');
                        Parentid = Parentid.substring(sl + 1, sl.length).toString();

                        if (PdfFilters.customFieldIds.length > 0) {

                            var a = PdfFilters.customFieldIds;
                            $.each(a, function () {
                                if (this != null && this != undefined && this != 'undefined') {

                                    var liId = this.toString();
                                    var splitIds = liId.split('_');
                                    if (Parentid == splitIds[0].toString()) {
                                        var actualId = "#li_" + Parentid + "_" + splitIds[1];
                                        var chkid = $(actualId).attr("title");
                                        innerfiltervalue += " " + chkid + ",";
                                    }
                                    //var chkid = $(liId).parent().attr("title");
                                    //innerfiltervalue += " " + chkid + ",";
                                }
                            });
                            if (innerfiltervalue != undefined && innerfiltervalue != 'undefined' && innerfiltervalue != '') {
                                htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                                htmltestdiv += '<label style="color:#050708;font-weight: 600;">' + headertitle + ': </label>';
                                htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                                innerfiltervalue = innerfiltervalue.substring(0, innerfiltervalue.length - 1);
                                htmltestdiv += innerfiltervalue + '</span>';
                                htmltestdiv += '</p>';
                            }
                        }
                    });


                    var innerfiltervalueOwner = "";
                    var isselectedOwner = true;
                    var pdfowner = PdfFilters.OwnerIds.toString().trim();
                    if (pdfowner.length > 0) {
                        $.each(PdfFilters.OwnerIds, function () {
                            innerfiltervalueOwner += " " + $("#ulSelectedOwner").find('#liOwner' + this).attr("title") + ",";
                            //$("#5820").parent().parent("#ulSelectedPlans").children().children("#5820").attr("plantitle");
                        });
                    }

                    if (innerfiltervalueOwner != undefined && innerfiltervalueOwner != 'undefined' && innerfiltervalueOwner != '') {
                        htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                        htmltestdiv += '<label style="color:#050708;font-weight: 600;">Owner: </label>';
                        htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                        innerfiltervalueOwner = innerfiltervalueOwner.substring(0, innerfiltervalueOwner.length - 1);
                        htmltestdiv += innerfiltervalueOwner + '</span>';
                        htmltestdiv += '</p>';
                    }

                    var innerfiltervalueTacticType = "";
                    var isselectedTacticType = true;
                    if (PdfFilters.TacticTypeids.length > 0) {
                        $.each(PdfFilters.TacticTypeids, function () {
                            innerfiltervalueTacticType += " " + $("#ulTacticType").find('#liTT' + this).attr("title") + ",";
                            //$("#5820").parent().parent("#ulSelectedPlans").children().children("#5820").attr("plantitle");
                        });
                    }

                    if (innerfiltervalueTacticType != undefined && innerfiltervalueTacticType != 'undefined' && innerfiltervalueTacticType != '') {
                        htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                        htmltestdiv += '<label style="color:#050708;font-weight: 600;">Tactic Type: </label>';
                        htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                        innerfiltervalueTacticType = innerfiltervalueTacticType.substring(0, innerfiltervalueTacticType.length - 1);
                        htmltestdiv += innerfiltervalueTacticType + '</span>';
                        htmltestdiv += '</p>';
                    }

                    var innerfiltervalueStatus = "";
                    var isselectedStatus = true;
                    if (PdfFilters.StatusIds.length > 0) {
                        $.each(PdfFilters.StatusIds, function () {
                            innerfiltervalueStatus += " " + $("#ulStatus").find('#' + this).parent().find("span").text() + ",";
                            //$("#5820").parent().parent("#ulSelectedPlans").children().children("#5820").attr("plantitle");
                        });
                    }

                    if (innerfiltervalueStatus != undefined && innerfiltervalueStatus != 'undefined' && innerfiltervalueStatus != '') {
                        htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                        htmltestdiv += '<label style="color:#050708;font-weight: 600;">Status: </label>';
                        htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                        innerfiltervalueStatus = innerfiltervalueStatus.substring(0, innerfiltervalueStatus.length - 1);
                        htmltestdiv += innerfiltervalueStatus + '</span>';
                        htmltestdiv += '</p>';
                    }
                    $("#filterdiv").html('');
                    $("#filterdiv").append(htmltestdiv);
                    $("#mqllabeltest").text($("#pmqlLabel").text());
                    $("#mqlspanvalue").text($("#pMQLs").text());
                    $("#mqlspanpercentage").text($("#pMQLImproved").text());
                    $("#pMQLImproved").parent().find('.greenfont').each(function () {
                        $("#mqlspanpercentage").css("color", "#559659");
                    });
                    $("#pMQLImproved").parent().find('.redfont').each(function () {
                        $("#mqlspanpercentage").css("color", "#EF2240");
                    });

                    var originurl = document.location.origin;
                    var mypathurl = document.location.pathname.split('/')[1];
                    var urlpdf = originurl + "/" + mypathurl + "/"; // This line use for stage servers.
                    //var urlpdf = originurl + "/";// This line uncomment for production version and comment above line
                    //$("#imglogopdf").attr("src", urlpdf + "Content/images/game-plan-logo.png")
                    $("#DivBullhornbg").parent().find('.bullhorn-bg').each(function () {
                        $("#mqlmaindiv").css("background-image", "url('" + urlpdf + "Content/images/bullhorn-bg.png')");
                        //  $("#mqlmaindiv").css("background-image", "url('@Url.Content("~/Content/images/bullhorn-bg.png")')");

                        $("#mqlmaindiv").css("background-position", "right bottom");
                        $("#mqlmaindiv").css("background-repeat", "no-repeat");
                    });

                    $("#DivBullhornbg").parent().find('.bullhorn-bg-disabled').each(function () {
                        $("#mqlmaindiv").css("background-image", "url('" + urlpdf + "Content/images/bullhorn-bg-disabled.png')");
                        //   $("#mqlmaindiv").css("background-image", "url('@Url.Content("~/Content/images/bullhorn-bg-disabled.png")')");
                        $("#mqlmaindiv").css("background-position", "right bottom");
                        $("#mqlmaindiv").css("background-repeat", "no-repeat");
                    });

                    $("#DivBullhornbg").parent().find('.bulldoller-bg').each(function () {

                        $("#budgetmaindiv").css("background-image", "url('" + urlpdf + "Content/images/icon-dollar.png')");
                        //     $("#budgetmaindiv").css("background-image", "url('@Url.Content("~/Content/images/icon-dollar.png")')");
                        $("#budgetmaindiv").css("background-position", "right bottom");
                        $("#budgetmaindiv").css("background-repeat", "no-repeat");
                    });


                    $("#budgetlabeltest").text($("#pcostLabel").text());
                    $("#budgetspanvalue").text($("#pbudget").text());
                    $("#ptacticcounttest").text($("#ptacticcount").text());


                    if (isQuater.split('-').length > 1) {
                        $("#AttachChartCanvas").html('');
                        $("#legendchart").show();
                        var ChartHtml = $("#chartCanvasmultiyear").html();
                        var Chartlegend = $("#legendchart").html();
                        var Canvas = $("#chart2").find(".dhx_canvas_text");
                        var i = 0;
                        var AttachChartHtml = '';
                        AttachChartHtml = ChartHtml;
                        var leAlignment = 15;
                        var z = 20;
                        var colorchart = "#C633C9;";
                        $.each(Canvas, function () {
                            if (i > 7) {

                                var left = $(this).css('left');
                                var leftvalue = "";
                                var top = $(this).css('top');
                                var text = $(this).text();
                                var BarHeight = 55 - parseInt(top);
                                if (parseInt(left) > 60) {
                                    colorchart = "#407B22;";
                                }
                                AttachChartHtml += "<div style='margin-left:" + left + "; margin-top:" + top + ";overflow: hidden;position: absolute;text-align: center;white-space: nowrap;font-size: 6px;font-weight: 200;'>";
                                AttachChartHtml += text;
                                AttachChartHtml += "<div style='width:5px;background-color:" + colorchart + " height:" + BarHeight + "px;border-top-left-radius: 10px;border-top-right-radius: 10px;'></div>";
                                //AttachChartHtml += "<div id='legend'></div>"
                                AttachChartHtml += "</div>";
                            }

                            i++;
                        });

                        //AttachChartHtml += Chartlegend;
                        $("#firstyear").text(isQuater.split('-')[0]);
                        $("#secondyear").text(isQuater.split('-')[1]);
                        $("#AttachChartCanvasmultiyear").html('');
                        $("#AttachChartCanvasmultiyear").html(AttachChartHtml);
                    }
                    else {
                        $("#legendchart").hide();
                        $("#AttachChartCanvasmultiyear").html('');
                        var ChartHtml = $("#chartCanvas").html();
                        var Canvas = $("#chart2").find(".dhx_canvas_text");
                        var i = 0;
                        var AttachChartHtml = ChartHtml;
                        $.each(Canvas, function () {

                            if (i > 4) {
                                var left = $(this).css('left');
                                var top = $(this).css('top');
                                var text = $(this).text();
                                var BarHeight = 55 - parseInt(top);
                                AttachChartHtml += "<div style='margin-left:" + left + "; margin-top:" + top + ";overflow: hidden;position: absolute;text-align: center;white-space: nowrap;font-size: 6px;font-weight: 200;'>";
                                AttachChartHtml += text;
                                AttachChartHtml += "<div style='width:5px;background-color: #C633C9;height:" + BarHeight + "px;border-top-left-radius: 10px;border-top-right-radius: 10px;'></div>";
                                AttachChartHtml += "</div>";
                            }
                            i++;
                        });

                        $("#AttachChartCanvas").html('');
                        $("#AttachChartCanvas").html(AttachChartHtml);
                        $('#AttachChartCanvas').css('margin-left', '55px');
                    }

                    var headerhtml = $("#testdiv").html();
                    //var Script = "<script>" + "$(document).ready(function () {  $('div').find('[task_id='L10874']').css('background-color','rgb(202, 60, 206)'); });" + "<//script>";
                    var style = "<style> div[task_id='L10874']:last-of-type {background-color:rgb(202, 60, 206)} </style>";
                    var datestart;
                    var dateend;
                    if ($.isNumeric(isQuater)) {
                        datestart = "01-01-" + isQuater;
                        dateend = "01-01-" + (parseInt(isQuater) + 1).toString();
                    }
                    else if (isQuater == 'thismonth') {
                        var date = new Date(), m = date.getMonth();
                        datestart = "01-" + (m + 1).toString() + "-" + date.getFullYear().toString();
                        dateend = "01-" + (m + 2).toString() + "-" + date.getFullYear().toString();
                        $('#mainpdfdiv').css('width', '1000px');
                        var headerhtml = $("#testdiv").html();
                    }
                    else if (isQuater == 'thisquarter') {
                        var startDate = getQarterStartDate();
                        var m = startDate.getMonth();
                        datestart = "01-" + (m + 1).toString() + "-" + startDate.getFullYear().toString();
                        dateend = "01-" + (m + 4).toString() + "-" + startDate.getFullYear().toString();
                        $('#mainpdfdiv').css('width', '1000px');
                        var headerhtml = $("#testdiv").html();
                    }
                    else { //added by Rahul Shah on 17/12/2015 for PL #1766
                        var PlanYears = isQuater.split("-");
                        var yearDiffrence = (parseInt(PlanYears[1]) - parseInt(PlanYears[0])) + 1;
                        datestart = "01-01-" + isQuater.split("-")[0];
                        dateend = "01-01-" + (parseInt(isQuater) + yearDiffrence).toString();
                        // $('#AttachChartCanvas').css('margin-left', '160px');
                        //if (PdfFilters.customFieldIds.toString().trim().length > 0) {
                        //    $("#legendchart").children().first().css('top', '275px');
                        //    $("#legendchart").children().last().css('top', '299px');
                        //}
                        $('#mainpdfdiv').css('width', '');
                        var headerhtml = $("#testdiv").html();
                    }
                    gantt.exportToPDF({
                        header: headerhtml,
                        start: datestart,
                        end: dateend

                    });
                    GlobalSearch();
                }
            }
            else {
                $('#cErrorInspectPopup').html('No plan selected to export the data in .pdf'); //PL #1595 - Dashrath Prajapati
                $('#errorMessageInspectPopup').css("display", "block");
                $('#errorMessageInspectPopup').removeClass('message-position');
            }
        }
        //Added by Rahul Shah for PL #1803 for Honeycomb pdf Header
        function setpdfgraphdata(lstchart) {

            //$(".dhx_chart_legend").html('');
            // $(".dhx_chart_legend").hide();
            var legendvalue = "";
            var activityyear = $('select#ddlUpComingActivites option:selected').val();
            if (activityyear.split('-').length > 1) {
                legendvalue = [{ text: activityyear.split('-')[0], color: "#c633c9" }, { text: activityyear.split('-')[1], color: "#407B22" }];
            }
            else {
                legendvalue = [];
            }
            var barChart2 = new dhtmlXChart({
                view: "bar",
                container: "chartpdf",
                value: "#NoOfActivity#",
                label: "#NoOfActivity#",
                color: "#Color#",
                radius: 3,
                padding: {
                    top: 25,
                    bottom: 16,
                    right: 00,
                    left: 00

                },
                xAxis: {
                    template: "#Month#"
                },
                legend: {
                    width: 3,
                    align: "right",
                    valign: "middle",
                    marker: {
                        type: "round",
                        width: 8
                    },
                    values: legendvalue
                },
            });
            barChart2.parse(lstchart, "json");
            $('.dhx_chart_legend').css({ 'left': '100px', 'top': '21px' });

            var dhtml_length = $('.dhx_chart_legend').length;
            if (activityyear.split('-').length > 1) {
                var i = 0;
                var leftcss;
                $(".dhx_canvas_text").each(function () {
                    i++;
                    if (i > 8) {
                        leftcss = parseInt($(this).css('left'));
                        $(this).css('left', (leftcss - 1));
                    }
                    else {
                        leftcss = parseInt($(this).css('left'));
                        $(this).css('left', (leftcss + 7));
                    }

                });
            }
        }
        // Add By Nishant Sheth
        // Desc :: to display parent child hireachy with export odf function
        var selectedIds = [];
        function GetParentIdRecursive(id) {

            var checkindexselected = selectedIds.indexOf(id);
            if (!(checkindexselected >= 0)) {
                selectedIds.push(id);
                var getparentid = gantt.getParent(id);
                if (getparentid != 0) {
                    return GetParentIdRecursive(getparentid);
                }
            }

        }
        //Added by Rahul Shah for PL #1782 for Honeycomb pdf
        function CallPdfHoneyComb() {
            var isAvailablerecord = false;
            // Modified By Nishant Sheth
            // Desc :: To resolve the #1981 code review points to resolve click on clear filters and
            if (PdfFilters.SelectedPlans.toString().trim().length > 0 && activeMenu == 'home') {
                isAvailablerecord = true;
            }
            else {
                if ($("#CurrentPlanId").val() > 0 && activeMenu != 'home') {
                    isAvailablerecord = true;
                }
            }
            if (isAvailablerecord) {
                var GanttTaskDataforHoney = {
                    data: new Array()
                };// Added By Rahul Shah For HoneyComp Pdf
                var GanttTaskDataNew = GanttTaskData;
                var defaultParentArr = {
                    index: [],
                    parent: [],
                    tacticId: [],

                }
                if (ExportSelectedIds.TaskID.length <= 0) {
                    ExportSelectedIds.TaskID = ExportSelectedIdsafterSearch.TaskID;
                }
                var Status = "";
                var planyear = GanttTaskDataNew.data[0].start_date.getFullYear();
                for (var i = 0; i < GanttTaskDataNew.data.length; i++) {
                    if (GanttTaskDataNew.data[i].type != undefined) {
                        if (GanttTaskDataNew.data[i].type.toUpperCase().toString() == "PLAN") {

                            Status = GanttTaskDataNew.data[i].Status;
                        }
                    }
                    for (var j = 0; j < ExportSelectedIds.TaskID.length; j++) {
                        if (GanttTaskDataNew.data[i].id == ExportSelectedIds.TaskID[j]) {

                            GetParentIdRecursive(GanttTaskDataNew.data[i].id);

                            //defaultParentArr.index.push(i);

                            //defaultParentArr.parent.push(GanttTaskDataNew.data[i].parent);
                            //GanttTaskDataforHoney.data[GanttTaskDataforHoney.data.length - 1].parent = 0;
                            //GanttTaskDataforHoney.data[GanttTaskDataforHoney.data.length - 1].color = '#' + GanttTaskDataforHoney.data[GanttTaskDataforHoney.data.length - 1].colorcode;
                            if (GanttTaskDataNew.data[i].type != undefined) {
                                if (GanttTaskDataNew.data[i].type.toUpperCase().toString() == "TACTIC") {

                                    //TotalTact = TotalTact + 1;
                                    //TotalCost = TotalCost + GanttTaskDataNew.data[i].cost;
                                    // Add BY Nishant Sheth
                                    //Desc:: resolve the issue with view by dropdown
                                    var name_Id = GanttTaskDataNew.data[i].id.split('_');
                                    var name = name_Id[0];
                                    var PlanId;
                                    var CampaignId;
                                    var ProgramId;
                                    var TacticId;
                                    var ImpTacticId;
                                    var LineId;
                                    if (name_Id.length == 1) {
                                        PlanId = name_Id[0].replace("L", "");
                                    }
                                    else if (name_Id.length == 2) {
                                        // Chaneg By Nishant Sheth
                                        // Desc:: To resolve issue with change view by dropdown
                                        var nameindex = name.indexOf("Z");
                                        if (nameindex >= 0) {
                                            PlanId = name_Id[1].replace("L", "");
                                            CampaignId = name_Id[1].replace("C", "");
                                        } else {
                                            PlanId = name_Id[0].replace("L", "");
                                            CampaignId = name_Id[1].replace("C", "");
                                        }
                                    }
                                    else if (name_Id.length == 3) {
                                        // Chaneg By Nishant Sheth
                                        // Desc:: To resolve issue with change view by dropdown
                                        var nameindex = name.indexOf("Z");
                                        if (nameindex >= 0) {
                                            PlanId = name_Id[1].replace("L", "");
                                            CampaignId = name_Id[2].replace("C", "");
                                            //ProgramId = name_Id[2].replace("P", "");
                                        } else {
                                            PlanId = name_Id[0].replace("L", "");
                                            CampaignId = name_Id[1].replace("C", "");
                                            ProgramId = name_Id[2].replace("P", "");
                                        }
                                    }
                                    else if (name_Id.length == 4) {
                                        // Chaneg By Nishant Sheth
                                        // Desc:: To resolve issue with change view by dropdown
                                        var nameindex = name.indexOf("Z");
                                        if (nameindex >= 0) {
                                            PlanId = name_Id[1].replace("L", "");
                                            CampaignId = name_Id[2].replace("C", "");
                                            ProgramId = name_Id[3].replace("P", "");
                                            //TacticId = name_Id[3].replace("T", "");
                                        } else {
                                            PlanId = name_Id[0].replace("L", "");
                                            CampaignId = name_Id[1].replace("C", "");
                                            ProgramId = name_Id[2].replace("P", "");
                                            TacticId = name_Id[3].replace("T", "");
                                        }
                                    }
                                    else {

                                        // Chaneg By Nishant Sheth
                                        // Desc:: To resolve issue with change view by dropdown
                                        var nameindex = name.indexOf("Z");
                                        if (nameindex >= 0) {
                                            PlanId = name_Id[1].replace("L", "");
                                            CampaignId = name_Id[2].replace("C", "");
                                            ProgramId = name_Id[3].replace("P", "");
                                            TacticId = name_Id[4].replace("T", "");
                                            //LineId = name_Id[4];
                                        } else {
                                            PlanId = name_Id[0].replace("L", "");
                                            CampaignId = name_Id[1].replace("C", "");
                                            ProgramId = name_Id[2].replace("P", "");
                                            TacticId = name_Id[3].replace("T", "");
                                            LineId = name_Id[4];
                                        }
                                    }

                                    defaultParentArr.tacticId.push(TacticId);
                                }
                            }
                        }
                    }
                }

                for (var p = 0; p < selectedIds.length; p++) {

                    var taskdata = gantt.getTask(selectedIds[p]);
                    GanttTaskDataforHoney.data.push(taskdata);
                    GanttTaskDataforHoney.data[GanttTaskDataforHoney.data.length - 1].color = '#' + GanttTaskDataforHoney.data[GanttTaskDataforHoney.data.length - 1].colorcode;
                }

                var tacticids = defaultParentArr.tacticId;
                gantt.clearAll();
                gantt.init("gantt_honey");
                gantt.parse(GanttTaskDataforHoney);
                gantt.refreshData();
                var htmltestdiv = '';
                htmltestdiv += '<h2 style="color: #040707; margin: 0 0 10px;">Marketing Calendar</h2>';
                htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                htmltestdiv += '<label style="color:#050708;font-weight: 600;">Time Frame: </label>';
                htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                htmltestdiv += isQuater + '</span>';
                htmltestdiv += '</p>';

                var innerfiltervalueplan = "";
                var isselectedplan = true;
                var DropDownPlan = true;
                $("#ulSelectedPlans").find("input[type=checkbox]").each(function () {
                    if ($(this).attr('checked') == 'checked') {
                        isselectedplan = true;
                    }
                });
                if (activeMenu == "home") {
                    if (PdfFilters.SelectedPlans.length > 0) {
                        $.each(PdfFilters.SelectedPlans, function () {
                            //innerfiltervalueplan += " " + $('#' + this).parent().parent("#ulSelectedPlans").children().children('#' + this).attr("plantitle") + ",";
                            // Modified By Nishant Sheth
                            // Des :: #1981 export pdf issue for plan name display undefined
                            innerfiltervalueplan += " " + $("#" + this).parent().parent("#ulSelectedPlans").children().children("#" + this).parent().attr('title') + ",";
                        });
                    }
                }
                else {
                    // Modified By Nishant Sheth
                    // Desc :: #1981 export pdf issue for plan name display undefined
                    innerfiltervalueplan += " " + $("#dropdown-plan-title option:selected").text() + ",";
                }


                //var isAvailablerecord = false;
                //// Modified By Nishant Sheth
                //// Desc :: To resolve the #1981 code review points to resolve click on clear filters and
                //if (PdfFilters.SelectedPlans.toString().trim().length > 0 && activeMenu == 'home') {
                //    isAvailablerecord = true;
                //}
                //else {
                //    if ($("#CurrentPlanId").val() > 0 && activeMenu != 'home') {
                //        isAvailablerecord = true;
                //    }
                //}
                //if (isAvailablerecord) {
                if (PdfFilters.SelectedPlans.toString().trim().length > 0) {
                    DropDownPlan = false;
                }
                //if (DropDownPlan == true) {
                //    if (activeMenu == 'plan') {
                //        innerfiltervalueplan += " " + $("select#dropdown-plan-title option").filter(":selected").text()
                //    }
                //}


                if (innerfiltervalueplan != undefined && innerfiltervalueplan != 'undefined' && innerfiltervalueplan != '') {
                    htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                    htmltestdiv += '<label style="color:#050708;font-weight: 600;">Plan: </label>';
                    htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                    innerfiltervalueplan = DropDownPlan == true ? innerfiltervalueplan : innerfiltervalueplan.substring(0, innerfiltervalueplan.length - 1);
                    htmltestdiv += innerfiltervalueplan + '</span>';
                    htmltestdiv += '</p>';
                }
                var Parentid = "";
                $.each($('#divCustomFieldsFilter').find('.dropdown-section'), function () {

                    var headertitle = $(this).find("h2 span").text();
                    var innerfiltervalue = "";

                    Parentid = this.id;
                    var sl = Parentid.lastIndexOf('-');
                    Parentid = Parentid.substring(sl + 1, sl.length).toString();

                    if (PdfFilters.customFieldIds.length > 0) {

                        var a = PdfFilters.customFieldIds;
                        $.each(a, function () {
                            if (this != null && this != undefined && this != 'undefined') {

                                var liId = this.toString();
                                var splitIds = liId.split('_');
                                if (Parentid == splitIds[0].toString()) {
                                    var actualId = "#li_" + Parentid + "_" + splitIds[1];
                                    var chkid = $(actualId).attr("title");
                                    innerfiltervalue += " " + chkid + ",";
                                }

                            }
                        });
                        if (innerfiltervalue != undefined && innerfiltervalue != 'undefined' && innerfiltervalue != '') {
                            htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                            htmltestdiv += '<label style="color:#050708;font-weight: 600;">' + headertitle + ': </label>';
                            htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                            innerfiltervalue = innerfiltervalue.substring(0, innerfiltervalue.length - 1);
                            htmltestdiv += innerfiltervalue + '</span>';
                            htmltestdiv += '</p>';
                        }
                    }

                });

                var innerfiltervalueOwner = "";
                var isselectedOwner = true;
                if (PdfFilters.OwnerIds.toString().trim().length > 0) {
                    $.each(PdfFilters.OwnerIds, function () {
                        innerfiltervalueOwner += " " + $("#ulSelectedOwner").find('#liOwner' + this).attr("title") + ",";

                    });
                }

                if (innerfiltervalueOwner != undefined && innerfiltervalueOwner != 'undefined' && innerfiltervalueOwner != '') {
                    htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                    htmltestdiv += '<label style="color:#050708;font-weight: 600;">Owner: </label>';
                    htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                    innerfiltervalueOwner = innerfiltervalueOwner.substring(0, innerfiltervalueOwner.length - 1);
                    htmltestdiv += innerfiltervalueOwner + '</span>';
                    htmltestdiv += '</p>';
                }

                var innerfiltervalueTacticType = "";
                var isselectedTacticType = true;
                if (PdfFilters.TacticTypeids.length > 0) {
                    $.each(PdfFilters.TacticTypeids, function () {
                        innerfiltervalueTacticType += " " + $("#ulTacticType").find('#liTT' + this).attr("title") + ",";

                    });
                }

                if (innerfiltervalueTacticType != undefined && innerfiltervalueTacticType != 'undefined' && innerfiltervalueTacticType != '') {
                    htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                    htmltestdiv += '<label style="color:#050708;font-weight: 600;">Tactic Type: </label>';
                    htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                    innerfiltervalueTacticType = innerfiltervalueTacticType.substring(0, innerfiltervalueTacticType.length - 1);
                    htmltestdiv += innerfiltervalueTacticType + '</span>';
                    htmltestdiv += '</p>';
                }

                var innerfiltervalueStatus = "";
                var isselectedStatus = true;
                if (PdfFilters.StatusIds.length > 0) {
                    $.each(PdfFilters.StatusIds, function () {
                        innerfiltervalueStatus += " " + $("#ulStatus").find('#' + this).parent().find("span").text() + ",";

                    });
                }

                if (innerfiltervalueStatus != undefined && innerfiltervalueStatus != 'undefined' && innerfiltervalueStatus != '') {
                    htmltestdiv += '<p style=" line-height: 24px;margin: 0;">';
                    htmltestdiv += '<label style="color:#050708;font-weight: 600;">Status: </label>';
                    htmltestdiv += '<span style="color: #9C9C9C; font-weight: 600; font-size: 14px;">';
                    innerfiltervalueStatus = innerfiltervalueStatus.substring(0, innerfiltervalueStatus.length - 1);
                    htmltestdiv += innerfiltervalueStatus + '</span>';
                    htmltestdiv += '</p>';
                }
                $("#filterdiv").html('');
                $("#filterdiv").append(htmltestdiv);

                var originurl = document.location.origin;
                var mypathurl = document.location.pathname.split('/')[1];
                var urlpdf = originurl + "/" + mypathurl + "/"; // This line use for stage servers.

                //$("#imglogopdf").attr("src", urlpdf + "Content/images/game-plan-logo.png")
                $("#DivBullhornbg").parent().find('.bullhorn-bg').each(function () {
                    $("#mqlmaindiv").css("background-image", "url('" + urlpdf + "Content/images/bullhorn-bg.png')");

                    $("#mqlmaindiv").css("background-position", "right bottom");
                    $("#mqlmaindiv").css("background-repeat", "no-repeat");
                });

                $("#DivBullhornbg").parent().find('.bullhorn-bg-disabled').each(function () {
                    $("#mqlmaindiv").css("background-image", "url('" + urlpdf + "Content/images/bullhorn-bg-disabled.png')");

                    $("#mqlmaindiv").css("background-position", "right bottom");
                    $("#mqlmaindiv").css("background-repeat", "no-repeat");
                });

                $("#DivBullhornbg").parent().find('.bulldoller-bg').each(function () {

                    $("#budgetmaindiv").css("background-image", "url('" + urlpdf + "Content/images/icon-dollar.png')");

                    $("#budgetmaindiv").css("background-position", "right bottom");
                    $("#budgetmaindiv").css("background-repeat", "no-repeat");
                });
                var TotalTact = 0;
                var TotalCost = 0;
                var TotalMql = "";
                var ChartHtml = "";
                var Canvas = "";
                var stryear = isQuater;
                $.ajax({
                    type: 'POST',
                    async: false,
                    url: '@Url.Content("~/Home/GetHeaderDataforHoneycombPDF/")',
                    data: {
                        TactIds: tacticids.toString(),
                        //strParam: planyear.toString()
                        strParam: stryear.toString()
                    },
                    success: function (data) {

                        $("#pdfchart").find('.dhx_canvas_text').remove();
                        $("#pdfchart").find("canvas").remove();
                        setpdfgraphdata(data.lstchart);
                        TotalMql = data.TotalMql;
                        TotalCost = data.TotalCost;
                        TotalTact = data.TotalCount;
                        ChartHtml = $("#chartCanvas").html();
                        Canvas = $("#chartpdf").find(".dhx_canvas_text");
                    },
                    error: function () {
                    }
                });
                $("#mqllabeltest").text($("#pmqlLabel").text());
                $("#budgetlabeltest").text($("#pcostLabel").text());

                if (Status != undefined && Status != null) {
                    if (Status.toUpperCase().toString() == "DRAFT") {
                        $("#mqlspanvalue").text($("#pMQLs").text());
                        $("#budgetspanvalue").text($("#pbudget").text());
                    }
                    else {
                        $("#HoneyMQLs").text(TotalMql);
                        SetPriceValue("#HoneyMQLs")
                        $("#mqlspanvalue").text($("#HoneyMQLs").text());
                        $("#honeybudget").text(TotalCost);
                        SetBudget("#honeybudget")
                        $("#budgetspanvalue").text($("#honeybudget").text());
                    }
                }
                $("#ptacticcounttest").text(TotalTact);
                //$("#mqlspanpercentage").text($("#pMQLImproved").text());
                //$("#pMQLImproved").parent().find('.greenfont').each(function () {
                //    $("#mqlspanpercentage").css("color", "#559659");
                //});
                //$("#pMQLImproved").parent().find('.redfont').each(function () {
                //    $("#mqlspanpercentage").css("color", "#EF2240");
                //});
                //var ChartHtml = $("#chartCanvas").html();
                //var Canvas = $("#chart2").find(".dhx_canvas_text");
                if (isQuater.split('-').length > 1) {

                    $("#AttachChartCanvas").html('');
                    $("#legendchart").show();
                    var ChartHtml = $("#chartCanvasmultiyear").html();
                    var Chartlegend = $("#legendchart").html();
                    var Canvas = $("#chartpdf").find(".dhx_canvas_text");
                    var i = 0;
                    var AttachChartHtml = '';
                    AttachChartHtml = ChartHtml;
                    var leAlignment = 15;
                    var z = 20;
                    var colorchart = "#C633C9;";
                    $.each(Canvas, function () {
                        if (i > 7) {

                            var left = $(this).css('left');
                            var leftvalue = "";
                            var top = $(this).css('top');
                            var text = $(this).text();
                            var BarHeight = 55 - parseInt(top);
                            if (parseInt(left) > 60) {
                                colorchart = "#407B22;";
                            }
                            AttachChartHtml += "<div style='margin-left:" + left + "; margin-top:" + top + ";overflow: hidden;position: absolute;text-align: center;white-space: nowrap;font-size: 6px;font-weight: 200;'>";
                            AttachChartHtml += text;
                            AttachChartHtml += "<div style='width:5px;background-color:" + colorchart + " height:" + BarHeight + "px;border-top-left-radius: 10px;border-top-right-radius: 10px;'></div>";
                            //AttachChartHtml += "<div id='legend'></div>"
                            AttachChartHtml += "</div>";
                        }

                        i++;
                    });

                    $("#firstyear").text(isQuater.split('-')[0]);
                    $("#secondyear").text(isQuater.split('-')[1]);
                    //AttachChartHtml += Chartlegend;
                    $("#AttachChartCanvasmultiyear").html('');
                    $("#AttachChartCanvasmultiyear").html(AttachChartHtml);
                    //$("#AttachChartCanvasmultiyear").css('margin-left', '60px');
                }
                else {
                    $("#legendchart").hide();
                    $("#AttachChartCanvasmultiyear").html('');
                    ChartHtml = $("#chartCanvas").html();
                    Canvas = $("#chartpdf").find(".dhx_canvas_text");
                    var i = 0;
                    var AttachChartHtml = ChartHtml;
                    $.each(Canvas, function () {

                        if (i > 4) {
                            var left = $(this).css('left');
                            var top = $(this).css('top');
                            var text = $(this).text();
                            var BarHeight = 55 - parseInt(top);
                            AttachChartHtml += "<div style='margin-left:" + left + "; margin-top:" + top + ";overflow: hidden;position: absolute;text-align: center;white-space: nowrap;font-size: 6px;font-weight: 200;'>";
                            AttachChartHtml += text;
                            AttachChartHtml += "<div style='width:5px;background-color: #C633C9;height:" + BarHeight + "px;border-top-left-radius: 10px;border-top-right-radius: 10px;'></div>";
                            AttachChartHtml += "</div>";
                        }
                        i++;
                    });

                    $("#AttachChartCanvas").html('');
                    $("#AttachChartCanvas").html(AttachChartHtml);
                }
                $("#testdiv #mqlspanpercentage").hide();
                $('#AttachChartCanvas').css('margin-left', '55px');
                var headerhtml = $("#testdiv").html();

                var style = "<style> div[task_id='L10874']:last-of-type {background-color:rgb(202, 60, 206)} </style>";

                var datestart;
                var dateend;

                if ($.isNumeric(isQuater)) {
                    datestart = "01-01-" + isQuater;
                    dateend = "01-01-" + (parseInt(isQuater) + 1).toString();
                }
                else if (isQuater == 'thismonth') {
                    var date = new Date(), m = date.getMonth();
                    datestart = "01-" + (m + 1).toString() + "-" + date.getFullYear().toString();
                    dateend = "01-" + (m + 2).toString() + "-" + date.getFullYear().toString();
                    $('#mainpdfdiv').css('width', '1000px');
                    var headerhtml = $("#testdiv").html();
                }
                else if (isQuater == 'thisquarter') {
                    var startDate = getQarterStartDate();
                    var m = startDate.getMonth();
                    datestart = "01-" + (m + 1).toString() + "-" + startDate.getFullYear().toString();
                    dateend = "01-" + (m + 4).toString() + "-" + startDate.getFullYear().toString();
                    $('#mainpdfdiv').css('width', '1000px');
                    var headerhtml = $("#testdiv").html();
                }
                else {
                    //added by Rahul Shah on 18/12/2015 for PL #1766
                    var PlanYears = isQuater.split("-");
                    var yearDiffrence = (parseInt(PlanYears[1]) - parseInt(PlanYears[0])) + 1;
                    datestart = "01-01-" + isQuater.split("-")[0];
                    dateend = "01-01-" + (parseInt(isQuater) + yearDiffrence).toString();
                    //Added by Rahul Shah for PL #1813

                    // $('#AttachChartCanvas').css('margin-left', '160px');
                    $('#mainpdfdiv').css('width', '');
                    var headerhtml = $("#testdiv").html();
                }
                gantt.exportToPDF({
                    header: headerhtml,
                    start: datestart,
                    end: dateend

                });

                //for (var m = 0; m < defaultParentArr.index.length; m++) {
                //    var indexdef = defaultParentArr.index[m];
                //    var parentdef = defaultParentArr.parent[m];
                //    GanttTaskData.data[indexdef].parent = parentdef;
                //}
                selectedIds = [];
                GanttTaskDataforHoney.data = new Array();
                gantt.clearAll();

                gantt.init("gantt_here");
                gantt.parse(GanttTaskData);
                //gantt.refreshData();

            }
            else {
                $('#cErrorInspectPopup').html('No plan selected to export the data in .pdf'); //PL #1595 - Dashrath Prajapati
                $('#errorMessageInspectPopup').css("display", "block");
                $('#errorMessageInspectPopup').removeClass('message-position');
            }
        }

        //End

        // Added by Arpita Soni for Ticket #2354 on 07/06/2016
        //Modified By Komal Rawal for #2355 on 14-07-16
        var AnchorTaskIdsList ={
            Id: [],
            Value : []
        };
        function CallPackageHoneyComb() {
            var ViewBy = $('#ddlTabViewBy').val();
            if ($('#IsGridView').val() != "True" &&  ViewBy != null && ViewBy != undefined && ViewBy == '@Enums.DictPlanGanttTypes[Convert.ToString(PlanGanttTypes.ROIPackage)]')
            {
                return false;
            }

            var countElements = $('.popover-content').find(".hc-block").length;
            var hasAnchorTactic = 0;
            var isOnlyTactics = true;
            var anchorTacticId = "";
            var promotionTacticIds = [];
            var AnchorTaskId = 0;
            var dhtmlxrowid = "";
            var IsAlreadyPackaged = [];
            var PlanIds = [];

            if (countElements > 0) {
                if ($('#IsGridView').val() == "True") {
                    $('.popover-content').find(".hc-block").each(function () {
                        var ROITacticType = $(this).attr('roitactictype');
                        var ExistingAnchorTacticId = $(this).attr('anchortacticid');
                        var Csvid = $(this).attr('csvid').split('_');
                        var EntityType = Csvid[0];

                        if (ROITacticType.toLowerCase() == '@Enums.AssetType.Asset.ToString().ToLower()') {
                            anchorTacticId = Csvid[1];
                            dhtmlxrowid = $(this).attr('dhtmlxrowid');
                            hasAnchorTactic++;
                        }
                        if (EntityType.toLowerCase() != '@Enums.EntityType.Tactic.ToString().ToLower()') {
                            isOnlyTactics = false;
                        }
                        else {
                            promotionTacticIds.push(Csvid[1]);
                        }

                        if ((!IsPackageView && ExistingAnchorTacticId != "0") || (IsPackageView && ExistingAnchorTacticId!="0" && ExistingAnchorTacticId != anchorTacticId)) {
                            IsAlreadyPackaged.push($(this).find('h5').text());
                        }
                    });

                }
                else {
                    //Added By komal rawal for #2355
                    $('.popover-content').find(".hc-block").each(function () {
                        var ROITacticType = $(this).attr('roitactictype');
                        var EntityType = $(this).attr('EntityType');
                        var ExistingAnchorTacticId = $(this).attr('anchortacticid');
                        var TacticId = 0;
                        if (EntityType.toLowerCase() == 'tactic') {
                            var TaskId = $(this).attr('EntityTaskId');
                            var ListIds = TaskId.split('_');
                            $.each(ListIds, function (index, Id) {
                                if (Id.indexOf('T') >= 0) {
                                    TacticId = Id.replace("T", "");
                                }
                                else if (Id.indexOf('L') >= 0)
                                {
                                    var TacticPlanId = Id.replace("L", "");
                                    var PlanIndex = PlanIds.indexOf(TacticPlanId);
                                    if (PlanIndex < 0) {
                                        PlanIds.push(TacticPlanId);
                                    }

                                }

                            });
                        }
                        if (ROITacticType.toLowerCase() == '@Enums.AssetType.Asset.ToString().ToLower()') {
                            anchorTacticId = TacticId;
                            hasAnchorTactic++;
                            AnchorTaskId = $(this).attr('EntityTaskId');
                            var index = AnchorTaskIdsList.Id.indexOf(AnchorTaskId);
                            if (index >= 0) {
                                AnchorTaskIdsList.Id.splice(index, 1);
                                AnchorTaskIdsList.Value.splice(index, 1);
                            }
                            AnchorTaskIdsList.Id.push(AnchorTaskId);
                        }

                        if (EntityType.toLowerCase() != '@Enums.EntityType.Tactic.ToString().ToLower()') {
                            isOnlyTactics = false;
                        }
                        else {
                            promotionTacticIds.push(TacticId);
                        }

                        if ((!IsPackageView && ExistingAnchorTacticId != "0") || (IsPackageView && ExistingAnchorTacticId!="0" && ExistingAnchorTacticId != anchorTacticId)) {
                            IsAlreadyPackaged.push($(this).find('h5').text());
                        }

                    });
                    //End

                    AnchorTaskIdsList.Value.push(promotionTacticIds.toString());


                }
            }
            if (hasAnchorTactic != 1 || !isOnlyTactics || IsAlreadyPackaged.length > 0 || PlanIds.length > 1) {
                // All errors as per validation
                isError = true;
                AnchorTaskIdsList = {
                    Id: [],
                    Value: []
                };
                if (!isOnlyTactics) {
                    ShowMessageHoneyComb(isError, '@RevenuePlanner.Helpers.Common.objCached.OnlyTacticsToCreatePackage', 400);
                }
                else if(PlanIds.length > 1)
                {
                    ShowMessageHoneyComb(isError, "@RevenuePlanner.Helpers.Common.objCached.SinglePlanTacticForPackage", 400);
                }
                else if (hasAnchorTactic == 0) {
                    ShowMessageHoneyComb(isError, "@RevenuePlanner.Helpers.Common.objCached.AtLeastOneAssetValidation", 400);
                }
                else if (hasAnchorTactic > 1) {
                    ShowMessageHoneyComb(isError, "@RevenuePlanner.Helpers.Common.objCached.MoreThanOneAssetValidation", 400);
                }
                else if (IsAlreadyPackaged.length > 0) {
                    ShowMessageHoneyComb(isError, "Tactics(" + IsAlreadyPackaged.join(',') + ") can belong to only one package. Please remove above tactic(s).", 400);
                }

            }
            else {
                // Create new package
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Home/AddROIPackageDetails")',
                    data: { AnchorTacticId: anchorTacticId, PromotionTacticIds: promotionTacticIds.toString() },
                    success: function (data) {
                        if ($('#IsGridView').val() != "True") {
                            var TaskHtml = $("div[task_id='" + AnchorTaskId + "']")[0];
                            if(TaskHtml != 'undefined' && TaskHtml != undefined && TaskHtml != null)
                            {
                                var LastChildNode = TaskHtml.firstChild.lastChild.outerHTML;
                                var FileNode = TaskHtml.firstChild.getElementsByClassName("gantt_file").item(0);
                                var BlankDiv = TaskHtml.getElementsByClassName("gantt_blank").item(0);
                                if(FileNode != null && FileNode!= 'undefined' && FileNode != undefined)
                                {
                                    FileNode = TaskHtml.firstChild.getElementsByClassName("gantt_file").item(0).outerHTML;
                                }

                                var AllCHildNodes = TaskHtml.firstChild.innerHTML;
                                var IsPAckageExists = TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0);
                                if (IsPAckageExists != null && IsPAckageExists != undefined && IsPAckageExists != 'undefined') {
                                    var PackageNode = TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0).outerHTML;
                                    AllCHildNodes = TaskHtml.firstChild.innerHTML;
                                    AllCHildNodes = AllCHildNodes.replace(PackageNode, "");
                                }
                                if(BlankDiv != null && BlankDiv!= 'undefined' && BlankDiv != undefined)
                                {

                                    AllCHildNodes = AllCHildNodes.replace(BlankDiv.outerHTML, "<div class='unlink-icon ROIPackage' onclick='OpenHoneyComb(this)' style='cursor:pointer' pkgtacids=" + promotionTacticIds + " ><i class='fa fa-object-group'></i></div>");
                                }
                                else
                                {
                                    AllCHildNodes = AllCHildNodes.replace(LastChildNode, "");
                                    AllCHildNodes = AllCHildNodes.replace(FileNode, "");
                                    AllCHildNodes = AllCHildNodes.concat("<div class='unlink-icon ROIPackage' onclick='OpenHoneyComb(this)' style='cursor:pointer' pkgtacids=" + promotionTacticIds + " ><i class='fa fa-object-group'></i></div>" + FileNode + LastChildNode);
                                }
                                TaskHtml.firstChild.innerHTML = AllCHildNodes;
                            }


                            // Bind anchortacticid of the new package to honeycomb icons in the grid
                            $.each(promotionTacticIds, function (i) {
                                var ItemID = anchorTacticId + "_" + promotionTacticIds[i];
                                AddRemovePackageItems.AddItemId.push(ItemID);
                                $('.honeycombbox-icon-gantt[taskid=' + promotionTacticIds[i] + ']').attr('anchortacticid', anchorTacticId);
                            });
                        }
                        else{
                            var rowId = dhtmlxrowid;
                            var getvalue = HomeGrid.cells(rowId, 1).getValue();
                            var Index = getvalue.indexOf("pkgIcon");
                            if (Index <= -1) {
                                // Add package icon on the grid when new package is created
                                var PkgIconDiv = "<div id=pkgIcon class='package-icon package-icon-grid' style='cursor:pointer' onclick=OpenHoneyComb(this) pkgtacids=" + promotionTacticIds.toString() + "><i class='fa fa-object-group'></i></div>";
                                HomeGrid.cells(rowId, 1).setValue(PkgIconDiv + getvalue);
                            }
                            else if (Index > -1) {
                                // Bind updated items to package icon into grid
                                var newValue = "<div id=pkgIcon class='package-icon package-icon-grid' style='cursor:pointer'  onclick=OpenHoneyComb(this) pkgtacids=" + promotionTacticIds.toString() + "><i class='fa fa-object-group'></i></div>";
                                var oldValue = $(getvalue).get(0).outerHTML;
                                getvalue = getvalue.replace(oldValue, newValue);
                                HomeGrid.cells(rowId, 1).setValue(getvalue);
                            }
                            // Bind anchortacticid of the new package to honeycomb icons in the grid
                            $.each(promotionTacticIds, function (i) {
                                $('.honeycombbox-icon-gantt[csvid=Tactic_' + promotionTacticIds[i] + ']').attr('anchortacticid', anchorTacticId);
                            });

                        }
                        // Unselect all items
                        RemoveAllHoneyCombData();
                        if(data.IsUpdatePackage != undefined && data.IsUpdatePackage == true) {
                            ShowMessage(false,  "@RevenuePlanner.Helpers.Common.objCached.PackageUpdated", 3000);
                        }
                        else{
                            ShowMessage(false,  "@RevenuePlanner.Helpers.Common.objCached.PackageCreated", 3000);
                        }
                    }

                });
            }

        }

        // Added by Arpita Soni for Ticket #2354 on 07/06/2016
        //Modified By Komal Rawal for #2355 on 14-07-16
        var PreventUnPackageClick = true;
        function CallUnPackageHoneyComb() {
            if (PreventUnPackageClick == false)
            {
                var CalendarTaskID = $('.popover-content').find(".hc-block[roitactictype=@Enums.AssetType.Asset.ToString()]").attr('entitytaskid');
                var anchorTacticId = 0;
                if (CalendarTaskID != null && CalendarTaskID != undefined && CalendarTaskID != 'undefined')
                {
                    var ListIds = CalendarTaskID.split('_');
                    $.each(ListIds, function (index, Id) {
                        if (Id.indexOf('T') >= 0) {
                            anchorTacticId = Id.replace("T", "");
                        }
                    });
                }
                if ($('#IsGridView').val() == "True") {
                    var objAssetElement = $('.popover-content').find(".hc-block[roitactictype=@Enums.AssetType.Asset.ToString()]");
                    if (objAssetElement != undefined && objAssetElement != null && objAssetElement.length > 0) {
                        anchorTacticId = $(objAssetElement).attr('csvid').split('_')[1];
                    }
                    else {
                        ShowMessageHoneyComb(true, "@RevenuePlanner.Helpers.Common.objCached.DeselectAssetFromPackage", 400);
                        return false;
                    }
                }
                else{
                    $('.popover-content').find(".hc-block[anchortacticid= " + anchorTacticId +" ]").each(function () {
                        var TaskID = $(this).attr('entitytaskid');
                        AddRemovePackageItems.RemoveId.push(TaskID);
                    });
                }

                $.ajax({
                    url: '@Url.Content("~/Home/UnpackageTactics/")',
                    data: {
                        AnchorTacticId: anchorTacticId
                    },
                    success: function (data) {
                        if ($('#IsGridView').val() == "True") {
                            // Remove package icon from the grid
                            var rowObject = $('.honeycombbox-icon-gantt[taskid=' + anchorTacticId + ']');
                            var rowId = $(rowObject).attr('dhtmlxrowid');
                            var getvalue = HomeGrid.cells(rowId, 1).getValue();

                            var Index = getvalue.indexOf("pkgIcon");
                            if (Index > -1) {
                                var newValue = $(getvalue).get(0).outerHTML;
                                getvalue = getvalue.replace(newValue, '');
                                HomeGrid.cells(rowId, 1).setValue(getvalue);
                            }
                        }
                        else {
                            var TaskHtml = $("div[task_id='" + CalendarTaskID + "']")[0];
                            if(TaskHtml != 'undefined' && TaskHtml != undefined && TaskHtml != null)
                            {
                                var FileNode = TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0);
                                var BlankDiv = TaskHtml.getElementsByClassName("gantt_blank").item(0);
                                var IsLinkIcon = TaskHtml.firstChild.getElementsByClassName("unlink-icon");
                                if(FileNode != null && FileNode!= 'undefined' && FileNode != undefined)
                                {
                                    FileNode = TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0).outerHTML
                                }
                                var AllCHildNodes = TaskHtml.firstChild.innerHTML;
                                if(BlankDiv != null && BlankDiv!= 'undefined' && BlankDiv != undefined)
                                {
                                    AllCHildNodes = AllCHildNodes.replace(FileNode, "");

                                }
                                else
                                {
                                    if(IsLinkIcon != null && IsLinkIcon != 'undefined' && IsLinkIcon != undefined && IsLinkIcon.length <= 1)
                                    {
                                        AllCHildNodes = AllCHildNodes.replace(FileNode, "<div class='gantt_tree_icon gantt_blank'></div>");
                                    }
                                    else
                                    {
                                        AllCHildNodes = AllCHildNodes.replace(FileNode, "");
                                    }

                                }
                                TaskHtml.firstChild.innerHTML = AllCHildNodes;
                            }
                            if (AnchorTaskIdsList.Id.length != 0)
                            {
                                $.each(AnchorTaskIdsList.Id, function (index, AnchorID) {
                                    if (AnchorID == CalendarTaskID) {
                                        var index = AnchorTaskIdsList.Id.indexOf(AnchorID);
                                        if (index >= 0) {
                                            AnchorTaskIdsList.Id.splice(index, 1);
                                            AnchorTaskIdsList.Value.splice(index, 1);
                                        }
                                    }
                                });
                            }
                            else
                            {
                                AnchorTaskIdsList.Id.push(CalendarTaskID);
                            }
                            // Added by Arpita Soni for Ticket #2357 on 07/15/2016
                            var ViewBy =  $('#ddlTabViewBy').val();
                            if ($('#IsGridView').val() != "True" &&  ViewBy != null && ViewBy != undefined && ViewBy == '@Enums.DictPlanGanttTypes[Convert.ToString(PlanGanttTypes.ROIPackage)]') {
                                var removeEntirePkg = CalendarTaskID.split('_')[0];
                                gantt.deleteTask(removeEntirePkg);
                                gantt.refreshData();
                                // If there is no data then hide grid and display message
                                if ($(gantt.$grid_data).find('.gantt_row').length <= 0) {
                                    $("#gantt_here").hide();
                                    $(".pull-right.toggle-status.source-sans-proregular").hide();
                                    $("#improvements").hide();
                                    $('#lblMarkringActivitiestitle').hide();
                                    $('#divCollaborator').hide();
                                    $('#divCollaboratorCount').hide(); // Added for #2112
                                    $("#NodatawithfilterCalendar").show();
                                }
                                GetHealderDataPer(filters.SelectedPlans.toString(),filters.customFieldIds.toString(),filters.OwnerIds.toString(),filters.TacticTypeids.toString(),filters.StatusIds.toString(),CalendarId);
                                GetNumberOfActivityPerMonByPlanIdPer(filters.SelectedPlans, isQuater, filters.customFieldIds.toString(),filters.OwnerIds.toString(),filters.TacticTypeids.toString(),filters.StatusIds.toString(),CalendarId);
                            }
                        }

                        // Unbind anchortacticid of the deleted package to honeycomb icons in the grid

                        $('.honeycombbox-icon-gantt[anchortacticid=' + anchorTacticId + ']').each(function () {
                            $(this).attr('anchortacticid', '0');
                        });
                        // Unselect all items from the grid
                        RemoveAllHoneyCombData();

                        ShowMessage(false,  "@RevenuePlanner.Helpers.Common.objCached.UnpackageSuccessful", 3000);
                    }
                });
            }
            else {
                return false;
            }
        }

        // Added by Arpita Soni for Ticket #2354 on 07/05/2016
        function OpenHoneyComb(obj) {
            RemoveAllHoneyCombData();
            IsPackageView = true;

            PreventUnPackageClick = false;
            currentPkgIds = $(obj).attr('pkgtacids').split(',');
            $('.popover-content > #UnpackageHoneyComb').removeAttr('style');
            $('.popover-content > #UnpackageHoneyComb').attr('style', 'cursor: pointer !important');
            var ViewBy =  $('#ddlTabViewBy').val();
            if ($('#IsGridView').val() != "True" &&  ViewBy != null && ViewBy != undefined && ViewBy == '@Enums.DictPlanGanttTypes[Convert.ToString(PlanGanttTypes.ROIPackage)]')
            {
                $('.popover-content > #PackageHoneyComb').removeAttr('style');
                $('.popover-content > #PackageHoneyComb').attr('style', 'color:gray; cursor: default !important');
            }

            // Get tactics belongs to the package
            var IdsNotinList = [];
            for (i = 0; i < currentPkgIds.length; i++) {
                var rowObject = $('.honeycombbox-icon-gantt[taskid=' + currentPkgIds[i] + ']');
                var id = $(rowObject).attr('taskid');

                if(rowObject.is(':visible') == true && id == $(rowObject).attr('anchortacticid')) {
                    PackageAnchorId = id;
                }

                if (IsUpdate==true || rowObject.is(':visible') == false || (id == undefined || id == 'undefined' || id == null || id == "")) {
                    IdsNotinList.push(currentPkgIds[i])
                }

                if (currentPkgIds.indexOf(id) >= 0) {
                    $(rowObject).trigger('click');
                }
            }
            //Added BY Komal rawal for #2358 show tactics in package even if they are not filtered
            if (IdsNotinList.length != 0) {
                $.ajax({
                    beforeSend: function (x) {
                        myApp.hidePleaseWait();
                    },
                    type: 'POST',
                    url: '@Url.Content("~/Home/GetPackageTacticDetails")',
                    data: {
                        viewBy: isRequest ? '@PlanGanttTypes.Request.ToString()' : type,
                        TacticIds: IdsNotinList.toString(),
                        TacticTaskColor: '@TacticTaskColor',
                        IsGridView: $('#IsGridView').val().toLowerCase(),
                    },
                    success: function (data) {
                        var ListData = data.Listofdata;
                        if ($('#IsGridView').val() == "True") {
                            $.each(IdsNotinList, function (index, TacticId) {
                                $.each(ListData, function (index, Data) {
                                    if (Data.TacticId.toString() == TacticId) {
                                        var index = ExportSelectedIds.TaskID.indexOf(Data.TaskId);
                                        if (index < 0)
                                        {
                                            ExportSelectedIds.TaskID.push(Data.TaskId);
                                            ExportSelectedIds.Title.push(htmlDecode(Data.Title));
                                            ExportSelectedIds.OwnerName.push(Data.OwnerName);
                                            ExportSelectedIds.TacticType.push(Data.TacticTypeValue);
                                            ExportSelectedIds.ColorCode.push(Data.ColorCode);
                                            ExportSelectedIds.PlanFlag.push('Grid');
                                            ExportSelectedIds.CsvId.push(Data.CsvId);
                                            ExportSelectedIds.ROITacticType.push(Data.ROITacticType);
                                            ExportSelectedIds.AnchorTacticId.push(Data.AnchorTacticId);
                                            if (Data.PCPTId != undefined && Data.PCPTId != null && Data.PCPTId != "")
                                            {
                                                ExpandTacticsForSelectedPackage(Data.PCPTId);
                                            }
                                            $("div[altid='" + Data.TaskId + "']").addClass("honeycombbox-icon-gantt-Active");
                                        }
                                    }

                                });
                            });
                        }
                        else
                        {
                            $.each(IdsNotinList, function (index, TacticId) {
                                $.each(ListData, function (index, Data) {
                                    if (Data.TacticId.toString() == TacticId) {
                                        var ValueAlreadyExists = false
                                        $("div[name1='" + Data.TaskId + "']").addClass("honeycombbox-icon-gantt-Active");
                                        $.each(ExportSelectedIds.TaskID, function (index, TaskId) {
                                            var Ids = TaskId.split('_');
                                            var index = Ids.indexOf("T" + TacticId);
                                            if(index >= 0)
                                            {
                                                ValueAlreadyExists = true;
                                            }

                                        });
                                        var Dataindex = ExportSelectedIds.TaskID.indexOf(Data.TaskId);
                                        if (Dataindex < 0 && ValueAlreadyExists == false) {
                                            ExportSelectedIds.TaskID.push(Data.TaskId);
                                            ExportSelectedIds.Title.push(htmlDecode(Data.Title));
                                            ExportSelectedIds.OwnerName.push(Data.OwnerName);
                                            ExportSelectedIds.TacticType.push(Data.TacticTypeValue);
                                            ExportSelectedIds.ColorCode.push(Data.ColorCode);
                                            ExportSelectedIds.PlanFlag.push('Calender');
                                            ExportSelectedIds.ROITacticType.push(Data.ROITacticType);
                                            ExportSelectedIds.CalendarEntityType.push(Data.CalendarEntityType);
                                            ExportSelectedIds.AnchorTacticId.push(Data.AnchorTacticId);
                                        }

                                    }

                                });
                            });
                        }


                        $("#totalEntity").text(ExportSelectedIds.TaskID.length);
                        $(".honeycombbox").show();
                    }
                });
            }
            //End
        }

        // Added by Arpita Soni for Ticket #2354 to expand tactics for selected package
        function ExpandTacticsForSelectedPackage(PCPTId) {
            var arrEntityIds = PCPTId.split('_');
            var CampaignId = "", ProgramId = "", TacticId = "";
            if(arrEntityIds!= null && arrEntityIds.length > 2) {
                CampaignId = arrEntityIds[1].replace('C','');
                ProgramId = arrEntityIds[2].replace('P','');

                var divCamp = $('div[taskid="' + CampaignId + '"]').attr('dhtmlxrowid');
                HomeGrid.openItem(divCamp);
                var divProg = $('div[taskid="' + ProgramId + '"]').attr('dhtmlxrowid');
                HomeGrid.openItem(divProg);
            }
        }

        // Added by Arpita Soni to display error message in Honeycomb popup
        function ShowMessageHoneyComb(IsError, Message, time) {
            $(".popover-content > #errorMsgHoneyComb").css("display", "block");
            $(".popover-content > #errorMsgHoneyComb > #spanMsgErrorHoneyComb").empty();
            $(".popover-content > #errorMsgHoneyComb > #spanMsgErrorHoneyComb").text(Message);
            if (time != 'undefined') {
                $(".popover-content > #errorMsgHoneyComb").slideDown(time);
            }
            //Modified By Komal to close message
            $("#errorMsgHoneyComb").find(".close").click(function (e) {
                $(this).closest(".alert").slideUp(400);
            });
        }


        function AddActuals() {
            var pid = $("#CurrentPlanId").val();
            var url = '@Url.Content("~/Plan/AddActual?PlanId=")' + pid + '&isGridView=' + $('#IsGridView').val().toLowerCase(); //Modified by Komal Rawal for 2013 Home/Plan Layout changes
            window.location.href = url;
        }

        function CallBudget() {
            var pid = $("#CurrentPlanId").val();
            var url = '@Url.Content("~/Plan/Budgeting?PlanId=")' + pid + '&isGridView=' + $('#IsGridView').val().toLowerCase(); //Modified by Komal Rawal for 2013 Home/Plan Layout changes
            window.location.href = url;
        }



        // Added by Nirav for Custom Dropdown - 388
        /*added by Nirav for plan consistency on 14 apr 2014*/
        function EditPlan() {
            var pid = $("#CurrentPlanId").val();
            var url = '@Url.Content("~/Plan/CreatePlan?id=")' + pid + '&isGridView=' + $('#IsGridView').val().toLowerCase(); //Modified by Komal Rawal for 2013 Home/Plan Layout changes
            window.location.href = url;
        }
        $(".selectBox select").selectbox();

        /*end Nirav*/
        /// Script Start
        /// Added By: Maninder Singh Wadhva.
        //// Global variable to hold quarter or year.
        var isQuater = Currenttime;//false;


        //// Global variable to hold current tab.
        var type = '@PlanGanttTypes.Tactic.ToString()';
        var isRequest = false;
        var RedirectToRequest = '@RedirectToRequest.ToString().ToLower()'
        if(RedirectToRequest == "true")
        {
            isRequest = true;
        }
        var showTacticStatus = false;   //// Added by Sohel on 12/05/2014 for PL #425 to Show status of tactics on Home and Plan screen

        //// Function to refresh current tab.
        function RefreshCurrentTab() {
            type = $('#ddlTabViewBy').val();
            AjaxRequest();
        }
        /// Script End
        /// Added By: Maninder Singh Wadhva.

        SetBudget("#pbudget");
        SetPriceValue("#pMQLs");
    </script>


    <script type="text/javascript">
        /// Script Start
        /// Added By: Maninder Singh Wadhva.
        //// Default load tactics in view control.
        var activeMenu = $('#ActiveMenu').val().toLowerCase();
        var getViewByList = false;  //// Added by Sohel Pathan on 28/10/2014 for PL ticket #885.
        var Successmsgduplicate = '@Successmsgduplicate';
        var Errormsgduplicate = '@errormsgduplicate';
        var isError = false;
        //Commented by Komal Rawal for 2013 Home/Plan Layout changes
        @*if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
        $("#divcalenderandgridtab").css("display", "block");
    }*@
        function SetPlanButtons() {

            //Added : By Kalpesh Sharma Ticket #638 Cloning icon for plans, campaigns, programs and tactics
            $('#BtnGroup').click(function (e) {
                if ($(this).html().toLowerCase() == "duplicate") {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/Clone")',
                        data: {
                            CloneType: '@Enums.DuplicationModule.Plan',
                            Id: '@Model.PlanId',
                            title: ''
                        },
                        success: function (data) {
                            if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                window.location = '@Url.Content("~/Login/Index")';
                            }
                            else {
                                if (data.redirect) {
                                    var url = '@Url.Content("~/Home/Index?ActiveMenu=")' + $('#ActiveMenu').val() + '&currentPlanId=' + data.planId;
                                    window.location.href = url;
                                    return;
                                }

                                if (data.errormsg) {
                                    alert(data.errormsg);
                                    return;
                                }
                            }
                        }
                    });
                }
                else {
                    var url = '@Url.Content("~/Plan/Create")';
                    window.location.href = url;
                }
            });
        }

        $(document).ready(function () {
            //// Global variable to hold filters

            DuplicatePlanMessage();
            SetPlanButtons();
            var flg = false;
            var strflg = "";
            var PlanIdsCustom;
            SetGantt();
            // Start - Added by Sohel Pathan on 11/12/2014 for PL ticket #1021
            if ('@((bool)ViewBag.ShowInspectPopup)' != '@false') {
                ShowInspectForPlanTacticId();
                //functions added to show campagin and program popup from email url link click when email sent to user when comapign or program shared
                ShowInspectForPlanCampaignId();
                ShowInspectForPlanProgramId();
                ShowInspectForPlanLineItemId();
            }
            else {
                var currentUrlQueryString = window.location.search.toString().toLowerCase();
                var isNotificationEmailShareLink = false;
                if (currentUrlQueryString.indexOf('plancampaignid') > 0 || currentUrlQueryString.indexOf('planprogramid') > 0 || currentUrlQueryString.indexOf('plantacticid') > 0) {
                    isNotificationEmailShareLink = true;
                }
                if ($('#cErrorInspectPopup').html() == '' && isNotificationEmailShareLink == true) {
                    $('#cErrorInspectPopup').html('<strong>Error! </strong> ' + '@ViewBag.ShowInspectPopupErrorMessage');
                    $("#content_wraper").removeClass("span10 all-height").addClass("span10 padding-top40");
                    $('#errorMessageInspectPopup').slideDown(3000);
                }
                else {
                    $("#content_wraper").removeClass("span10 padding-top40").addClass("span10 all-height");
                    $('#errorMessageInspectPopup').slideUp(400);
                }
            }
            // End - Added by Sohel Pathan on 11/12/2014 for PL ticket #1021
            filters.SelectedPlans.push(CurrentPlanId);
            PlanIdsCustom = filters.SelectedPlans.toString();

            LoadPlan();
            getViewByList = true;

            $('#hdnSelectedPlanIds').val(PlanIdsCustom);
            NumberFormatterTipsyTitle(".tipsyclassTitle", 27);


            var planids = [];

            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                planids.push(CurrentPlanId);
            }
            else {
                $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {

                    if ($(this).attr('checked') == 'checked') {
                        var chkid = $(this).attr("id");
                        var Value = $(this).attr("planTitle");
                        if (chkid != undefined && chkid != 'undefined') {
                            planids.push(chkid);
                        }
                    }
                });
            }
            checkedPlancount = $("#ulSelectedPlans li input:checkbox:checked").length;
            $('#tPlancount').text('/' + $('#ulSelectedPlans li').length);
            $('#cPlancount').text(checkedPlancount);

            GetTacticTypelist(planids);
            GetOwnerListForFilter(planids);
            GetLastSetofViews($('#FilterName').val());

            if ($('#IsGridView').val() == "True") {
                $("#CalenderView").hide();
                ChangeTabView(GridId); //Modified by Komal Rawal for 2013 Home/Plan Layout changes

            }
            // LastSetofowners();
        });
        var CloseClick = false;
        var ExportToCsv = false;
        $(document).on('click', function (e) {

            if (CloseClick == true) {

                e.stopPropagation();
                e.preventDefault();

            }
            else {

                var targetname = e.target.nodeName;
                if (targetname != "circle") {
                    $(".popover").removeClass('in').addClass('out');

                }
            }

            CloseClick = false;
        });
        //Modified by Komal Rawal  on 14/12/2015 for PL #1782 :- export to csv from honeycomb not working.
        $(".popover-content").live('click', function (e) {

            if (ExportToCsv) {
                CloseClick = false;
            }
            else {
                CloseClick = true;
            }
            ExportToCsv = false;

        });

        /*Added By Komal Rawal for honeycomb feature #1779*/

        $("#honeycomb").popover({
            title: 'HoneyComb',
            html: true,
            placement: 'top',
            content: function () {
                CloseClick = true;
                $('#honeycomb_content').find(".hc-block").remove();
                var htmlstring = "";            // Contains html for promotion tactics
                var htmlstringForAsset = "";    // Contains html for asset tactics

                // Start - Added by Arpita Soni for Ticket #2354 on 07/11/2016
                // Always display error message on the top in honeycomb popup
                var errMessageTopDisplay = "";
                errMessageTopDisplay = $('#honeycomb_content').find('#errorMsgHoneyComb').get(0).outerHTML;
                if (errMessageTopDisplay == undefined || errMessageTopDisplay == null || errMessageTopDisplay == '')
                {
                    errMessageTopDisplay = '';
                }
                else {
                    $('#honeycomb_content').find("#errorMsgHoneyComb").remove();
                }

                // Enable/Disable Unpackage Menu from Honeycomb popup
                $('#honeycomb_content').find("#UnpackageHoneyComb").removeAttr('style');
                $('#honeycomb_content').find("#PackageHoneyComb").removeAttr('style');

                var ViewBy = $('#ddlTabViewBy').val();

                if ($('#IsGridView').val() != "True" &&  ViewBy != null && ViewBy != undefined && ViewBy == '@Enums.DictPlanGanttTypes[Convert.ToString(PlanGanttTypes.ROIPackage)]')
                {
                    $('#honeycomb_content').find("#PackageHoneyComb").attr('style', 'color:gray; cursor: default !important');
                }
                else {
                    $('#honeycomb_content').find("#PackageHoneyComb").attr('style', 'cursor: pointer !important');
                }

                if (!IsPackageView) {
                    $('#honeycomb_content').find("#UnpackageHoneyComb").attr('style', 'color:gray; cursor: default !important');
                }
                else {
                    $('#honeycomb_content').find("#UnpackageHoneyComb").attr('style', 'cursor: pointer !important');
                }
                // End - Added by Arpita Soni for Ticket #2354 on 07/11/2016

                var hccontrolsdiv = $('#honeycomb_content').find("#hc-controlsdiv").parent().html();
                var Removefromlist = [];

                if (ExportSelectedIds.TaskID.length > 0) {
                    $('#honeycomb_content').html("");

                    for (i = 0; i < (ExportSelectedIds.TaskID.length) ; i++) {
                        var HasActiveClass = false;
                        if ($('#IsGridView').val() == "True") {
                            HasActiveClass = $("div[altid='" + ExportSelectedIds.TaskID[i] + "']").hasClass("honeycombbox-icon-gantt-Active");
                            if (HasActiveClass == true || IsPackageView == true) {
                                // Modified by Arpita Soni for Ticket #2354 on 07/07/2016
                                // Added some attributes for validation in ROI packaging
                                if(ExportSelectedIds.ROITacticType[i] == '@Enums.AssetType.Asset.ToString()')
                                {
                                    // For asset tactics
                                    htmlstringForAsset += '<div class="hc-block asset-bg" anchortacticid="' + ExportSelectedIds.AnchorTacticId[i] + '" dhtmlxrowid="' + ExportSelectedIds.DhtmlxRowId[i] + '"  csvid="' + ExportSelectedIds.CsvId[i] + '" roitactictype="' + ExportSelectedIds.ROITacticType[i] + '"> <div class="row-fluid"> ' +
                                    ' <div  class="span8 pophover-left"  style="border-left: 5px solid #' + ExportSelectedIds.ColorCode[i] + '"> ' +
                                    ' <h5 title="' + htmlEncode(ExportSelectedIds.Title[i]) + '">' + htmlEncode(ExportSelectedIds.Title[i]) + '</h5> ' +
                                    ' <p class="metadata"> ' +
                                    ' <span>' + ExportSelectedIds.TacticType[i] + ' </span>|<span> ' + ExportSelectedIds.OwnerName[i] + '</span> ' +
                                    ' </p></div> ' +
                                    ' <div class="span1 text-right pull-right" title="Delete" > ' +
                                    ' <i taskid = "' + ExportSelectedIds.TaskID[i] + '" id ="CloseIcon"  class="fa fa-times" onclick="CloseIcon(this)" ></i> ' +
                                    ' </div></div></div>';
                                }
                                else {
                                    // For promotion tactics
                                    htmlstring += '<div class="hc-block" anchortacticid="' + ExportSelectedIds.AnchorTacticId[i] + '" dhtmlxrowid="' + ExportSelectedIds.DhtmlxRowId[i] + '"  csvid="' + ExportSelectedIds.CsvId[i] + '" roitactictype="' + ExportSelectedIds.ROITacticType[i] + '"> <div class="row-fluid"> ' +
                                        ' <div  class="span8 pophover-left"  style="border-left: 5px solid #' + ExportSelectedIds.ColorCode[i] + '"> ' +
                                        ' <h5 title="' + htmlEncode(ExportSelectedIds.Title[i]) + '">' + htmlEncode(ExportSelectedIds.Title[i]) + '</h5> ' +
                                        ' <p class="metadata"> ' +
                                        ' <span>' + ExportSelectedIds.TacticType[i] + ' </span>|<span> ' + ExportSelectedIds.OwnerName[i] + '</span> ' +
                                        ' </p></div> ' +
                                        ' <div class="span1 text-right pull-right" title="Delete"> ' +
                                        ' <i taskid = "' + ExportSelectedIds.TaskID[i] + '" id ="CloseIcon"  class="fa fa-times" onclick="CloseIcon(this)" ></i> ' +
                                        ' </div></div></div>';
                                }
                            }
                            else {
                                Removefromlist.push(ExportSelectedIds.TaskID[i]);
                            }
                        }
                        else {
                            //Added by komal Rawal for #2355
                            //Add asset to the top in the honeycomb list
                            if(ExportSelectedIds.ROITacticType[i] == '@Enums.AssetType.Asset.ToString()')
                            {
                                htmlstringForAsset += '<div class="hc-block asset-bg" anchortacticid="' + ExportSelectedIds.AnchorTacticId[i] + '"  EntityTaskId="' + ExportSelectedIds.TaskID[i] + '"  EntityType="' + ExportSelectedIds.CalendarEntityType[i] + '" roitactictype="' + ExportSelectedIds.ROITacticType[i] + '"><div class="row-fluid"><div  class="span8 pophover-left"  style="border-left: 5px solid #' + ExportSelectedIds.ColorCode[i] + '"><h5 title="' +  htmlEncode(ExportSelectedIds.Title[i]) + '">' +  htmlEncode(ExportSelectedIds.Title[i]) + '</h5>  <p class="metadata"><span>' + ExportSelectedIds.TacticType[i] + ' </span>|<span> ' + ExportSelectedIds.OwnerName[i] + '</span></p></div><div class="span1 text-right pull-right" title="Delete"><i taskid = "' + ExportSelectedIds.TaskID[i] + '" id ="CloseIcon"  class="fa fa-times" onclick="CloseIcon(this)" ></i></div></div></div>';
                            }
                            else
                            {
                                htmlstring += '<div class="hc-block" anchortacticid="' + ExportSelectedIds.AnchorTacticId[i] + '"  EntityTaskId="' + ExportSelectedIds.TaskID[i] + '"  EntityType="' + ExportSelectedIds.CalendarEntityType[i] + '" roitactictype="' + ExportSelectedIds.ROITacticType[i] + '"><div class="row-fluid"><div  class="span8 pophover-left"  style="border-left: 5px solid #' + ExportSelectedIds.ColorCode[i] + '"><h5 title="' +  htmlEncode(ExportSelectedIds.Title[i]) + '">' + htmlEncode( ExportSelectedIds.Title[i]) + '</h5>  <p class="metadata"><span>' + ExportSelectedIds.TacticType[i] + ' </span>|<span> ' + ExportSelectedIds.OwnerName[i] + '</span></p></div><div class="span1 text-right pull-right" title="Delete"><i taskid = "' + ExportSelectedIds.TaskID[i] + '" id ="CloseIcon"  class="fa fa-times" onclick="CloseIcon(this)" ></i></div></div></div>';
                            }

                        }

                    }
                }
                $('#honeycomb_content').append(errMessageTopDisplay + htmlstringForAsset + htmlstring + hccontrolsdiv);

                for (i = 0; i < Removefromlist.length; i++) {
                    var index = ExportSelectedIds.TaskID.indexOf(Removefromlist[i]);
                    if (index >= 0) {
                        ExportSelectedIds.TaskID.splice(index, 1);
                        ExportSelectedIds.Title.splice(index, 1);
                        ExportSelectedIds.OwnerName.splice(index, 1);
                        ExportSelectedIds.TacticType.splice(index, 1);
                        ExportSelectedIds.ColorCode.splice(index, 1);
                        ExportSelectedIds.ROITacticType.splice(index, 1);
                        ExportSelectedIds.DhtmlxRowId.splice(index, 1);
                        ExportSelectedIds.AnchorTacticId.splice(index, 1);
                        ExportSelectedIds.CalendarEntityType.splice(index, 1);
                        ExportSelectedIds.AnchorTacticId.splice(index, 1);
                    }


                }

                return $("#honeycomb_content").html();


            }

        });

        function RemoveAllHoneyCombData() {

            $('#honeycomb_content').find(".hc-block").remove();

            // Added by Arpita Soni for Ticket #2354 on 07/07/2016
            IsPackageView = false;
            PreventUnPackageClick = true;
            ExportSelectedIds = {
                TaskID: [],
                Title: [],
                ColorCode: [],
                OwnerName: [],
                TacticType: [],
                PlanFlag: [],
                CsvId: [],
                ROITacticType: [],
                DhtmlxRowId: [],
                AnchorTacticId: [] ,
                CalendarEntityType: [],
            };

            if ($('#IsGridView').val() == "True") {

                $("div[class*='honeycombbox-icon-gantt-Active']").removeClass("honeycombbox-icon-gantt-Active")


            }
            else {
                $("div[class*='honeycombbox-icon-gantt-Active']").removeClass("honeycombbox-icon-gantt-Active");

            }

            $("#totalEntity").text(0);
            $(".popover ").hide();
            $(".honeycombbox").hide();


        }

        function CloseIcon(item) {
            CloseClick = true;
            var taskId = item.attributes.taskid.value;
            var Totallength = $("#totalEntity").text();
            var Height = $(".popover").css('top').replace("px", "");
            var Blockheight = $('.popover-content').find(".hc-block").css('height').replace("px", "");
            var Margin = $('.popover-content').find(".hc-block").css('margin').split(" ")[0].replace("px", "");
            var Sum = parseInt(Number(Blockheight) + Number(Margin));
            var removeFromHoneyComb = true;
            if ($('#IsGridView').val() == "True") {
                // Added by Arpita Soni for Ticket #2354 on 07/07/2016
                if (IsPackageView && currentPkgIds.indexOf($(item).parents('.hc-block').attr('anchortacticid')) > -1) {
                    var result = DeleteTacticFromPackageOnClickCloseIcon(item, taskId, Totallength, Height, Sum);
                    if(!result)
                    {
                        return false;
                    }
                }
                else {
                    // package is not selected then no need to validate any items
                    $("div[altid='" + taskId + "']").removeClass("honeycombbox-icon-gantt-Active");
                    Totallength = Totallength - 1;
                    Height = Number(Height) + (Sum);

                    $("#totalEntity").text(Totallength);
                    $(".popover").css('top', Height + "px");
                }

                var index = ExportSelectedIds.TaskID.indexOf(taskId);
                if (index >= 0) {
                    ExportSelectedIds.TaskID.splice(index, 1);
                    ExportSelectedIds.Title.splice(index, 1);
                    ExportSelectedIds.OwnerName.splice(index, 1);
                    ExportSelectedIds.TacticType.splice(index, 1);
                    ExportSelectedIds.ColorCode.splice(index, 1);
                    ExportSelectedIds.ROITacticType.splice(index, 1);
                    ExportSelectedIds.CalendarEntityType.splice(index, 1);
                    ExportSelectedIds.DhtmlxRowId.splice(index, 1);
                    ExportSelectedIds.AnchorTacticId.splice(index, 1);

                }
            }
            else {
                if (IsPackageView && currentPkgIds.indexOf($(item).parents('.hc-block').attr('anchortacticid')) > -1) {
                    var result = DeleteTacticFromPackageCalendarOnClickCloseIcon(item, taskId, Totallength, Height, Sum);
                    if (!result) {
                        return false;
                    }
                }
                else {
                    // Conditions for Calender
                    $("div[name1='" + taskId + "']").removeClass("honeycombbox-icon-gantt-Active");
                    Totallength = Totallength - 1;
                    Height = Number(Height) + (Sum);

                    $("#totalEntity").text(Totallength);
                    $(".popover").css('top', Height + "px");
                }

                var index = ExportSelectedIds.TaskID.indexOf(taskId);
                if (index >= 0) {
                    ExportSelectedIds.TaskID.splice(index, 1);
                    ExportSelectedIds.Title.splice(index, 1);
                    ExportSelectedIds.OwnerName.splice(index, 1);
                    ExportSelectedIds.TacticType.splice(index, 1);
                    ExportSelectedIds.ColorCode.splice(index, 1);
                    ExportSelectedIds.ROITacticType.splice(index, 1);
                    ExportSelectedIds.CalendarEntityType.splice(index, 1);
                    ExportSelectedIds.AnchorTacticId.splice(index, 1);

                }

            }



            item.parentNode.parentNode.parentNode.remove();
            var HoneyContent = $('.popover-content').find(".hc-block").length;
            if (HoneyContent == 0) {
                PreventUnPackageClick = true;
                IsPackageView = false;
                $(".popover ").hide();
                $(".honeycombbox").hide();
            }
        };


        // Added by Komal Rawal for Ticket #2355 on 13/07/2016
        function DeleteTacticFromPackageCalendarOnClickCloseIcon(item, taskId, Totallength, Height, Sum) {
            // If package is selected then apply validation as per selected asset or promotion
            var ROITacticType = $(item).parents('.hc-block').attr('roitactictype');
            var CalendarTaskID = $('.popover-content').find(".hc-block[roitactictype=@Enums.AssetType.Asset.ToString()]").attr('entitytaskid');
            var ListIds = taskId.split('_');
            var anchorTacticId = 0;
            $.each(ListIds, function (index, Id) {
                if (Id.indexOf('T') >= 0) {
                    anchorTacticId = Id.replace("T", "");
                }

            });
            var IsPromotion = true;
            var PromoID = 0;

            // If Asset tactic then provide confirmation to delete entire package
            if (ROITacticType.toLowerCase() == '@Enums.AssetType.Asset.ToString().ToLower()') {
                var deleteAsset = confirm('Deleting this Tactic will delete the entire package.\n Do you wish to continue?');
                IsPromotion = false;
                if (!deleteAsset) {
                    removeFromHoneyComb = false;
                    return false;
                }
                else{
                    $('.popover-content').find(".hc-block[anchortacticid= " + anchorTacticId +" ]").each(function () {
                        var TaskID = $(this).attr('entitytaskid');
                        AddRemovePackageItems.RemoveId.push(TaskID);
                    });
                }
            }


            // Delete tactics from database
            $.ajax({
                beforeSend: function (x) {
                    if (ROITacticType.toLowerCase() != '@Enums.AssetType.Asset.ToString().ToLower()') {
                        myApp.hidePleaseWait();
                    }
                },
                type: 'POST',
                url: '@Url.Content("~/Home/UnpackageTactics")',
                data: { AnchorTacticId: anchorTacticId, IsPromotion: IsPromotion },
                success: function (data) {
                    var TaskHtml = $("div[task_id='" + CalendarTaskID + "']")[0];
                    if(TaskHtml != 'undefined' && TaskHtml != undefined && TaskHtml != null)
                    {
                        var FileNode = TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0);
                        if(FileNode != null && FileNode!= 'undefined' && FileNode != undefined)
                        {
                            FileNode = TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0).outerHTML;
                        }
                    }
                    var ViewBy = $('#ddlTabViewBy').val();

                    if (IsPromotion) {
                        AddRemovePackageItems.RemoveId.push(taskId);
                        if(TaskHtml != 'undefined' && TaskHtml != undefined && TaskHtml != null)
                        {
                            TaskHtml.firstChild.getElementsByClassName("ROIPackage").item(0).setAttribute("pkgtacids", data.remainItems.toString());
                        }

                        if (AnchorTaskIdsList.Id.length != 0) {
                            $.each(AnchorTaskIdsList.Id, function (index, AnchorID) {
                                if (AnchorID == CalendarTaskID) {
                                    AnchorTaskIdsList.Value[index] = data.remainItems.toString()
                                }
                            });
                        }
                        else {

                            AnchorTaskIdsList.Id.push(CalendarTaskID);
                            AnchorTaskIdsList.Value.push(data.remainItems.toString());
                        }

                        if ($('#IsGridView').val() != "True" &&  ViewBy != null && ViewBy != undefined && ViewBy == '@Enums.DictPlanGanttTypes[Convert.ToString(PlanGanttTypes.ROIPackage)]')
                        {
                            var taskToDelete = $("div[name1='" + taskId + "']");
                            if(taskToDelete != undefined && taskToDelete.length > 0){
                                gantt.deleteTask(taskId);
                            }
                        }
                        // Update count on Honeycomb icon
                        // Conditions for Calender
                        $("div[name1='" + taskId + "']").removeClass("honeycombbox-icon-gantt-Active");
                        Totallength = Totallength - 1;
                        Height = Number(Height) + (Sum);

                        // Unbind anchortacticid of the deleted package to honeycomb icons in the grid
                        $('.honeycombbox-icon-gantt[name1 =' + taskId + ']').each(function () {
                            $(this).attr('anchortacticid', '0');
                        });
                    }
                    else {

                        // As package is deleted, remove package icon from the grid
                        if(TaskHtml != 'undefined' && TaskHtml != undefined && TaskHtml != null)
                        {
                            var BlankDiv = TaskHtml.getElementsByClassName("gantt_blank").item(0);
                            var IsLinkIcon = TaskHtml.firstChild.getElementsByClassName("unlink-icon");
                            var AllCHildNodes = TaskHtml.firstChild.innerHTML;
                            if(BlankDiv != null && BlankDiv!= 'undefined' && BlankDiv != undefined)
                            {
                                AllCHildNodes = AllCHildNodes.replace(FileNode, "");

                            }
                            else
                            {
                                if(IsLinkIcon != null && IsLinkIcon != 'undefined' && IsLinkIcon != undefined && IsLinkIcon.length <= 1)
                                {
                                    AllCHildNodes = AllCHildNodes.replace(FileNode, "<div class='gantt_tree_icon gantt_blank'></div>");
                                }
                                else
                                {
                                    AllCHildNodes = AllCHildNodes.replace(FileNode, "");
                                }
                            }

                            TaskHtml.firstChild.innerHTML = AllCHildNodes;
                        }

                        $.each(AnchorTaskIdsList.Id, function (index, AnchorID) {
                            if (AnchorID == CalendarTaskID) {
                                var index = AnchorTaskIdsList.Id.indexOf(AnchorID);
                                if (index >= 0) {
                                    AnchorTaskIdsList.Id.splice(index, 1);
                                    AnchorTaskIdsList.Value.splice(index, 1);
                                }

                            }

                        });
                        AnchorTaskIdsList.Id.push(CalendarTaskID);
                        if ($('#IsGridView').val() != "True" &&  ViewBy != null && ViewBy != undefined && ViewBy == '@Enums.DictPlanGanttTypes[Convert.ToString(PlanGanttTypes.ROIPackage)]') {
                            var removeEntirePkg = taskId.split('_')[0];
                            gantt.deleteTask(removeEntirePkg);
                            gantt.refreshData();
                        }
                        // If there is no data then hide grid and display message
                        if ($(gantt.$grid_data).find('.gantt_row').length <= 0) {
                            $("#gantt_here").hide();
                            $(".pull-right.toggle-status.source-sans-proregular").hide();
                            $("#improvements").hide();
                            $('#lblMarkringActivitiestitle').hide();
                            $('#divCollaborator').hide();
                            $('#divCollaboratorCount').hide(); // Added for #2112
                            $("#NodatawithfilterCalendar").show();
                        }

                        // If asset tactic is deleted then entire package deleted so remove all data from honeycomb
                        RemoveAllHoneyCombData();

                        $('.honeycombbox-icon-gantt[anchortacticid=' + anchorTacticId + ']').each(function () {
                            $(this).attr('anchortacticid', '0');
                        });

                        ShowMessage(false,  "@RevenuePlanner.Helpers.Common.objCached.UnpackageSuccessful", 3000);
                    }




                    $("#totalEntity").text(Totallength);
                    $(".popover").css('top', Height + "px");
                }
            });

            return true;
        }
        //End

        // Added by Arpita Soni for Ticket #2354 on 07/08/2016
        function DeleteTacticFromPackageOnClickCloseIcon(item, taskId, Totallength, Height, Sum) {
            // If package is selected then apply validation as per selected asset or promotion
            var ROITacticType = $(item).parents('.hc-block').attr('roitactictype');
            var planTacticId = $(item).parents('.hc-block').attr('csvid').split('_')[1];
            var dhtmlxrowid = $(item).parents('.popover-content').find(".hc-block[roitactictype='@Enums.AssetType.Asset.ToString()']").attr('dhtmlxrowid');
            var IsPromotion = true;

            // If Asset tactic then provide confirmation to delete entire package
            if (ROITacticType.toLowerCase() == '@Enums.AssetType.Asset.ToString().ToLower()') {
                var deleteAsset = confirm('Deleting this Tactic will delete the entire package.\n Do you wish to continue?');
                IsPromotion = false;
                if (!deleteAsset) {
                    removeFromHoneyComb = false;
                    return false;
                }
            }

            // Delete tactics from database
            $.ajax({
                type: 'POST',
                beforeSend: function (x) {
                    if (ROITacticType.toLowerCase() != '@Enums.AssetType.Asset.ToString().ToLower()') {
                        myApp.hidePleaseWait();
                    }
                },
                url: '@Url.Content("~/Home/UnpackageTactics")',
                data: { AnchorTacticId: planTacticId, IsPromotion: IsPromotion },
                success: function (data) {
                    var getvalue = HomeGrid.cells(dhtmlxrowid, 1).getValue();
                    var Index = getvalue.indexOf("pkgIcon");

                    if (IsPromotion) {
                        if (Index > -1) {
                            // Bind updated items to package icon into grid
                            var newValue = "<div id=pkgIcon class='package-icon package-icon-grid' style='cursor:pointer'  onclick=OpenHoneyComb(this) pkgtacids=" + data.remainItems.toString() + "><i class='fa fa-object-group'></i></div>";
                            var oldValue = $(getvalue).get(0).outerHTML;
                            getvalue = getvalue.replace(oldValue, newValue);
                            HomeGrid.cells(dhtmlxrowid, 1).setValue(getvalue);
                        }
                        // Unbind anchortacticid of the deleted package to honeycomb icons in the grid
                        $('.honeycombbox-icon-gantt[csvid=Tactic_' + planTacticId + ']').each(function () {
                            $(this).attr('anchortacticid', '0');
                        });
                        // Update count on Honeycomb icon
                        $("div[altid='" + taskId + "']").removeClass("honeycombbox-icon-gantt-Active");
                        Totallength = Totallength - 1;
                        Height = Number(Height) + (Sum);
                    }
                    else {
                        // As package is deleted, remove package icon from the grid
                        if (Index > -1) {
                            var newValue = $(getvalue).get(0).outerHTML;
                            getvalue = getvalue.replace(newValue, '');
                            HomeGrid.cells(dhtmlxrowid, 1).setValue(getvalue);
                        }
                        // Unbind anchortacticid of the deleted package to honeycomb icons in the grid
                        $('.honeycombbox-icon-gantt[anchortacticid=' + planTacticId + ']').each(function () {
                            $(this).attr('anchortacticid', '0');
                        });

                        // If asset tactic is deleted then entire package deleted so remove all data from honeycomb
                        RemoveAllHoneyCombData();
                        ShowMessage(false,  "@RevenuePlanner.Helpers.Common.objCached.UnpackageSuccessful", 3000);
                    }

                    $("#totalEntity").text(Totallength);
                    $(".popover").css('top', Height + "px");
                }
            });
            return true;
        }

        function LoadPlan() {
            var plans = @Html.Raw(Json.Encode(ListBudgetingPlan))
            populateNF(plans, "dropdown-plan-title");
            var nlform = new NLForm(document.getElementById('nl-form2'));
        }


        var appendtag = '';//uday
        function DuplicatePlanMessage() {
            /*close x event on message*/
            $("#SuccessMsg").find(".close").click(function (e) {
                e.stopPropagation();
                e.preventDefault();
                $("#content_wraper").removeClass("span10 padding-top40").addClass("span10 all-height");
                $(this).closest(".alert").slideUp(300);/*SlideUp value change 400 to 300 by Mitesh Vaishnav on 04 july 2014*/
            });

            $("#errorMsg").find(".close").click(function (e) {
                e.stopPropagation();
                e.preventDefault();
                $("#content_wraper").removeClass("span10 padding-top40").addClass("span10 all-height");
                $(this).closest(".alert").slideUp(400);
            });

            if (Successmsgduplicate != "") {
                ShowMessage(isError, Successmsgduplicate, 3000);
            }

            if (Errormsgduplicate != "") {
                isError = true;
                ShowMessage(isError, Errormsgduplicate, 400);
            }
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        function ShowInspectForPlanTacticId() {
            var hdnshowInspectForPlanTacticId = $("#hdnshowInspectForPlanTacticId")
            var hdnIsImprovement = $('#hdnIsImprovement');
            if (hdnshowInspectForPlanTacticId.val() != 0) {
                ShowModel(null, true);
                hdnshowInspectForPlanTacticId.val(0);
                hdnIsImprovement.val(false);
            }
        }

        function ShowInspectForPlanCampaignId() {
            var hdnshowInspectForPlanCampaignId = $("#hdnshowInspectForPlanCampaignId")
            if (hdnshowInspectForPlanCampaignId.val() != 0) {
                ShowModel(null, true);
                hdnshowInspectForPlanCampaignId.val(0);
            }
        }

        function ShowInspectForPlanProgramId() {
            var hdnshowInspectForPlanProgramId = $("#hdnshowInspectForPlanProgramId")
            if (hdnshowInspectForPlanProgramId.val() != 0) {

                ShowModel(null, true);
                hdnshowInspectForPlanProgramId.val(0);
            }
        }
        function ShowInspectForPlanLineItemId() {
            var hdnShowInspectForPlanLineItemId = $("#hdnShowInspectForPlanLineItemId")
            if (hdnShowInspectForPlanLineItemId.val() != 0) {
                ShowModel(null, true);
                hdnShowInspectForPlanLineItemId.val(0);
            }
        }
        strflg = "";

        function ApplyOrRemoveFilter() {
            ($(this).toggleClass("x-icon"));
            RefreshCurrentTab();
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Function to add html for improvement activities.
        function AddImprovementActivities(colorCode, parentTitle, parentId, filteredData) {
            var accordionDiv = $('#DivAccordionImprovementActivities');
            accordionDiv.append("<div class='accordion-heading'>\
                                    <a href='#accordion-element-improvement-" + parentId + "' data-toggle='collapse' colorcode = '" + colorCode + "' class='accordion-toggle item-color collapsed chevron-right'>\
                                        <div class='cf'>" + parentTitle + "<span class='pull-right'><span id='spnimprovement_" + parentId + "'>0</span>/" + filteredData.length + "</span></div>\
                                    </a>\
                                </div>\
                                <div class='accordion-body collapse' id='accordion-element-improvement-" + parentId + "'>\
                                </div>");

            $.each(filteredData, function (index2, objfilteredData) {
                $("#accordion-element-improvement-" + parentId).append("<a taskid='" + objfilteredData.TaskId + "' colorcode = '" + colorCode + "' class='accordion-inner item-color cursor-pointer'>" + objfilteredData.Title + "</a>")
                $("a[taskid='" + objfilteredData.TaskId + "']").click(function (event) {
                    GanttOpenBranch($(this).attr('taskid'));
                });
            })

            $(accordionDiv).find('.item-color').each(function () {
                var colorcode = $(this).attr('colorcode');
                if ($(this).find('.cf').length == 0) {
                    $(this).css("border-left", "7px solid #" + colorcode);
                    $(this).hover(function () {
                        $(this).css("background-color", "#" + colorcode);
                    },
                    function () {
                        $(this).css("background", "none repeat scroll 0% 0% transparent");
                    }
                    );
                }
                else {
                    $(this).find('.cf').css("border-left", "7px solid #" + colorcode);
                    $(this).find('.cf').hover(function () {
                        $(this).css("background-color", "#" + colorcode);
                    },
                    function () {
                        $(this).css("background", "none repeat scroll 0% 0% transparent");
                    }
                    );
                }

            });
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Function to add marketing activities.
        function AddMarketingActivities(colorCode, parentTitle, parentId, filteredData) {
            var accordionDiv = $('#DivAccordionMarketingActivities');
            accordionDiv.append("<div class='accordion-heading'>\
                                    <a href='#accordion-element-marketing-" + parentId + "' data-toggle='collapse' colorcode = '" + colorCode + "' class='accordion-toggle item-color collapsed chevron-right'>\
                                        <div class='cf'>" + parentTitle + "<span class='pull-right'><span id='spn_" + parentId + "'>0</span>/" + filteredData.length + "</span></div>\
                                    </a>\
                                </div>\
                                <div class='accordion-body collapse' id='accordion-element-marketing-" + parentId + "'>\
                                </div>");

            $.each(filteredData, function (index2, objfilteredData) {
                $("#accordion-element-marketing-" + parentId).append("<a taskid='" + objfilteredData.TaskId + "' colorcode = '" + colorCode + "' class='accordion-inner item-color cursor-pointer'>" + objfilteredData.Title + "</a>")
                $("a[taskid='" + objfilteredData.TaskId + "']").click(function (event) {
                    GanttOpenBranch($(this).attr('taskid'));
                });
            })

            $(accordionDiv).find('.item-color').each(function () {
                var colorcode = $(this).attr('colorcode');
                if ($(this).find('.cf').length == 0) {
                    $(this).css("border-left", "7px solid #" + colorcode);
                    $(this).hover(function () {
                        $(this).css("background-color", "#" + colorcode);
                    },
                    function () {
                        $(this).css("background", "none repeat scroll 0% 0% transparent");
                    }
                    );
                }
                else {
                    $(this).find('.cf').css("border-left", "7px solid #" + colorcode);
                    $(this).find('.cf').hover(function () {
                        $(this).css("background-color", "#" + colorcode);
                    },
                    function () {
                        $(this).css("background", "none repeat scroll 0% 0% transparent");
                    }
                    );
                }

            });
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Function to add improvement activities.
        function AddAccordionToggleAndInnerImprovementTactic(improvementTacticTypeForAccordion, improvementTacticForAccordion) {
            var accordionDiv = $('#DivAccordionImprovementActivities');
            accordionDiv.empty();
            $.each(improvementTacticTypeForAccordion, function (index1, tactic) {
                var colorCode = tactic.ColorCode;
                var improvementTacticTypeId = tactic.ImprovementTacticTypeId;

                //// Filter plan improvement tactic based on improvement tactic type id.
                var filteredTactic = $.grep(improvementTacticForAccordion, function (value) { return value.ImprovementTacticTypeId == improvementTacticTypeId; })
                AddImprovementActivities(colorCode, tactic.Title, improvementTacticTypeId, filteredTactic);
            })
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Function to create tactic view control.
        function AddAccordionToggleAndInnerTactic(data) {
            if (data.tacticType != undefined && data.tacticType != 'undefined') {
                if (data.tacticType.length > 0) {
                    var accordionDiv = $('#DivAccordionMarketingActivities');
                    accordionDiv.empty();
                    $.each(data.tacticType, function (index1, objTactic) {
                        var colorCode = objTactic.ColorCode;
                        var tacticTypeId = objTactic.TacticTypeId;

                        //// Filter plan campaign program tactic based on tactic type id.
                        var filteredTactic = $.grep(data.planCampaignProgramTactic, function (value) { return value.TacticTypeId == tacticTypeId; })
                        AddMarketingActivities(colorCode, objTactic.Title, tacticTypeId, filteredTactic);
                    });
                }
                else {
                    $('#marketing-activities').hide();
                }
            }
            else {
                $('#marketing-activities').hide();
            }
        }

        function GanttOpenBranch(taskId) {

            var flag = false;
            $(".gantt_grid_data").find('div[class^="gantt_row"]').each(function (index1) {
                var itaskid = $(this).attr('task_id');
                if (taskId == itaskid) {
                    flag = true;
                }
            });

            if (flag == false) {

                if (type.toString() == '@PlanGanttTypes.Tactic.ToString()' || type.toString() == '@PlanGanttTypes.Request.ToString()' || taskId.substring(0, 1) == "Z") {
                    GanttOpenTaskInCalender(taskId);
                }
                else {
                    $('.gantt_task_line').each(function () {
                        var ganttTaskid = $(this).attr('task_id');
                        if (ganttTaskid.indexOf(taskId) > 0) {
                            var taskPrefix = ganttTaskid.substring(0, ganttTaskid.indexOf('_')) + '_';
                            GanttOpenTaskInCalender(taskPrefix + taskId);
                        }
                    });
                }
            }
        }

        function GanttOpenTaskInCalender(taskId) {
            var arr = taskId.split('_');
            //// Added by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
            var CampaignID = ''
            if (arr.length >= 3) {
                CampaignID = arr[0] + '_';
            }
            ////

            var newTaskId = '';

            $.each(arr, function (index, item) {
                var tId = '';
                for (var counter = 0; counter <= index; counter++) {
                    if (tId == '') {
                        tId = arr[counter]
                    }
                    else {
                        tId += '_' + arr[counter]
                    }
                }

                if (newTaskId == '') {
                    newTaskId = tId;
                }
                gantt.open(tId);
            });

            isRender = true;
            iterateMarketingActivitesOnExpand(newTaskId);
            isRender = false;
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Function to create vertical view control.
        function AddAccordionToggleAndInnerCustomFields(data) {
            if (data.customFields != undefined && data.customFields != 'undefined') {
                if (data.customFields.length > 0) {
                    var accordionDiv = $('#DivAccordionMarketingActivities');
                    accordionDiv.empty();

                    $.each(data.customFields, function (index1, objVertical) {
                        var colorCode = objVertical.ColorCode;
                        var cfId = objVertical.cfId;
                        var filteredVertical = $.grep(data.customFieldTactics, function (value) { return value.cfId == cfId; }).sort(SortAlphabetically);
                        AddMarketingActivities(colorCode, objVertical.Title, cfId, filteredVertical);
                    });
                }
                else {
                    $('#marketing-activities').hide();
                }
            }
            else {
                $('#marketing-activities').hide();
            }
        }

        //// Function to create request view control.
        var activities = { data: '' };
        function AddAccordionToggleAndInnerRequest(data) {
            AddAccordionToggleAndInnerTactic(data);
        }

        //// Function to sort alphabetically.
        function SortAlphabetically(obj1, obj2) {
            var obj1Property = obj1.Title.toLowerCase();
            var obj2Property = obj2.Title.toLowerCase();
            return ((obj1Property < obj2Property) ? -1 : ((obj1Property > obj2Property) ? 1 : 0));
        }

        var planYear;
        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Modified By Maninder Singh Wadhva to Address PL#203
        //// Function to make ajax request.
        function AjaxRequest() {
            //// Start - Added by Sohel Pathan on 19/01/2015 for PL ticket #1134
            //   if (IsUpdate) { //Modified By Komal rawal for 2104 as tactic did not load for new user
            filters.customFieldIds = [];

            $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.customFieldIds.push(chkid);
                    }
                }
            });
            filters.SelectedPlans = [];
            $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        filters.SelectedPlans.push(chkid);
                    }
                }
            });
            if (filters.SelectedPlans.length == 1) {
                CurrentPlanId = filters.SelectedPlans[0].toString();
                $("#CurrentPlanId").val(filters.SelectedPlans[0].toString());

            }

            // Add by dasharth parjapti
            // Desc ::  to resolve the owner filter issue
            filters.OwnerIds = [];
            $("#ulSelectedOwner li input:checkbox:checked").map(function () {
                filters.OwnerIds.push($(this).attr("id"));
            });

            // Add By Nishant Sheth
            // Desc :: To resolve the #1981 code review points to resolve click on clear filters and
            filters.TacticTypeids = [];
            $("#ulTacticType li input:checkbox:checked").map(function () {
                filters.TacticTypeids.push($(this).attr("id").replace("CbTT", ""));
            });

            filters.StatusIds = [];
            $("#ulStatus li input:checkbox:checked").map(function () {
                filters.StatusIds.push($(this).attr("id"));
            });
            //   }
            //// End - Added by Sohel Pathan on 19/01/2015 for PL ticket #1134

            //Added for "Select All" case of #1953 and #1993 By Maitri Gandhi on 16/2/2016
            var CheckedCounter = 0, AllCounter = 0, id = null, UncheckedCounter = 0;
            $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                    AllCounter = $(this).find("input[type=checkbox]").length;
                    CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                    UncheckedCounter = AllCounter - CheckedCounter;
                    if (AllCounter == UncheckedCounter) {
                        var Id = $(this).attr("id");
                        if (Id.indexOf("-") >= 0)
                        {
                            Id = Id.split('-')[1];
                            var CustomId = Id + "_null";
                            filters.customFieldIds.push(CustomId);

                        }
                    }
                    else if (AllCounter == CheckedCounter) {
                        id = this.id;
                        if (id != null && id != "" && id.indexOf("-") > -1) {
                            id = this.id.split("-")[1];
                        }
                        var i = 0, customfieldid;
                        for (i = 0; i < filters.customFieldIds.length; i++) {
                            if (filters.customFieldIds[i].indexOf("_") > -1) {
                                customfieldid = filters.customFieldIds[i].split("_")[0];
                                if (id == customfieldid) {
                                    filters.customFieldIds.splice(i, 1);
                                    i--;
                                }
                            }
                        }
                    }

                }
            });        ////End

            var Planid = filters.SelectedPlans;
            var CustomFieldId = filters.customFieldIds;
            var OwnerIds = filters.OwnerIds;
            var TacticTypeids = filters.TacticTypeids; //Modified for #1283
            var GetSelectedPlanNo = filters.SelectedPlans.length;
            var StatusIds = filters.StatusIds;
            PdfFilters.SelectedPlans = [];
            $.each(filters.SelectedPlans, function () {
                PdfFilters.SelectedPlans.push(this);
            });
            PdfFilters.OwnerIds = [];
            $.each(filters.OwnerIds, function () {
                PdfFilters.OwnerIds.push(this);
            });
            PdfFilters.TacticTypeids = [];
            $.each(filters.TacticTypeids, function () {
                PdfFilters.TacticTypeids.push(this);
            });
            PdfFilters.StatusIds = [];
            $.each(filters.StatusIds, function () {
                PdfFilters.StatusIds.push(this);
            });
            //PdfFilters.SelectedPlans = filters.SelectedPlans;
            PdfFilters.customFieldIds = filters.customFieldIds;
            isQuater = $('#ddlUpComingActivites').val();

            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                // #838 Showing Multiple Plans on Plan Page : Kalpesh Sharma
                Planid = CurrentPlanId;
                GetSelectedPlanNo = 1;
            }
            if (Planid != 0) {
                if (!IsViewBy) {
                    GetHealderDataPer(Planid.toString(), CustomFieldId.toString(), OwnerIds.toString(), TacticTypeids.toString(), filters.StatusIds.toString(), CalendarId);
                }
                IsViewBy = false;
                GetNumberOfActivityPerMonByPlanIdPer(Planid.toString(), isQuater, CustomFieldId.toString(), OwnerIds.toString(), TacticTypeids.toString(), filters.StatusIds.toString(), CalendarId);
                $.ajax({
                    type: "POST",//Modified BY Komal Rawal for #1991 to solve json length problem in passing query string.
                    cache: false,
                    url: '@Url.Action("GetViewControlDetail", "Home")',
                    data: {
                        viewBy: isRequest ? '@PlanGanttTypes.Request.ToString()' : type,
                        PlanId: Planid.toString(),
                        timeFrame: isQuater,
                        customFieldIds: CustomFieldId.toString(),
                        ownerIds: OwnerIds.toString(),
                        TacticTypeid: TacticTypeids.toString(),
                        StatusIds: filters.StatusIds.toString(),
                        activeMenu: $('#ActiveMenu').val(),
                        getViewByList: getViewByList,
                        isupdate: IsUpdate,
                    },
                    dataType: "json",
                    success: function (data) {
                        // Add By Nishant Sheth
                        // Desc :: To get header values with cache object
                        //GetHealderDataPer(Planid.toString(), CustomFieldId.toString(), OwnerIds.toString(), TacticTypeids.toString(), filters.StatusIds.toString(),CalendarId);
                        if (data.serviceUnavailable != 'undefined' && data.serviceUnavailable == '#') {
                            window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                        }
                        else if (data.isError != 'undefined' && data.isError == true) {
                            ShowMessage(true, "Error occured due to exception. Please contact system admin.");
                        }
                        else {
                            // Add By Nishant sheth
                            // #1818 :: Display message if no any data with filters
                            if (data.taskData.length > 0 || isRequest) {
                                $("#gantt_here").show();
                                $(".pull-right.toggle-status.source-sans-proregular").show();
                                // $("#improvements").show();
                                $('#lblMarkringActivitiestitle').hide();
                                $('#divCollaborator').show();
                                $('#divCollaboratorCount').show(); // Added for #2112
                                $("#NodatawithfilterCalendar").hide();

                                type = data.ViewBy.toString();
                                if (getViewByList == true) {
                                    BindViewSelections(data.ViewById, type);
                                }
                                getViewByList = false;
                                $('#ddlTabViewBy').val(data.ViewBy.toString());
                                $('.request-icons').find('.counter').html(data.requestCount);
                                planYear = parseInt(data.planYear);
                                var isDataExistForTacticTable = false;
                                //// Modified By Maninder Singh Wadhva PL Ticket#47
                                if (typeof data.improvementTacticTypeForAccordion != 'undefined' &&
                                    typeof data.improvementTacticForAccordion != 'undefined' &&
                                    data.improvementTacticForAccordion.length > 0 &&
                                    data.improvementTacticTypeForAccordion.length > 0 &&
                                    data.taskData.length > 0) {
                                    // $('#improvements').show();
                                    // AddAccordionToggleAndInnerImprovementTactic(data.improvementTacticTypeForAccordion, data.improvementTacticForAccordion);
                                    isDataExistForTacticTable = true;
                                    $('#improvements').hide();
                                }
                                else {
                                    $('#improvements').hide();
                                }

                                // To hide/show current plan edit button based on user plan edit permission
                                if ((CurrentPlanId > 0 && GetSelectedPlanNo == 1) || activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                                    $("#divPlanEditButtonHome").show();
                                    $("#divPlanButton").removeClass('full-radius');// Added for single button with radius all corner #2015
                                    $('.WelcomeMessageBorder').show();
                                    GetCurrentPlanPermissionDetail();
                                }
                                else {
                                    $("#divPlanEditButtonHome").hide();
                                    $("#divPlanButton").addClass('full-radius');// Added for single button with radius all corner #2015
                                    $('.WelcomeMessageBorder').show();
                                    //  $("#divAddActuals").hide();
                                }

                                //// Modified By Maninder Singh Wadhva PL Ticket#47
                                //// filtering non improvement task data.
                                var filteredNonImprovementData = $.grep(data.taskData, function (value) { return (typeof value.isImprovement == 'undefined') });
                                if (filteredNonImprovementData.length > 0 && activeMenu == '@Enums.ActiveMenu.Home.ToString().ToLower()') {
                                    isDataExistForTacticTable = true;
                                    $('#marketing-activities').show();
                                    var IsCampaign = type.indexOf('@Common.CampaignCustomTitle') > 0 ? '@Common.CampaignCustomTitle' : type.toString();
                                    var IsProgram = type.indexOf('@Common.ProgramCustomTitle') > 0 ? '@Common.ProgramCustomTitle' : type.toString();
                                    var IsTactic = type.indexOf('@Common.TacticCustomTitle') > 0 ? '@Common.TacticCustomTitle' : type.toString();
                                    if (isRequest) {
                                        // AddAccordionToggleAndInnerRequest(data);
                                    }
                                    else if (type == '@PlanGanttTypes.Tactic.ToString()') {
                                        //  AddAccordionToggleAndInnerTactic(data);
                                    }
                                    else if (IsTactic == type) {
                                        //   AddAccordionToggleAndInnerCustomFields(data);
                                    }
                                    else {
                                        $('#marketing-activities').hide();
                                    }

                                    AttachEventToGroupHeading();
                                    $('#marketing-activities').hide();
                                }
                                else {
                                    $('#marketing-activities').hide();
                                }

                                //GanttTaskData = data.taskData; // Add By Nishant Sheth
                                renderGantt(data.taskData);
                                //commented by Rahul Shah on 22/02/2016 for PL #1905. to set focus after link tactic
                                // var _scrollY = scrollstate.y
                                // gantt.scrollTo(0, _scrollY);
                                $("html, body").animate({ scrollTop: bodyscrollpos }, 100);

                                var w1 = window.innerWidth;
                                var w3 = document.body.clientWidth;

                                //// Hide/Show Tabulated data shown below gantt of request tab.
                                if (isRequest) {
                                    requestPlanActiveTab(isRequest);
                                    //$(".shadow-scroll-gantt").hide();   //Commented by Rahul Shah on 14/09/2015 for PL #1582
                                    $("#table_activities").show();
                                    FillTacticTableForRequest(data);
                                    $("#ddlTabViewBy").find("option[value= @PlanGanttTypes.Tactic.ToString()]").prop("selected", "selected");
                                    $("#ddlTabViewBy").multiselect('refresh');
                                    isRequest = false;
                                }
                                else {
                                    requestPlanActiveTab(false);
                                    $("#table_activities").hide();
                                    $(".shadow-scroll-gantt").hide();
                                }
                                //gantt.refreshData();

                                // Commented By Nishant Sheth
                                // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                                //$("div[id^='LinkIcon']").each(function () {

                                //    bootstrapetitle($(this), 'This tactic is linked to ' + "<U>" + htmlDecode($(this).attr('linkedplanname') + "</U>"), "tipsy-innerWhite");
                                //});
                                //$(".gantt_container .gantt_tree_content").each(function (index, element) {

                                //    $(element).attr("title", htmlDecode(element.innerHTML));
                                //});

                                //// Added By Ravindra Singh Sisodiya  PL Ticket #1411
                                //// display popup based on type and name and title.

                                $(".gantt_last_cell").dblclick(function (e) {
                                    e.stopPropagation();
                                });

                                // Commented By Nishant Sheth
                                // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                                //$(".gantt_add").click(function (e) {

                                //    var type = $(this).attr('id');
                                //    var name = $(this).attr('Name');
                                //    var title = $(this).attr('aria-label');
                                //    var permission = $(this).attr('Permission');
                                //    var linetype = $(this).attr('lineitemtype');
                                //    var LinkTacticPermission = $(this).attr('linktacticpermission');
                                //    var LinkedTacticId = $(this).attr('linkedtacticid');
                                //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

                                //});

                                var $doc = $(document);
                                $doc.click(function () {
                                    $('#popupType').css('display', 'none');
                                });

                                $(document).mouseup(function (e) {
                                    $('#popupType').css("display", "none");
                                });
                                $(".gantt_ver_scroll").scroll(function () {
                                    $('#popupType').css('display', 'none');
                                });

                            } else {
                                //Add By Nishant Sheth
                                // Desc :: #1818
                                $("#gantt_here").hide();
                                $(".pull-right.toggle-status.source-sans-proregular").hide();
                                $("#improvements").hide();
                                $('#lblMarkringActivitiestitle').hide();
                                $('#divCollaborator').hide();
                                $('#divCollaboratorCount').hide(); // Added for #2112
                                $("#NodatawithfilterCalendar").show();
                            }
                        }

                    }
                });
            }
            else {
                $('#DivloadPlan').hide();
                $('.tab-content').hide();
                $('#chart2').hide();
                $('#pbudget').attr("original-title", "$0");
                $('.changes').hide();
                $('#Notabcontent').show();
                $('#divhoneycombbox').hide(); // Add By Nishant Sheth Desc :: To hide the honey comb icon with no data exist
                // Start - Added by Sohel Pathan on 16/07/2014 for Internal Functional Review Points #63
                $('#marketing-activities').hide();
                $('#improvements').hide();
            }
        }

        function BindViewSelections(data, type) {
            var $dropdown = $("#ddlTabViewBy");
            $dropdown.html('');
            var $html = '';
            if (data.length > 0) {
               
                $.each(data, function (index, time) {
                   
                        if (type == time.Value) {
                            $html += '<option value="' + time.Value + '" selected="selected">' + time.Text + '</option>';
                        }
                        else {
                            $html += '<option value="' + time.Value + '">' + time.Text + '</option>';
                        }
                   
                });
            }
            $dropdown.append($html);
            $("#ddlTabViewBy").multiselect('refresh');
        }

        //Function to get current plan edit permission, PL #538
        function GetCurrentPlanPermissionDetail() {
            $.ajax({
                type: "GET",
                cache: false,
                url: '@Url.Action("GetCurrentPlanPermissionDetail", "Home")',
                data: { planId: CurrentPlanId },
                success: function (data) {
                    if (data.serviceUnavailable != 'undefined' && data.serviceUnavailable == '#') {
                        //// Function to redirect to login page on unavailability of web service.
                        //// Added By: Maninder Singh Wadhva on 11/24/2014.
                        //// Ticket: 942 Exception handeling in Gameplan.
                        window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                    }
                    else {
                        if (data.IsPlanEditable) {
                            $("#divPlanEditButtonHome").show();
                            $('.WelcomeMessageBorder').show();
                            $("#isViewOnly").val(true);
                        }
                        else {
                            //  $("#divPlanEditButtonHome").hide(); //Modified By Komal Rawal to not to hide grid button with permission.
                            $('.WelcomeMessageBorder').show();
                            $("#isViewOnly").val(false);
                        }
                    }
                }
            });
        }


        function FillTacticTableForRequest(data) {

            onlyTactic = $.grep(data.taskData, function (value) {
                return ((typeof value.isSubmitted != 'undefined') && (typeof value.isDeclined != 'undefined'))
            });

            submittedTactic = $.grep(onlyTactic, function (value) {
                return (value.isSubmitted == true);
            });

            declinedTactic = $.grep(onlyTactic, function (value) {
                return (value.isDeclined == true);
            });

            var submittedDeclinedTactic = submittedTactic.concat(declinedTactic);
            activities = { data: submittedDeclinedTactic };

            if (activities.data.length > 0) {
                FillTacticsTable();
            }
            else {
                ////// Modified By Maninder Singh Wadhva PL Ticket#47
                $('#table_activities > tbody >tr').remove();
                var varCount = $('#table_activities thead th').length;
                $('#table_activities > tbody').html('<tr class="no-tactic-found"><td colspan="' + varCount + '">No submitted tactic found.</td></tr>');
            }

            if ($('#IsViewOnly').val() != '') {
                $("#table_activities th:nth-child(6), #table_activities td:nth-child(6)").remove();
            }
        }
        function AttachEventToGroupHeading() {
            var divAccordionGroups = $("div[id^='DivAccordionGroup']").find("div.accordion-heading a");
            $.each(divAccordionGroups, function (index, accGroup) {
                var accordionGroup = $(this);
                if (typeof accordionGroup != 'undefined') {
                    accordionGroup.click(function () {
                        var anchor = $(this).parent().next().find("a");
                        if (typeof anchor != 'undefined') {
                            anchor.click();
                        }
                    });
                }
            })
        }

        //// Function to start date of current quarter.
        function getQarterStartDate() {
            var currentDate = new Date();
            var quater = Math.floor((currentDate.getMonth()) / 3) + 1;
            var startDate;
            var fullYear = currentDate.getFullYear();
            switch (quater) {
                case 1:
                    startDate = new Date(fullYear, 00, 01);
                    break;
                case 2:
                    startDate = new Date(fullYear, 03, 01);
                    break;
                case 3:
                    startDate = new Date(fullYear, 06, 01);
                    break;
                case 4:
                    startDate = new Date(fullYear, 09, 01);
                    break;
                default:
                    startDate = currentDate;
            }

            return startDate;
        }

        //// Function to set common properties of gantt.
        ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
        function SetGantt() {
            gantt.config.grid_width = 364;
            gantt.config.readonly = true;
            gantt.config.autofit = true;
            gantt.config.drag_links = false;
            gantt.config.drag_resize = true;
            gantt.config.drag_progress = false;
            gantt.config.smart_rendering = true;
        }

        // Variable to maintein closed task in calendar.
        var arrClosedTask = [];

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //// Function to render gantt i.e. for this year or this quarter.
        function renderGantt(taskData) {

            var tasks = {
                data: taskData
            };

            GanttTaskData = tasks;// Add By Nishant Sheth
            $.each(tasks.data, function (index, objData) {
                objData.start_date = new Date(objData.start_date);
            });

            //// Start -- Modified by Sohel Pathan on 22/05/2014 for Internal Review Points
            //// Instead of iterating each task and delete then it, there is a better way to use .clearAll() method that removes all the task from gantt.
            if ($('.gantt_task_row').length > 0) {
                gantt.clearAll();
            }
            //// End -- Modified by Sohel Pathan on 22/05/2014 for Internal Review Points
            gantt.config.select_task = false;
            if (isQuater == "thisquarter") {
                //// Setting scale.
                gantt.config.scale_unit = "month";
                gantt.config.step = 12;
                gantt.config.date_scale = " %Y";

                gantt.config.scale_height = 60;
                //gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, { name: "add", label: "", width: 70 }];
                gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, { name: "machineName", label: "Machine name", tree: true, resize: true, align: "center", hide: true }, { name: "add", label: "", width: 70 }];
                gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

                //// Getting quarter
                var startDate = getQarterStartDate();
                var endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 3, 1);
                gantt.config.start_date = startDate;
                gantt.config.end_date = endDate;
                //// filtering quater data
                var filteredData = $.grep(tasks.data,
                                           function (value) {
                                               return (value.start_date >= startDate && value.start_date <= endDate)
                                           }
                                         );
                var filteredTasks = { data: filteredData };
                //commented by Rahul Shah on 19/03/2016 for PL #2069
                //gantt.config.static_background = true; // Add By Nishant Sheth //#2056
                gantt.init("gantt_here");
                gantt.config.branch_loading = true; // Add By Nishant Sheth // #2056

                var json_length = filteredTasks.data.length;
                var gantt_div = document.getElementById("gantt_here");

                // Added by KAPIL - #454 - to resolve extra space
                CalGanntHeight();

                //// Function to add class to each task bar.
                ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
                gantt.templates.task_class = function (start, end, task) {
                    return getCSSForTask(task);
                };
                gantt.parse(filteredTasks);

                //// Added By Ravindra Singh Sisodiya  PL Ticket #1411
                //// display popup based on type and name and title.
                $(".gantt_last_cell").dblclick(function (e) {
                    e.stopPropagation();
                });

                // Commented By Nishant Sheth
                // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                //$(".gantt_add").click(function (e) {

                //    var type = $(this).attr('id');
                //    var name = $(this).attr('Name');
                //    var title = $(this).attr('aria-label');
                //    var permission = $(this).attr('Permission');
                //    var linetype = $(this).attr('lineitemtype');
                //    var LinkTacticPermission = $(this).attr('linktacticpermission');
                //    var LinkedTacticId = $(this).attr('linkedtacticid');
                //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

                //});

                var $doc = $(document);
                $doc.click(function () {
                    $('#popupType').css('display', 'none');
                });

                $(document).mouseup(function (e) {
                    $('#popupType').css("display", "none");
                });
                $(".gantt_ver_scroll").scroll(function () {
                    $('#popupType').css('display', 'none');
                });
            }
            else if (isQuater == "thismonth") {
                gantt.config.scale_unit = "month";
                gantt.config.step = 12;
                gantt.config.date_scale = " %Y";
                gantt.config.scale_height = 60;
                gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, { name: "machineName", label: "Machine name", tree: true, resize: true, align: "center", hide: true }, { name: "add", label: "", width: 70 }];
                //gantt.config.columns = [{ name: "custom_text", label: "Machine name", width: '*', resize: true }, { name: "add", label: "", width: 70 }];
                gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

                var date = new Date(), m = date.getMonth();
                gantt.config.start_date = new Date(date.getFullYear(), m, 01);
                gantt.config.end_date = new Date(date.getFullYear(), m + 1, 01);
                /*Added by Mitesh Vaishnav for PL ticket #671 Plan: Freezing of Application with Please Wait Dialog Box (This Month Option)*/
                var startDate = new Date(date.getFullYear(), m, 01);
                var endDate = new Date(date.getFullYear(), m + 1, 01);
                /*End :Added by Mitesh Vaishnav for PL ticket #671 Plan: Freezing of Application with Please Wait Dialog Box (This Month Option)*/
                var filteredData = $.grep(tasks.data,
                                          function (value) {
                                              return (value.start_date >= startDate && value.start_date <= endDate)
                                          }
                                        );
                var filteredTasks = { data: filteredData };

                gantt.init("gantt_here");
                var json_length = tasks.data.length;
                var gantt_div = document.getElementById("gantt_here");

                // Added by KAPIL - #454 - to resolve extra space
                CalGanntHeight();

                //// Function to add class to each task bar.
                ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
                gantt.templates.task_class = function (start, end, task) {
                    return getCSSForTask(task);
                };

                gantt.parse(filteredTasks);//Modified by Mitesh Vaishnav on 04/08/2014 for PL ticket #671 Plan: Freezing of Application with Please Wait Dialog Box (This Month Option)

                //// Added By Ravindra Singh Sisodiya  PL Ticket #1411
                //// display popup based on type and name and title.
                $(".gantt_last_cell").dblclick(function (e) {
                    e.stopPropagation();
                });

                // Commented By Nishant Sheth
                // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                //$(".gantt_add").click(function (e) {

                //    var type = $(this).attr('id');
                //    var name = $(this).attr('Name');
                //    var title = $(this).attr('aria-label');
                //    var permission = $(this).attr('Permission');
                //    var linetype = $(this).attr('lineitemtype');
                //    var LinkTacticPermission = $(this).attr('linktacticpermission');
                //    var LinkedTacticId = $(this).attr('linkedtacticid');
                //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

                //});

                var $doc = $(document);
                $doc.click(function () {
                    $('#popupType').css('display', 'none');
                });

                $(document).mouseup(function (e) {
                    $('#popupType').css("display", "none");
                });
                $(".gantt_ver_scroll").scroll(function () {
                    $('#popupType').css('display', 'none');
                });
            }
            else if ($.isNumeric(isQuater)) {

                var PlanYears = isQuater.split("-");
                var yearDiffrence = 1;
                if (PlanYears.length > 1) {
                    yearDiffrence=(parseInt(PlanYears[1]) - parseInt(PlanYears[0])) + 1;
                }
                gantt.config.scale_unit = "year";
                gantt.config.step = 1;
                gantt.config.date_scale = "%Y";
                gantt.config.scale_height = 60;
                //gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: "*", resize: true }, { name: "add", label: "", width: 70 }];
                gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, { name: "machineName", label: "Machine name", tree: true, resize: true, align: "center", hide: true }, { name: "add", label: "", width: 70 }];
                gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

                var date = new Date();
                gantt.config.start_date = new Date(planYear, 00, 01);
                gantt.config.end_date = new Date(planYear + yearDiffrence, 00, 01);
                gantt.init("gantt_here");

                var json_length = tasks.data.length;
                var gantt_div = document.getElementById("gantt_here");

                // Added by KAPIL - #454 - to resolve extra space
                CalGanntHeight();

                //// Function to add class to each task bar.
                ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
                gantt.templates.task_class = function (start, end, task) {
                    return getCSSForTask(task);
                };

                gantt.parse(tasks);
            }
            else {

                // Add By Nishant Sheth
                // Desc :: For 24 months
                var PlanYears = isQuater.split("-");
                var yearDiffrence = 1;
                if (PlanYears.length > 1) {
                    yearDiffrence = (parseInt(PlanYears[1]) - parseInt(PlanYears[0])) + 1;
                }
                gantt.config.scale_unit = "year";
                gantt.config.step = 1;
                gantt.config.date_scale = "%Y";
                gantt.config.scale_height = 60;
                //gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: "*", resize: true }, { name: "add", label: "", width: 70 }];
                gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, { name: "machineName", label: "Machine name", tree: true, resize: true, align: "center", hide: true }, { name: "add", label: "", width: 70 }];
                gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

                var date = new Date();
                gantt.config.start_date = new Date(planYear, 00, 01);
                gantt.config.end_date = new Date(planYear + yearDiffrence, 00, 01);
                gantt.init("gantt_here");

                var json_length = tasks.data.length;
                var gantt_div = document.getElementById("gantt_here");

                // Added by KAPIL - #454 - to resolve extra space
                CalGanntHeight();

                //// Function to add class to each task bar.
                ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
                gantt.templates.task_class = function (start, end, task) {
                    return getCSSForTask(task);
                };

                gantt.parse(tasks);
            }


            //// Hide/Show Tabulated data shown below gantt of request tab.
            if ('@PlanGanttTypes.Request.ToString()' == type) {

                var gantt_div1 = document.getElementById("gantt_here");

                // Added by KAPIL - #454 - to resolve extra space
                CalGanntHeight();

                ////
                gantt.config.min_column_width = function (data) {
                    return 10;
                };
            }

            //// Modified by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
            isRender = true;
            gantt.eachTask(function (task) {
                // Modified by dharmraj for #485 Planning Window doesnt remember previous view
                if (arrClosedTask.indexOf(task.id) > -1) {
                    gantt.getTask(task.id).$open = false;
                }
                else {
                    gantt.getTask(task.id).$open = true;
                }
                CountTacticForRenderChart(task.id, '');
            });

            //// Modified by :- Maninder Singh for PL ticket #203 	Performance issue - Home screen taking too long to load.
            // gantt.refreshData();

            isRender = false;
            ////
            hoverRows();
            AttachEventToTactic();
            AttachEventToonTaskRowClick();
            GlobalSearch();
            //Added by Rahul Shah on 22/02/2016 for PL #1905. to set focus after link tactic
            setTimeout(function () {
                var _scrollY = scrollstate.y
                gantt.scrollTo(0, _scrollY);
            }, 250);

        }

        //// Added by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
        function CountTacticForRenderChart(leftNavTaskID, CampaignID) {

            /////Modified By Maninder Singh Wadhva PL Ticket#47, 337
            if (leftNavTaskID.substring(0, 1) == "L" && leftNavTaskID.indexOf("M") > 0) {
                $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                    var tid = this.id.substring(this.id.indexOf('_') + 1);
                    var cnt = 0;
                    $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                        var taskid = $(this).attr('taskid');
                        //#840 : Undefined error on home when all BU and all Plans are selected : Kalpesh Sharma
                        //Check that task is exists or not before we render it.
                        if (gantt.isTaskExists(taskid)) {
                            if (typeof gantt.getTask(taskid) != 'undefined') {
                                var taskVisible = gantt.getTask(taskid).$open;     // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                if (CampaignID == '') {
                                    if (taskid == leftNavTaskID && (typeof taskVisible != 'undefined') && taskVisible == true) {   // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                        cnt = cnt + 1;
                                    }
                                }
                                else {
                                    if (taskid.indexOf(CampaignID) >= 0 && leftNavTaskID.indexOf("_I") > 0 && !(leftNavTaskID.indexOf("_Y") > 0) &&
                                        (typeof taskVisible != 'undefined') && taskVisible == true) { // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                        cnt = cnt + 1;
                                    }
                                }
                            }
                        }
                    });

                    if ($("#" + this.id).text() != '' && leftNavTaskID.indexOf("_I") > 0) {
                        updateCountOnExpand($("#" + this.id), cnt);
                    }
                });
            }
            else if ((leftNavTaskID.substring(0, 1) == "Z") && leftNavTaskID.indexOf("M") > 0) {
                $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                    var tid = this.id.substring(this.id.indexOf('_') + 1);
                    var cnt = 0;
                    $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function () {
                        var taskPrefix = leftNavTaskID.substring(0, leftNavTaskID.indexOf('_')) + '_';
                        var taskid = taskPrefix + $(this).attr('taskid');

                        //#840 : Undefined error on home when all BU and all Plans are selected : Kalpesh Sharma
                        //Check that task is exists or not before we render it.
                        if (gantt.isTaskExists(taskid)) {
                            var task = gantt.getTask(taskid);
                            if (typeof task != 'undefined') {
                                var taskVisible = gantt.getTask(taskid).$open;     // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                if (CampaignID == '') {
                                    if (taskid == leftNavTaskID && (typeof taskVisible != 'undefined') && taskVisible == true) {   // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                        cnt = cnt + 1;
                                    }
                                }
                                else {
                                    if (taskid.indexOf(CampaignID) >= 0 && leftNavTaskID.indexOf("_I") > 0 && !(leftNavTaskID.indexOf("_Y") > 0) &&
                                        (typeof taskVisible != 'undefined') && taskVisible == true) { // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                        cnt = cnt + 1;
                                    }
                                }
                            }
                        }
                    });
                    if ($("#" + this.id).text() != '' && leftNavTaskID.indexOf("_I") > 0) {
                        updateCountOnExpand($("#" + this.id), cnt);
                    }
                });
            }
            else {
                $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                    var tid = this.id.substring(this.id.indexOf('_') + 1);
                    cnt = 0;
                    $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index1) {
                        var taskid = $(this).attr('taskid');
                        //#840 : Undefined error on home when all BU and all Plans are selected : Kalpesh Sharma
                        //Check that task is exists or not before we render it.
                        if (gantt.isTaskExists(taskid)) {
                            var taskVisible = gantt.getTask(taskid).$open; // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            if (CampaignID == '') {
                                if (taskid == leftNavTaskID && (typeof taskVisible != 'undefined') && taskVisible == true) { // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                    cnt = cnt + 1;
                                }
                            }
                            else {
                                if (taskid.indexOf(CampaignID) >= 0 && leftNavTaskID.indexOf("_T") > 0 && !(leftNavTaskID.indexOf("_Y") > 0) &&
                                    (typeof taskVisible != 'undefined') && taskVisible == true) { // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                    cnt = cnt + 1;
                                }
                            }
                        }
                    });

                    if ($("#" + this.id).text() != '' && leftNavTaskID.indexOf("_T") > 0) {
                        updateCountOnExpand($("#" + this.id), cnt);
                    }
                });
            }
        }

        ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
        function getCSSForTask(task) {
            var isImprovement = false;
            if (typeof task.plantacticid != 'undefined' || (typeof task.isImprovement != 'undefined' && task.isImprovement == true)) {
                var cssClass = task.color + ' cursorPointer' + (task.isSubmitted && ('@PlanGanttTypes.Request.ToString()' == type) ? ' to-approve' : '');
                if (typeof task.isImprovement != 'undefined' && task.isImprovement == true &&
                    typeof task.ImprovementPlanTacticId != 'undefined') {
                    cssClass += ' improvement border-top';
                    isImprovement = true;
                }
                else {
                    if (!task.$open) {
                        ///Modified by Dharmraj PL Ticket#394 - Apply required styling on the Improvement activity in calendar
                        cssClass = ' improvement improvementcolor27A4E5 colorC6EBF3-with-border ';
                    }
                    else {
                        cssClass += ' no_drag ';
                    }
                }
            } else {
                cssClass = task.color + ' no_drag ';
            }

            //// Added by Sohel on 12/05/2014 for PL #425 to Show status of tactics on Home and Plan screen
            if (showTacticStatus == true) {
                if (task.Status == "Created")
                    cssClass += " tactic-created";
                else if (task.Status == "Submitted")
                    cssClass += " tactic-submitted ";
                else if (task.Status == "Approved" || task.Status == "Complete" || task.Status == "In-Progress")
                    cssClass += " tactic-approved";
                else if (task.Status == "Rejected" || task.Status == "Declined")
                    cssClass += " tactic-rejected";

                if (isImprovement == true)
                    cssClass += " improvement-border-top-status";
            }
            return cssClass;
        }

        function Quarter() {

            gantt.config.scale_unit = "month";
            gantt.config.step = 12;
            gantt.config.date_scale = " %Y";

            gantt.config.scale_height = 60;
            gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, ];
            gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

            //// Getting quarter
            var startDate = getQarterStartDate();
            var endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 3, 1);
            gantt.config.start_date = startDate;
            gantt.config.end_date = endDate;

            //// filtering quater data
            var filteredData = $.grep(tasks.data,
                                       function (value) {
                                           return (value.start_date >= startDate && value.start_date <= endDate)
                                       }
                                     );
            var filteredTasks = { data: filteredData };

            gantt.init("gantt_here");

            var json_length = filteredTasks.data.length;
            var gantt_div = document.getElementById("gantt_here");
            gantt_div.style.height = ((json_length * 35) + 94) + "px";

            //// Function to add class to each task bar.
            gantt.templates.task_class = function (start, end, task) {
                if (typeof task.plantacticid != 'undefined') {
                    return task.color + ' cursorPointer' + (task.isSubmitted && ('@PlanGanttTypes.Request.ToString()' == type) ? ' to-approve' : '');
                } else {
                    return task.color;
                }
            };
            gantt.parse(filteredTasks);
        }

        function year() {
            gantt.config.scale_unit = "year";
            gantt.config.step = 1;
            gantt.config.date_scale = "%Y";
            gantt.config.scale_height = 60;
            gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, ];
            gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

            gantt.config.start_date = new Date(planYear, 00, 01);
            gantt.config.end_date = new Date(planYear + 1, 00, 01);
            gantt.init("gantt_here");

            var json_length = tasks.data.length;
            var gantt_div = document.getElementById("gantt_here");
            gantt_div.style.height = ((json_length * 35) + 94) + "px";

            //// Function to add class to each task bar.
            gantt.templates.task_class = function (start, end, task) {
                if (typeof task.plantacticid != 'undefined') {
                    return task.color + ' cursorPointer' + (task.isSubmitted && ('@PlanGanttTypes.Request.ToString()' == type) ? ' to-approve' : '');
                } else {
                    return task.color;
                }
            };

            gantt.parse(tasks);
        }

        function thismonth() {
            gantt.config.scale_unit = "month";
            gantt.config.step = 12;
            gantt.config.date_scale = " %Y";

            gantt.config.scale_height = 60;
            gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, ];
            gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

            //// Getting quarter
            var date = new Date();
            var startDate = new Date(date.getFullYear(), date.getMonth(), 1);
            var endDate = new Date(date.getFullYear(), date.getMonth() + 1, 0);

            gantt.config.start_date = startDate;
            gantt.config.end_date = endDate;

            //// filtering quater data
            var filteredData = $.grep(tasks.data,
                                       function (value) {
                                           return (value.start_date >= startDate && value.start_date <= endDate)
                                       }
                                     );
            var filteredTasks = { data: filteredData };

            gantt.init("gantt_here");

            var json_length = filteredTasks.data.length;
            var gantt_div = document.getElementById("gantt_here");
            gantt_div.style.height = ((json_length * 35) + 94) + "px";

            //// Function to add class to each task bar.
            gantt.templates.task_class = function (start, end, task) {
                if (typeof task.plantacticid != 'undefined') {
                    return task.color + ' cursorPointer' + (task.isSubmitted && ('@PlanGanttTypes.Request.ToString()' == type) ? ' to-approve' : '');
                } else {
                    return task.color;
                }
            };
            gantt.parse(filteredTasks);
        }

        function nextyear() {
            gantt.config.scale_unit = "year";
            gantt.config.step = 1;
            gantt.config.date_scale = "%Y";
            gantt.config.scale_height = 60;
            gantt.config.columns = [{ name: "text", label: "Task name", tree: true, width: '*', resize: true }, ];
            gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];

            gantt.config.start_date = new Date(planYear + 1, 00, 01);
            gantt.config.end_date = new Date(planYear + 2, 00, 01);
            gantt.init("gantt_here");

            var json_length = tasks.data.length;
            var gantt_div = document.getElementById("gantt_here");
            gantt_div.style.height = ((json_length * 35) + 94) + "px";

            //// Function to add class to each task bar.
            gantt.templates.task_class = function (start, end, task) {
                if (typeof task.plantacticid != 'undefined') {
                    return task.color + ' cursorPointer' + (task.isSubmitted && ('@PlanGanttTypes.Request.ToString()' == type) ? ' to-approve' : '');
                } else {
                    return task.color;
                }
            };

            gantt.parse(tasks);
        }

        function modSampleHeight() {
            var headHeight = 94;
            var sch = document.getElementById("gantt_here");
            sch.style.height = (parseInt(document.body.offsetHeight) - headHeight) + "px";
            gantt.setSizes();
        }

        //// Variable to hold double click event.
        var eventTaskClick;
        //// Function to attach event to show inspect model.
        function AttachEventToTactic() {
            //// Detaching double click event.
            if (eventTaskClick != undefined) {
                gantt.detachEvent(eventTaskClick);
            }

            //// Attaching single click event
            eventTaskClick = gantt.attachEvent("onTaskClick", function (taskId, e) {
                var where = e.target.getAttribute('class');
                if (where == 'gantt_task_content' || where == 'gantt_tree_content'){
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();

                    ShowModel(taskId, null);
                    return true;
                }else{
                    return false;
                }
            });

        }

        var eventTaskDoubleClickevent;
        function AttachEventToonTaskRowClick() {
            //// Detaching double click event.
            if (eventTaskDoubleClickevent != undefined) {
                gantt.detachEvent(eventTaskDoubleClickevent);
            }

            //// Attaching double click event
            eventTaskDoubleClickevent = gantt.attachEvent("onTaskRowClick", function (taskId, trg) {
                scrollstate = gantt.getScrollState();
                bodyscrollpos = $(window).scrollTop();
            });
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        function ShowModel(taskId, isShowInspect) {
            removeDefaultModalPopupBackgroungColor();
            var task, planTacticId, planProgramId, planCampaignId, planId, planLineItemId;
            var isImprovement = false;
            if (taskId != null) {
                task = gantt.getTask(taskId);
                planCampaignId = task.plancampaignid;
                planProgramId = task.planprogramid;
                planId = task.planid;

                isImprovement = (typeof task.isImprovement != 'undefined' && task.isImprovement == true)

                if (isImprovement) {
                    planTacticId = task.ImprovementPlanTacticId;
                }
                else {
                    planTacticId = task.plantacticid;
                }
            } else if (isShowInspect) {
                planTacticId = $("#hdnshowInspectForPlanTacticId").val();
                planCampaignId = $("#hdnshowInspectForPlanCampaignId").val();
                planProgramId = $("#hdnshowInspectForPlanProgramId").val();
                isImprovement = $('#hdnIsImprovement').val().toLowerCase();
                planLineItemId = $("#hdnShowInspectForPlanLineItemId").val();
            }
            isImprovement = isImprovement.toString();
            //// Checking whether current task is improvement tactic or not.
            if (typeof planTacticId != 'undefined' && planTacticId != 0 && isImprovement == 'true') {

                modalFullPosition(); // Added by Kapil Antala on 17 Sep 2014 for #732 - new popup design

                $('.modal-backdrop').addClass('modalFull-backdrop');
                $('.modal-backdrop').attr("style", "display:none !important;");
                $("#successMessage").css("display", "none");
                $("#errorMessage").css("display", "none");
                $("#modal-container-186470").modal('show');
                loadInspectPopup(planTacticId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.ImprovementTactic).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()", 0, "@Enums.InspectPopupRequestedModules.Index.ToString()");
            }
                //// Checking whether current task is tactic or not.
            else if (typeof planTacticId != 'undefined' && planTacticId != 0) {
                modalFullPosition(); // Added by Kapil Antala on 17 Sep 2014 for #732 - new popup design
                $('.modal-backdrop').addClass('modalFull-backdrop');
                $('.modal-backdrop').attr("style", "display:none !important;");
                $("#successMessage").css("display", "none");
                $("#errorMessage").css("display", "none");
                $("#modal-container-186470").modal('show');
                loadInspectPopup(planTacticId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()", 0, "@Enums.InspectPopupRequestedModules.Index.ToString()");
            }

                //// Checking whether current task is tactic or not.
            else if (typeof planProgramId != 'undefined' && planProgramId != 0) {
                modalFullPosition(); // Added by Kapil Antala on 17 Sep 2014 for #732 - new popup design
                $('.modal-backdrop').addClass('modalFull-backdrop');
                $('.modal-backdrop').attr("style", "display:none !important;");
                $("#successMessage").css("display", "none");
                $("#errorMessage").css("display", "none");
                $("#modal-container-186470").modal('show');
                loadInspectPopup(planProgramId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Program).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()", 0, "@Enums.InspectPopupRequestedModules.Index.ToString()");//Modified by Komal rawal For #1325 - To get the default mode as read only
            }
                //// Checking whether current task is tactic or not.
            else if (typeof planCampaignId != 'undefined' && planCampaignId != 0) {
                modalFullPosition(); // Added by Kapil Antala on 17 Sep 2014 for #732 - new popup design
                $('.modal-backdrop').addClass('modalFull-backdrop');
                $('.modal-backdrop').attr("style", "display:none !important;");
                $("#successMessage").css("display", "none");
                $("#errorMessage").css("display", "none");
                $("#modal-container-186470").modal('show');
                loadInspectPopup(planCampaignId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Campaign).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()", 0, "@Enums.InspectPopupRequestedModules.Index.ToString()"); //Modified by Komal rawal For #1324 - To get the default mode as read only
            }
                //// Checking whether current task is tactic or not.
            else if (typeof planLineItemId != 'undefined' && planLineItemId != 0) {
                modalFullPosition(); // Added by Kapil Antala on 17 Sep 2014 for #732 - new popup design
                $('.modal-backdrop').addClass('modalFull-backdrop');
                $('.modal-backdrop').attr("style", "display:none !important;");
                $("#successMessage").css("display", "none");
                $("#errorMessage").css("display", "none");
                $("#modal-container-186470").modal('show');
                loadInspectPopup(planLineItemId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.LineItem).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()", 0, "@Enums.InspectPopupRequestedModules.Index.ToString()");
            }
            else if (typeof planId != 'undefined' && planId != 0) {
                modalFullPosition();
                $('.modal-backdrop').addClass('modalFull-backdrop');
                $('.modal-backdrop').attr("style", "display:none !important;");
                $("#successMessage").css("display", "none");
                $("#errorMessage").css("display", "none");
                $("#modal-container-186470").modal('show');
                loadInspectPopup(planId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Plan).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()");
            }
        }


        $("#modal-container-186470").on("show", function (e) {
            $("#modalMainContainer").show();
        });
        function CloseIconClick() {
            $('.close-x-big-icon').click(function () {
                logMixpanelTrack("Exit from inspection window."); // log Exit(close) Plan/Campaign/Program/Tactic inspect window event to mixpanel. Added by Viral regarding PL ticket #2434.
                //Added by Rahul shah to remove all media code honeycomb data on click of close icon for  PL #2371
                RemoveAllMediaCodeData();
                $("#modal-container-186470").addClass("transition-close");
                $("#modal-container-186470").removeClass("transition_y");
                addDefaultModalPopupBackgroungColor();
                $('body').removeClass('bodyOverflow');
                // Modified by Rahul Shah for PL #2307 on 23/06/2016 to display data without search when user add/copy tactic,program,campaign for calendar.
                if (isDataModified) {
                    $('#txtGlobalSearch').val("");
                    $('#ExpClose').css('display', 'none');
                    $('#ExpSearch').css('display', 'block');
                }
                if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                    if ($('#IsGridView').val().toLowerCase() == "true") {

                        if (isDataModified) {
                            if (gridSearchFlag == 1) {
                                isCopyTacticHomeGrid = isCopyTactic;
                                isEditTacticHomeGrid = isEditTactic;
                                LoadPlanGrid();
                                gridSearchFlag = 0;
                            }
                            else if (isBoostAuthorized) {
                                var url = "@Url.Content("~/Plan/LoadImprovementGrid")";
                                $("#ImprovementGrid").load(url + '?id=' + CurrentPlanId);

                            }
                        }
                        if (typeof inspectCloseFocus != 'undefined' && inspectCloseFocus != '') {
                            $("html, body").animate({ scrollTop: inspectCloseFocus }, 100);
                        }
                        return true;

                    }
                    else {
                        //Modified by Rahul Shah on 25/03/2016 for PL #2075
                        if ($("#hdnPlanLineItemID").val() == '0' || $("#hdnPlanLineItemID").val() == undefined) {
                            if (isDataModified) {
                                RefreshCurrentTab();
                            }
                            else {
                                gantt.refreshData();
                                GlobalSearch();
                            }
                        } else {
                            $('#divPlanEditButtonHome').click();
                        }

                    }
                }
                else {
                    if ($("#hdnPlanLineItemID").val() == '0' || $("#hdnPlanLineItemID").val() == undefined) {
                        if (isDataModified) {
                            RefreshCurrentTab();
                        }
                        else {
                            gantt.refreshData();
                            GlobalSearch();
                        }
                    }
                    else {
                        $('#divPlanEditButtonHome').click();

                    }

                }
                $(".datepicker.dropdown-menu").each(function () {
                    $(this).remove();
                });

                //// Added By Ravindra Singh Sisodiya  PL Ticket #1411
                //// display popup based on type and name and title.
                if (activeMenu != '@Enums.ActiveMenu.Plan.ToString().ToLower()' || $('#IsGridView').val().toLowerCase() == "true") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                    $(".gantt_last_cell").dblclick(function (e) {
                        e.stopPropagation();
                    });
                    // Commented By Nishant Sheth
                    // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                    //$(".gantt_add").click(function (e) {
                    //    var type = $(this).attr('id');
                    //    var name = $(this).attr('Name');
                    //    var title = $(this).attr('aria-label');
                    //    var permission = $(this).attr('Permission');
                    //    var linetype = $(this).attr('lineitemtype');
                    //    var LinkTacticPermission = $(this).attr('linktacticpermission');
                    //    var LinkedTacticId = $(this).attr('linkedtacticid');
                    //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);
                    //});

                    var $doc = $(document);
                    $doc.click(function () {
                        $('#popupType').css('display', 'none');
                    });

                    $(document).mouseup(function (e) {
                        $('#popupType').css("display", "none");
                    });
                    $(".gantt_ver_scroll").scroll(function () {
                        $('#popupType').css('display', 'none');
                    });
                }
                // Commented By Nishant Sheth
                // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                //$("div[id^='LinkIcon']").each(function () {

                //    bootstrapetitle($(this), 'This tactic is linked to ' + "<U>" + htmlDecode($(this).attr('linkedplanname') + "</U>"), "tipsy-innerWhite");
                //});
            });
        }
        //Added By Komal RAwal for #2001
        function ConfirmLinkTactic() {
            $("#modal-container-186470").addClass("transition-close");
            $("#modal-container-186470").removeClass("transition_y");
            addDefaultModalPopupBackgroungColor();
            $('body').removeClass('bodyOverflow');
            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                if ($('#IsGridView').val().toLowerCase() == "true") {

                    if (isDataModified) {
                        if (gridSearchFlag == 1) {
                            isCopyTacticHomeGrid = isCopyTactic;
                            isEditTacticHomeGrid = isEditTactic;
                            LoadPlanGrid();
                            gridSearchFlag = 0;
                        }
                        else if (isBoostAuthorized) {
                            var url = "@Url.Content("~/Plan/LoadImprovementGrid")";
                            $("#ImprovementGrid").load(url + '?id=' + CurrentPlanId);

                        }
                    }
                    if (typeof inspectCloseFocus != 'undefined' && inspectCloseFocus != '') {
                        $("html, body").animate({ scrollTop: inspectCloseFocus }, 100);
                    }
                    return true;

                }
                else {
                    if (isDataModified) {
                        RefreshCurrentTab();
                    }
                    else {
                        gantt.refreshData();
                    }
                }
            }
            else {
                if (isDataModified) {
                    RefreshCurrentTab();
                }
                else {
                    gantt.refreshData();
                }
            }
            $(".datepicker.dropdown-menu").each(function () {
                $(this).remove();
            });

            //// Added By Ravindra Singh Sisodiya  PL Ticket #1411
            //// display popup based on type and name and title.
            if (activeMenu != '@Enums.ActiveMenu.Plan.ToString().ToLower()' || $('#IsGridView').val().toLowerCase() == "true") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                $(".gantt_last_cell").dblclick(function (e) {
                    e.stopPropagation();
                });

                // Commented By Nishant Sheth
                // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
                //$(".gantt_add").click(function (e) {
                //    var type = $(this).attr('id');
                //    var name = $(this).attr('Name');
                //    var title = $(this).attr('aria-label');
                //    var permission = $(this).attr('Permission');
                //    var linetype = $(this).attr('lineitemtype');
                //    var LinkTacticPermission = $(this).attr('linktacticpermission');
                //    var LinkedTacticId = $(this).attr('linkedtacticid');
                //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);
                //});

                var $doc = $(document);
                $doc.click(function () {
                    $('#popupType').css('display', 'none');
                });

                $(document).mouseup(function (e) {
                    $('#popupType').css("display", "none");
                });
                $(".gantt_ver_scroll").scroll(function () {
                    $('#popupType').css('display', 'none');
                });
            }

            $("div[id^='LinkIcon']").each(function () {

                bootstrapetitle($(this), 'This tactic is linked to ' + "<U>" + htmlDecode($(this).attr('linkedplanname') + "</U>"), "tipsy-innerWhite");
            });
        };

        //Scrip Addded By Bhavesh for Inspect Popup

        // Added By Bhavesh
        // Inspect Popup
        /// Start Script Of Inspect Popup
        /// Modified by Kunal to add  section parameter to open popup campaign, program or tactic wise
        function loadInspectPopup(id, section, tabValue, mode, parentId) {
            logMixpanelTrack("Open "+ section +" inspection window."); // log Plan, Campaign, Program, Tactic, Line Item inspection window open event to mixpanel.

            parentId = typeof parentId !== 'undefined' ? parentId : '0';
            var url = '@Url.Content("~/Inspect/LoadInspectPopup")';
            $("#divPartial").empty();
            $("#divPartial").load(url + '?id=' + id + '&Section=' + section + '&TabValue=' + tabValue + '&InspectPopupMode=' + mode + '&parentId=' + parentId + '&RequestedModule=' + '@Enums.InspectPopupRequestedModules.Index.ToString()', function (response, status, xhr) {
                if (response == '{"serviceUnavailable":"~/Login/ServiceUnavailable"}') {
                    //// Call function to redirect on service unavailibility.
                    //// Added By: Maninder Singh Wadhva on 11/24/2014.
                    //// Ticket: 942 Exception handeling in Gameplan.
                    window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                }

                //modalBackdropDisplayNone();
            });
        }

        //End Script Of Bhaveh

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //Start Creating and Populating tabulated data
        function FillTacticsTable() {
            $('#table_activities > tbody >tr').remove();
            if (typeof activities != 'undefined') {
                if (activities.data.length) {
                    for (i in activities.data) {
                        addRowTactic(i, activities.data[i].id, activities.data[i].text, activities.data[i].projectedStageValue,
                            activities.data[i].mqls, activities.data[i].cws, activities.data[i].cost, activities.data[i].isDeclined, activities.data[i].isSubmitted, activities.data[i].isImprovement);
                    }
                }

                //Fetch all the row values from the tables
                $('.ActivitiesFormater').each(function () {
                    //Added By : Kalpesh Sharma
                    //PL #508 Set format for label in tool tip
                    SetBudget($(this));
                });

            }
        }

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        //add row in tactics table
        function addRowTactic(index, id, text, projectedStageValue, mqls, cws, cost, isDeclined, isSubmitted, isImprovement) {

            var $activitiesTable = $('#table_activities > tbody');
            var $html = "";
            if (isImprovement) {
                var valueForImprovement = '---';
                projectedStageValue = valueForImprovement;
                mqls = valueForImprovement;
                cws = valueForImprovement;
            }
            if (isDeclined) {
                $html += '<tr class="rejected" id="' + id + '" data-index="' + index + '">' +
                            '<td class="border-r sm">'

                if (isImprovement) {
                    $html += '<span class="bullhorn-icon"></span>'
                }
                //Modified by Arpita Soni on 01/16/2015 for ticket #1084
                $html += '<span class="title-baseline-model ConcatTextlength" style="width: 400px" title=' + text + ' >' + text + '</span><span class="search-icon"></span></td>' +
                            '<td class="sm">' + displayTacticMQL(projectedStageValue) + '</td>' +
                            '<td class="sm">' + displayTacticMQL(mqls) + '</td>' +
                            '<td class="sm ActivitiesFormater">' + FormatCurrency(cws, false) + '</td>' +
                            '<td class="border-r sm ActivitiesFormater">' + FormatCurrency(cost, false) + '</td>';
                $html += '<td><span class="reject-icon active"></span><span class="accept-icon"></span></td>';

                $html += '</tr>';
            } else if (isSubmitted) {
                $html += '<tr class="pending"  id="' + id + '" data-index="' + index + '">' +
                            '<td class="border-r sm">'

                if (isImprovement) {
                    $html += '<span class="bullhorn-icon"></span>'
                }
                //Modified by Arpita Soni on 01/16/2015 for ticket #1084
                $html += '<span class="title-baseline-model ConcatTextlength" style="width: 400px" title=' + text + ' >' + text + '</span><span class="search-icon"></span></td>' +
                            '<td class="sm">' + displayTacticMQL(projectedStageValue) + '</td>' +
                            '<td class="sm">' + displayTacticMQL(mqls) + '</td>' +
                            '<td class="sm ActivitiesFormater">' + FormatCurrency(cws, false) + '</td>' +
                            '<td class="border-r sm ActivitiesFormater">' + FormatCurrency(cost, false) + '</td>';
                $html += '<td><span class="reject-icon"></span><span class="accept-icon"></span></td>';
                $html += '</tr>';
            }

            $activitiesTable.append($html);

        }

        function displayTacticMQL(MQL) {
            if (MQL != 'N/A' && MQL != '---') {
                //Modified by Arpita Soni on 01/16/2015 for Ticket #1084
                return number_format(MQL, 0, '.', ',');

            }
            else {
                return MQL;
            }
        }

        $(document).on("click", ".accept-icon", function () {
            var task = gantt.getTask($(this.parentNode.parentNode).attr("id"));
            ApproveTactic(this, task);
        })

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        function ApproveTactic(e, task) {
            var approveDeclineTacticId;
            var isImprovement = false;
            if (typeof task.isImprovement != 'undefined' && task.isImprovement == true) {
                approveDeclineTacticId = task.ImprovementPlanTacticId;
                isImprovement = true;
            }
            else {
                approveDeclineTacticId = task.plantacticid;
            }

            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Inspect/ApproveDeclineTactic/")',
                data: {
                    planTacticId: approveDeclineTacticId,
                    isApprove: true,
                    isImprovement: isImprovement
                },
                dataType: "json",
                success: function (data) {
                    if (data.serviceUnavailable != 'undefined' && data.serviceUnavailable == '#') {
                        window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                    }
                    else {
                        if (data.result == true) {
                            if (task.isSubmitted) {
                                $('#RequestCount').html($('#RequestCount').html() - 1);
                            }

                            var index = $(e.parentNode.parentNode).attr("data-index");
                            task.isDeclined = false;
                            task.isSubmitted = false;
                            activities.data.splice(index, 1);

                            $('#table_activities tbody tr').remove();
                            FillTacticsTable();
                            gantt.refreshData();
                            isRequest = true;
                            // Added by Dharmraj to refresh current tab for PL #364
                            RefreshCurrentTab();
                        }
                        else {
                            alert('Not Approved');
                        }
                    }
                }
            });
        }

        $(document).on("click", ".reject-icon", function () {
            var task = gantt.getTask($(this.parentNode.parentNode).attr("id"));
            DeclineTactic(this, task);
        })

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        function DeclineTactic(e, task) {
            var approveDeclineTacticId;
            var isImprovement = false;
            if (typeof task.isImprovement != 'undefined' && task.isImprovement == true) {
                approveDeclineTacticId = task.ImprovementPlanTacticId;
                isImprovement = true;
            }
            else {
                approveDeclineTacticId = task.plantacticid;
            }

            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Inspect/ApproveDeclineTactic/")',
                data: {
                    planTacticId: approveDeclineTacticId,
                    isApprove: false,
                    isImprovement: isImprovement
                },
                dataType: "json",
                success: function (data) {
                    if (data.serviceUnavailable != 'undefined' && data.serviceUnavailable == '#') {
                        window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                    }
                    else {
                        if (data.result == true) {
                            if (task.isSubmitted) {
                                $('#RequestCount').html($('#RequestCount').html() - 1);
                            }
                            var index = $(e.parentNode.parentNode).attr("data-index");
                            var activityTemp = activities.data[index];
                            activities.data.splice(index, 1);
                            $('#table_activities tbody tr').remove();
                            activityTemp.isDeclined = true;
                            activityTemp.isSubmitted = false;
                            activities.data.push(activityTemp);
                            FillTacticsTable();
                            gantt.refreshData();
                            isRequest = true;
                            // Added by Dharmraj to refresh current tab for PL #364
                            RefreshCurrentTab();
                        }
                        else {
                            alert('Not Declined');
                        }
                    }
                }
            });
        }

        //tbody tr
        $("#table_activities").on("click", ".sm", function () {
            ShowModel($(this.parentNode).attr("id"), null)
        })
        //End Creating and Populating tabulated data

        /// Script End
        /// Added By: Maninder Singh Wadhva.

        /// Ended Script Of Inspect Popup
        //Commented by komal Rawal for new homepage UI


        //// Modified By Maninder Singh Wadhva PL Ticket#47
        gantt.attachEvent("onTaskOpened", function (id) {
            var planid = CurrentPlanId;
            //// Modified by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
            if (typeof isRender == 'undefined' || isRender == false) {
                OnTaskExapnd(id);
            }
            hoverRows();
            arrClosedTask = jQuery.grep(arrClosedTask, function (value) {
                return value != id;
            });

            // added by dharmraj to display tooltip on camp., prog., tactic name in calendar.
            $(".gantt_container .gantt_tree_content").each(function (index, element) {
                $(element).attr("title", htmlDecode(element.innerHTML));
            });


            $(".gantt_last_cell").dblclick(function (e) {
                e.stopPropagation();
            });
            // Commented By Nishant Sheth
            // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
            //$(".gantt_add").click(function (e) {
            //    var type = $(this).attr('id');
            //    var name = $(this).attr('Name');
            //    var title = $(this).attr('aria-label');
            //    var permission = $(this).attr('Permission');
            //    var linetype = $(this).attr('lineitemtype');
            //    var LinkTacticPermission = $(this).attr('linktacticpermission');
            //    var LinkedTacticId = $(this).attr('linkedtacticid');
            //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

            //});

            var $doc = $(document);
            $doc.click(function () {
                $('#popupType').css('display', 'none');
            });

            $(document).mouseup(function (e) {
                $('#popupType').css("display", "none");
            });
            $(".gantt_ver_scroll").scroll(function () {
                $('#popupType').css('display', 'none');
            });
            GlobalSearch();
        });

        //// Added by :- Sohel Pathan on 11/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
        function OnTaskExapnd(id) {
            iterateMarketingActivitesOnExpand(id);
        }

        function iterateMarketingActivitesOnExpand(id) {
            if (id.substring(0, 1) == "C" || id.substring(0, 1) == "Z" || (id.substring(0, 1) == "L" && id.indexOf("M") <= 0)) {
                var intid = 0;
                if (id.indexOf("P") >= 0) {
                    intid = id.substring(id.indexOf('P') + 1);
                }
                if (intid != 0) {
                    //// Two levels Exapnding tabs for Program in all tabs
                    $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                        var tid = this.id.substring(this.id.indexOf('_') + 1);
                        var cnt = 0;
                        var a = gantt.getChildren(id);
                        $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index1) {
                            var taskid = $(this).attr('taskid');
                            var taskVisible = $("#gantt_here").find('div[task_id="' + taskid + '"]');
                            // Start - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            if (typeof taskVisible != 'undefined') {
                                if (taskVisible.length > 0) {
                                    $.each(a, function (index2, value2) {
                                        if (taskid == value2) {
                                            cnt = cnt + 1;
                                        }
                                    });
                                }
                            }
                            // End - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                        });

                        if ($("#" + this.id).text() != '' && cnt != 0) {    // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            updateCountOnExpand($("#" + this.id), cnt);
                        }
                    });
                }
                else {
                    //// Three levels Exapnding tabs for Campaign in all tabs
                    if (id.substring(0, 1) == "C") {
                        $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var a = gantt.getChildren(id);
                            $.each(a, function (index1, value1) {
                                // Start - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                var childVisible = gantt.getTask(value1).$open;
                                if (typeof childVisible != undefined) {
                                    if (childVisible == true) {
                                        var child = gantt.getChildren(value1);
                                        $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                            var taskid = $(this).attr('taskid');
                                            var taskVisible = $("#gantt_here").find('div[task_id="' + taskid + '"]');
                                            if (typeof taskVisible != 'undefined') {
                                                if (taskVisible.length > 0) {
                                                    $.each(child, function (index3, value3) {
                                                        if (taskid == value3) {
                                                            cnt = cnt + 1;
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    }
                                }
                                // End - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            });

                            if ($("#" + this.id).text() != '' && cnt != 0) {    // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                updateCountOnExpand($("#" + this.id), cnt);
                            }
                        });
                    }
                    //// Three levels Exapnding tabs for Improvement Activities in Stage or custom field
                    if ((id.substring(0, 1) == "Z") && (id.indexOf("L") > 0 && id.indexOf("M") > 0)) {
                        $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var a = gantt.getChildren(id);
                            $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                var taskid = $(this).attr('taskid');
                                $.each(a, function (index, value) {
                                    if (value.indexOf(taskid) > 0) {
                                        cnt = cnt + 1;
                                    }
                                });
                            });

                            if ($("#" + this.id).text() != '' && cnt != 0) {
                                updateCountOnExpand($("#" + this.id), cnt);
                            }
                        });
                    }
                        //// Five levels Expanding tabs forStage or customfield
                    else if ((id.substring(0, 1) == "Z") && (id.indexOf("L") <= 0 && id.indexOf("M") <= 0)) {
                        $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var childLevel5 = gantt.getChildren(id);
                            $.each(childLevel5, function (index1, value5) {
                                var childVisible5 = gantt.getTask(value5).$open;
                                if (typeof childVisible5 != undefined) {
                                    if (childVisible5 == true && value5.indexOf("M") <= 0) {
                                        var a = gantt.getChildren(value5);
                                        $.each(a, function (index1, value1) {
                                            var childVisibleMain = gantt.getTask(value1).$open;
                                            if (typeof childVisibleMain != undefined) {
                                                if (childVisibleMain == true && value1.indexOf("M") <= 0) {
                                                    var child1 = gantt.getChildren(value1);
                                                    $.each(child1, function (index4, value4) {
                                                        var childVisible = gantt.getTask(value4).$open;
                                                        if (typeof childVisible != undefined) {
                                                            if (childVisible == true && value4.indexOf("M") <= 0) {
                                                                var child = gantt.getChildren(value4);
                                                                $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                                                    var taskid = $(this).attr('taskid');
                                                                    var taskVisible = $("#gantt_here").find('div[task_id="' + taskid + '"]');
                                                                    if (child.length > 0) {
                                                                        $.each(child, function (index3, value3) {
                                                                            if (taskid == value3 && (typeof taskVisible != 'undefined') && taskVisible.length > 0) {
                                                                                cnt = cnt + 1;
                                                                            }
                                                                        });
                                                                    }
                                                                    else {
                                                                        if (taskid == value4 && (typeof taskVisible != 'undefined') && taskVisible.length > 0) {
                                                                            cnt = cnt + 1;
                                                                        }
                                                                    }
                                                                });
                                                            }
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    }
                                }
                            });

                            if ($("#" + this.id).text() != '' && cnt != 0) {
                                updateCountOnExpand($("#" + this.id), cnt);
                            }
                        });
                        iterateImprovementActivitiesOnExpand(id);
                    }
                        //// Four levels Exapnding tabs for Plan
                    else if ((id.substring(0, 1) == "Z" || id.substring(0, 1) == "L") && id.indexOf("M") <= 0) {
                        $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var a = gantt.getChildren(id);
                            $.each(a, function (index1, value1) {
                                // Start - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                var childVisibleMain = gantt.getTask(value1).$open;
                                if (typeof childVisibleMain != undefined) {
                                    if (childVisibleMain == true && value1.indexOf("M") <= 0) {
                                        var child1 = gantt.getChildren(value1);
                                        $.each(child1, function (index4, value4) {
                                            var childVisible = gantt.getTask(value4).$open;
                                            if (typeof childVisible != undefined) {
                                                if (childVisible == true && value4.indexOf("M") <= 0) {
                                                    var child = gantt.getChildren(value4);
                                                    $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                                        var taskid = $(this).attr('taskid');
                                                        var taskVisible = $("#gantt_here").find('div[task_id="' + taskid + '"]');
                                                        if (child.length > 0) {
                                                            $.each(child, function (index3, value3) {
                                                                if (taskid == value3 && (typeof taskVisible != 'undefined') && taskVisible.length > 0) {
                                                                    cnt = cnt + 1;
                                                                }
                                                            });
                                                        }
                                                        else {
                                                            if (taskid == value4 && (typeof taskVisible != 'undefined') && taskVisible.length > 0) {
                                                                cnt = cnt + 1;
                                                            }
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    }
                                }
                                // End - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            });

                            if ($("#" + this.id).text() != '' && cnt != 0) {    // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                updateCountOnExpand($("#" + this.id), cnt);
                            }
                        });
                        iterateImprovementActivitiesOnExpand(id);
                    }
                }
            }
                //// Two levels Expanding tabs for Improvent Activities in Tactic and Request Tab
                ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
            else if (id.substring(0, 1) == "L" && id.indexOf("M") > 0) {
                $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                    var tid = this.id.substring(this.id.indexOf('_') + 1);
                    var cnt = 0;
                    var a = gantt.getChildren(id);
                    $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                        var taskid = $(this).attr('taskid');
                        $.each(a, function (index, value) {

                            if (taskid == value) {
                                cnt = cnt + 1;
                            }
                        });
                    });

                    if ($("#" + this.id).text() != '' && cnt != 0) {    // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                        updateCountOnExpand($("#" + this.id), cnt);
                    }
                });
            }
        }

        function iterateImprovementActivitiesOnExpand(id) {
            $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                var tid = this.id.substring(this.id.indexOf('_') + 1);
                var cnt = 0;
                var child1 = gantt.getChildren(id);
                $.each(child1, function (index, value1) {
                    if (value1.indexOf("M") > 0) {
                        var child1Visible = gantt.getTask(value1).$open;
                        if (typeof child1Visible != undefined) {
                            if (child1Visible == true) {
                                var a = gantt.getChildren(value1);
                                $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                    var taskid = $(this).attr('taskid');
                                    $.each(a, function (index, value) {
                                        if (id.substring(0, 1) == "Z") {
                                            if (value.indexOf(taskid) > 0) {
                                                cnt = cnt + 1;
                                            }
                                        }
                                        else {
                                            if (taskid == value) {
                                                cnt = cnt + 1;
                                            }
                                        }
                                    });
                                });
                            }
                        }
                    }
                    if (id.substring(0, 1) == "Z") {
                        var child1Visible = gantt.getTask(value1).$open;
                        if (typeof child1Visible != undefined) {
                            if (child1Visible == true) {
                                var childInner = gantt.getChildren(value1);
                                $.each(childInner, function (indexInner, valueInner) {
                                    var childVisibleInner = gantt.getTask(valueInner).$open;
                                    if (typeof childVisibleInner != undefined) {
                                        if (childVisibleInner == true && valueInner.indexOf("M") > 0) {
                                            var a = gantt.getChildren(valueInner);
                                            $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                                var taskid = $(this).attr('taskid');
                                                $.each(a, function (index, value) {
                                                    if (value.indexOf(taskid) > 0) {
                                                        cnt = cnt + 1;
                                                    }
                                                });
                                            });
                                        }
                                    }
                                });
                            }
                        }
                    }
                });
                if ($("#" + this.id).text() != '' && cnt != 0) {    // Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                    updateCountOnExpand($("#" + this.id), cnt);
                }
            });
        }

        //// Added by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
        function updateCountOnExpand(spanId, cnt) {
            var TotalCountText = ($(spanId).parent()).text();
            var TotalCount = parseInt((TotalCountText.substring(TotalCountText.indexOf('/') + 1)));
            var currentCount = parseInt(spanId.text());
            var sum = (currentCount + cnt);
            if (sum <= TotalCount) {
                spanId.text(sum);
            }
        };

        //// Modified By Maninder Singh Wadhva PL Ticket#47
        gantt.attachEvent("onTaskClosed", function (id) {

            //// Modified by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
            OnTaskCollapse(id)
            hoverRows();
            if (arrClosedTask.indexOf(id) == -1) {
                arrClosedTask.push(id);
            }

            // added by dharmraj to display tooltip on camp., prog., tactic name in calendar.
            $(".gantt_container .gantt_tree_content").each(function (index, element) {
                $(element).attr("title", htmlDecode(element.innerHTML));
            });


            $(".gantt_last_cell").dblclick(function (e) {
                e.stopPropagation();
            });
            // Commented By Nishant Sheth
            // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
            //$(".gantt_add").click(function (e) {
            //    var type = $(this).attr('id');
            //    var name = $(this).attr('Name');
            //    var title = $(this).attr('aria-label');
            //    var permission = $(this).attr('Permission');
            //    var linetype = $(this).attr('lineitemtype');
            //    var LinkTacticPermission = $(this).attr('linktacticpermission');
            //    var LinkedTacticId = $(this).attr('linkedtacticid');
            //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

            //});

            var $doc = $(document);
            $doc.click(function () {
                $('#popupType').css('display', 'none');
            });

            $(document).mouseup(function (e) {
                $('#popupType').css("display", "none");
            });
            $(".gantt_ver_scroll").scroll(function () {
                $('#popupType').css('display', 'none');
            });
            GlobalSearch();

        });

        //// Added by :- Sohel Pathan on 11/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
        function OnTaskCollapse(id) {
            //iterateMarketingActivitesOnCollapse(id);
        }

        function iterateMarketingActivitesOnCollapse(id) {
            if (id.substring(0, 1) == "C" || id.substring(0, 1) == "Z" || (id.substring(0, 1) == "L" && id.indexOf("M") <= 0)) {
                var intid = 0;
                if (id.indexOf("P") >= 0) {
                    intid = id.substring(id.indexOf('P') + 1);
                }
                if (intid != 0) {
                    //// Two levels Collapsing tabs for Program in all tabs
                    $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index1) {
                        var tid = this.id.substring(this.id.indexOf('_') + 1);
                        var cnt = 0;
                        var a = gantt.getChildren(id);
                        $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                            var taskid = $(this).attr('taskid');
                            $.each(a, function (index, value) {
                                if (taskid == value) {
                                    cnt = cnt + 1;
                                }
                            });
                        });

                        updateTacticCountOnCollapse($("#" + this.id), cnt);
                    });
                }
                else {
                    //// Three levels Collapsing tabs  for Campaign in all tabs
                    if (id.substring(0, 1) == "C") {
                        $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var a = gantt.getChildren(id);
                            $.each(a, function (index1, value1) {
                                // Start - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                var childVisible = gantt.getTask(value1).$open;
                                if (typeof childVisible != undefined) {
                                    if (childVisible == true) {
                                        var child = gantt.getChildren(value1);
                                        $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                            var taskid = $(this).attr('taskid');
                                            $.each(child, function (index3, value3) {
                                                if (taskid == value3) {
                                                    cnt = cnt + 1;
                                                }
                                            });
                                        });
                                    }
                                }
                                // End - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            });

                            updateTacticCountOnCollapse($("#" + this.id), cnt);
                        });
                    }
                    //// Three levels Collapsing tabs for Improvement Activities in Stage or customfield
                    if ((id.substring(0, 1) == "Z") && (id.indexOf("L") > 0 && id.indexOf("M") > 0)) {
                        $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var a = gantt.getChildren(id);
                            $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                var taskid1 = $(this).attr('taskid');
                                $.each(a, function (index, value) {
                                    if (value.indexOf(taskid1) > 0) {
                                        cnt = cnt + 1;
                                    }
                                });
                            });

                            if ($("#" + this.id).text() != '') {
                                var newCount = parseInt($("#" + this.id).text()) - cnt;
                                if (newCount >= 0) {
                                    $("#" + this.id).text(newCount);
                                }
                            }
                        });
                    }
                        //// Five levels Expanding tabs for Stage or customfield
                    else if ((id.substring(0, 1) == "Z") && (id.indexOf("L") <= 0 && id.indexOf("M") <= 0)) {
                        $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var childLevel5 = gantt.getChildren(id);
                            $.each(childLevel5, function (index1, value5) {
                                var childVisible5 = gantt.getTask(value5).$open;
                                if (typeof childVisible5 != undefined) {
                                    if (childVisible5 == true && value5.indexOf("M") <= 0) {
                                        var a = gantt.getChildren(value5);
                                        $.each(a, function (index1, value1) {
                                            // Start - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                            var childVisibleMain = gantt.getTask(value1).$open;
                                            if (typeof childVisibleMain != undefined) {
                                                if (childVisibleMain == true && value1.indexOf("M") <= 0) {
                                                    var b = gantt.getChildren(value1);
                                                    $.each(b, function (index4, value4) {
                                                        var childVisible = gantt.getTask(value4).$open;
                                                        if (typeof childVisible != undefined) {
                                                            if (childVisible == true && value4.indexOf("M") <= 0) {
                                                                var child = gantt.getChildren(value4);
                                                                $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                                                    var taskid = $(this).attr('taskid');
                                                                    if (child.length > 0) {
                                                                        $.each(child, function (index3, value3) {
                                                                            if (taskid == value3) {
                                                                                cnt = cnt + 1;
                                                                            }
                                                                        });
                                                                    }
                                                                    else {
                                                                        if (taskid == value4) {
                                                                            cnt = cnt + 1;
                                                                        }
                                                                    }
                                                                });
                                                            }
                                                        }
                                                    });
                                                }
                                            }
                                            // End - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                        });
                                    }
                                }
                            });
                            updateTacticCountOnCollapse($("#" + this.id), cnt);
                        });
                        iterateImprovementActivitiesOnCollapse(id);
                    }
                        //// Four levels Collapsing tabs tabs for Plan
                    else if ((id.substring(0, 1) == "Z" || id.substring(0, 1) == "L") && id.indexOf("M") <= 0) {
                        $("#DivAccordionMarketingActivities").find('span[id^="spn_"]').each(function (index0) {
                            var tid = this.id.substring(this.id.indexOf('_') + 1);
                            var cnt = 0;
                            var a = gantt.getChildren(id);
                            $.each(a, function (index1, value1) {
                                // Start - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                                var childVisibleMain = gantt.getTask(value1).$open;
                                if (typeof childVisibleMain != undefined) {
                                    if (childVisibleMain == true && value1.indexOf("M") <= 0) {
                                        var b = gantt.getChildren(value1);
                                        $.each(b, function (index4, value4) {
                                            var childVisible = gantt.getTask(value4).$open;
                                            if (typeof childVisible != undefined) {
                                                if (childVisible == true && value4.indexOf("M") <= 0) {
                                                    var child = gantt.getChildren(value4);
                                                    $("#accordion-element-marketing-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                                        var taskid = $(this).attr('taskid');
                                                        if (child.length > 0) {
                                                            $.each(child, function (index3, value3) {
                                                                if (taskid == value3) {
                                                                    cnt = cnt + 1;
                                                                }
                                                            });
                                                        }
                                                        else {
                                                            if (taskid == value4) {
                                                                cnt = cnt + 1;
                                                            }
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    }
                                }
                                // End - Modified By :- Sohel Pathan on 30/07/2014 for PL ticket #649
                            });

                            updateTacticCountOnCollapse($("#" + this.id), cnt);
                        });
                        iterateImprovementActivitiesOnCollapse(id);
                    }
                }
            }
                //// Two levels Expanding tabs for Improvent Activities in Tactic and Request Tab
                ////Modified By Maninder Singh Wadhva PL Ticket#47, 337
            else if (id.substring(0, 1) == "L" && id.indexOf("M") > 0) {
                $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                    var tid = this.id.substring(this.id.indexOf('_') + 1);
                    var cnt = 0;
                    var a = gantt.getChildren(id);
                    $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                        var taskid = $(this).attr('taskid');
                        $.each(a, function (index, value) {

                            if (taskid == value) {
                                cnt = cnt + 1;
                            }
                        });
                    });

                    if ($("#" + this.id).text() != '') {
                        var newCount = parseInt($("#" + this.id).text()) - cnt;
                        if (newCount >= 0) {
                            $("#" + this.id).text(newCount);
                        }
                    }
                });
            }
        }

        function iterateImprovementActivitiesOnCollapse(id) {
            $("#DivAccordionImprovementActivities").find('span[id^="spnimprovement_"]').each(function (index1) {
                var tid = this.id.substring(this.id.indexOf('_') + 1);
                var cnt = 0;
                var child1 = gantt.getChildren(id);
                $.each(child1, function (index, value1) {
                    if (value1.indexOf("M") > 0) {
                        var child1Visible = gantt.getTask(value1).$open;
                        if (typeof child1Visible != undefined) {
                            if (child1Visible == true) {
                                var a = gantt.getChildren(value1);
                                $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                    var taskid = $(this).attr('taskid');
                                    $.each(a, function (index, value) {
                                        if (id.substring(0, 1) == "Z") {
                                            if (value.indexOf(taskid) > 0) {
                                                cnt = cnt + 1;
                                            }
                                        }
                                        else {
                                            if (taskid == value) {
                                                cnt = cnt + 1;
                                            }
                                        }
                                    });
                                });
                            }
                        }
                    }
                    if (id.substring(0, 1) == "Z") {
                        var child1Visible = gantt.getTask(value1).$open;
                        if (typeof child1Visible != undefined) {
                            if (child1Visible == true) {
                                var childInner = gantt.getChildren(value1);
                                $.each(childInner, function (indexInner, valueInner) {
                                    var childVisibleInner = gantt.getTask(valueInner).$open;
                                    if (typeof childVisibleInner != undefined) {
                                        if (childVisibleInner == true && valueInner.indexOf("M") > 0) {
                                            var a = gantt.getChildren(valueInner);
                                            $("#accordion-element-improvement-" + tid).find('a[class^="accordion-inner"]').each(function (index2) {
                                                var taskid = $(this).attr('taskid');
                                                $.each(a, function (index, value) {
                                                    if (value.indexOf(taskid) > 0) {
                                                        cnt = cnt + 1;
                                                    }
                                                });
                                            });
                                        }
                                    }
                                });
                            }
                        }
                    }
                });
                if ($("#" + this.id).text() != '') {
                    var newCount = parseInt($("#" + this.id).text()) - cnt;
                    if (newCount >= 0) {
                        $("#" + this.id).text(newCount);
                    }
                }
            });
        }

        //// Added by :- Sohel Pathan on 10/04/2014 for PL ticket #419 to display tactic count properly in left nav-menu
        function updateTacticCountOnCollapse(spanId, cnt) {
            if (spanId.text() != '') {
                var TotalCountText = ($(spanId).parent()).text();
                var TotalCount = parseInt((TotalCountText.substring(TotalCountText.indexOf('/') + 1)));
                var currentCount = parseInt(spanId.text());
                var diff = (currentCount - cnt);
                if (diff >= 0) {
                    spanId.text(diff);
                }
                else {
                    spanId.text(TotalCount - cnt);
                }
            }
        };

        function modalBackdropDisplayNone() {
            setTimeout(function () {
                $('.modal-backdrop').each(function () {
                    if (typeof ($(this).attr('id')) == 'undefined') {
                        $(this).attr("style", "display:none !important;");
                    }
                });
            }, 500);
        };

        gantt.attachEvent("onTaskDblClick", function (id, e) {

            flg = false;
        });

        //Added By Rahul Shah on 23/09/2015 for PL #1613
        gantt.attachEvent("onDataRender", function (id, e) {
            // Commented By Nishant Sheth
            // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
            //$(".gantt_add").click(function (e) {

            //    var type = $(this).attr('id');
            //    var name = $(this).attr('Name');
            //    var title = $(this).attr('aria-label');
            //    var permission = $(this).attr('Permission');
            //    var linetype = $(this).attr('lineitemtype');
            //    var LinkTacticPermission = $(this).attr('linktacticpermission');
            //    var LinkedTacticId = $(this).attr('linkedtacticid');
            //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

            //});
        });

        gantt.attachEvent("onTaskSelected", function (id, item) {
        });

    </script>

    <script>

        function hoverRows() {
            /*change hover envent on gantt rows to yellow banckgorund*/
            $('.gantt_row').hover(function () {
                $(this).css("background-color", "#fff3a1");
                var task_id = $(this).attr('task_id');
                $('.gantt_task_row').each(function () {
                    if ($(this).attr('task_id') == task_id) {
                        $(this).css("background-color", "#fff3a1");
                    }
                });
            }, function () {
                $(this).css("background-color", "#ffffff");
                var task_id = $(this).attr('task_id');
                $('.gantt_task_row').each(function () {
                    if ($(this).attr('task_id') == task_id) {
                        $(this).css("background-color", "#ffffff");
                    }
                });
            });
            /*change hover envent on gantt rows to yellow banckgorund*/
            $('.gantt_task_row').hover(function () {
                $(this).css("background-color", "#fff3a1");
                var task_id = $(this).attr('task_id');
                $('.gantt_row').each(function () {
                    if ($(this).attr('task_id') == task_id) {
                        $(this).css("background-color", "#fff3a1");
                    }
                });
            }, function () {
                $(this).css("background-color", "#ffffff");
                var task_id = $(this).attr('task_id');
                $('.gantt_row').each(function () {
                    if ($(this).attr('task_id') == task_id) {
                        $(this).css("background-color", "#ffffff");
                    }
                });
            });
        }

    </script>

    <script>
        var ImpTacticId;
        $(document).ready(function () {
            function toggleChevron(e) {
                $(e.target)
                    .prev('.accordion-heading')
                    .find("i.indicator")
                //.toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
                .toggleClass('fa-angle-down fa-angle-up');
            }
            $('.accordion').on('hidden.bs.collapse', toggleChevron);
            $('.accordion').on('shown.bs.collapse', toggleChevron);

            if ($('#ddlUpComingActivites').val() != 'undefined') {
                Currenttime = $('#ddlUpComingActivites').val();
                isQuater = Currenttime;
            }
            //   GetLastSetofViews();



        });

        function SetTooltip() {            
            $(".honeycombbox-icon-gantt").tooltip({
                'container': 'body',
                'placement': 'bottom'
            });
            $(".grid_Search").tooltip({
                'container': 'body',
                'placement': 'bottom'
            });            
        }
        var PreviousListFilter = {
            OwnerIds: [],
            TacticTypeIds: []
        }
        function GetLastSetofViews(presetName) {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("LastSetOfViews", "Home")',
                data: { PresetName: presetName },
                dataType: "json",
                async: false,
                success: function (data) {

                    if (data.returnURL != 'undefined' && data.returnURL == '#') {
                        window.location = '@Url.Content("~/Login/Index")';
                    }
                    else {
                        if (data.StatusNAmes != null) {
                            if (data.StatusNAmes.length != 0 && data.StatusNAmes.length != undefined) {
                                $("#ulStatus li input[type=checkbox]").removeAttr('checked');
                                $("#ulStatus li ").removeClass("close-list");
                                for (i = 0 ; i < data.StatusNAmes.length; i++) {
                                    $("#ulStatus li input[type=checkbox]").each(function () {
                                        var Value = $(this).attr("id");
                                        if (Value == data.StatusNAmes[i]) {
                                            filters.StatusIds.push(Value);
                                            $(this).attr('checked', 'checked');
                                            $(this).parent().addClass("close-list");
                                        }

                                    });

                                }

                            }
                            else {
                                $('#ulStatus').find("input[type=checkbox]").each(function () {
                                    $(this).attr('checked', 'checked');
                                    $(this).parent().addClass("close-list");

                                });


                            }
                        }
                        else {
                            $("#ulStatus li").each(function (i) {
                                $(this).removeClass("close-list");
                                var chkid = $(this).find("input[type=checkbox]").attr("id");
                                $("#" + chkid).removeAttr("checked");
                            });
                        }

                        var AutoSelectedCustomField = 0;
                        if (data.Customfields.length != 0 && data.Customfields.length != undefined) {
                            for (i = 0 ; i < data.Customfields.length; i++) {
                                var CustomFieldId = data.Customfields[i].ID.split('_')[1];
                                var CustomFieldValues = data.Customfields[i].Value;
                                $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                                    var chkid = $(this).attr("id");
                                    var chkfieldid = $(this).attr("id").split('_')[0];
                                    var chkOptionid = $(this).attr("id").split('_')[1];
                                    if (chkfieldid == CustomFieldId) {
                                        if (CustomFieldValues.indexOf(chkOptionid) != -1) {
                                            $(this).attr('checked', 'checked');
                                            AutoSelectedCustomField++;
                                            filters.customFieldIds.push(chkid);
                                            $(this).parent().addClass("close-list");
                                        }
                                        else {
                                            $(this).removeAttr('checked');
                                        }

                                    }
                                });
                                //Maintain CustomeField Count : 1952 By Maitri Gandhi
                                $("#SelectedCustomFilter_" + CustomFieldId).text(AutoSelectedCustomField);
                                AutoSelectedCustomField = 0;

                            }
                        }
                        else {
                            //Code for Select All : 1952 By Maitri Gandhi
                            $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                                $(this).attr('checked', 'checked');
                                $(this).parent().addClass("close-list");
                                AutoSelectedCustomField++;
                            });
                            $('#ulSelectedFilter').find("li #CustomFields .sidebarliwidthSelected-right").text(FiltersAll);

                        }
                        //Modified by komal rawal for #2301 on 28-06-2016
                        if (data.OwnerNames.length != 0 && data.OwnerNames.length != undefined && data.OwnerNames != "All") {
                            filters.OwnerIds = [];
                            $("#ulSelectedOwner li input[type=checkbox]").removeAttr('checked');
                            $("#ulSelectedOwner li ").removeClass("close-list");
                            for (i = 0 ; i < data.OwnerNames.length; i++) {
                                PreviousListFilter.OwnerIds.push(data.OwnerNames[i]);
                                $("#ulSelectedOwner li input[type=checkbox]").each(function () {
                                    var Value = $(this).attr("id");
                                    if (Value == data.OwnerNames[i]) {
                                        filters.OwnerIds.push(Value);
                                        $(this).attr('checked', 'checked');
                                        $(this).parent().addClass("close-list");
                                    }
                                });
                            }
                        }
                        else if (data.OwnerNames == "All")
                        {
                            $("#ulSelectedOwner li input[type=checkbox]").each(function () {
                                var Value = $(this).attr("id");
                                filters.OwnerIds.push(Value);
                                $(this).attr('checked', 'checked');
                                $(this).parent().addClass("close-list");
                            });

                        }



                        if (data.TTList != null) {
                            if (data.TTList.length != 0 && data.TTList.length != undefined && data.TTList != "All") {
                                filters.TacticTypeids = [];
                                $("#ulTacticType li input[type=checkbox]").removeAttr('checked');
                                $("#ulTacticType li ").removeClass("close-list");
                                for (i = 0 ; i < data.TTList.length; i++) {
                                    PreviousListFilter.TacticTypeIds.push(data.TTList[i]);
                                    $("#ulTacticType li input[type=checkbox]").each(function () {
                                        var Value = $(this).attr("id").replace("CbTT", "");
                                        if (Value == data.TTList[i]) {
                                            filters.TacticTypeids.push(Value);
                                            $(this).attr('checked', 'checked');
                                            $(this).parent().addClass("close-list");
                                        }
                                    });

                                }

                            }
                            else if (data.TTList == "All") {
                                $("#ulTacticType li input[type=checkbox]").each(function () {
                                    var Value = $(this).attr("id").replace("CbTT", "");
                                    filters.TacticTypeids.push(Value);
                                    $(this).attr('checked', 'checked');
                                    $(this).parent().addClass("close-list");
                                });

                            }
                            else {
                                $('#ulTacticType').find("input[type=checkbox]").each(function () {
                                    $(this).attr('checked', 'checked');
                                    $(this).parent().addClass("close-list");

                                });

                            }
                        }
                        else {
                            $("#ulTacticType li").each(function (i) {
                                $(this).removeClass("close-list");
                                var chkid = $(this).find("input[type=checkbox]").attr("id");
                                $("#" + chkid).removeAttr("checked");
                            });

                        }



                        if (data.Years != null) {
                            if (data.Years.length != 0 && data.Years.length != undefined) {
                                $("#ulSelectedYear li input[type=checkbox]").removeAttr('checked');
                                $("#ulSelectedYear li ").removeClass("close-list");
                                for (i = 0 ; i < data.Years.length; i++) {
                                    $("#ulSelectedYear li input[type=checkbox]").each(function () {
                                        var Value = $(this).attr("yearvalue");
                                        if (Value == data.Years[i]) {
                                            filters.SelectedYears.push(Value);
                                            $(this).attr('checked', 'checked');
                                            $(this).parent().addClass("close-list");
                                        }

                                    });

                                }

                            }
                        }
                        //Added by Maitri Gandhi for #2014 on 29/2/2016 to maintain selected preset
                        if (presetName != 'undefined' && presetName != null && presetName != "")
                        {
                            SaveLastSetofViews();
                        }
                        UpdateSelectedFilters();

                    }
                }
            });

        }


        function RefershPlanHeaderCalc() {
            var Currenttime = $('#ddlUpComingActivites').val();
            //  var SelectedPlanIds = $('#hdnSelectedPlanIds').val();
            //Modified By Komal Rawal on 22-02-16 to get proper value in header according to filter on add or copy tactic.
            var SelectedPlanIds = [];
            var SelectedOwners = [];
            var SelectedCF = [];
            var SelectedTacticType = [];
            var SelectedStatus = [];
            $('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
                if ($(this).attr('checked') == 'checked') {
                    var chkid = $(this).attr("id");
                    if (chkid != undefined && chkid != 'undefined') {
                        SelectedPlanIds.push(chkid);
                    }
                }
            });

            if (SelectedPlanIds.length == 0 || SelectedPlanIds == null || SelectedPlanIds == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                SelectedPlanIds = $('#hdnSelectedPlanIds').val()
            }

            $("#ulSelectedOwner li input:checkbox:checked").map(function () {
                SelectedOwners.push($(this).attr("id"));
            });

            $("#ulTacticType li input[type=checkbox]:checked").each(function () {

                var chkid = $(this).attr("id");
                SelectedTacticType.push(chkid.replace("CbTT", ""));

            });

            $('#divCustomFieldsFilter').find("input[type=checkbox]:checked").each(function () {
                var chkid = $(this).attr("id");
                if (chkid != undefined && chkid != 'undefined') {
                    SelectedCF.push(chkid);
                }
            });
            //Added for "Select All" case of #1952 and #1993 By Maitri Gandhi on 16/2/2016
            var CheckedCounter = 0, AllCounter = 0, id = null, UncheckedCounter = 0;;
            $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                    AllCounter = $(this).find("input[type=checkbox]").length;
                    CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                    UncheckedCounter = AllCounter - CheckedCounter;
                    if (AllCounter == UncheckedCounter) {
                        var Id = $(this).attr("id");
                        if (Id.indexOf("-") >= 0) {
                            Id = Id.split('-')[1];
                            var CustomId = Id + "_null";
                            SelectedCF.push(CustomId);

                        }
                    }
                    else if (AllCounter == CheckedCounter) {
                        id = this.id;
                        if (id != null && id != "" && id.indexOf("-") > -1) {
                            id = this.id.split("-")[1];
                        }
                        var i = 0, customfieldid;
                        for (i = 0; i < SelectedCF.length; i++) {
                            if (SelectedCF[i].indexOf("_") > -1) {
                                customfieldid = SelectedCF[i].split("_")[0];
                                if (id == customfieldid) {
                                    SelectedCF.splice(i, 1);
                                    i--;
                                }
                            }
                        }
                    }
                }
            });        ////End
            $("#ulStatus li input[type=checkbox]:checked").each(function () {
                var chkid = $(this).attr("id");
                SelectedStatus.push(chkid);
            });
            //End
            //Modified BY Komal rawal for #1929 proper Hud chart and count
            var ID = CalendarId;
            if ($('#IsGridView').val().toLowerCase() == "true") {
                ID = GridId;
                GetHealderData(SelectedPlanIds, SelectedCF, SelectedOwners, SelectedTacticType, SelectedStatus, ID); //Modified by Nishant Sheth for perfomance to make it call only for grid view
            }

            GetNumberOfActivityPerMonByPlanIdPer(SelectedPlanIds, Currenttime);
        }

        $('#errorMessageInspectPopup .close').click(function () {
            $('#content_wraper').removeClass('padding-top40');
        });


        //Added By Ravindra Singh Sisodiya
        // Ticket #1411
        function displayconfirm(strURL) {
            if (isDataChanged()) {
                $('#spanMessageError').html(" You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;&nbsp;<a style='color:gray;' href='" + strURL + "' class='btn-gray'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
                $("#errorMessage").slideDown(400);
            }
            else {
                window.location.href = strURL;
            }
        }

        //function to check myValue attribute values and input values that any changes made?
        function isDataChanged() {
            var changed = false;
            $('.accordion-actuals').find("input,input[type=text],textarea,select").each(function () {
                var iv = $(this).attr("myValue");
                if ($(this).val().toString().trim() != iv.toString().trim()) {
                    //changed = true;
                    changed = false;
                    //return false;
                }
            });
            return changed;
        }

        function HideAllMessages() {
            $("#successMessagePlan").css("display", "none");
            $("#spanSuccMessagePlan").empty();
            $("#errorMessagePlan").css("display", "none");
            $("#spanErrMessagePlan").empty();
            $("#successMessage").css("display", "none");
            $("#spanMessageSuccess").empty();
            $("#errorMessage").css("display", "none");
            $("#spanMessageError").empty();
        }



        function DisplayPopUpMenu(obj,e) {
            gridSearchFlag = 1;
            // Modified By Nishant Sheth
            // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
            var LinkTacticPermission = $(obj).attr('linktacticpermission');
            var LinkedTacticId = $(obj).attr('linkedtacticid');

            //var type = typeVal;
            var type = $(obj).attr('id');
            //var name = nameVal;
            var name = $(obj).attr('Name');
            // var chk_permission = titleVal.split("/");
            //var title = titleVal;
            var title = $(obj).attr('aria-label');
            //var permission = permission;
            var permission = $(obj).attr('Permission');

            //var LineType = linetype;
            var LineType = $(obj).attr('lineitemtype');
            //Modified BY Komal Rawal for 2056
            if($('#IsGridView').val().toLowerCase() == "true")
            {
                LinkTacticPermission = $(obj).attr('linktacticper');
                LinkedTacticId = $(obj).attr('linkedtacticid');
                type = $(obj).attr('id');
                //var name = nameVal;
                name = $(obj).attr('alt');
                // var chk_permission = titleVal.split("/");
                //var title = titleVal;
                title = $(obj).parent().prev().attr('title');
                //var permission = permission;
                permission = $(obj).attr('per');

                //var LineType = linetype;
                LineType = $(obj).attr('lt');

            } //End
            var name_Id = name.split("_");
            var PlanId;
            var CampaignId;
            var ProgramId;
            var TacticId;
            var ImpTacticId;
            var LineId;

            if (name_Id.length == 1) {
                PlanId = name_Id[0].replace("L", "");
            }
            else if (name_Id.length == 2) {
                // Chaneg By Nishant Sheth
                // Desc:: To resolve issue with change view by dropdown
                var nameindex = name.indexOf("Z");
                if (nameindex >= 0) {
                    PlanId = name_Id[1].replace("L", "");
                    CampaignId = name_Id[1].replace("C", "");
                } else {
                    PlanId = name_Id[0].replace("L", "");
                    CampaignId = name_Id[1].replace("C", "");
                }
            }
            else if (name_Id.length == 3) {
                // Chaneg By Nishant Sheth
                // Desc:: To resolve issue with change view by dropdown
                var nameindex = name.indexOf("Z");
                if (nameindex >= 0) {
                    PlanId = name_Id[1].replace("L", "");
                    CampaignId = name_Id[2].replace("C", "");
                    //ProgramId = name_Id[2].replace("P", "");
                } else {
                    PlanId = name_Id[0].replace("L", "");
                    CampaignId = name_Id[1].replace("C", "");
                    ProgramId = name_Id[2].replace("P", "");
                }
            }
            else if (name_Id.length == 4) {
                // Chaneg By Nishant Sheth
                // Desc:: To resolve issue with change view by dropdown
                var nameindex = name.indexOf("Z");
                if (nameindex >= 0) {
                    PlanId = name_Id[1].replace("L", "");
                    CampaignId = name_Id[2].replace("C", "");
                    ProgramId = name_Id[3].replace("P", "");
                    //TacticId = name_Id[3].replace("T", "");
                } else {
                    PlanId = name_Id[0].replace("L", "");
                    CampaignId = name_Id[1].replace("C", "");
                    ProgramId = name_Id[2].replace("P", "");
                    TacticId = name_Id[3].replace("T", "");
                }
            }
            else {

                // Chaneg By Nishant Sheth
                // Desc:: To resolve issue with change view by dropdown
                var nameindex = name.indexOf("Z");
                if (nameindex >= 0) {
                    PlanId = name_Id[1].replace("L", "");
                    CampaignId = name_Id[2].replace("C", "");
                    ProgramId = name_Id[3].replace("P", "");
                    TacticId = name_Id[4].replace("T", "");
                    //LineId = name_Id[4];
                } else {
                    PlanId = name_Id[0].replace("L", "");
                    CampaignId = name_Id[1].replace("C", "");
                    ProgramId = name_Id[2].replace("P", "");
                    TacticId = name_Id[3].replace("T", "");
                    LineId = name_Id[4];
                }
            }

            var ul;

            if (type == "Plan") {
                if (permission == "true") {
                    if ('@IsPlanCreateAuthorized'.toLowerCase() == 'true') {
                        ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewPlan'>New Plan </li> <li class='new-prog' id='ClonePlan1'>Copy Plan</li>  <li class='new-prog' id='ChildCampaign'>New Campaign</li> </ul>";
                    }
                    else {

                        ul = "<ul style='margin: 0;'> <li class='new-prog' id='ChildCampaign'>New Campaign</li> </ul>";

                    }
                }
                else {
                    $('#popupType').css('display', 'none');
                }
            }

            else if (type == "Program") {
                if (permission == "true") {
                    ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewProgram'>New Program </li> <li class='new-prog' id='CloneProgram1'>Copy Program </li>  <li class='new-prog' id='ChildTactic'>New Tactic</li> <li class='new-prog CopyEntity' sectionType='" + type + "' entityId='" + PlanId + "_" + ProgramId + "' id='lblCopyTo' popupType='Copying'  onclick='OpentCopyPopup(this)'>Copy To</li></ul>";
                }
                else {
                    $('#popupType').css('display', 'none');
                }
            }

            else if (type == "Tactic") {
                if (permission == "true") {

                    if (LinkTacticPermission.toLowerCase() == "true" && (LinkedTacticId == "null" || LinkedTacticId == "0")) {
                        ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewTactic1'>New Tactic </li> <li class='new-prog' id='CloneTactic1'>Copy Tactic </li>  <li class='new-prog' id='ChildLineItem'>New Line Item </li> <li class='new-prog CopyEntity' sectionType='" + type + "' entityId='" + PlanId + "_" + TacticId + "' id='lblCopyTo' onclick='OpentCopyPopup(this)' popupType='Copying'>Copy To</li> <li class='link-icon' sectionType='" + type + "' entityId='" + PlanId + "_" + TacticId + "' id='lblLinkTo' onclick='OpentCopyPopup(this)'popupType='Linking'><i class='fa fa-link'></i>Link To</li></ul>";
                    }
                    else {

                        ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewTactic1'>New Tactic </li> <li class='new-prog' id='CloneTactic1'>Copy Tactic </li>  <li class='new-prog' id='ChildLineItem'>New Line Item </li> <li class='new-prog CopyEntity' sectionType='" + type + "' entityId='" + PlanId + "_" + TacticId + "' id='lblCopyTo' popupType='Copying' onclick='OpentCopyPopup(this)'>Copy To</li></ul>";

                    }
                }
                else {
                    $('#popupType').css('display', 'none');
                }
            }

            else if (type == "Campaign") {
                if (permission == "true") {
                    ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewCampaign'>New Campaign</li> <li class='new-prog' id='CloneCampaign1'>Copy Campaign</li>  <li class='new-prog' id='ChildProgram'>New Program</li> <li class='new-prog CopyEntity' sectionType='" + type + "' entityId='" + PlanId + "_" + CampaignId + "' id='lblCopyTo' onclick='OpentCopyPopup(this)' popupType='Copying'>Copy To</li></ul>";
                }
                else {
                    $('#popupType').css('display', 'none');
                }
            }
            else if (type == "Line") {
                if (permission == "true") {
                    if (LineType == "0") {
                        ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewLineItem'>New Line Item</li> </ul>";
                    }
                    else {
                        ul = "<ul style='margin: 0;'>  <li class='new-prog' id='NewLineItem'>New Line Item</li> <li class='new-prog' id='CloneLineItem'>Copy Line Item</li>  </ul>";

                    }
                }
                else {
                    $('#popupType').css('display', 'none');
                }
            }
            else {
                if (permission == "true") {
                    ul = "<ul style='margin: 0;'>  <li class='new-prog' id='ImpsTactic'>New " + type + "</li> </ul>";
                }
                else {
                    $('#popupType').css('display', 'none');
                }
                if (name_Id.length != 1 && name_Id.length != 0) {
                    var nameindex = name.indexOf("Z");
                    if (nameindex >= 0) {
                        ImpTacticId = name_Id[2].replace("M", "");
                    } else {
                        ImpTacticId = name_Id[1].replace("M", "");
                    }
                }
            }
            if (permission == "true") {
                $('#popupType').css('display', 'block');
            }
            $('#popupType').html(ul);

            var left = e.pageX;
            var target = $(e.target);
            var targetOffset = target.offset().top;
            var scrollPosition = $(window).scrollTop();

            if ($('#popupType').css('display') != 'none') {
                if (scrollPosition <= targetOffset) {
                    $('#popupType').css({
                        //'display': 'block',
                        'top': targetOffset,
                        'left': left,
                    });
                }
                else {
                    var targetHeight = target.height();
                    var contentHeight = $('#popupType').outerHeight();
                    var targetBottomOffset = targetOffset + targetHeight - contentHeight;
                    $('#popupType').css({
                        // 'display': 'block',
                        'top': targetBottomOffset,
                        'left': left,
                    });
                }
            }
            //else {
            //    $('#popupType').css('display', 'none');
            //}
            e.stopPropagation();

            ////new Plan.
            $("#NewPlan").click(function (e) {

                var url = '@Url.Action("CreatePlan", "Plan")';
                displayconfirm(url);
            });

            ////Copy Plan.
            $('#ClonePlan1').click(function () {
                var planId = PlanId; //$("#hdnPlanId").val();
                if (parseInt(planId) > 0) {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/Clone")',
                        data: {
                            CloneType: '@Enums.DuplicationModule.Plan',
                            Id: PlanId,
                            title: ''
                        },
                        success: function (data) {
                            if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                window.location = '@Url.Content("~/Login/Index")';
                            }
                            else {
                                if (data.redirect) {
                                    $("#successMessage").css("display", "block");
                                    $("#spanMessageSuccess").empty();
                                    $("#spanMessageSuccess").text(data.msg);
                                    logMixpanelTrack("Copy Plan:" + data.msg); // log Plan copied event to mixpanel. Added by Viral regarding PL ticket #2434.
                                    window.location = data.redirect;
                                    //  RefreshCurrentTab();
                                    return;
                                }
                                if (data.errormsg != '') {
                                    $('#cErrorDuplicatePlan').html('<strong>Error! </strong> ' + $('#cErrorDuplicatePlan').html());
                                    return;
                                }

                            }
                        }
                    });
                }
            });

            //Child Campaign
            $('#ChildCampaign').click(function () {
                isCopyTactic = PlanId;
                var planId = PlanId; // $("#hdnPlanId").val();
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Campaign).ToLower()", 0, planId, '@RequestedModule');
                $('.taskpopup').css('display', 'none');
            });

            //new Campaign
            $('#NewCampaign').click(function () {
                isCopyTactic = PlanId;
                var planId = PlanId; // $("#hdnPlanId").val();
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Campaign).ToLower()", 0, planId, '@RequestedModule');
                $('.taskpopup').css('display', 'none');
            });

            ////Copy Campaign.
            $('#CloneCampaign1').click(function () {
                if ($('#IsGridView').val().toLowerCase() == "false") {
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = CampaignId;
                var idPlanCamaign = CampaignId;//$("#hdnPlanCampaignId").val();
                var Title = $("<div/>").text(title).html();// Encode Title
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Inspect/Clone")',
                    data: {
                        CloneType: '@Enums.DuplicationModule.Campaign',
                        Id: idPlanCamaign,
                        title: Title,
                        CalledFromBudget: '@CalledFromBudget',
                        RequsetedModule: '@RequestedModule',
                        planId: PlanId
                    },
                    success: function (data) {
                        if (data.IsSuccess != 'undefined' && data.IsSuccess == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else if (data.IsSuccess) {
                            RefershPlanHeaderCalc();   //Modified By Komal Rawal on 04-03-16 to get proper value in header according to filter on add or copy Campaign.
                            isCopyTactic = data.Id;
                            isCopyTacticHomeGrid = isCopyTactic;
                            if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Nishant Sheth for perfomance
                                RefreshCurrentTab();
                            }
                            isError = false;
                            ShowMessage(isError, data.msg);
                            logMixpanelTrack("Copy Campaign:" + data.msg); // log Plan copied event to mixpanel. Added by Viral regarding PL ticket #2434.

                            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                                if (CurrentPlanId > 0) {
                                    if ($('#IsGridView').val().toLowerCase() == "true") {
                                        LoadPlanGrid();
                                    }

                                }
                            }

                            return;
                        }
                        else {
                            isError = true;
                            ShowMessage(isError, data.msg);
                            return false;
                        }
                    }
                });
            });

            //Child Program
            $('#ChildProgram').click(function () {
                if ($('#IsGridView').val().toLowerCase() == "false") {
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = CampaignId;
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Program).ToLower()", 0, CampaignId, '@RequestedModule');
                $('.taskpopup').css('display', 'none');
            });

            //New Program
            $('#NewProgram').click(function () {
                isCopyTactic = CampaignId;
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Program).ToLower()", 0, CampaignId, '@RequestedModule');
                $('.taskpopup').css('display', 'none');
            });

            //Copy Program
            $('#CloneProgram1').click(function () {
                if ($('#IsGridView').val().toLowerCase() == "false") {
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = ProgramId;
                var idPlanProgram = ProgramId;// $("#hdnPlanProgramId").val();
                var Title = $("<div/>").text(title).html();// Encode Title
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Inspect/Clone")',
                    data: {
                        CloneType: '@Enums.DuplicationModule.Program',
                        Id: idPlanProgram,
                        title: Title,
                        CalledFromBudget: '@CalledFromBudget',
                        RequsetedModule: '@RequestedModule'
                    },
                    success: function (data) {
                        if (data.IsSuccess != 'undefined' && data.IsSuccess == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else if (data.IsSuccess) {
                            RefershPlanHeaderCalc();   //Modified By Komal Rawal on 04-03-16 to get proper value in header according to filter on add or copy program.
                            isCopyTactic = data.Id;
                            isCopyTacticHomeGrid = isCopyTactic;
                            if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Nishant Sheth for perfomance
                                RefreshCurrentTab();
                            }
                            isError = false;
                            ShowMessage(isError, data.msg);
                            logMixpanelTrack("Copy Program:" + data.msg); // log Program copied event to mixpanel. Added by Viral regarding PL ticket #2434.
                            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                                if (CurrentPlanId > 0) {
                                    if ($('#IsGridView').val().toLowerCase() == "true") {
                                        LoadPlanGrid();
                                    }
                                }
                            }
                            return;
                        }
                        else {
                            isError = true;
                            ShowMessage(isError, data.msg);
                            return false;
                        }
                    }
                });
            });

            //Child Tactic
            $("#ChildTactic").on("click", function () {
                if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = ProgramId;
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()", 0, ProgramId, '@RequestedModule');
                $("#errorMessage").css("display", "none");
                $("#successMessage").css("display", "none");
                $('.taskpopup').css('display', 'none');
                return false;
            });

            //New Tactic
            $("#NewTactic1").on("click", function () {

                if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = ProgramId;
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()", 0, ProgramId, '@RequestedModule');
                $("#errorMessage").css("display", "none");
                $("#successMessage").css("display", "none");
                $('.taskpopup').css('display', 'none');
                return false;
            });

            //Copy Tactic
            $('#CloneTactic1').click(function () {

                if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = ProgramId;
                var idPlanTactic = TacticId;// $("#hdnPlanTacticId").val();
                var Title = $("<div/>").text(title).html();// Encode Title
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Inspect/Clone")',
                    data: {
                        CloneType: '@Enums.DuplicationModule.Tactic',
                        Id: idPlanTactic,
                        title: Title,
                        CalledFromBudget: '@CalledFromBudget',
                        RequsetedModule: '@RequestedModule'
                    },
                    success: function (data) {
                        if (data.IsSuccess != 'undefined' && data.IsSuccess == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else if (data.IsSuccess) {
                            RefershPlanHeaderCalc();   //Modified By Komal Rawal on 22-02-16 to get proper value in header according to filter on add or copy tactic.
                            isCopyTactic = data.Id;
                            isCopyTacticHomeGrid = isCopyTactic;
                            if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Nishant Sheth for perfomance
                                RefreshCurrentTab();
                            }
                            isError = false;
                            ShowMessage(isError, data.msg);
                            logMixpanelTrack("Copy Tactic:" + data.msg); // log Tactic copied event to mixpanel. Added by Viral regarding PL ticket #2434.
                            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                                if (CurrentPlanId > 0) {
                                    if ($('#IsGridView').val().toLowerCase() == "true") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                                        LoadPlanGrid();
                                    }
                                    else {
                                        //Added by kausha somaiya on 09/01/2015 for ticket no #1869
                                        GetCollaborators(CurrentPlanId);
                                    }
                                }
                            }
                            return;
                        }
                        else {
                            isError = true;
                            ShowMessage(isError, data.msg);
                            return false;
                        }
                    }
                });
            });

            //Child Line Item
            $('#ChildLineItem').click(function () {
                isCopyTactic = TacticId;
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.LineItem).ToLower()", 0, TacticId, '@RequestedModule');
                $('.taskpopup').css('display', 'none');
            });

            //Improvments Tactic
            $('#ImpsTactic').click(function (e) {
                var improvementTacticId = ImpTacticId;
                e.stopPropagation();
                $.ajaxSetup({ cache: false });
                var idTactic = "0";//$(this).parent().attr("index");

                if (idTactic == 0) {
                    $("a#divimpTactic").removeClass('1');
                    $(this).parent().addClass('1');
                }
                displayConfirmCommon('impTacticCommonClick(' + idTactic + ',' + improvementTacticId + ');');
                $('.taskpopup').css('display', 'none');
            });
            // New Line Item
            //new Campaign
            $('#NewLineItem').click(function () {
                isCopyTactic = TacticId;
                isDataModified = false;
                var planId = PlanId; // $("#hdnPlanId").val();
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.LineItem).ToLower()", 0, TacticId, '@RequestedModule');
                $('.taskpopup').css('display', 'none');
            });

            //Copy Line Item
            $('#CloneLineItem').click(function () {
                if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                    scrollstate = gantt.getScrollState();
                    bodyscrollpos = $(window).scrollTop();
                }
                isCopyTactic = TacticId;
                var idPlanLineItem = LineId;// $("#hdnPlanTacticId").val();
                var Title = $("<div/>").text(title).html();// Encode Title
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Inspect/Clone")',
                    data: {
                        CloneType: '@Enums.DuplicationModule.LineItem',
                        Id: idPlanLineItem,
                        title: Title,
                        CalledFromBudget: '@CalledFromBudget',
                        RequsetedModule: '@RequestedModule'
                    },
                    success: function (data) {
                        if (data.IsSuccess != 'undefined' && data.IsSuccess == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else if (data.IsSuccess) {
                            isCopyTactic = data.Id;
                            isCopyTacticHomeGrid = isCopyTactic;
                            RefreshCurrentTab();
                            isError = false;
                            ShowMessage(isError, data.msg);
                            if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
                                if (CurrentPlanId > 0) {
                                    if ($('#IsGridView').val().toLowerCase() == "true") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                                        LoadPlanGrid();
                                    }
                                }
                            }
                            return;
                        }
                        else {
                            isError = true;
                            ShowMessage(isError, data.msg);
                            return false;
                        }
                    }
                });
            });
            function displayConfirmCommon(functionName) {
                eval(functionName);

            }

        }
        //Dharmraj Start 8July2014 Common function to handle tactic click event
        function impTacticCommonClick(id, improvementTacticId) {
            if (id == 0) {
                var idProgram = improvementTacticId;// $("a#divimpTactic.1").attr('data-id-program');
                ShowModels("@Enums.InspectPopupMode.Add.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.ImprovementTactic).ToLower()", 0, idProgram, '@Enums.InspectPopupRequestedModules.Index.ToString()');
                return false;
            }
            else {
                ShowModels("@Enums.InspectPopupMode.ReadOnly.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.ImprovementTactic).ToLower()", id, idProgram, '@Enums.InspectPopupRequestedModules.Index.ToString()');
                return false;
            }
        }

        function ShowModels(mode, section, id, ParentId, RequestedModule) {
            removeDefaultModalPopupBackgroungColor();
            modalFullPosition(); // Added by Kapil Antala on 17 Sep 2014 for #732 - new popup design

            $('.modal-backdrop').addClass('modalFull-backdrop');
            $('.modal-backdrop').attr("style", "display:none !important;");
            $("#successMessage").css("display", "none");
            $("#errorMessage").css("display", "none");
            $("#successMessageDuplicatePlan").css("display", "none");
            $("#modal-container-186470").modal('show');
            ParentId = typeof ParentId != 'undefined' ? ParentId : '0';
            RequestedModule = typeof RequestedModule != 'undefined' ? RequestedModule : '';

            $("#hdnRequestedModule").val(RequestedModule);
            var currentTab = "Setup";
            // Commented by Arpita Soni for Ticket #2236 on 06/20/2016
            //if ((RequestedModule == "Budgeting") && (mode == "ReadOnly")) {
            //    currentTab = "Budget";
            //}

            if (section == "campaign") {
                if (mode == "Add") {
                    loadInspectPopup("0", "campaign", currentTab, "Add", ParentId, RequestedModule);
                }
                else {
                    loadInspectPopup(id, "campaign", currentTab, "Edit", ParentId, RequestedModule);
                }
            }
            else if (section == "program") {
                if (mode == "Add") {
                    loadInspectPopup("0", "program", currentTab, "Add", ParentId, RequestedModule);
                }
                else {
                    loadInspectPopup(id, "program", currentTab, "Edit", ParentId, RequestedModule);
                }
            }
            else if (section == "tactic") {
                if (mode == "Add") {
                    loadInspectPopup("0", "tactic", currentTab, "Add", ParentId, RequestedModule);
                }
                else {
                    loadInspectPopup(id, "tactic", currentTab, "Edit", ParentId, RequestedModule);
                }
            }
            else if (section == "improvementtactic") {
                if (mode == "Add") {
                    loadInspectPopup(0, "improvementtactic", currentTab, "Add", ParentId, RequestedModule);
                }
                else {
                    loadInspectPopup(id, "improvementtactic", currentTab, "Edit", ParentId, RequestedModule);
                }
            }
            else if (section == "lineitem") {
                if (mode == "Add") {
                    loadInspectPopup("0", "lineitem", currentTab, "Add", ParentId, RequestedModule);
                }
                else {
                    loadInspectPopup(id, "lineitem", currentTab, "Edit", ParentId, RequestedModule);
                }
            }
            else if (section == "plan") {
                if (mode == "Add") {
                    loadInspectPopup("0", "plan", currentTab, "Add", ParentId, RequestedModule);
                }
                else {
                    loadInspectPopup(id, "plan", currentTab, "Edit", ParentId, RequestedModule);
                }
            }
            //modalBackdropDisplayNone();
        };

    </script>
    <script>
        $('.sidebar-toogle a').toggle(

    function () {
        $('#sidebar').css({
            'position': 'relative',
            'left': 'auto',
            'width': '50px',
            'background': 'transparent',

        });
        $(".sidebar-toogle-wrapper h4.text-shadow-black").css("display", "none");
        $(".sidebar-section").css("display", "none");
        $("#improvements > .accordion-group").css('display', 'none'); // added by dashrath prajapati for pl #1955 H9_QA: Improvement tactics label visisble under filters
        $('.sidebar-toogle a').html(">>").css('letter-spacing', '-1px');

        $(".wraper-btns").css("display", "none");
        $("#content_wraper").css('width', 'calc(100% - 52px)'); // #2331 issue
        $('#sidebar.sidebar').css({ 'width': '50px', 'background': 'transparent', });
        $('.sidebar-toogle').css('border-bottom-width', '0');

        ///new code
        var ganttwidth = $("#gantt_here").width();
        var totalWidth = ganttwidth - 230;
        if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
            if ($('#IsGridView').val().toLowerCase() == "true") {
                var ganttwidth = $("#gridbox").width();
                var totalWidth = ganttwidth + 230;
                ResizeGrid(totalWidth);
            }
        }

        gantt._render_tasks_scales(totalWidth);
        $('#gantt_hor_scroll').attr('style', 'Width: 1453px;');

        $(".gantt_last_cell").dblclick(function (e) {
            e.stopPropagation();
        });

        $(".gantt_last_cell").click(function (e) {
            e.stopPropagation();
        });
        // Commented By Nishant Sheth
        // Desc:: To resolve the #2056 unresponsive javascript error in Firefox
        //$(".gantt_add").click(function (e) {

        //    var type = $(this).attr('id');
        //    var name = $(this).attr('Name');
        //    var title = $(this).attr('aria-label');
        //    var permission = $(this).attr('Permission');
        //    var linetype = $(this).attr('lineitemtype');
        //    var LinkTacticPermission = $(this).attr('linktacticpermission');
        //    var LinkedTacticId = $(this).attr('linkedtacticid');
        //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

        //});

        var $doc = $(document);
        $doc.click(function () {
            $('#popupType').css('display', 'none');
        });

        $(document).mouseup(function (e) {
            $('#popupType').css("display", "none");
        });
        $(".gantt_ver_scroll").scroll(function () {
            $('#popupType').css('display', 'none');
        });

        $('.gantt_hor_scroll').hide();

        @*if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
        if (document.getElementById("liGrid").className.indexOf("active") >= 0) {
            var ganttwidth = $("#gridbox").width();
            var totalWidth = ganttwidth + 230;
            ResizeGrid(totalWidth);
        }
    }*@

    }, function () {
        $('#sidebar').css({
            'position': 'static',
            'left': 'auto',
            //'background': '#e9e9e9 none repeat scroll 0 0', /* Commented for #2219 - Bhumika */
            'width': '280px',

        });
        $('.sidebar-toogle a').html("<< hide").css('letter-spacing', '0px');
        $(".sidebar-toogle-wrapper h4.text-shadow-black").css("display", "block");
        $(".sidebar-section").css("display", "block");
        $(".wraper-btns").css("display", "block");
        $("#content_wraper").css('width', 'calc(100% - 282px)'); //Edited for #2219 + #2331 - Bhumika
        $('#sidebar.sidebar').css({ 'width': '280px' }); //  removed bgcolor for #2219 - Bhumika
        $('.sidebar-toogle').css('border-bottom-width', '1px');

        ///new code
        var ganttwidth = $("#gantt_here").width();
        var totalWidth = ganttwidth - 230;
        gantt._render_tasks_scales(totalWidth);

        $('#gantt_hor_scroll').attr('style', 'Width: 1483px;');

        $(".gantt_last_cell").dblclick(function (e) {
            e.stopPropagation();
        });

        $(".gantt_last_cell").click(function (e) {
            e.stopPropagation();
        });

        //$(".gantt_add").click(function (e) {

        //    var type = $(this).attr('id');
        //    var name = $(this).attr('Name');
        //    var title = $(this).attr('aria-label');
        //    var permission = $(this).attr('Permission');
        //    var linetype = $(this).attr('lineitemtype');
        //    var LinkTacticPermission = $(this).attr('linktacticpermission');
        //    var LinkedTacticId = $(this).attr('linkedtacticid');
        //    DisplayPopUpMenu(type, name, title, permission, linetype, LinkTacticPermission, LinkedTacticId, e);

        //});

        var $doc = $(document);
        $doc.click(function () {
            $('#popupType').css('display', 'none');
        });

        $(document).mouseup(function (e) {
            $('#popupType').css("display", "none");
        });
        $(".gantt_ver_scroll").scroll(function () {
            $('#popupType').css('display', 'none');
        });

        $('.gantt_hor_scroll').hide();
        if (activeMenu == '@Enums.ActiveMenu.Plan.ToString().ToLower()') {
            if ($('#IsGridView').val().toLowerCase() == "true") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                var ganttwidth = $("#gridbox").width();
                var totalWidth = ganttwidth - 230;
                ResizeGrid(totalWidth);
            }
        }
    })

        function DisplayEditablePopup(id, type) {
            gridSearchFlag = 1;
            isEditTactic = id;
            isDataModified = false;
            if (type == "Plan") {
                ShowModels("@Enums.InspectPopupMode.Edit.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Plan).ToLower()", id, 0, '@RequestedModule');
            }
            else if (type == "CP") {
                ShowModels("@Enums.InspectPopupMode.Edit.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Campaign).ToLower()", id, 0, '@RequestedModule');
            }
            else if (type == "PP") {
                ShowModels("@Enums.InspectPopupMode.Edit.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Program).ToLower()", id, 0, '@RequestedModule');
            }
            else if (type == "TP") {
                ShowModels("@Enums.InspectPopupMode.Edit.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()", id, 0, '@RequestedModule');
            }
            else if (type == "LP") {
                ShowModels("@Enums.InspectPopupMode.Edit.ToString()", "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.LineItem).ToLower()", id, 0, '@RequestedModule');
            }
        }
        var isLoadcopied = false;
        var cloneObj = "";
        function OpentCopyPopup(obj, isProceed) {
            cloneObj = obj;
            var redirectType = $(obj).attr('redirecttype');
            if (redirectType == "" || redirectType == undefined) {
                if ($('#IsGridView').val().toLowerCase() == "false") { //Modified by Komal Rawal for 2013 Home/Plan Layout changes
                    scrollstate = gantt.getScrollState();
                }
                else {
                    linkItemId = $(obj).attr('entityid');
                    if (linkItemId.indexOf("_") >= 0) {
                        linkItemId = linkItemId.split('_')[1];
                    }
                    else {
                        linkItemId = $(obj).attr('entityid').replace("_", "");
                    }
                    var selectedcell = HomeGrid.findCell(linkItemId, 3, true);
                    var id = selectedcell[0];
                    var rowid = id[0];
                    ItemIndex = HomeGrid.getRowIndex(rowid);
                    state0 = ItemIndex;
                }
            }
            var sectionType = $(obj).attr('sectionType');
            var entityId = $(obj).attr('entityId');
            var popuptype = $(obj).attr('popupType');
            var returnpara = true;
            var activeTab = $("#InspectTab li.active a").text();
            if (activeTab != null && activeTab != undefined && activeTab != '' && redirectType != undefined) {
                if (sectionType == '@Enums.Section.Tactic.ToString()') {

                    if ((checkChangeValue(".resubmission", true)) && ($("#hdnIsResubmitableStatus").val().toString().toLowerCase() == "true") && isProceed == undefined) {
                        var iserror = false;
                        $('form').find('input[type=text], select, textarea').each(function () {
                            if ($(this).attr('require') == 'true') {
                                if ($(this).val().toString().trim() == '' && $(this).parent().css("display") != "none") {
                                    $(this).addClass("error");
                                    iserror = true;
                                }
                                else {
                                    $(this).removeClass("error");
                                }
                            }
                        });
                        $('.dropdown_new_btn').each(function () {
                            if (typeof $(this).attr('require') != 'undefined' && $(this).attr('require') == 'true' && $(this).find('p').text() == 'Please Select' && $(this).parent().parent().css("display") != "none") {
                                $(this).addClass("error");
                                iserror = true;
                            }
                            else {
                                $(this).removeClass("error");
                            }
                        });
                        if (iserror) {
                            ShowError("@RevenuePlanner.Helpers.Common.objCached.ValidateForEmptyField");
                            return false;
                        }

                        url = '@Url.Content("~/Inspect/LoadResubmission")';
                        $("#divResubmission").load(url + '?redirectionType=' + "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic)" + '&labelValues=' + _resubmissionLabelValues);
                        isLoadcopied = true;
                    }
                    else {
                        returnpara = SaveAllData(activeTab);
                        $('#spanMessageSuccess').empty();
                        $("#successMessage").css("display", "none");
                    }
                }
                else {
                    returnpara = SaveAllData(activeTab);
                    $('#spanMessageSuccess').empty();
                    $("#successMessage").css("display", "none");
                }
            }
            if (returnpara && !isLoadcopied) {
                $("#dvCopyEntity").empty();
                var url = '@Url.Content("~/Plan/LoadCopyEntityPopup")';
                $("#dvCopyEntity").load(url + "?entityId=" + entityId + "&section=" + sectionType + "&PopupType=" + popuptype + "&RedirectType=" + redirectType); // section parameter added to open share tactic popup
            }
            else {
                $("#SuccessMsg").css("display", "none");
                $("#successMessage").css("display", "none");
                $('.btn-dropdwn').hide();
            }
        }
        function OpentCopyPopuponProceed(obj) {
            var redirectType = $(obj).attr('redirecttype');
            var sectionType = $(obj).attr('sectionType');
            var entityId = $(obj).attr('entityId');
            var popuptype = $(obj).attr('popupType');
            var planTacticId = entityId.split('_')[1];
            loadInspectPopup(planTacticId, "@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()", "Setup", "@Enums.InspectPopupMode.Edit.ToString()", 0, "@Enums.InspectPopupRequestedModules.Index.ToString()");
            $("#dvCopyEntity").empty();
            var url = '@Url.Content("~/Plan/LoadCopyEntityPopup")';
            $("#dvCopyEntity").load(url + "?entityId=" + entityId + "&section=" + sectionType + "&PopupType=" + popuptype + "&RedirectType=" + redirectType); // section parameter added to open share tactic popup
            $("#SuccessMsg").css("display", "none");
            $('.btn-dropdwn').hide();
        }
        function SaveAsPreset() {

            var IsAnyPlanSelected = $('#ulSelectedPlans').find("li").hasClass("close-list");
            var IsAnyCustomFieldSelected = $('#divCustomFieldsFilter').find("li").hasClass("close-list");
            var IsAnyTTSelected = $('#ulTacticType').find("li").hasClass("close-list");
            var IsAnyStatusSelected = $('#ulStatus').find("li").hasClass("close-list");
            var IsAnyOwnerSelected = $('#ulSelectedOwner').find("li").hasClass("close-list");
            if (!IsAnyCustomFieldSelected && !IsAnyPlanSelected && !IsAnyTTSelected && !IsAnyStatusSelected && !IsAnyOwnerSelected) {
                alert('Please select at least one filter');
                return false;
            }
            else {
                $("#content_SaveFilters").css("display", "block");
                $("#PlanModulesSection").css("display", "none");
                $("#Filtersidebar").css("display", "none");
            }

        }

        function ClearAllPreset() {

            BulkTTOperation(false);
            BulkStatusOperation(false);
            //Added vy kausha for ticket no #1836
            BulkOwnerOperation(false);
            //Modified By komal Rawal to solve issue of owner list function getting called twice.
            if (activeMenu.toLowerCase() == 'home') {
                LoadPlanData(null);
                //Added by Maitri Gandhi to clear plan name
                $("#ulSelectedPlans li").each(function (i) {
                    $(this).removeClass("close-list");
                    var chkid = $(this).find("input[type=checkbox]").attr("id");
                    $("#" + chkid).removeAttr("checked");
                });
            }
            else
            {
                BulkPlanOperation(false);

            }
            //End
            $('#divCustomFieldsFilter').find("li").each(function (i) {
                $(this).removeClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).removeAttr("checked");
            });

            $("#accordion-Year li input:checkbox:checked").each(function () {
                $(this).removeAttr("checked");
                $(this).parent().removeClass("close-list");
            });
            UpdateSelectedFilters();
            // Add By Nishant Sheth
            // Desc :: To resolve the #1981 code review points to resolve click on clear filters and after click on export pdf button without update result button click
            PdfFilters.customFieldIds = [];
            PdfFilters.PlanIDs = [];
            PdfFilters.SelectedPlans = [];
            PdfFilters.PlanTitles = [];
            PdfFilters.OwnerIds = [];
            PdfFilters.TacticTypeids = [];
            // End By Nishant Sheth
        }

        function LoadPreset() {
            var isLoadPreset = true;
            $.ajax({
                type: 'POST',
                url: '@Url.Action("LastSetOfViews", "Home")',
                data: {
                    isLoadPreset: isLoadPreset,
                },
                //dataType: "json",
                async: false,
                success: function (data) {
                    if (data != null) {
                        $('#DefaultFilters').css('display', 'block');
                        $('#DefaultFilters').html(data);

                    }
                    else {
                        $('#DefaultFilters').css('display', 'none');
                    }


                }

            });
            $("#successMessageSidebar").css("display", "none");
            $("#DefaultFilters").css("display", "block");
            $("#PlanModulesSection").css("display", "none");
            $("#Filtersidebar").css("display", "none");
            //  $("#displaydata").css("display", "none");

        }

        function SavePreset() {
            var ViewName = $("#txtPresetName").val();
            if (ViewName.trim() == null || ViewName.trim() == "") {
                $("#successMessageSidebar").css("display", "none");
                $('div[id=errorMessageMainSidebar]').each(function () {
                    if ($(this).parent().is(':visible')) {
                        $(this).show();
                        $(this).find("span[id=spanErrorMessageRole]").text('@Common.objCached.ProvidePresetName');
                        // $(this).slideDown(600);
                        //$(this).slideDown(600).delay(3000).slideUp(600);
                    }
                });
                $("#txtPresetName").val("");
            }
            else {
                SavePresetValue = true;
                SaveLastSetofViews(ViewName.trim());
                UpdateResult();
            }


        }

        function CancelSavePreset() {
            $("#txtPresetName").val("");
            $("#errorMessageMainSidebar").css("display", "none");
            $("#successMessageSidebar").css("display", "none");
            $("#successMessageLoadPreset").css("display", "none");
            $("#content_SaveFilters").css("display", "none");
            $("#DefaultFilters").css("display", "none");
            $("#PlanModulesSection").css("display", "block");
            $("#Filtersidebar").css("display", "block");
        }
        //Added by Rahul Shah for PL #2270. perform Global Search on calendar.
        var SearchTextforcal = ""
        function GlobalSearch() {
            //$('#ExpLoading').css('display', 'block');
            // Modified by Rahul Shah for PL #2307 on 23/06/2016 to display data without search when user add/copy tactic,program,campaign for calendar.
            if (isCopyTactic > 0) {
                $('#txtGlobalSearch').val("");
                $('#ExpClose').css('display', 'none');
                $('#ExpSearch').css('display', 'block');
                isCopyTactic = 0;
            }

            if ($('#divPlanButton').children().hasClass("request-btn-active") || $('#RequestTab').children().hasClass("request-btn-active")) {
                gantt.refreshData();
                function contains(haystack, needle) {
                    var a = (haystack || "").toLowerCase(),
                        b = (needle || "").toLowerCase();

                    return !!(a.indexOf(b) > -1);

                }
                function hasValue(parent, value, searchcriteria) {
                    if (value == "") {
                        return true;
                    }
                    if (searchcriteria == '@Enums.GlobalSearch.ExternalName.ToString().ToUpper()') {
                        if (contains(htmlDecode(gantt.getTask(parent).machineName), value))
                            return true;
                    }
                    if (searchcriteria == '@Enums.GlobalSearch.ActivityName.ToString().ToUpper()') {
                        if (contains(htmlDecode(gantt.getTask(parent).text), value))
                            return true;
                    }

                    var child = gantt.getChildren(parent);
                    for (var i = 0; i < child.length; i++) {
                        if (hasValue(child[i], value, searchcriteria))
                            return true;
                    }
                    return false;
                }
                gantt.attachEvent("onBeforeTaskDisplay", function (id, task) {
                    if (hasValue(id, $('#txtGlobalSearch').val().trim(), $('#searchCriteria').val().replace(" ", "").toUpperCase().toString())) {
                        return true;
                    } else {
                        return false;
                    }
                });
                if ($(gantt.$grid_data).find('.gantt_row').length <= 0) {

                    if ($('#txtGlobalSearch').val().length > 0) {
                        SearchTextforcal = $('#txtGlobalSearch').val().trim();
                        $('#txtGlobalSearch').val("");
                        GlobalSearch();
                        $('#txtGlobalSearch').val(SearchTextforcal);
                        $('#SuccessMsg').css('display', 'none');
                        $("#spanMsgSuccess").empty();
                        $("#errorMsg").css("display", "block");
                        $("#spanMsgError").empty();
                        $("#spanMsgError").text("No data found! Please check the filter and make correct Plan and Attributes selections");
                    }
                }
                else {
                    $("#errorMsg").css("display", "none");
                    $("#spanMsgError").empty();
                }
            }
            else if ($('#divPlanEditButtonHome').children().hasClass("request-btn-active")) {
                var SearchDDLValue = $('#searchCriteria').val().replace(" ", "");
                var SearchText = $('#txtGlobalSearch').val();
                GlobalSearchonGrid(SearchText, SearchDDLValue);
            }
            //$('#ExpLoading').css('display', 'none');
        }

        //Added by Rahul shah to remove all media code honeycomb data on click of close icon for  PL #2371
        function RemoveAllMediaCodeData() {
            $('#honeycomb_contentMediaCode').find(".hc-block").remove();
            $('#divHoneyCombBoxMediaCode .popover-content').html("");
            ExportSelectedIdsMediaCode = {
                MediacodeSelectedRowId: [],
                Mediacodes: [],
                MediacodeID: [],
                AltId: []
            };
            $('#MediaCodeGrid').find('tr').find('td').find("div[class*='honeycombbox-icon-gantt-Active']").removeClass("honeycombbox-icon-gantt-Active");
            $("#totalEntityMediacode").text(ExportSelectedIdsMediaCode.AltId.length);
            $("#divHoneyCombBoxMediaCode").hide();
            $('#MediaCodeSelectAll').removeAttr('checked');
        }

    </script>
