@model RevenuePlanner.Models.HomePlanModel
@using RevenuePlanner.Helpers
@{
    ViewBag.Title = "Add Actuals";
    ViewBag.ActiveMenu = RevenuePlanner.Helpers.Enums.ActiveMenu.Plan;
    ViewBag.Title = ViewBag.ActiveMenu;
    int CurrentPlanId = ViewBag.PlanId;
    var ListBudgetingPlan = Model.objplanhomemodelheader.plans; //Modified for new homepage UI
    var IsQuarter = ViewBag.IsQuarter;
    string FilterName = Sessions.FilterPresetName;
    var PageTitle = "Add Actuals";
    var IsGridView = (bool)ViewBag.GridView; //Modified by Komal Rawal for 2013 Home/Plan Layout changes
    // var IsSavedPlan = (string)ViewBag.IsLastSavedPlan;
}
@Html.Hidden("PageTitle", PageTitle)
@Html.Hidden("FilterName", FilterName)


@section nlFormContent{
    <link rel="stylesheet" href="@Url.Content("~/Content/css/NaturalLanguageForm/default.css")" type="text/css" />
    <link rel="stylesheet" href="@Url.Content("~/Content/css/NaturalLanguageForm/component.css")" type="text/css" />
    <script type="text/javascript" src="@Url.Content("~/Scripts/js/NaturalLanguageForm/modernizr.custom.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/js/NaturalLanguageForm/nlform.js?n=")@DateTime.Now"></script>
}


@* Commented for #2312  *@
@*@section PlanHeader{

    <div class="light-blue-chart cf full-width-header" id="planHeader">
        @Html.Partial("~/Views/Shared/_planheader.cshtml", Model.objplanhomemodelheader)
    </div>

}*@

@section Sidebar
{
    <style type="text/css">
        .chkbxfilter {
            float: right;
             /*#2055 again removed top margin for allignment 21-3-2016 */    
        }

        #accordion-SelectedFilter .accordion-group
        {
            margin-bottom: 0 !important;
        }

        
    </style>
    @*modified by Rahul Shah for Pl #1837*@
    <!--success message-->
    <div class="save-filter">
        <!--error message-->
        <div id="errorMessageMainSidebar" class="alert hide alert-error">
            <a class="close">×</a>
            <strong></strong><span id="spanErrorMessageRole"></span>
        </div>

        <!--error message-->
        <div id="successMessageLoadPreset" class="alert hide alert-success">
            <a class="close">×</a>
            <div id="cSuccess"><span id="spanSuccessMessageRole"></span></div>
        </div>
        <div id="content_SaveFilters" class="sidebar-preset scroll-section" style="height: 456.85px; display: none">
            <h2>Save As Preset</h2>
            <label for="Preset">Please enter a name for preset</label>
            <input type="text" id="txtPresetName" />
            <input type="button" class="btn btn-blue text-shadow-blue source-sans-proregular" title="Proceed" value="Proceed" id="btnSaveProceed" onclick="javascript: SavePreset()" />
            <input type="button" class="btn btn-link" title="Cancel" value="Cancel" id="btnSaveCancel" onclick="javascript: CancelSavePreset()" />
        </div>
        <div id="DefaultFilters" style="display: none"></div>
    </div>
    <div class="padding-content padding-bottom0" id="DivButtonsHome">
        <h4 class="text-shadow-black source-sans-prolight">Actions</h4>
        <div class="wraper-btns cf">
            <div>
                <button class="btn btn-blue text-shadow-blue source-sans-proregular" type="button" onclick="displayconfirm('@Url.Action("Index", "Home", new { activeMenu = RevenuePlanner.Helpers.Enums.ActiveMenu.Plan, currentPlanId = CurrentPlanId, isGridView = IsGridView })');" style="min-width:90%">< Back to Plan</button>
            </div>
        </div>
    </div>
    @*modified by Rahul Shah for Pl #1837*@
    <div id="Filtersidebar" class="span2 sidebar">
        @*Commented By Maitri Gandhi on 25/2/2016 For #2014*@
        @*<div class="WelcomeMessageBorder"></div>*@

        <!--success message-->
        <div class="error-msg-filter">
            <div id="successMessageSidebar" class="alert hide alert-success">
                <a class="close">×</a>
                <div id="cSuccess"><span id="spanSuccessMessageRole"></span></div>
            </div>
            <!--error message-->

        </div>
        <div class="sidebar-section scroll-section">
            <div class="float-left filter-preset">
                <div class="width50 float-left filter-title ">
                    <span class="filter-header">Filters</span>
                </div>
                <div class="dropdown" style="float: right;">
                    <button id="dropdownMenu1" class="btn btn-default dropdown-toggle" aria-expanded="true" data-toggle="dropdown" type="button">
                        <i class="fa fa-bars"></i>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" role="menu">
                        <li onclick="SaveAsPreset()" role="presentation">
                            <a id="saveaslink" tabindex="-1" role="menuitem">Save Current Filters</a>
                        </li>
                        @*Commented by Maitri Gandhi on 1/3/2016 to resolve the scenario of more than one plan in saved preset*@
                        @*<li onclick="LoadPreset()" role="presentation">
                            <a tabindex="-1" role="menuitem">Load Saved Filters</a>
                        </li>*@
                        <li onclick="ClearAllPreset()" role="presentation">
                            <a tabindex="-1" role="menuitem">Clear All</a>
                        </li>
                    </ul>
                </div>
            </div>


            <div style="clear: both;"></div>

            @*View Selected Filter Section - #1953 - Added By: Maitri Gandhi *@
            <div id="accordion-SelectedFilter" class="dropdown-section accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <h2 id="aYear" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-SelectedFilter" href="#accordion-element-SelectedFilter">@Enums.FilterLabel.Active_Attributes.ToString().Replace("_", " ")<i class="indicator glyphicon glyphicon-chevron-up pull-right"></i></h2>
                    </div>
                    <div id="accordion-element-SelectedFilter" class="accordion-body in collapse">
                        <ul class="scroll-list singleselect" id="ulSelectedFilter">
                            @{
                                List<string> YearText1 = new List<string>();
                                List<string> PlanTitle = new List<string>();
                                List<string> OwnerName = new List<string>();
                                List<string> StatusTitle = new List<string>();
                            }
                            @* <li class="accordion-inner" title="Plane">
                                <span class="sidebarliwidthSelected-left">Plan - </span>
                                <span id="lstPlanSelected" class="sidebarliwidthSelected-right"></span>
                            </li> *@
                            @{
                                foreach (var custField in Model.lstCustomFields)
                                {
                                <li class="accordion-inner" title='@custField.Title'>
                                    <div id="CustomFields">
                                        <span class="sidebarliwidthSelected-left">@custField.Title - </span>
                                        <span id="lstCustomFieldSelected_@custField.CustomFieldId" class="sidebarliwidthSelected-right">All</span>
                                    </div>
                                </li>
                                }
                            }

                            <li class="accordion-inner" title="Owner">
                                <span class="sidebarliwidthSelected-left">Owner - </span>
                                <span id="lstOwner" class="sidebarliwidthSelected-right"></span>
                            </li>
                            <li class="accordion-inner" title="TacticType">
                                <span class="sidebarliwidthSelected-left">Tactic Type - </span>
                                <span id="lstTType" class="sidebarliwidthSelected-right"></span>
                            </li>

                        </ul>
                    </div>
                </div>
            </div>
            <div class="padding-content padding-bottom0 sidebar-toogle-wrapper update-btn">
                <div class="wraper-btns cf">
                    <button class="btn btn-blue text-shadow-blue source-sans-proregular squares-icon" style="min-width: 90%" type="button" id="btnUpdateResultFilters" onclick="UpdateResult()">
                        @Enums.FilterLabel.Update_Attributes.ToString().Replace("_", " ")
                    </button>
                </div>
            </div>
            <div id="divCustomFieldsFilter">
                @if (Model.lstCustomFields.Count > 0)
                {
                    int custFieldCount = 0;
                    foreach (var CustomField in Model.lstCustomFields)
                    {
                    <div id="accordion-@CustomField.CustomFieldId" class="dropdown-section accordion CustomFieldAccordian">
                        <div class="accordion-group">
                            @{ var currentCustomFieldOptions = Model.lstCustomFieldOptions.Where(option => option.CustomFieldId == CustomField.CustomFieldId).ToList(); }
                            <div class="accordion-heading">
                                <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-@CustomField.CustomFieldId" href="#accordion-element-@CustomField.CustomFieldId"><span class="sidebar_label tipsyclassTitle">@CustomField.Title</span>@*<i class="indicator glyphicon glyphicon-chevron-down pull-right"></i> #1951 *@<i class="indicator fa fa-angle-down pull-right"></i><span class="filter-count"><span id="SelectedCustomFilter_@CustomField.CustomFieldId">@currentCustomFieldOptions.Count()</span>/@currentCustomFieldOptions.Count()</span></h2>
                            </div>
                            <div id="accordion-element-@CustomField.CustomFieldId" class="accordion-body collapse">
                                <ul class="scroll-list" id='ulSelected-@CustomField.CustomFieldId'>
                                    @foreach (var customFieldOption in currentCustomFieldOptions)
                                    {
                                        string id = "li_" + customFieldOption.CustomFieldId.ToString() + "_" + customFieldOption.CustomFieldOptionId.ToString();
                                        <li class="accordion-inner" id="@id" title="@customFieldOption.Title"><span class="sidebarliwidth">@customFieldOption.Title</span><input type="checkbox" class="chkbxfilter" id="@customFieldOption.CustomFieldId.ToString()_@customFieldOption.CustomFieldOptionId.ToString()" onchange="toggleCustomFields(this,@CustomField.CustomFieldId,@custFieldCount)" />
                                            @*<span class="chkbx-icon"></span> #1951 - sidebar design  checkbox styling*@</li>
                                    }
                                </ul>
                                <div class="list-tab">
                                    @if (currentCustomFieldOptions.Count() > 0)
                                    {
                                        <ul id="@CustomField.CustomFieldId-AllModule">
                                            <li><a onclick="BulkCustomFieldOperation(true, @CustomField.CustomFieldId,'@currentCustomFieldOptions.Count()')">select all</a></li>
                                            <li>|</li>
                                            <li><a onclick="BulkCustomFieldOperation(false, @CustomField.CustomFieldId,'@currentCustomFieldOptions.Count()')">@*deselect all*@clear</a></li>
                                        </ul>
                                    }
                                    else
                                    {
                                        <div id="No'@CustomField.Title'Found" class="NoDataFoundFilter">No @CustomField.Title Found</div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>   
                                    custFieldCount++;
                    }
                }
            </div>
            <div id="accordion-Owner" class="dropdown-section accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-Owner" href="#accordion-element-Owner">Owner<i class="indicator fa fa-angle-down pull-right"></i><span id="tOwnercount" class="filter-count"></span><span id="cOwnercount" class="filter-count"></span></h2>
                    </div>
                    <div id="accordion-element-Owner" class="accordion-body collapse">
                        <ul class="scroll-list" id="ulSelectedOwner">
                            @* @if (Model.objIndividuals.Count > 0)
                            {
                                foreach (var item in Model.objIndividuals)
                                {
                                    string id = "liOwner" + item.UserId;
                                    string name = item.FirstName + " " + item.LastName;

                                    if (item.UserId == Sessions.User.UserId)
                                    {
                                        <li class="accordion-inner close-list" id="@id" title="@name"><span class="sidebarliwidth">@name</span><input type="checkbox" class="chkbxfilter" id="@item.UserId" onchange="toggleOwner(this)" checked="checked" /></li>
                                    }
                                    else
                                    {
                                        <li class="accordion-inner" id="@id" title="@name"><span class="sidebarliwidth">@name</span><input type="checkbox" class="chkbxfilter" id="@item.UserId" onchange="toggleOwner(this)" /></li>
                                    }


                                }
                            }*@
                        </ul>
                        <div class="list-tab">
                            @* @if (Model.objIndividuals.Count > 0)
                             {
                            <ul id="ulOwnerAllModule">
                                <li><a onclick="BulkOwnerOperation(true)">select all</a></li>
                                <li>|</li>
                                <li><a onclick="BulkOwnerOperation(false)">deselect all</a></li>
                            </ul>
                          
                           *@
                            <ul id="ulOwnerAllModule">
                                <li><a onclick="BulkOwnerOperation(true)">select all</a></li>
                                <li>|</li>
                                <li><a onclick="BulkOwnerOperation(false)">@*deselect all*@clear</a></li>
                            </ul>
                            <div id="NoOwnerFound" class="NoDataFoundFilter">No Owner Found</div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="accordion-TacticType" class="dropdown-section accordion">
                <div class="accordion-group">
                    <div class="accordion-heading">
                        <h2 class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-TacticType" href="#accordion-element-TacticType">Tactic Type<i class="indicator fa fa-angle-down pull-right"></i><span id="tTTcount" class="filter-count"></span><span id="cTTcount" class="filter-count"></span></h2>
                    </div>
                    <div id="accordion-element-TacticType" class="accordion-body collapse">
                        <ul class="scroll-list" id="ulTacticType">
                            @*  @if (((List<RevenuePlanner.Models.TacticType>)ViewBag.TacticTypeList).Count > 0)
                        {
                            foreach (var item in ((List<RevenuePlanner.Models.TacticType>)ViewBag.TacticTypeList))
                            {
                                string id = "li" + item.TacticTypeId;
                                string _id = "CbTT" + item.TacticTypeId;
                                <li class="accordion-inner" id="@id" title="@item.Title"><span class="sidebarliwidth">@item.Title</span><input type="checkbox" class="chkbxfilter" id="@_id" onchange="toggleTacticType(this)"/></li>
                            }
                        }*@
                        </ul>
                        <div class="list-tab">
                            @*   @if (((List<RevenuePlanner.Models.TacticType>)ViewBag.TacticTypeList).Count > 0)
                        {
                           <ul id="TacticTypeAllModule">
                               <li><a onclick="BulkTTOperation(true)">select all</a></li>
                               <li>|</li>
                               <li><a onclick="BulkTTOperation(false)">deselect all</a></li>
                           </ul>
                        }
                        else
                        {
                           <div id="NoTTFound" class="NoDataFoundFilter">No TacticType Found</div>
                        }*@
                            <ul id="TacticTypeAllModule">
                                <li><a onclick="BulkTTOperation(true)">select all</a></li>
                                <li>|</li>
                                <li><a onclick="BulkTTOperation(false)">@*deselect all*@clear</a></li>
                            </ul>
                            <div id="NoTTFound" class="NoDataFoundFilter">No Tactic Type Found</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End Second Accordion-->
    <div style="clear: both;"></div>
}

@Html.Hidden("CurrentPlanId", CurrentPlanId)
@*<!--Error message-->
<div id="errorMessage" class="alert alert-error hide message-position-small">
    <a class="close" id="aclose">×</a>
    <strong>Error! </strong><span id="spanMessageError">@Common.objCached.ValidateForEmptyField</span>
</div>
<!--Error message-->
<!--success message-->
<div id="successMessage" class="alert alert-success hide message-position-small">
    <a class="close">×</a>
    <strong>Success. </strong><span id="spanMessageSuccess"></span>
</div>
<!--success message-->*@

@* Added for #2312  *@
<div class="light-blue-chart cf full-width-header" id="planHeader">
    @Html.Partial("~/Views/Shared/_planheader.cshtml", Model.objplanhomemodelheader)
</div>

<div class="create-plan-form">
    <ul class="nav nav-tabs">
        <li class="title-header source-sans-proregular">
            <h2>Add Actuals</h2>
        </li>
        <li id="liOpen" class="active pull-right">
            <a href="#">Open</a>
        </li>
        <li id="liAll" class="pull-right">
            <a href="#">All Tactics</a>
        </li>
    </ul>
    <div class="div-user-Note" id="div-user-Note" style="display: none;">
        <span>Note that imported values override user-generated values.</span>
    </div>
    <div class="padding-content cf source-sans-proregular">
        <!--Second Accordion-->
        <div class="accordion accordion-actuals" id="accordion2">
        </div>
    </div>
    <div id="DivPartialShareTactic">
    </div>
</div>
<script type="text/javascript">
    var actuals;
    var MQlTitle = '';
    var IsLineItemActual = false;
    //var showMyTacticId = 0;
    var IsHeaderActuals = true;
    var Status = 0;
    var isQuater = '@IsQuarter';
    var CurrentPlanId = '@CurrentPlanId';
    var isError = false;
    var _decmlRegex = '^(0|[0-9][0-9]*)[.]?[0-9]*$'; // Old: '^(0|[1-9][0-9]*)$';
    var filters = {
        parentCustomFieldsIds: [],
        OwnerIds: [],
        TacticTypeids: [],
        customFieldIds: [],
        PlanIDs: [],
        SelectedPlans: [],
        PlanTitles: [],
        StatusIDs: []
    };
    //Added By Maitri Gandhi for #1953 on 18/2/2016
    var FiltersAll = "All";
    var FiltersNone = "None";

    var selectedFilters = {
        yearIds: [],
        planName: [],
        ownerName: [],
        tacticTypeTitle: [],
        StatusIds: []
    };
    //var TotalStatus = 0;
    var checkedOwnercount = 0;
    var checkedTTcount = 0;

    $(document).ready(function () {
        $("#lblMarkringActivitiesTitle").hide();
        $('#nl-form2').show();

        $("#div-user-Note").show();

        $(".alert").find(".close").on("click", function (e) {
            $(this).closest(".alert").slideUp(400);
        });

        $(document).on("click", "#calendar-link-home-actuals", function (e) {
            displayconfirm('@Url.Action("Index", "Home", new { activeMenu = RevenuePlanner.Helpers.Enums.ActiveMenu.Plan, currentPlanId = @RevenuePlanner.Helpers.Sessions.PlanId })');
        });



        $("#liOpen a").click(function () {
            displayConfirmCommon('liOpenTabClick();');
        });

        $("#liAll a").click(function () {
            displayConfirmCommon('liAllTabClick();');
        });

        //Dharmraj Start 14July2014 : ticket #547, No warning of data loss during Add actuals
        $("#header a").not("#ContactSupport").click(function () {
            if (isDataChanged()) {
                displayconfirm($(this).attr('href'));
                return false;
            }
            else {
                return true;
            }
        });

        $(document).on("click", "#confirmClose, .confirmClose", function (e) {
            $("#errorMsg").slideUp(400);
        });
        $(document).on("click", "#btnNPlan", function (e) {
            displayconfirm('@Url.Action("Create", "Plan")');
        });
        $(document).on("click", "#btnAddActivity", function (e) {
            displayconfirm('@Url.Action("Assortment", "Plan")');
        });

        NumberFormatterTipsyTitle(".tipsyclassTitle", 27);        
        
        //onClickPlanTitle();
        GetTacticTypelist(CurrentPlanId, false);
        GetOwnerListForFilter(CurrentPlanId, false);
        //Modified sequence by Maitri Gandhi on 3/5/2016 for #2160 Observations
        LoadPlan();
        onClickPlanTitle();
        GetLastSetofViews($('#FilterName').val());
        CallAjax();
       
       
    });//document ready
    // Add By Nishant Sheth
    // Desc :: Toggle for tactic name
    function anchorclick(obj)
    {
        $(".glass-icon").css({ "visibility": "hidden" });   
        $(".table-titles-actual-left").css({ "color": "#F0F0F0" });
        
        var that = obj,
            mask = $(that).next().find(".table-actual-mask"),
            titles = $(that).find(".table-titles-actual-left"),
            glassIcon = $(that).find(".glass-icon"),
            shadowRight = $(that).next().find(".shadow-scroll-table-mask-right"),
            shadowLeft = $(that).next().find(".shadow-scroll-table-mask-left");
        var styles = { visibility: "hidden", width: "0px", height: "0px" };

        if ($(that).parent().parent().parent().next().hasClass("in")) {
            /*set mask shadows width*/
            $('.shadow-scroll-table-mask-left').css({ "visibility": "hidden" });
            $('.shadow-scroll-table-mask-right').css({ "visibility": "hidden" });
            glassIcon.css({ "visibility": "hidden" });
            titles.css({ "color": "#ffffff" });
            mask.css({ "overflow-x": "hidden" });
            shadowRight.css(styles);
            shadowLeft.css(styles);
            animateMask($(mask), 0);
        } else {
            /*set mask shadows width*/
            glassIcon.css({ "visibility": "visible" });
            titles.css({ "color": "#908D88" });
            mask.css({ "height": "0px" });
            mask.css({ "overflow-x": "scroll" });
            //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            var CurrentID = $(obj).attr('href');
            var heights = ($(CurrentID).find(".accordion-inner").height()) + 10;
            animateMask($(mask), heights);
        }
        //Added by Rahul Shah on 03/05/2016 for PL #2016
        var curId = $(obj).attr('href');

        $(curId).prev().find('.shadow-scroll-table-mask-left').css({ "visibility": "hidden" });
        $(curId).prev().find('.shadow-scroll-table-mask-right').css({ "visibility": "hidden" });
        /*set mask height*/
        $('.table-actual-mask').css({ "height": "0px" });
        /*set left titles from header if toogle  is open*/
        $(".accordion-actuals .accordion-group .in").prev().
                                                find(".table-titles-actual-left")
                                                        .css({ "color": "#F0F0F0" });
        /*set glass icon from header if toogle  is open*/
        $(".accordion-actuals .accordion-group .in").prev().
                                                        find(".glass-icon")
                                                                .css({ "visibility": "hidden" });
        /*set visibility on scroll over mask*/
        $(curId).prev().find(".table-actual-mask").css({ "overflow-x": "hidden" });

        $(curId).find('.addFormatterActualCurrency').each(function () {
            SetBudget($(this));
        });
        $(curId).find('.addFormatterActualNumber').each(function () {
            SetPriceValue($(this));
        });
        $(curId).find('.setBudget').each(function () {
            SetBudget("#" + $(this).attr('id'));
        });

        var curId1 = curId.replace('collapse', 'divTable');
        $(curId1).find('.currency_dollar').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });
        $(curId1).find('.priceValue').priceFormat({ prefix: '', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });

        $(curId1).find('.currency_dollarCost').each(function () {
            var txtvalue = $(this).val();
            $(this).attr('title', txtvalue);
        });
        $(curId1).find('.priceValue').each(function () {
            var txtvalue = $(this).val();
            $(this).attr('title', txtvalue);
        });
        $(curId1).find('.currency_dollar').each(function () {
            var txtvalue = $(this).val();
            $(this).attr('title', txtvalue);
        });
        $(curId1).find('.currency_dollarCost').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isDouble: true });

        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");
        if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))  // If Internet Explorer, return version number
        {
            $('.table-actual-mask').each(function () {
                $(this).css({ "overflow-x": "hidden", "width": "601px", "height": "0px" });
            });
        }
    }

        function GetTacticTypelist(Planids, ifexists) {
            var asyncval = false;
            if (ifexists != undefined && ifexists != 'undefined' && ifexists != '' && ifexists != null) {
                asyncval = ifexists;
            }

            $('#ulTacticType').html('');
            if (!ifexists) {
                filters.TacticTypeids = [];
            }
            $.ajax({
                beforeSend: function (x) {
                    myApp.hidePleaseWait();
                },
                type: "GET",
                cache: false,
                async: asyncval,
                @*           url: '@Url.Action("GetTacticTypeListForFilter", "Report")',*@
            url: '@Url.Action("GetTacticTypeListForFilter", "Home")',
            data: {
                PlanId: Planids.toString()
            },
            dataType: "json",
            success: function (data) {
                if (data.returnURL != 'undefined' && data.returnURL == '#') {
                    window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                }
                else {
                    if (data.isSuccess == true) {
                        if (data.TacticTypelist != 'undefined' && data.TacticTypelist != null) {
                            TactictypeCount = data.TacticTypelist.length;
                            if (TactictypeCount > 0) {

                                $("#TacticTypeAllModule").css("display", "block");
                                $("#NoTTFound").hide();
                                $.each(data.TacticTypelist, function (i, TactictypeItem) {
                                    var checked = "";
                                    var checkedclass = "";
                                    //Modify by Rahul Shah on 28/10/2015 for PL #1438

                                    checked = "checked";
                                    checkedclass = "close-list";
                                    //}
                                    $('#ulTacticType').append('<li class="accordion-inner ' + checkedclass + '" title="' + TactictypeItem.Title + '" id="liTT' + TactictypeItem.TacticTypeId + '"><span class="sidebarliwidth">' + TactictypeItem.Title + '</span><input type="checkbox" class="chkbxfilter" TacticTypeTitle="' + TactictypeItem.Title + '" onchange="toggleTacticType(this)" id="CbTT' + TactictypeItem.TacticTypeId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span> #1951*/
                                });
                            }
                            else {
                                $("#TacticTypeAllModule").css("display", "none");
                                $("#NoTTFound").show();
                            }
                        }
                        else {
                            $("#TacticTypeAllModule").css("display", "none");
                            $("#NoTTFound").show();
                        }
                        TactictypeCount = $("#ulTacticType li").length;
                        checkedTTcount = $("#ulTacticType li input:checkbox:checked").length;
                        $('#tTTcount').text('/' + TactictypeCount);
                        $('#cTTcount').text(checkedTTcount);
                    }
                }
            }
        });

    }

    function GetOwnerListForFilter(Planids, ifexists) {
       
        var type = '@PlanGanttTypes.Tactic.ToString()';
            var asyncval = false;
            if (ifexists != undefined && ifexists != 'undefined' && ifexists != '' && ifexists != null) {
                asyncval = ifexists;
            }
            $('#ulSelectedOwner').html('');
            if (!ifexists) {
                filters.OwnerIds = [];
            }
            $.ajax({
                beforeSend: function (x) {
                    myApp.hidePleaseWait();
                },
                type: "GET",
                cache: false,
                async: asyncval,
        @*url: '@Url.Action("GetOwnerListForFilter", "Report")',*@
            url: '@Url.Action("GetOwnerListForFilter", "Home")',
            data: {
                PlanId: Planids.toString(),
                ViewBy: type,
                ActiveMenu: '@RevenuePlanner.Helpers.Enums.ActiveMenu.Home'
                },
            dataType: "json",
            success: function (data) {

                if (data.returnURL != 'undefined' && data.returnURL == '#') {
                    window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                    }
                    else {
                        if (data.isSuccess == true) {
                            if (data.AllowedOwner != 'undefined' && data.AllowedOwner != null) {

                                OwnerCount = data.AllowedOwner.length;
                                if (OwnerCount > 0) {
                                    var IsOwnerPresent = false;
                                    $("#ulOwnerAllModule").css("display", "block");
                                    $("#NoOwnerFound").hide();
                                    $.each(data.AllowedOwner, function (i, OwnerItem) {

                                        var LoggedInOwner = data.LoggedInUser.OwnerId;
                                        var checked = "";
                                        var checkedclass = "";
                                        //Modified By Maitri Gandhi on 24/2/2016 For #2014
                                        if (OwnerItem.OwnerId == LoggedInOwner) {
                                            IsOwnerPresent = true;
                                            //checked = "checked"
                                            //checkedclass = "close-list"
                                        }
                                        checked = "checked"
                                        checkedclass = "close-list"

                                        //Modify by Rahul Shah on 28/10/2015 for PL #1438
                                        //if (ifexists &&  filters.OwnerIds.indexOf(OwnerItem.OwnerId)>= 0) {
                                        //checked = "checked";
                                        //checkedclass = "close-list";
                                        //}

                                        $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + OwnerItem.Title + '" id="liOwner' + OwnerItem.OwnerId + '"><span class="sidebarliwidth">' + OwnerItem.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + OwnerItem.Title + '" onchange="toggleOwner(this)" id="' + OwnerItem.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span> #1951*/
                                    });
                                    if (IsOwnerPresent == false) {

                                        // Modified By Nishant Sheth
                                        // Desc:: To resolve the #1790 observation
                                        checked = "checked"
                                        checkedclass = "close-list"
                                        $('#ulSelectedOwner').append('<li class="accordion-inner ' + checkedclass + '" title="' + data.LoggedInUser.Title + '" id="liOwner' + data.LoggedInUser.OwnerId + '"><span class="sidebarliwidth">' + data.LoggedInUser.Title + '</span><input type="checkbox" class="chkbxfilter" OwnerTitle="' + data.LoggedInUser.Title + '" onchange="toggleOwner(this)" id="' + data.LoggedInUser.OwnerId + '"' + checked + '></input></li>');/*<span class="chkbx-icon"></span>*/
                                    }
                                }
                                else {
                                    $("#ulOwnerAllModule").css("display", "none");
                                    $("#NoOwnerFound").show();
                                }
                            }
                            else {
                                $("#ulOwnerAllModule").css("display", "none");
                                $("#NoOwnerFound").show();
                            }
                            checkedOwnercount = $("#ulSelectedOwner li input:checkbox:checked").length;
                            TotalOwnercount = $("#ulSelectedOwner li").length;
                            $('#tOwnercount').text('/' + TotalOwnercount);
                            $('#cOwnercount').text(checkedOwnercount);
                        }
                    }
                }
        });
        }


        function GetLastSetofViews(presetName) {

            $.ajax({
                type: 'POST',
                url: '@Url.Action("LastSetOfViews", "Home")',
            data: { PresetName: presetName },
            dataType: "json",
            async: false,
            success: function (data) {

                if (data.returnURL != 'undefined' && data.returnURL == '#') {
                    window.location = '@Url.Content("~/Login/Index")';
                }
                else {
                    var AutoSelectedCustomField = 0;
                    if (data.Customfields.length != 0 && data.Customfields.length != undefined) {

                        for (i = 0 ; i < data.Customfields.length; i++) {
                            if (data.Customfields[i].ID.split('_').length > 1) {
                                var CustomFieldId = data.Customfields[i].ID.split('_')[1];
                                var CustomFieldValues = data.Customfields[i].Value;
                                $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {

                                    var chkid = $(this).attr("id");
                                    var chkfieldid = $(this).attr("id").split('_')[0];
                                    var chkOptionid = $(this).attr("id").split('_')[1];
                                    if (chkfieldid == CustomFieldId) {

                                        if (CustomFieldValues.indexOf(chkOptionid) != -1) {
                                            $(this).attr('checked', 'checked');
                                            AutoSelectedCustomField++;
                                            filters.customFieldIds.push(chkid);
                                            $(this).parent().addClass("close-list");
                                        }
                                        else {
                                            $(this).removeAttr('checked');
                                        }

                                    }
                                });
                                //Maintain CustomeField Count : 1853 By Maitri Gandhi
                                $("#SelectedCustomFilter_" + CustomFieldId).text(AutoSelectedCustomField);
                                AutoSelectedCustomField = 0;
                            }
                        }
                    }
                    else {
                        //Code for Select All : 1853 By Maitri Gandhi
                        $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
                            $(this).attr('checked', 'checked');
                            $(this).parent().addClass("close-list");
                            AutoSelectedCustomField++;
                        });
                        $('#ulSelectedFilter').find("li #CustomFields .sidebarliwidthSelected-right").text(FiltersAll);
                    }

                    if (data.OwnerNames.length != 0 && data.OwnerNames.length != undefined) {

                        filters.OwnerIds = [];
                        $("#ulSelectedOwner li input[type=checkbox]").removeAttr('checked');
                        $("#ulSelectedOwner li ").removeClass("close-list");
                        for (i = 0 ; i < data.OwnerNames.length; i++) {

                            $("#ulSelectedOwner li input[type=checkbox]").each(function () {

                                var Value = $(this).attr("id");
                                if (Value == data.OwnerNames[i]) {

                                    filters.OwnerIds.push(Value);
                                    $(this).attr('checked', 'checked');
                                    $(this).parent().addClass("close-list");
                                }
                            });
                        }
                    }

                    if (data.TTList != null) {
                        if (data.TTList.length != 0 && data.TTList.length != undefined) {

                            filters.TacticTypeids = [];
                            $("#ulTacticType li input[type=checkbox]").removeAttr('checked');
                            $("#ulTacticType li ").removeClass("close-list");
                            for (i = 0 ; i < data.TTList.length; i++) {

                                $("#ulTacticType li input[type=checkbox]").each(function () {

                                    var Value = $(this).attr("id").replace("CbTT", "");
                                    if (Value == data.TTList[i]) {

                                        filters.TacticTypeids.push(Value);
                                        $(this).attr('checked', 'checked');
                                        $(this).parent().addClass("close-list");
                                    }
                                });
                            }
                        }
                        else {
                            $('#ulTacticType').find("input[type=checkbox]").each(function () {
                                $(this).attr('checked', 'checked');
                                $(this).parent().addClass("close-list");
                            });
                        }
                    }
                    else {
                        $("#ulTacticType li").each(function (i) {
                            $(this).removeClass("close-list");
                            var chkid = $(this).find("input[type=checkbox]").attr("id");
                            $("#" + chkid).removeAttr("checked");
                        });

                    }
                    //Added by Maitri Gandhi for #2014 on 29/2/2016 to maintain selected preset
                    if (presetName != 'undefined' && presetName != null && presetName != "") {
                        SaveLastSetofViews();
                    }
                    UpdateSelectedFilters();
                }
            }
        });

    }

    function SaveLastSetofViews(ViewName) {
        filters.customFieldIds = [];
        //Added by Rahul Shah on 22/01/2016 for PL #1898
        filters.OwnerIds = [];
        filters.parentCustomFieldsIds = [];
        $("#ulSelectedOwner li input[type=checkbox]").each(function () {
            var chkid = $(this).attr("id");
            if ($(this).is(':checked')) {
                filters.OwnerIds.push(chkid);
            }
        });

        $('#divCustomFieldsFilter').children().each(function () {
            filters.parentCustomFieldsIds.push($(this).attr('id').split('-')[1])
        });
        $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
            if ($(this).attr('checked') == 'checked') {
                var chkid = $(this).attr("id");
                if (chkid != undefined && chkid != 'undefined') {
                    filters.customFieldIds.push(chkid);
                }
            }
        });
        //Commented By Komal Rawal on 17-02-2016 to resolve issue of Saving last viewed Plan on dropdown change.
        //filters.SelectedPlans = [];
        //$('#ulSelectedPlans').find("input[type=checkbox]").each(function () {
        //    if ($(this).attr('checked') == 'checked') {
        //        var chkid = $(this).attr("id");
        //        var chkplanid = chkid.split('_');
        //        if (chkid != undefined && chkid != 'undefined') {
        //            filters.SelectedPlans.push(chkplanid[0]);
        //        }
        //    }
        //});

        //if (filters.SelectedPlans.length == 1) {
        //    CurrentPlanId = filters.SelectedPlans[0].toString();
        //    $("#CurrentPlanId").val(filters.SelectedPlans[0].toString());
        //}
        //End

        //if (filters.SelectedPlans.length == 0) {
        //    filters.SelectedPlans.push($("#CurrentPlanId").val());
        //}

        //if (TacticDeselectAll) {
        //    filters.TacticTypeids.push(0);
        //}
        filters.TacticTypeids = [];
        $("#ulTacticType li input[type=checkbox]").each(function () {
            var chkid = $(this).attr("id");
            if ($(this).is(':checked')) {
                filters.TacticTypeids.push(chkid.replace("CbTT", ""));
            }
        });


        var Planid = CurrentPlanId;   //Modified By Komal Rawal on 17-02-2016 to resolve issue of Saving last viewed Plan on dropdown change.
        var CustomFieldId = filters.customFieldIds;
        var OwnerIds = filters.OwnerIds;
        var TacticTypeids = filters.TacticTypeids;
        var GetSelectedPlanNo = filters.SelectedPlans.length;
        var ParentCustomFieldsIds = filters.parentCustomFieldsIds;

        $.ajax({
            type: "POST",   //Modified By Maitri Gandhi on 3/5/2016 for #2160 Observations
            cache: false,
            async: false,
            url: '@Url.Action("SaveLastSetofViews", "Home")',
            data: {
                PlanId: Planid.toString(),
                customFieldIds: CustomFieldId.toString(),
                ownerIds: OwnerIds.toString(),
                TacticTypeid: TacticTypeids.toString(),
                StatusIds: "AddActual",
                ViewName: ViewName,
                ParentCustomFieldsIds: filters.parentCustomFieldsIds.toString()  //Modified By Komal rawal to handle scenario of null entry in custom field.
            },
            dataType: "json",
            success: function (data) {
                if (data.isSuccess == true) {


                    if (data.ViewName != null && data.ViewName != "" && data.ViewName != undefined) {
                        $("#content_SaveFilters").css("display", "none");
                        $("#DivButtonsHome").css("display", "block");
                        $("#Filtersidebar").css("display", "block");
                        $("#errorMessageMainSidebar").css("display", "none");
                        $('div[id=successMessageSidebar]').each(function () {
                            if ($(this).parent().is(':visible')) {
                                $(this).show();
                                $(this).find("span[id=spanSuccessMessageRole]").text('@Common.objCached.SavePresetSuccess');
                                // $(this).slideDown(600);
                                //$(this).slideDown(600).delay(3000).slideUp(600);
                            }
                        });

                        $("#txtPresetName").val('');
                    }
                }
                else {
                    $("#successMessageSidebar").css("display", "none");
                    $('div[id=errorMessageMainSidebar]').each(function () {
                        if ($(this).parent().is(':visible')) {
                            $(this).show();
                            $(this).find("span[id=spanErrorMessageRole]").text(data.msg);
                            // $(this).slideDown(600);
                            //$(this).slideDown(600).delay(3000).slideUp(600);
                        }
                    });

                }
            }

        })

    }

    //Added by komal rawal for new homepage UI
    function LoadPlan() {
        var plans = @Html.Raw(Json.Encode(ListBudgetingPlan))
        populateNF(plans, "dropdown-plan-title");
        var nlform = new NLForm(document.getElementById('nl-form2'));
        GetHealderData(CurrentPlanId, "", "", "", "", "", IsHeaderActuals);
        GetNumberOfActivityPerMonByPlanId(CurrentPlanId, isQuater, "", "", "", "", "", IsHeaderActuals);
    }    
    function onClickPlanTitle() {        
        var IsSavedPlan = null;

        //Added by Rahul Shah for PL #1898
        $('#nl-form2 > div[class="nl-field nl-dd"]').find('li').click(function (e) {
            //Added by Maitri Gandhi for #2040 on 31/3/2016
            var cookie = document.cookie;
            if (cookie.indexOf("gridOpengridbox") > -1) {
                var cookies = cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    if (cookies[i].indexOf("gridOpengridbox") > -1) {
                        cookies[i] = "gridOpengridbox=plan.1";
                    }
                } document.cookie = "gridOpengridbox=plan.1";
                //document.cookie = cookies.join(';');
            }
            else {
                //cookie += "; gridOpen=plan.1";
                document.cookie = "gridOpengridbox=plan.1";
            }
            CurrentPlanId = $(this).attr('value');
            IsSavedPlan = $("#CurrentPlanId").val();
            if ((IsSavedPlan.indexOf(CurrentPlanId.toString()) <= -1 || IsSavedPlan == null)) {
                // Modified By Rahul Shah
                // Desc :: To resolve the #1953 code review points to mismatch customfield selection count on plan change.
                $("#divCustomFieldsFilter").find("div.accordion").each(function () {
                    var id = 0, CheckedCounter = 0;
                    $(this).find("input[type=checkbox]").each(function () {
                        $(this).parent().addClass("close-list");
                        $(this).attr("checked", "checked");
                    });
                    //Modified to optimize the code by Maitri Gandhi
                    CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                    id = this.id;
                    if (id != null && id != "" && id.indexOf("-") > -1) {
                        id = this.id.split("-")[1];
                        $("#SelectedCustomFilter_" + id).text(CheckedCounter);
                    }
                });
                $("#accordion-Year li input:checkbox:checked").each(function () {
                    $(this).removeAttr("checked");
                    $(this).parent().removeClass("close-list");
                });                
                // Modified By Rahul Shah
                // Desc :: To resolve the #1953 code review points to mismatch Tactic Type and Satus selection count on plan change
                GetTacticTypelist(CurrentPlanId, false);
                $('#ulTacticType li input:checkbox').each(function () {
                    $(this).attr("checked", "checked");
                    $(this).parent().addClass("close-list");
                });
                //Modified By Maitri Gandhi on 24/2/2016 For #2014

                GetOwnerListForFilter(CurrentPlanId, false);
                $('#ulSelectedOwner li input:checkbox').each(function () {
                    @*if ($(this).attr('id') != '@Sessions.User.UserId') {

                        $(this).removeAttr("checked");
                        $(this).parent().removeClass("close-list");
                    }
                    else {*@

                    $(this).attr('checked', 'checked')
                    $(this).parent().addClass("close-list");

                    //}

                });
                $('#ulStatus li input:checkbox').each(function () {
                    $(this).attr("checked", "checked");
                    $(this).parent().addClass("close-list");
                });
            }

            SaveLastSetofViews();
            $("#CurrentPlanId").val(CurrentPlanId);
            if (CurrentPlanId > 0) {
                GetHealderData(CurrentPlanId, "", "", "", "", "", IsHeaderActuals);
                GetNumberOfActivityPerMonByPlanId(CurrentPlanId, isQuater, "", "", "", "", "", IsHeaderActuals);
                GetList(CurrentPlanId);
            }
        });
    }

    function GetList(Planid) {
        var url = '@Url.Content("~/Plan/AddActual")';
        window.location = url + "?PlanId=" + Planid;
    }
    //End

    function liOpenTabClick() {
        Status = 0;
        ShowOwnerList(); //Added by Arpita Soni on 01/13/2015 for ticket #1090
        $("#liOpen").addClass('active');
        $("#liAll").removeClass('active');
        $("#errorMsg").css("display", "none");
        $("#SuccessMsg").css("display", "none");
        //Added By : Kalpesh Sharma Functional Review Point #76
        $("#div-user-Note").show();
        CallAjax();
    }

    function liAllTabClick() {
        Status = 1;
        ShowOwnerList(); //Added by Arpita Soni on 01/13/2015 for ticket #1090
        $("#liOpen").removeClass('active');
        $("#liAll").addClass('active');//#585
        $("#errorMsg").css("display", "none");
        $("#SuccessMsg").css("display", "none");
        $("#div-user-Note").show();
        CallAjax();
    }

    //Added by Arpita Soni on 01/13/2015 for ticket #1090
    function ShowOwnerList() {
        $('#ulSelectedOwner li').show();
        $('#ulOwnerAllModule ').show();
        $('#NoOwnerFound1').hide();
    }
    //Ended by Arpita Soni on 01/13/2015 for ticket #1090

    //Dharmraj Start 14July2014 : ticket #547, No warning of data loss during Add actuals
    function displayconfirm(strURL) {
        if (isDataChanged()) {
            $('#spanMsgError').html(" You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;&nbsp;<a style='color:gray;' href='" + strURL + "' class='btn-gray'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
            $("#errorMsg").slideDown(400);
        }
        else {
            window.location.href = strURL;
        }
    }

    function displayConfirmCommon(functionName) {
        if (isDataChanged()) {
            $('#spanMsgError').html(" You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;&nbsp;<a id='btnConfirmOK' class='btn-gray CursorHand' style='color:gray;'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
            $("#errorMsg").slideDown(400);
            $("#btnConfirmOK").click(function () {
                $('#spanMsgError').html("");
                $("#errorMsg").hide();
                eval(functionName);
            });
        }
        else {
            eval(functionName);
        }
    }

    //function to check myValue attribute values and input values that any changes made?
    function isDataChanged() {
        var changed = false;
        $('.accordion-actuals').find("input,input[type=text],textarea,select").each(function () {
            var iv = $(this).attr("myValue");
            if ($(this).val().toString().trim() != iv.toString().trim()) {      // Modified by Sohel Pathan on 02/09/2014 for PL ticket #742
                changed = true;
                return false; // Added by Sohel Pathan on 02/09/2014 for PL ticket #742
            }
        });
        return changed;
    }
    //Dharmraj End 14July2014 : ticket #547, No warning of data loss during Add actuals

    function CallAjax() {
        //// Start - Added by Sohel Pathan on 22/01/2015 for PL ticket #1144
        var tacticTypeIds = [];
        $('#accordion-TacticType').find("input[type=checkbox]").each(function () {
            if ($(this).attr('checked') == 'checked') {
                var chkid = $(this).attr("id");
                if (chkid != undefined && chkid != 'undefined') {
                    //tacticTypeIds.push(chkid);
                    tacticTypeIds.push(chkid.replace("CbTT", ""));
                }
            }
        });

        //var customFieldIds = [];
        //$('.CustomFieldAccordian').find("input[type=checkbox]").each(function () {
        //    if ($(this).attr('checked') == 'checked') {
        //        var chkid = $(this).attr("id");
        //        if (chkid != undefined && chkid != 'undefined') {
        //            customFieldIds.push(chkid);
        //        }
        //    }
        //});
        var customFieldIds = [];
        $('#divCustomFieldsFilter').find("input[type=checkbox]").each(function () {
            if ($(this).attr('checked') == 'checked') {
                var chkid = $(this).attr("id");
                if (chkid != undefined && chkid != 'undefined') {
                    customFieldIds.push(chkid);
                }
            }
        });
        var ownerIds = [];
        $('#accordion-Owner').find("input[type=checkbox]").each(function () {
            if ($(this).attr('checked') == 'checked') {
                var chkid = $(this).attr("id");
                if (chkid != undefined && chkid != 'undefined') {
                    ownerIds.push(chkid);
                }
            }
        });
        //// End - Added by Sohel Pathan on 22/01/2015 for PL ticket #1144
        //Added for "Select All" case of #1953 and #1993 By Maitri Gandhi on 16/2/2016
        var CheckedCounter = 0, AllCounter = 0, id = null, UncheckedCounter = 0;
        $("#divCustomFieldsFilter").find("div.accordion").each(function () {
            if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                AllCounter = $(this).find("input[type=checkbox]").length;
                CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                UncheckedCounter = AllCounter - CheckedCounter;
                if (AllCounter == UncheckedCounter) {
                    var Id = $(this).attr("id");
                    if (Id.indexOf("-") >= 0) {
                        Id = Id.split('-')[1];
                        var CustomId = Id + "_null";
                        customFieldIds.push(CustomId);

                    }
                }
                else if (AllCounter == CheckedCounter) {
                    id = this.id;
                    if (id != null && id != "" && id.indexOf("-") > -1) {
                        id = this.id.split("-")[1];
                    }
                    var i = 0, customfieldid;
                    for (i = 0; i < customFieldIds.length; i++) {
                        if (customFieldIds[i].indexOf("_") > -1) {
                            customfieldid = customFieldIds[i].split("_")[0];
                            if (id == customfieldid) {
                                customFieldIds.splice(i, 1);
                                i--;
                            }
                        }
                    }
                }
            }
        });        ////End
        var uId = $(window).attr('name');
        $.ajax({
            type: 'POST',
            url: '@Url.Content("~/Home/GetActualTactic/")',
            data: {
                status: Status,
                tacticTypeId: tacticTypeIds.toString(),
                customFieldId: customFieldIds.toString(),
                ownerId: ownerIds.toString(),
                PlanId: $("#CurrentPlanId").val(),
                UserId: uId
            },
            success: function (r) {
                //// Added By: Maninder Singh Wadhva on 11/24/2014.
                //// Ticket: 942 Exception handeling in Gameplan.
                if (r.returnLoginURL != 'undefined' && r.returnLoginURL == '#') {
                    window.location = '@Url.Content("~/Login/Index")';
                }
                else if (r.returnURL != 'undefined' && r.returnURL == '#') {
                    window.location = '@Url.Content(Common.RedirectOnServiceUnavailibilityPage)';
                }
                else {
                    actuals = r;
                    $('.accordion-actuals').empty();
                    LoadPage();
                    AssignDefaultValue(); // added by dharmraj, #547
                    $(".table-titles-actual-left").css({ "color": "#F0F0F0" });
                }
            }
        });
}
    // Add By Nishant Sheth
    // Desc ::#2111 Taking more time to load for large number of tactics
    function LoadPagePerformance(id){
        //fillActualsTable();
        NumberFormatterTipsyTitle(".actualtipsyclassTitle", 24);
        maskWidht();
        $(".glass-icon").css({ "visibility": "hidden" });   
        $(".table-titles-actual-left").css({ "color": "#F0F0F0" });
        /*if a toogle is open the first time page loads, change css of mask*/
        
        //$(".accordion-actuals .accordion-group .in").prev()
        $("#accordion"+id+"").find(".accordion-heading")
                                                    .find(".table-actual-mask")
                                                        .css({ "height": "254px" });

        ///*change left titles from header if toogle  is open*/
        //$(".accordion-actuals .accordion-group .in").prev().
        $("#accordion"+id+"").find(".accordion-heading").
                                                     find(".table-titles-actual-left")
                                                             .css({ "color": "#908D88" });




        /*change mask if toogle is open*/
        //$(".accordion-actuals .accordion-heading a").click(function () {
            
            var that = $("#accordion"+id+"").find(".accordion-heading").find("a"),
                mask = $(that).next().find(".table-actual-mask"),
                titles = $(that).find(".table-titles-actual-left"),
                glassIcon = $(that).find(".glass-icon"),
                shadowRight = $(that).next().find(".shadow-scroll-table-mask-right"),
                shadowLeft = $(that).next().find(".shadow-scroll-table-mask-left");
            var styles = { visibility: "hidden", width: "0px", height: "0px" };

            if ($(that).parent().parent().parent().next().hasClass("in")) {
                /*set mask shadows width*/
                $('.shadow-scroll-table-mask-left').css({ "visibility": "hidden" });
                $('.shadow-scroll-table-mask-right').css({ "visibility": "hidden" });
                glassIcon.css({ "visibility": "hidden" });
                titles.css({ "color": "#ffffff" });
                mask.css({ "overflow-x": "hidden" });
                shadowRight.css(styles);
                shadowLeft.css(styles);
                animateMask($(mask), 0);
            } else {
                /*set mask shadows width*/
                glassIcon.css({ "visibility": "visible" });
                titles.css({ "color": "#908D88" });
                mask.css({ "height": "0px" });
                mask.css({ "overflow-x": "scroll" });
                //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
                var CurrentID = $(that).attr('href');
                var heights = ($(CurrentID).find(".accordion-inner").height()) + 10;
                animateMask($(mask), heights);
            }
            //Added by Rahul Shah on 03/05/2016 for PL #2016
            var curId = $(that).attr('href');

            $(curId).prev().find('.shadow-scroll-table-mask-left').css({ "visibility": "hidden" });
            $(curId).prev().find('.shadow-scroll-table-mask-right').css({ "visibility": "hidden" });
            /*set mask height*/
            $('.table-actual-mask').css({ "height": "0px" });
            /*set left titles from header if toogle  is open*/
            //$(".accordion-actuals .accordion-group .in").prev().
            //$("#accordion"+id+"").find(".accordion-heading").
            //                                        find(".table-titles-actual-left")
            //                                                .css({ "color": "#ffffff" });
            /*set glass icon from header if toogle  is open*/
            //$(".accordion-actuals .accordion-group .in").prev().
            //$("#accordion"+id+"").find(".accordion-heading").
            //                                                find(".glass-icon")
            //                                                        .css({ "visibility": "hidden" });
            /*set visibility on scroll over mask*/
            $(curId).prev().find(".table-actual-mask").css({ "overflow-x": "hidden" });

     
                
            $(curId).find('.addFormatterActualCurrency').each(function () {
                SetBudget($(this));
            });
            $(curId).find('.addFormatterActualNumber').each(function () {
                SetPriceValue($(this));
            });
            $(curId).find('.setBudget').each(function () {
                SetBudget("#" + $(this).attr('id'));
            });

            var curId1 = curId.replace('collapse', 'divTable');
            $(curId1).find('.currency_dollar').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });
            $(curId1).find('.priceValue').priceFormat({ prefix: '', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });

            $(curId1).find('.currency_dollarCost').each(function () {
                var txtvalue = $(this).val();
                $(this).attr('title', txtvalue);
            });
            $(curId1).find('.priceValue').each(function () {
                var txtvalue = $(this).val();
                $(this).attr('title', txtvalue);
            });
            $(curId1).find('.currency_dollar').each(function () {
                var txtvalue = $(this).val();
                $(this).attr('title', txtvalue);
            });
            $(curId1).find('.currency_dollarCost').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isDouble: true });

        //});
           

        /*click event on mask*/
        /*change mask if toogle is open*/
        //$(".table-actual-mask").click(function (event) {
        //    event.preventDefault();
        //    event.stopPropagation();
        //});

        /*shadow on table*/
        $(".accordion-actuals .accordion-heading").find('.table-actual-mask').scroll(function () {
            //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            var TacticSideBorderHeight = ($($(this).parent().prev().attr("href")).find(".accordion-inner").height()) + 10 + "px";
            var styles = { visibility: "visible", widht: "15px", height: TacticSideBorderHeight };
            var styles1 = { visibility: "hidden", widht: "15px", height: TacticSideBorderHeight };
            if ($(this).scrollLeft() > 0) {
                /*set shadows*/
                $(this).prev().css(styles);
                $(this).next().css(styles);
                $(this).next().css({ "margin-left": $(".table-actual-mask").width() });
            }
            if ($(this).scrollLeft() == 0) {
                $(this).prev().css(styles1);
            }
            if ($(this).scrollLeft() == 1800 - $(".table-actual-mask").width()) {
                $(this).next().css(styles1);
            }

        });

        window.onresize = function () {
            function maskWidht() {
                var widthHeader = $("#accordion2").width(),

               //#598 Added by Kalpesh Sharma : Add Actuals: Inappropriate Display of Add Actuals Tactics
               widthRigth = widthHeader - 662;

                $(".header-toogle-actual-right").width(widthRigth);
                $(".table-actual-mask").width(widthRigth);
                $('.table-actual-mask').scrollLeft(0);
                $(".accordion-actuals .accordion-heading").find('.table-actual-mask').next().css({ "margin-left": widthRigth });

                return this;
            };
            maskWidht();

        }
      
        $('.accordion-actuals').find('input').each(function () {
            $(this).keyup(function () {
                var currentValue = $(this).val().trim().replace(/,/g, '').replace('$', '');
                currentValue = currentValue == '' ? "0" : currentValue; // Added by Sohel Pathan on 03/09/2014 for Internal Review Points
                //if (currentValue.match('^(0|[1-9][0-9]*)$')) {
                if (currentValue.match(_decmlRegex)) {
                    var costlbl = (this).id.replace('ActuallblCCost', '');
                    if ((this).id.replace(costlbl, '') != "ActuallblCCost") {
                        var arr = (this).id.split('-');
                        costlbl = arr[0];
                        var formatValue = "P";
                        if (arr[1] == 'Revenue') {
                            formatValue = "C";
                        }
                        var ida = "Actuallbl" + formatValue + arr[1] + arr[0];
                        var totalvalue = 0;
                        $('#tr' + arr[0] + arr[1]).find('input').each(function () {
                            var cvalue = parseFloat($(this).val().trim().replace(/,/g, '').replace('$', ''));
                            if (!isNaN(cvalue)) {
                                totalvalue = cvalue + parseFloat(totalvalue);
                            }
                        });

                        if (arr[1] == 'Revenue') {
                            document.getElementById(ida).innerHTML = totalvalue;
                            document.getElementById(ida).innerHTML = FormatCurrency(document.getElementById(ida).innerHTML, true);
                            SetBudget('#' + ida); // Added by Sohel Pathan on 26/08/2014 for Internal Review Points //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in # 1755
                            $('#' + ida).attr('orignal-value', totalvalue);
                        }

                            //If Tactic has not any line item at that time application will update the Actual cost and Projected Cost.
                        else if (arr[1] == 'Cost') {
                            costlbl = $('#tr' + arr[0] + arr[1]).attr('tacticid');
                            var updateActalCost = "ActuallblCCost" + costlbl;
                            document.getElementById(updateActalCost).innerHTML = totalvalue;
                            document.getElementById(updateActalCost).innerHTML = FormatCurrency(document.getElementById(updateActalCost).innerHTML, true);
                            SetBudget('#' + updateActalCost);   //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755
                            $('#' + updateActalCost).attr('orignal-value', totalvalue);
                        }
                        else if (arr[1] != 'Revenue' && arr[1] != 'Cost' && arr[1] != 'ProjectedStageValue' && arr[1] != 'MQL' &&
                            arr[1] != 'CW' && arr[1] != 'INQ') {
                            //Update the Actual Cost and apply currency format.
                            document.getElementById(ida).innerHTML = totalvalue;
                            document.getElementById(ida).innerHTML = FormatCurrency(document.getElementById(ida).innerHTML, true);
                            SetBudget('#' + ida); // Added by Sohel Pathan on 26/08/2014 for Internal Review Points //AdUncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755

                            costlbl = $('#tr' + arr[0] + arr[1]).attr('tacticid');

                            //Update the line item for the appropriate Period (Y1,Y2....Y12)
                            var ActualsName = 'ActuallblP' + arr[1] + arr[0];
                            $('#' + ActualsName).attr('linevalue', totalvalue);
                            var lineItemTotal = 0;
                            var LineClassName = costlbl + 'Line-' + arr[2];
                            $('.' + LineClassName).each(function () {
                                var lineItemvalue = parseFloat($(this).val().trim().replace(/,/g, '').replace('$', '').replace(/!/g, "_"));
                                if (!isNaN(lineItemvalue)) {
                                    lineItemTotal = lineItemvalue + parseFloat(lineItemTotal);
                                }
                            });

                            var lineId = costlbl + "Cost-" + arr[2];
                            document.getElementById(lineId).innerHTML = lineItemTotal;
                            document.getElementById(lineId).innerHTML = FormatCurrency(document.getElementById(lineId).innerHTML, true);
                            SetBudget('#' + lineId);    //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755

                            //Update the Actual cost value based upon Line item actual sum.

                            var updateActalCost = "ActuallblCCost" + costlbl;
                            var updateActalCostValueTotal = 0;
                            var currentTacticLineItemsDv = '.lineItemActualsValues' + costlbl;
                            $(currentTacticLineItemsDv).each(function () {
                                var updateActalCostValue = parseFloat($(this).attr('linevalue').trim().replace(/,/g, '').replace('$', ''));
                                if (!isNaN(updateActalCostValue)) {
                                    updateActalCostValueTotal = updateActalCostValue + parseFloat(updateActalCostValueTotal);
                                }
                            });

                            //Update the value and apply currency formatter on it .
                            document.getElementById(updateActalCost).innerHTML = updateActalCostValueTotal;
                            document.getElementById(updateActalCost).innerHTML = FormatCurrency(document.getElementById(updateActalCost).innerHTML, true);
                            SetBudget('#' + updateActalCost);   //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755
                            $('#' + updateActalCost).attr('orignal-value', updateActalCostValueTotal);
                        }
                        else {
                            $('#hdn' + ida.toString()).val(totalvalue); // Added by Sohel Pathan on 27/08/2014 for Internal Review Points
                            document.getElementById(ida).innerHTML = totalvalue;
                            document.getElementById(ida).innerHTML = FormatCommas(document.getElementById(ida).innerHTML, false);
                            SetPriceValue(document.getElementById(ida)); // Added by Sohel Pathan on 26/08/2014 for Internal Review Points
                        }
                    }
                    calculateRIO(costlbl);
                }
            });
        });

        // Modified by dharmraj for implement new formula to calculate ROI, #533
        function calculateRIO(id) {
            var pcost = $("#hdnProjectedlblCCost" + id).val();  // Modified by Sohel Pathan on 10/09/2014 for Internal Review Points
            if (pcost != 0 && !isNaN(pcost)) {
                var prevenue = $("#hdnProjectedlblValueRevenue" + id).val();    // Modified by Sohel Pathan on 10/09/2014 for Internal Review Points
                var roip = (prevenue - pcost) / pcost;
                $("#ProjectedROI" + id).text(FormatCommas(roip.toFixed(2).toString()));
            }

            //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            pcost = parseFloat(ReplaceCC($("#ActuallblCCost" + id).attr("orignal-value")));
            if (pcost != 0 && !isNaN(pcost)) {
                var prevenue = parseFloat(ReplaceCC($("#ActuallblCRevenue" + id).attr("orignal-value")));
                var roiT = (prevenue - pcost) / pcost;
                $("#ActualROI" + id).text(FormatCommas(roiT.toFixed(2).toString()));
                SetPriceValue($("#ActualROI" + id));  //Added By Maitri for #1755 on 2/3/2016
            }
        }

        $("[id^='BtnShareTactic']").click(function () {
            $("#errorMsg").css("display", "none");
            $("#SuccessMsg").css("display", "none");
            $("#DivPartialShareTactic").empty();
            var url = '@Url.Content("~/Inspect/ShowShareTactic/")';
            $("#DivPartialShareTactic").load(url + '?planTacticId=' + $(this).attr('tacticId') + '&section=@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()');
        });


        $("[id^='UpdateResult']").click(function () {
            $("#errorMsg").css("display", "none");
            $("#SuccessMsg").css("display", "none");
            var _LineItems = [];
            var title = htmlEncode($('#txtTacticTitle').val());
            var _tactic = []
            var tacticId = $(this).attr('tacticId');
            var stageId = $(this).attr('stageId');
            isError = false;
            var isData = false;
            //// Modified by Sohel Pathan on 26/08/2014 for Internal Review Points
            var totalProjectedStageValueActual = $("#hdnActuallblPProjectedStageValue" + tacticId).val();
            var ProjectedStageValueTitle = $("#hdnProjectedStageValueTitle" + tacticId).val();
            //// Modified by Sohel Pathan on 26/08/2014 for Internal Review Points
            var totalMQLActual = $("#hdnActuallblPMQL" + tacticId).val();
            var totalCWActual = ReplaceCC($("#ActuallblPCW" + tacticId).text());
            var totalRevenueActual = ReplaceCC($("#ActuallblCRevenue" + tacticId).text());
            //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            var totalCostActual = 0;
            if (IsLineItemActual) {
                totalCostActual = ReplaceCC($("#ActuallblCCost" + tacticId).val());
            }
            else {
                totalCostActual = ReplaceCC($("#ActuallblCCost" + tacticId).text());
            }

            var totalROI = ReplaceCC($("#ProjectedROI" + tacticId).text());
            var totalROIActual = ReplaceCC($("#ActualROI" + tacticId).text());
            var tableId = "#divTable" + tacticId;
            $(tableId).find('input').each(function () {
                if ($(this).val().trim() != '') {
                    var _isCurrency = $(this).hasClass("currency_dollar");
                    var thisValue = ReplaceCC($(this).val());
                    if ((!_isCurrency) && thisValue.match('^(0|[0-9][0-9]*)$')) {
                        $(this).removeClass("error");
                    }
                    else if ((_isCurrency) && thisValue.match(_decmlRegex)) {
                        $(this).removeClass("error");
                    }
                    else {
                        $(this).addClass("error");
                        isError = true;
                    }
                    var arr = (this).id.split('-');
                    if (thisValue != '') {
                        var lineitemclass = tacticId + '_Line';
                        if (!$(this).hasClass(lineitemclass)) {
                            _tactic.push({
                                PlanTacticId: tacticId,
                                StageTitle: arr[1],
                                Period: arr[2],
                                ActualValue: thisValue,
                                TotalProjectedStageValueActual: totalProjectedStageValueActual,
                                TotalMQLActual: totalMQLActual,
                                TotalCWActual: totalCWActual,
                                TotalRevenueActual: totalRevenueActual,
                                TotalCostActual: totalCostActual,
                                ROI: totalROI,
                                ROIActual: totalROIActual,
                                IsActual: true,
                                StageId: stageId
                                //PlanLineItemId: arr[0]
                            });
                            isData = true;
                        }
                        else {
                            _LineItems.push({
                                PlanLineItemId: arr[0],
                                Period: arr[2],
                                Value: thisValue
                            });
                            isLineItem = true;
                        }
                    }
                }
                else {
                    $(this).removeClass("error");
                }
            });
            if (isError) {
               @* $("#errorMessage").css("display", "block");
                $("#spanMessageError").text("@RevenuePlanner.Helpers.Common.objCached.ValidateForValidField");*@
                ShowMessage(isError, "@RevenuePlanner.Helpers.Common.objCached.ValidateForValidField")
                return false;
            }
            if (parseFloat(totalMQLActual) > parseFloat(totalProjectedStageValueActual)) {
                isError = true;
                var msg = "@RevenuePlanner.Helpers.Common.objCached.ValidationForMqlGreaterThanINQ"
                var msgdisplay = msg.replace('{0}', FormatCommas(totalMQLActual.toString())).replace('{1}', ProjectedStageValueTitle).replace('{3}', ProjectedStageValueTitle).replace('{2}', FormatCommas(totalProjectedStageValueActual.toString())).replace(/{4\}/g, MQlTitle);
                //$("#spanMessageError").text(msgdisplay);
                //$("#errorMessage").css("display", "block");
                ShowMessage(isError, msgdisplay)
                return false;
            }
            if (!isData) {
                _tactic.push({
                    PlanTacticId: tacticId,
                    StageTitle: 0,
                    Period: 0,
                    ActualValue: 0,
                    TotalProjectedStageValueActual: totalProjectedStageValueActual,
                    TotalMQLActual: totalMQLActual,
                    TotalCWActual: totalCWActual,
                    TotalRevenueActual: totalRevenueActual,
                    TotalCostActual: totalCostActual,
                    ROI: totalROI,
                    ROIActual: totalROIActual,
                    IsActual: false,
                    StageId: stageId
                });
            }
            $("#errorMsg").css("display", "none");
            //_tactic = JSON.stringify({ 'tacticactual': _tactic });

            var Tactic_title = $(".colTitle" + tacticId).attr('Tactitle');
            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                async: false,
                type: 'POST',
                //url: '@Url.Content("~/Inspect/UploadResult/")?UserId=' + $(window).attr('name'),
                url: '@Url.Content("~/Inspect/UploadResult/")',
                //data: _tactic,
                data: JSON.stringify({ tacticactual: _tactic, lineItemActual: _LineItems, tactictitle: Tactic_title }),
                success: function (data) {
                    if (data.returnURL != 'undefined' && data.returnURL == '#') {
                        window.location = '@Url.Content("~/Login/Index")';
                    }
                    else {
                        if (data != 'undefined') {
                            if (data.id != 0) {
                                //Commented by Rahul Shah on 03/05/2016 for PL #2111
                                CallAjax();
                                //$("#successMessage").css("display", "block");
                                //$("#spanMessageSuccess").empty();
                                //$("#spanMessageSuccess").text(data.msg);
                                ShowMessage(isError, data.msg)
                            }
                        }
                    }
                }
            });


        });
    
    }
function LoadPage() {
    fillActualsTable();
    NumberFormatterTipsyTitle(".actualtipsyclassTitle", 24);
    maskWidht();

    /*if a toogle is open the first time page loads, change css of mask*/
    $(".accordion-actuals .accordion-group .in").prev()
                                                .find(".table-actual-mask")
                                                    .css({ "height": "254px" });

    ///*change left titles from header if toogle  is open*/
    $(".accordion-actuals .accordion-group .in").prev().
                                                 find(".table-titles-actual-left")
                                                         .css({ "color": "#908D88" });




    /*change mask if toogle is open*/
    $(".accordion-actuals .accordion-heading a").click(function () {

        var that = this,
            mask = $(that).next().find(".table-actual-mask"),
            titles = $(that).find(".table-titles-actual-left"),
            glassIcon = $(that).find(".glass-icon"),
            shadowRight = $(that).next().find(".shadow-scroll-table-mask-right"),
            shadowLeft = $(that).next().find(".shadow-scroll-table-mask-left");
        var styles = { visibility: "hidden", width: "0px", height: "0px" };

        if ($(that).parent().parent().parent().next().hasClass("in")) {
            /*set mask shadows width*/
            $('.shadow-scroll-table-mask-left').css({ "visibility": "hidden" });
            $('.shadow-scroll-table-mask-right').css({ "visibility": "hidden" });
            glassIcon.css({ "visibility": "hidden" });
            titles.css({ "color": "#ffffff" });
            mask.css({ "overflow-x": "hidden" });
            shadowRight.css(styles);
            shadowLeft.css(styles);
            animateMask($(mask), 0);
        } else {
            /*set mask shadows width*/
            glassIcon.css({ "visibility": "visible" });
            titles.css({ "color": "#908D88" });
            mask.css({ "height": "0px" });
            mask.css({ "overflow-x": "scroll" });
            //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            var CurrentID = $(this).attr('href');
            var heights = ($(CurrentID).find(".accordion-inner").height()) + 10;
            animateMask($(mask), heights);
        }
        //Added by Rahul Shah on 03/05/2016 for PL #2016
        var curId = $(this).attr('href');

        $(curId).prev().find('.shadow-scroll-table-mask-left').css({ "visibility": "hidden" });
        $(curId).prev().find('.shadow-scroll-table-mask-right').css({ "visibility": "hidden" });
        /*set mask height*/
        $('.table-actual-mask').css({ "height": "0px" });
        /*set left titles from header if toogle  is open*/
        $(".accordion-actuals .accordion-group .in").prev().
                                                find(".table-titles-actual-left")
                                                        .css({ "color": "#F0F0F0" });
        /*set glass icon from header if toogle  is open*/
        $(".accordion-actuals .accordion-group .in").prev().
                                                        find(".glass-icon")
                                                                .css({ "visibility": "hidden" });
        /*set visibility on scroll over mask*/
        $(curId).prev().find(".table-actual-mask").css({ "overflow-x": "hidden" });

     
        //$('.shadow-scroll-table-mask-right').removeClass("resetVisibility");

        //$('.shadow-scroll-table-mask-left').removeClass("resetVisibility");

        ////Added By : Kalpesh Sharma Internal Review Points 07-18-2014
        //$(".accordion-actuals .accordion-group .in").prev().
        //                                 find(".shadow-scroll-table-mask-right").addClass("resetVisibility");

        ////Added By : Kalpesh Sharma Internal Review Points 07-18-2014
        //$(".accordion-actuals .accordion-group .in").prev().
        //                 find(".shadow-scroll-table-mask-left").addClass("resetVisibility");
                
        $(curId).find('.addFormatterActualCurrency').each(function () {
            SetBudget($(this));
        });
        $(curId).find('.addFormatterActualNumber').each(function () {
            SetPriceValue($(this));
        });
        $(curId).find('.setBudget').each(function () {
            SetBudget("#" + $(this).attr('id'));
        });

        var curId1 = curId.replace('collapse', 'divTable');
        $(curId1).find('.currency_dollar').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });
        $(curId1).find('.priceValue').priceFormat({ prefix: '', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });

        $(curId1).find('.currency_dollarCost').each(function () {
            var txtvalue = $(this).val();
            $(this).attr('title', txtvalue);
        });
        $(curId1).find('.priceValue').each(function () {
            var txtvalue = $(this).val();
            $(this).attr('title', txtvalue);
        });
        $(curId1).find('.currency_dollar').each(function () {
            var txtvalue = $(this).val();
            $(this).attr('title', txtvalue);
        });
        $(curId1).find('.currency_dollarCost').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isDouble: true });

    });

    /*click event on mask*/
    /*change mask if toogle is open*/
    $(".table-actual-mask").click(function (event) {
        event.preventDefault();
        event.stopPropagation();
    });

    /*shadow on table*/
    $(".accordion-actuals .accordion-heading").find('.table-actual-mask').scroll(function () {
        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        var TacticSideBorderHeight = ($($(this).parent().prev().attr("href")).find(".accordion-inner").height()) + 10 + "px";
        var styles = { visibility: "visible", widht: "15px", height: TacticSideBorderHeight };
        var styles1 = { visibility: "hidden", widht: "15px", height: TacticSideBorderHeight };
        if ($(this).scrollLeft() > 0) {
            /*set shadows*/
            $(this).prev().css(styles);
            $(this).next().css(styles);
            $(this).next().css({ "margin-left": $(".table-actual-mask").width() });
        }
        if ($(this).scrollLeft() == 0) {
            $(this).prev().css(styles1);
        }
        if ($(this).scrollLeft() == 1800 - $(".table-actual-mask").width()) {
            $(this).next().css(styles1);
        }

    });

    window.onresize = function () {
        function maskWidht() {
            var widthHeader = $("#accordion2").width(),

           //#598 Added by Kalpesh Sharma : Add Actuals: Inappropriate Display of Add Actuals Tactics
           widthRigth = widthHeader - 662;

            $(".header-toogle-actual-right").width(widthRigth);
            $(".table-actual-mask").width(widthRigth);
            $('.table-actual-mask').scrollLeft(0);
            $(".accordion-actuals .accordion-heading").find('.table-actual-mask').next().css({ "margin-left": widthRigth });

            return this;
        };
        maskWidht();

    }
    //Commented by Rahul Shah on 03/05/2016 for PL #2111
    // For Format Price & Total Input
    //$('.currency_dollar').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });
    //$('.priceValue').priceFormat({ prefix: '', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isAllowNull: true, isDouble: true });

    //$('.currency_dollarCost').each(function () {
    //    var txtvalue = $(this).val();
    //    $(this).attr('title', txtvalue);
    //});

    //$('.priceValue').each(function () {
    //    var txtvalue = $(this).val();
    //    $(this).attr('title', txtvalue);//uday 2-7-2014 internal poinmt to add tooltip title...
    //});

    //$('.currency_dollar').each(function () {
    //    var txtvalue = $(this).val();
    //    $(this).attr('title', txtvalue);//uday 3-7-2014 internal poinmt to add tooltip title...
    //});

    //$('.currency_dollarCost').priceFormat({ prefix: '$', centsSeparator: '', thousandsSeparator: ',', centsLimit: 0, isDouble: true });
    
    $('.accordion-actuals').find('input').each(function () {
        $(this).keyup(function () {
            var currentValue = $(this).val().trim().replace(/,/g, '').replace('$', '');
            currentValue = currentValue == '' ? "0" : currentValue; // Added by Sohel Pathan on 03/09/2014 for Internal Review Points
            //if (currentValue.match('^(0|[1-9][0-9]*)$')) {
            if (currentValue.match(_decmlRegex)) {
                var costlbl = (this).id.replace('ActuallblCCost', '');
                if ((this).id.replace(costlbl, '') != "ActuallblCCost") {
                    var arr = (this).id.split('-');
                    costlbl = arr[0];
                    var formatValue = "P";
                    if (arr[1] == 'Revenue') {
                        formatValue = "C";
                    }
                    var ida = "Actuallbl" + formatValue + arr[1] + arr[0];
                    var totalvalue = 0;
                    $('#tr' + arr[0] + arr[1]).find('input').each(function () {
                        var cvalue = parseFloat($(this).val().trim().replace(/,/g, '').replace('$', ''));
                        if (!isNaN(cvalue)) {
                            totalvalue = cvalue + parseFloat(totalvalue);
                        }
                    });

                    if (arr[1] == 'Revenue') {
                        document.getElementById(ida).innerHTML = totalvalue;
                        document.getElementById(ida).innerHTML = FormatCurrency(document.getElementById(ida).innerHTML, true);
                        SetBudget('#' + ida); // Added by Sohel Pathan on 26/08/2014 for Internal Review Points //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in # 1755
                        $('#' + ida).attr('orignal-value', totalvalue);
                    }

                        //If Tactic has not any line item at that time application will update the Actual cost and Projected Cost.
                    else if (arr[1] == 'Cost') {
                        costlbl = $('#tr' + arr[0] + arr[1]).attr('tacticid');
                        var updateActalCost = "ActuallblCCost" + costlbl;
                        document.getElementById(updateActalCost).innerHTML = totalvalue;
                        document.getElementById(updateActalCost).innerHTML = FormatCurrency(document.getElementById(updateActalCost).innerHTML, true);
                        SetBudget('#' + updateActalCost);   //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755
                        $('#' + updateActalCost).attr('orignal-value', totalvalue);
                    }
                    else if (arr[1] != 'Revenue' && arr[1] != 'Cost' && arr[1] != 'ProjectedStageValue' && arr[1] != 'MQL' &&
                        arr[1] != 'CW' && arr[1] != 'INQ') {
                        //Update the Actual Cost and apply currency format.
                        document.getElementById(ida).innerHTML = totalvalue;
                        document.getElementById(ida).innerHTML = FormatCurrency(document.getElementById(ida).innerHTML, true);
                        SetBudget('#' + ida); // Added by Sohel Pathan on 26/08/2014 for Internal Review Points //AdUncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755

                        costlbl = $('#tr' + arr[0] + arr[1]).attr('tacticid');

                        //Update the line item for the appropriate Period (Y1,Y2....Y12)
                        var ActualsName = 'ActuallblP' + arr[1] + arr[0];
                        $('#' + ActualsName).attr('linevalue', totalvalue);
                        var lineItemTotal = 0;
                        var LineClassName = costlbl + 'Line-' + arr[2];
                        $('.' + LineClassName).each(function () {
                            var lineItemvalue = parseFloat($(this).val().trim().replace(/,/g, '').replace('$', '').replace(/!/g, "_"));
                            if (!isNaN(lineItemvalue)) {
                                lineItemTotal = lineItemvalue + parseFloat(lineItemTotal);
                            }
                        });

                        var lineId = costlbl + "Cost-" + arr[2];
                        document.getElementById(lineId).innerHTML = lineItemTotal;
                        document.getElementById(lineId).innerHTML = FormatCurrency(document.getElementById(lineId).innerHTML, true);
                        SetBudget('#' + lineId);    //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755

                        //Update the Actual cost value based upon Line item actual sum.

                        var updateActalCost = "ActuallblCCost" + costlbl;
                        var updateActalCostValueTotal = 0;
                        var currentTacticLineItemsDv = '.lineItemActualsValues' + costlbl;
                        $(currentTacticLineItemsDv).each(function () {
                            var updateActalCostValue = parseFloat($(this).attr('linevalue').trim().replace(/,/g, '').replace('$', ''));
                            if (!isNaN(updateActalCostValue)) {
                                updateActalCostValueTotal = updateActalCostValue + parseFloat(updateActalCostValueTotal);
                            }
                        });

                        //Update the value and apply currency formatter on it .
                        document.getElementById(updateActalCost).innerHTML = updateActalCostValueTotal;
                        document.getElementById(updateActalCost).innerHTML = FormatCurrency(document.getElementById(updateActalCost).innerHTML, true);
                        SetBudget('#' + updateActalCost);   //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755
                        $('#' + updateActalCost).attr('orignal-value', updateActalCostValueTotal);
                    }
                    else {
                        $('#hdn' + ida.toString()).val(totalvalue); // Added by Sohel Pathan on 27/08/2014 for Internal Review Points
                        document.getElementById(ida).innerHTML = totalvalue;
                        document.getElementById(ida).innerHTML = FormatCommas(document.getElementById(ida).innerHTML, false);
                        SetPriceValue(document.getElementById(ida)); // Added by Sohel Pathan on 26/08/2014 for Internal Review Points
                    }
                }
                calculateRIO(costlbl);
            }
        });
    });

    // Modified by dharmraj for implement new formula to calculate ROI, #533
    function calculateRIO(id) {
        var pcost = $("#hdnProjectedlblCCost" + id).val();  // Modified by Sohel Pathan on 10/09/2014 for Internal Review Points
        if (pcost != 0 && !isNaN(pcost)) {
            var prevenue = $("#hdnProjectedlblValueRevenue" + id).val();    // Modified by Sohel Pathan on 10/09/2014 for Internal Review Points
            var roip = (prevenue - pcost) / pcost;
            $("#ProjectedROI" + id).text(FormatCommas(roip.toFixed(2).toString()));
        }

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        pcost = parseFloat(ReplaceCC($("#ActuallblCCost" + id).attr("orignal-value")));
        if (pcost != 0 && !isNaN(pcost)) {
            var prevenue = parseFloat(ReplaceCC($("#ActuallblCRevenue" + id).attr("orignal-value")));
            var roiT = (prevenue - pcost) / pcost;
            $("#ActualROI" + id).text(FormatCommas(roiT.toFixed(2).toString()));
            SetPriceValue($("#ActualROI" + id));  //Added By Maitri for #1755 on 2/3/2016
        }
    }

    $("[id^='BtnShareTactic']").click(function () {
        $("#errorMsg").css("display", "none");
        $("#SuccessMsg").css("display", "none");
        $("#DivPartialShareTactic").empty();
        var url = '@Url.Content("~/Inspect/ShowShareTactic/")';
                $("#DivPartialShareTactic").load(url + '?planTacticId=' + $(this).attr('tacticId') + '&section=@Convert.ToString(RevenuePlanner.Helpers.Enums.Section.Tactic).ToLower()');
            });


            $("[id^='UpdateResult']").click(function () {
                $("#errorMsg").css("display", "none");
                $("#SuccessMsg").css("display", "none");
                var _LineItems = [];
                var title = htmlEncode($('#txtTacticTitle').val());
                var _tactic = []
                var tacticId = $(this).attr('tacticId');
                var stageId = $(this).attr('stageId');
                isError = false;
                var isData = false;
                //// Modified by Sohel Pathan on 26/08/2014 for Internal Review Points
                var totalProjectedStageValueActual = $("#hdnActuallblPProjectedStageValue" + tacticId).val();
                var ProjectedStageValueTitle = $("#hdnProjectedStageValueTitle" + tacticId).val();
                //// Modified by Sohel Pathan on 26/08/2014 for Internal Review Points
                var totalMQLActual = $("#hdnActuallblPMQL" + tacticId).val();
                var totalCWActual = ReplaceCC($("#ActuallblPCW" + tacticId).text());
                var totalRevenueActual = ReplaceCC($("#ActuallblCRevenue" + tacticId).text());
                //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
                var totalCostActual = 0;
                if (IsLineItemActual) {
                    totalCostActual = ReplaceCC($("#ActuallblCCost" + tacticId).val());
                }
                else {
                    totalCostActual = ReplaceCC($("#ActuallblCCost" + tacticId).text());
                }

                var totalROI = ReplaceCC($("#ProjectedROI" + tacticId).text());
                var totalROIActual = ReplaceCC($("#ActualROI" + tacticId).text());
                var tableId = "#divTable" + tacticId;
                $(tableId).find('input').each(function () {
                    if ($(this).val().trim() != '') {
                        var _isCurrency = $(this).hasClass("currency_dollar");
                        var thisValue = ReplaceCC($(this).val());
                        if ((!_isCurrency) && thisValue.match('^(0|[0-9][0-9]*)$')) {
                            $(this).removeClass("error");
                        }
                        else if ((_isCurrency) && thisValue.match(_decmlRegex)) {
                            $(this).removeClass("error");
                        }
                        else {
                            $(this).addClass("error");
                            isError = true;
                        }
                        var arr = (this).id.split('-');
                        if (thisValue != '') {
                            var lineitemclass = tacticId + '_Line';
                            if (!$(this).hasClass(lineitemclass)) {
                                _tactic.push({
                                    PlanTacticId: tacticId,
                                    StageTitle: arr[1],
                                    Period: arr[2],
                                    ActualValue: thisValue,
                                    TotalProjectedStageValueActual: totalProjectedStageValueActual,
                                    TotalMQLActual: totalMQLActual,
                                    TotalCWActual: totalCWActual,
                                    TotalRevenueActual: totalRevenueActual,
                                    TotalCostActual: totalCostActual,
                                    ROI: totalROI,
                                    ROIActual: totalROIActual,
                                    IsActual: true,
                                    StageId: stageId
                                    //PlanLineItemId: arr[0]
                                });
                                isData = true;
                            }
                            else {
                                _LineItems.push({
                                    PlanLineItemId: arr[0],
                                    Period: arr[2],
                                    Value: thisValue
                                });
                                isLineItem = true;
                            }
                        }
                    }
                    else {
                        $(this).removeClass("error");
                    }
                });
                if (isError) {
                   @* $("#errorMessage").css("display", "block");
                    $("#spanMessageError").text("@RevenuePlanner.Helpers.Common.objCached.ValidateForValidField");*@
                    ShowMessage(isError, "@RevenuePlanner.Helpers.Common.objCached.ValidateForValidField")
                    return false;
                }
            if (parseFloat(totalMQLActual) > parseFloat(totalProjectedStageValueActual)) {
                isError = true;
                var msg = "@RevenuePlanner.Helpers.Common.objCached.ValidationForMqlGreaterThanINQ"
                var msgdisplay = msg.replace('{0}', FormatCommas(totalMQLActual.toString())).replace('{1}', ProjectedStageValueTitle).replace('{3}', ProjectedStageValueTitle).replace('{2}', FormatCommas(totalProjectedStageValueActual.toString())).replace(/{4\}/g, MQlTitle);
                //$("#spanMessageError").text(msgdisplay);
                //$("#errorMessage").css("display", "block");
                ShowMessage(isError, msgdisplay)
                return false;
            }
            if (!isData) {
                _tactic.push({
                    PlanTacticId: tacticId,
                    StageTitle: 0,
                    Period: 0,
                    ActualValue: 0,
                    TotalProjectedStageValueActual: totalProjectedStageValueActual,
                    TotalMQLActual: totalMQLActual,
                    TotalCWActual: totalCWActual,
                    TotalRevenueActual: totalRevenueActual,
                    TotalCostActual: totalCostActual,
                    ROI: totalROI,
                    ROIActual: totalROIActual,
                    IsActual: false,
                    StageId: stageId
                });
            }
            $("#errorMsg").css("display", "none");
            //_tactic = JSON.stringify({ 'tacticactual': _tactic });

            var Tactic_title = $(".colTitle" + tacticId).attr('Tactitle');
            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                async: false,
                type: 'POST',
                //url: '@Url.Content("~/Inspect/UploadResult/")?UserId=' + $(window).attr('name'),
                    url: '@Url.Content("~/Inspect/UploadResult/")',
                    //data: _tactic,
                    data: JSON.stringify({ tacticactual: _tactic, lineItemActual: _LineItems, tactictitle: Tactic_title }),
                    success: function (data) {
                        if (data.returnURL != 'undefined' && data.returnURL == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                }
                else {
                    if (data != 'undefined') {
                        if (data.id != 0) {
                            //Commented by Rahul Shah on 03/05/2016 for PL #2111
                            CallAjax();
                            //$("#successMessage").css("display", "block");
                            //$("#spanMessageSuccess").empty();
                            //$("#spanMessageSuccess").text(data.msg);
                            ShowMessage(isError, data.msg)
                        }
                    }
                }
                    }
                });


        });
}

function AssignDefaultValue() {
    $('.accordion-actuals').find("input,input[type=text],textarea,select").each(function () {
        $(this).attr("myValue", $(this).val());
        $(this).attr("title", $(this).val());//uday 2-7-2014
    });
}

function fillActualsTable() {
    if (typeof actuals != 'undefined') {
        $('.accordion-actuals').empty();
        var $html = '';
        var isFilterFound = false;
        if (actuals.length) {
            var indexValue = 0;
            for (i in actuals) {
                indexValue = indexValue + 1;
                isFilterFound = true;
                // Modified By Nishant Sheth
                // Desc :: #2111 replace function for display only list of tactic name without table
                addRowActualPerformance(indexValue, actuals[i].id, actuals[i].title, actuals[i].projectedStageValue, actuals[i].projectedStageValueActual, actuals[i].mqlProjected, actuals[i].mqlActual, actuals[i].cwProjected, actuals[i].cwActual, actuals[i].revenueProjected, actuals[i].revenueActual, actuals[i].costProjected, actuals[i].costActual, actuals[i].roiProjected, actuals[i].roiActual, actuals[i].actualData, actuals[i].modifiedBy, actuals[i].LastSync, actuals[i].stageTitle, actuals[i].tacticStageId, actuals[i].tacticStageTitle, actuals[i].IsTacticEditable, actuals[i].LineItemsData, actuals[i].costActualData, actuals[i].YearDiffrence, actuals[i].StartYear);
            }
            if (!isFilterFound) {
                $html += '@RevenuePlanner.Helpers.Common.objCached.NoTacticFound';
                    var $tableActuals = $('.accordion-actuals');
                    $tableActuals.append($html);
                }
                else {
                    ShowOwnerList();
                }
            }
            else {
                if (Status == 0) {
                    $html += '@RevenuePlanner.Helpers.Common.objCached.NoOpenTacticExists';
                    //Added by Arpita Soni on 01/13/2015 for ticket #1090
                    //$('#ulSelectedOwner li').hide();
                    //$('#ulOwnerAllModule ').hide();
                    //$('#NoOwnerFound1').show();
                    //Ended by Arpita Soni on 01/13/2015 for ticket #1090
                }
                else {
                    $html += '@RevenuePlanner.Helpers.Common.objCached.NoTacticExistPlan';
                    //Added by Arpita Soni on 01/13/2015 for ticket #1090
                    //$('#ulSelectedOwner li').hide();
                    //$('#ulOwnerAllModule ').hide();
                    //$('#NoOwnerFound1').show();
                    //Ended by Arpita Soni on 01/13/2015 for ticket #1090
                }
                var $tableActuals = $('.accordion-actuals');

                $tableActuals.append($html);
            }
        //Commented by Rahul Shah on 03/05/2016 for PL #2111
        //start
            //Uncommented by Maitri Gandhi on 2/3/2016 to make consistent look of Actuals - Covered in #1755
            //$('.addFormatterActualCurrency').each(function () {
            //    //Added By : Kalpesh Sharma Internal Review Points 07-18-2014
            //    SetBudget($(this)); // Modfified by Sohel Pathan on 10/09/2014 for Internal Review Points  
            //    //FormatCurrency($(this).innerHTML, true);
            //});

            //$('.addFormatterActualNumber').each(function () {
            //    //Added By : Kalpesh Sharma Internal Review Points 07-18-2014
            //    SetPriceValue($(this));
            //});

            //// Start - Added by Sohel Pathan on 12/09/2014 for PL ticket #760
            //$('.setBudget').each(function () {
            //    SetBudget("#" + $(this).attr('id'));    // Modified By : Viral Kadiya Internal Review Points 10/29/2014
            //});
            // End - Added by Sohel Pathan on 12/09/2014 for PL ticket #760
        //end
        }
    }
    // Add By Nishant Sheth
    // Desc :: Add row for tactic name #2111
    function addRowActualPerformance(_index, _id, _title, _projectedStageValue, _projectedStageValueActual, _mqlProjected, _mqlActual, _cwProjected, _cwActual, _revenueProjected, _revenueActual, _costProjected, _costActual, _roiProjected, _roiActual, _actualData, _modifiedBy, _LastSync, stageTitle, tacticStageId, tacticStageTitle, IsTacticEditable, _LineItemsData, _costActualData, _YearDiffrence, _StartYear) {
        var $tableActuals = $('.accordion-actuals');
        var num = parseInt(_index);
        var $html = '<div class="accordion-group" id="accordion'+_id+'">' +
                      '<div class="accordion-heading">' +
                      '<div class="accordion-toggle">' +
                                  '<div class="header-toogle-actual">' +
                                   '<a data-toggle="collapse" class="chevron-right" data-parent="#accordion2" href="#collapse' + _id + '" onclick="renderactualtable(' + _id + ')"> ' +
                                      '<div class="header-toogle-actual-left">' +
                                      '<span class="font-black">' + num + '.</span><span class="actualtipsyclassTitle">' + _title +
                                      '</span><span class="glass-icon"></span>' +
                                          '<span class="table-titles-actual-left">' +
                                              '<label>Projected</label>' +
                                              '<label>Actual</label>' +
                                          '</span>' +
                                      '</div>' +
                                  '</a>'+
                                  '</div>'+
                                  '</div>'+
                                  '</div>'+
                                  '<div id="collapse' + _id + '" class="accordion-body collapse colTitle' + _id + '" style="height: auto" Tactitle="' + _title + '"><div>'+
                                  '</div>';
        $tableActuals.append($html);
    }
    // Add By Nishant Sheth
    // Desc :: Call function for Render table for selected tacics #2111
    function renderactualtable(id)
    {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");
        $("[id^='collapse']").removeAttr('style');
        //var actualData = $.grep(actuals, function (e) { return e.id == id; });
        if (!$("#divTable" + id + "").length > 0) {
            var atcualIndex = 0;
            $.each(actuals, function (index, value) {
                if (value.id == id) {
                    atcualIndex = index;
                    return false;
                }
            });

            //atcualIndex=parseInt(actuals.map((el) => el.id).indexOf(id));

            //debugger;
            var index = atcualIndex + 1;
            //alert(i);
            addRowActualExpand(index, id, actuals[atcualIndex].title, actuals[atcualIndex].projectedStageValue, actuals[atcualIndex].projectedStageValueActual, actuals[atcualIndex].mqlProjected, actuals[atcualIndex].mqlActual, actuals[atcualIndex].cwProjected, actuals[atcualIndex].cwActual, actuals[atcualIndex].revenueProjected, actuals[atcualIndex].revenueActual, actuals[atcualIndex].costProjected, actuals[atcualIndex].costActual, actuals[atcualIndex].roiProjected, actuals[atcualIndex].roiActual, actuals[atcualIndex].actualData, actuals[atcualIndex].modifiedBy, actuals[atcualIndex].LastSync, actuals[atcualIndex].stageTitle, actuals[atcualIndex].tacticStageId, actuals[atcualIndex].tacticStageTitle, actuals[atcualIndex].IsTacticEditable, actuals[atcualIndex].LineItemsData, actuals[atcualIndex].costActualData, actuals[atcualIndex].YearDiffrence, actuals[atcualIndex].StartYear);

            if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))  // If Internet Explorer, return version number
            {
                $("[id^='accordion']").find('.header-toogle-actual > a').each(function () {
                    $(this).removeAttr('class');
                    $(this).addClass('chevron-right');
                    $(this).parent().find('.header-toogle-actual-right .table-actual-mask').css({ "overflow-x": "hidden", "width": "601px", "height": "0px" });
                });

                $("[id^='collapse']").each(function () {
                    $(this).removeAttr('class');
                    $(this).addClass('accordion-body colTitle92193 collapse');
                });

                if ($('#accordion' + id).find('.header-toogle-actual > a').hasClass('chevron-right')) {
                    $('#accordion' + id).find('.header-toogle-actual > a').removeAttr('class');
                    $('#accordion' + id).find('.header-toogle-actual > a').addClass('collapse chevron-down');

                    $(this).parent().find('.header-toogle-actual-right .table-actual-mask').css({ "overflow-x": "scroll", "width": "601px", "height": "300px" });

                    $('#collapse' + id).removeAttr('class');
                    $('#collapse' + id).addClass('accordion-body colTitle92193 in collapse');
                }
                else {
                    $('#accordion' + id).find('.header-toogle-actual > a').removeAttr('class');
                    $('#accordion' + id).find('.header-toogle-actual > a').addClass('chevron-right');

                    $('#collapse' + id).removeAttr('class');
                    $('#collapse' + id).addClass('accordion-body colTitle92193 collapse');
                }
            }
        }
    }
    // Add By Nishant Sheth
    // Desc :: Render table of selected tacics #2111
    function addRowActualExpand(_index, _id, _title, _projectedStageValue, _projectedStageValueActual, _mqlProjected, _mqlActual, _cwProjected, _cwActual, _revenueProjected, _revenueActual, _costProjected, _costActual, _roiProjected, _roiActual, _actualData, _modifiedBy, _LastSync, stageTitle, tacticStageId, tacticStageTitle, IsTacticEditable, _LineItemsData, _costActualData, _YearDiffrence, _StartYear) {
        var $tableActuals = $('#accordion'+_id);
        $tableActuals.html('');
        var num = parseInt(_index);
        var $html = '' +
                        '<div class="accordion-heading">' +
                        '<div class="accordion-toggle">' +
                                    '<div class="header-toogle-actual">' +
                                     '<a data-toggle="collapse" class="chevron-right" data-parent="#accordion2" href="#collapse' + _id + '" onclick="anchorclick(this)">' +
                                        '<div class="header-toogle-actual-left">' +
                                        '<span class="font-black">' + num + '.</span><span class="actualtipsyclassTitle">' + _title +
                                        '</span><span class="glass-icon"></span>' +
                                            '<span class="table-titles-actual-left">' +
                                                '<label>Projected</label>' +
                                                '<label>Actual</label>' +
                                            '</span>' +
                                        '</div>' +
                                    '</a>';

        $html += '<div class="header-toogle-actual-right">' +
        '<div class="shadow-scroll-table-mask-left"></div>' +
        '<div class="table-actual-mask">' +
        '<div id="divTable' + _id + '">' +
           '<table id="table_actuals" class="table" tableTacticId="tableActual' + _id + '">' +
            '<thead>' +
            '<tr>';
        for (var i = 0; i < parseInt(_YearDiffrence + 1) ; i++) {

            $html += '<th>Jan - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Feb - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Mar - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Apr - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>May - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Jun - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Jul - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Aug - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Sep - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Oct - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Nov - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Dec - ' + (parseInt(_StartYear) + i) + '  </th>'
        }

        $html += '</tr>' +
                '</thead>' +
                '<tbody>';
        var arrStage = stageTitle;
        for (var p = 0; p < arrStage.length; p = p + 1) {
            var idtr = "tr" + _id + arrStage[p];
            $html += '<tr id=' + idtr + '>';
            for (var j = 1; j <= (12 * parseInt(_YearDiffrence + 1)) ; j = j + 1) {
                var tdId = _id + "-" + arrStage[p] + "-Y" + j;
                $html += '<td><input id="' + tdId + '" placeholder="---" ';     // Modified by Sohel Pathan on 02/09/2014 for Internal Review Point
                if (arrStage[p] == 'Revenue') {
                    $html += ' class="currency_dollar"  maxlength="@RevenuePlanner.Helpers.Common.maxLengthDollar"';
                }
                else {
                    $html += ' class="priceValue"  maxlength="@RevenuePlanner.Helpers.Common.maxLengthPriceValue"';
                }

                for (k in _actualData) {
                    var comStr1 = _actualData[k].title + _actualData[k].period;
                    var comStr2 = arrStage[p] + "Y" + j;
                    if (comStr1 == comStr2) {
                        $html += 'value="' + _actualData[k].actualValue + '"';
                    }
                    //updateBy = _actualData[k].UpdateBy;
                    stat = _actualData[k].IsUpdate;
                }
                $html += ' ></input></td>';
            }
            $html += '</tr>';
        }

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        $html += '<tr id=' + "tr" + _id + "Cost" + ' TacticId=' + _id + '>';
        for (var j = 1; j <= (12 * parseInt(_YearDiffrence + 1)) ; j = j + 1) {
            var newCounterTactic = j - 1;
            var tdId = _id + "-" + "Cost" + "-Y" + j;
            var divId = _id + "Cost-Y" + j;
            $html += '<td>';
            if (_LineItemsData.length <= 0) {
                $html += '<input id="' + tdId + '" placeholder="---" '; // Modified by Sohel Pathan on 02/09/2014 for Internal Review Point
                $html += ' class="currency_dollar "  maxlength="@RevenuePlanner.Helpers.Common.maxLengthDollar"';
                $html += 'value="' + FormatCurrency(_costActualData[newCounterTactic].Cost, true) + '"';
                $html += ' ></input>';
            }
            else {
                $html += '<div id="' + divId + '" class="table-info-actual-left addFormatterActualCurrency " style="float: right;">' + FormatCurrency(_costActualData[newCounterTactic].Cost, true) + '</div>';
            }
            $html += '</td>';
        }
        $html += '</tr>';

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        for (var p = 0; p < _LineItemsData.length; p = p + 1) {
            //// Modified by Arpita Soni on 01/12/2015 for ticket #1093
            var TacticId = _id;
            var idtr = "tr" + _LineItemsData[p].id + TacticId;
            $html += '<tr id=' + idtr + ' TacticId=' + _id + '>';
            for (var j = 1; j <= (12 * parseInt(_YearDiffrence + 1)) ; j = j + 1) {
                var tdId = _LineItemsData[p].id + "-" + TacticId + "-Y" + j;
                var ClassName = "currency_dollar" + " " + _id + "Line-Y" + j;
                ClassName = _id + "_Line " + ClassName;
                $html += '<td><input id="' + tdId + '" placeholder="---" '; // Modified by Sohel Pathan on 02/09/2014 for Internal Review Point
                $html += ' class="' + ClassName + '"  maxlength="@RevenuePlanner.Helpers.Common.maxLengthPriceValue"';

                var newCounter = j - 1;
                var Data = _LineItemsData[p].LineItemActual[newCounter];

                if (typeof Data != 'undefined') {
                    var val = _LineItemsData[p].LineItemActual[newCounter].Cost;
                    if (val != null && val != 'undefined' && val.length > 0) {
                        $html += 'value="' + FormatCurrency(_LineItemsData[p].LineItemActual[newCounter].Cost, true) + '"';
                    }
                    //$html += 'value="' +  + '"';
                }
                else {
                    $html += 'value="' + 0 + '"';
                }

                $html += ' ></input></td>';
            }
            $html += '</tr>';
        }

        $html += '</tbody>' +
            '</table>' +
            '</div>' +
            '</div>' +
            '<div class="shadow-scroll-table-mask-right"></div>' +
            '</div>' +
            '</div>' +
        '</div>' +
    '</div>' +
    '<div id="collapse' + _id + '" class="accordion-body collapse colTitle' + _id + '" style="height: auto" Tactitle="' + _title + '">' +
      '<div class="accordion-inner">';
        //Modified by Bhumika for #1755 on 4/3/2016 for UI issues.
        for (var i = 0; i < arrStage.length; i++) {
            if (arrStage[i] == '@Enums.InspectStageValues[Enums.InspectStage.ProjectedStageValue.ToString()].ToString()') {
                $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">' + tacticStageTitle + '</span><input type="hidden" id="hdnProjectedStageValueTitle' + _id + '" value="' + tacticStageTitle + '" /><span class="table-info-actual-left-wraper">' +
                                                                  '<span class="table-info-actual-left truncate addFormatterActualNumber" id="lblProjectedStageValue' + _id + '">' +
                                                _projectedStageValue +
                                        '</span>' +
                                            '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber" id="ActuallblPProjectedStageValue' + _id + '">' +
                                                _projectedStageValueActual +
                                        '</span>' +
                                        '<input type="hidden" id="hdnActuallblPProjectedStageValue' + _id + '" value=" ' + _projectedStageValueActual + ' " />' +   //// Added by Sohel Pathan on 27/08/2014 for Internal Review Points
                                    '</span>' +
                                '</div></div>';
            }
            else if (arrStage[i].toLowerCase() == '@Common.StageCodeMQL') {
                MQlTitle = '@Html.LabelForMQL("MQL")';
                $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">' + MQlTitle + '</span><span class="table-info-actual-left-wraper">' +
                                                '<span class="table-info-actual-left truncate addFormatterActualNumber" id="ProjectedlblPMQL' + _id + '">' +
                                                    _mqlProjected +
                                                '</span>' +
                                                '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber" id="ActuallblPMQL' + _id + '">' +
                                                    _mqlActual +
                                                '</span>' +
                                                '<input type="hidden" id="hdnActuallblPMQL' + _id + '" value=" ' + _mqlActual + ' " />' +       //// Added by Sohel Pathan on 27/08/2014 for Internal Review Points
                                            '</span>' +
                                        '</div></div>';
            }
        }

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">@Html.LabelForCW("CW")</span><span class="table-info-actual-left-wraper">' +
                                        '<span class="table-info-actual-left truncate addFormatterActualNumber" id="ProjectedlblValueCW' + _id + '">' +
                                            number_format(_cwProjected, 0, 0, ',') +    // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                        '</span>' +
                                        '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber" id="ActuallblPCW' + _id + '">' +
                                            _cwActual +
                                        '</span>' +
                                    '</span>' +
                                '</div></div>';

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">Revenue</span><span class="table-info-actual-left-wraper">' +
                                        '<span class="table-info-actual-left truncate setBudget" id="ProjectedlblValueRevenue' + _id + '">' +    // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                            FormatCurrency(_revenueProjected, true) +   // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                        '</span>' +
                                        '<span orignal-value="' + _revenueActual + '" class="table-info-actual-left table-info-actual-width truncate setBudget" id="ActuallblCRevenue' + _id + '">' +    // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                            FormatCurrency(_revenueActual, true) +  // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                        '</span>' +
                                        '<input type="hidden" id="hdnProjectedlblValueRevenue' + _id + '" value=" ' + _revenueProjected + ' " />' +       //// Added by Sohel Pathan on 10/09/2014 for Internal Review Points
                                    '</span>' +
                                '</div></div>';

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">Cost</span>' +
                            '<span id="border-right" class="table-info-actual-left-wraper">' +
                                '<span class="table-info-actual-left truncate setBudget" id="ProjectedlblCCost' + _id + '">' +   // Modified by Sohel Pathan on 15/09/2014 for PL ticket #760
                                    FormatCurrency(_costProjected, true) +  // Modified by Sohel Pathan on 15/09/2014 for PL ticket #760
                                '</span>';

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        $html += '<span orignal-value="' + _costActual + '" id="ActuallblCCost' + _id + '" class="table-info-actual-left table-info-actual-width truncate setBudget">' + FormatCurrency(_costActual, true) + '</span>';   // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
        $html += '<input type="hidden" id="hdnProjectedlblCCost' + _id + '" value=" ' + _costProjected + ' " />';       //// Added by Sohel Pathan on 10/09/2014 for Internal Review Points
        $html += '</span>' +
                        '</div></div>';

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        for (line in _LineItemsData) {
            //// Modified by Arpita Soni on 01/12/2015 for ticket #1093
            var TacticId = _id;
            $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="inner-lineItem truncate testTacticTitle"  title="' + _LineItemsData[line].Title + '">' + _LineItemsData[line].Title +
                                         '</span><span id="border-right" class="table-info-actual-left-wraper">' +
                                             '<span class="table-info-actual-left truncate setBudget" id="lineItemProjectedCost' + _LineItemsData[line].id + '">' +  // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                                 FormatCurrency(_LineItemsData[line].LineItemCost, true) +  // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                             '</span>' +
                                             '<span lineValue="' + _LineItemsData[line].LineItemActualCost + '" class="table-info-actual-left table-info-actual-width setBudget lineItemActualsValues' + TacticId + '" style="float: right;" id="ActuallblP' + TacticId + _LineItemsData[line].id + '">' +  // Modified by Arpita Soni on 01/12/2015 for PL ticket #1093
                                              FormatCurrency(_LineItemsData[line].LineItemActualCost, true) +   // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                '</span>' +
                            '</span>' +
                        '</div></div>';
        }

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">ROI</span>' +
                                '<span id="border-right" class="table-info-actual-left-wraper">' +
                                    '<span class="table-info-actual-left truncate" id="ProjectedROI' + _id + '">' +
                                        _roiProjected.toFixed(2) +
                                    '</span>' +
                                    '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber " id="ActualROI' + _id + '">' +
                                        _roiActual.toFixed(2) +
                                    '</span>' +
                                '</span>' +
                            '</div></div>';

        $html += '<div class="body-toogle-actual">' +
                        '<div class="wrapper-toogle-actual-buttons">' +
                        '<div class="pull-left" style="width:315px;">' +
                        '<label id="last-synced" class="pull-left margin-top6 margin-bottom0" style="line-height:10px;">' + _LastSync + '</label>' +
                        '<label id="last-updated" class="pull-left margin-bottom0">' + _modifiedBy + '</label></div>';

        if (IsTacticEditable) {
            $html += '<button id="BtnShareTactic' + _id + '" tacticId="' + _id + '" class="btn btn-blue text-shadow-blue source-sans-proregular share-tactic-icon button-inspect-result-modal pull-right" type="button"><span class="flag-icon"></span>Share Tactic</button>' +
                     '<button id="UpdateResult" stageId="' + tacticStageId + '" tacticId="' + _id + '" class="btn btn-blue text-shadow-blue source-sans-proregular button-inspect-result-modal pull-right margin-right20" type="button"><span class="flag-icon"></span>Update Actuals</button>';
        }

        $html += '</div>' +
                   '</div>' +
                   '</div>' +
               '</div>' +
             '';
        
        $tableActuals.html($html);
        LoadPagePerformance(_id);
        AssignDefaultValue();
    }
    //add row in actuals table
    //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
    //addRowActual
    function addRowActual(_index, _id, _title, _projectedStageValue, _projectedStageValueActual, _mqlProjected, _mqlActual, _cwProjected, _cwActual, _revenueProjected, _revenueActual, _costProjected, _costActual, _roiProjected, _roiActual, _actualData, _modifiedBy, _LastSync, stageTitle, tacticStageId, tacticStageTitle, IsTacticEditable, _LineItemsData, _costActualData, _YearDiffrence, _StartYear) {
        var $tableActuals = $('.accordion-actuals');
        var num = parseInt(_index);
        var $html = '<div class="accordion-group">' +
                        '<div class="accordion-heading">' +
                        '<div class="accordion-toggle">' +
                                    '<div class="header-toogle-actual">' +
                                     '<a data-toggle="collapse" class="chevron-right" data-parent="#accordion2" href="#collapse' + _id + '">' +
                                        '<div class="header-toogle-actual-left">' +
                                        '<span class="font-black">' + num + '.</span><span class="actualtipsyclassTitle">' + _title +
                                        '</span><span class="glass-icon"></span>' +
                                            '<span class="table-titles-actual-left">' +
                                                '<label>Projected</label>' +
                                                '<label>Actual</label>' +
                                            '</span>' +
                                        '</div>' +
                                    '</a>';

        $html += '<div class="header-toogle-actual-right">' +
        '<div class="shadow-scroll-table-mask-left"></div>' +
        '<div class="table-actual-mask">' +
        '<div id="divTable' + _id + '">' +
           '<table id="table_actuals" class="table" tableTacticId="tableActual' + _id + '">' +
            '<thead>' +
            '<tr>';
        for (var i = 0; i < parseInt(_YearDiffrence + 1) ; i++) {

            $html += '<th>Jan - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Feb - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Mar - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Apr - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>May - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Jun - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Jul - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Aug - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Sep - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Oct - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Nov - ' + (parseInt(_StartYear) + i) + '  </th>' +
                        '<th>Dec - ' + (parseInt(_StartYear) + i) + '  </th>'
        }

        $html += '</tr>' +
                '</thead>' +
                '<tbody>';
        var arrStage = stageTitle;
        for (var p = 0; p < arrStage.length; p = p + 1) {
            var idtr = "tr" + _id + arrStage[p];
            $html += '<tr id=' + idtr + '>';
            for (var j = 1; j <= (12 * parseInt(_YearDiffrence + 1)) ; j = j + 1) {
                var tdId = _id + "-" + arrStage[p] + "-Y" + j;
                $html += '<td><input id="' + tdId + '" placeholder="---" ';     // Modified by Sohel Pathan on 02/09/2014 for Internal Review Point
                if (arrStage[p] == 'Revenue') {
                    $html += ' class="currency_dollar"  maxlength="@RevenuePlanner.Helpers.Common.maxLengthDollar"';
                    }
                    else {
                        $html += ' class="priceValue"  maxlength="@RevenuePlanner.Helpers.Common.maxLengthPriceValue"';
                    }

                    for (k in _actualData) {
                        var comStr1 = _actualData[k].title + _actualData[k].period;
                        var comStr2 = arrStage[p] + "Y" + j;
                        if (comStr1 == comStr2) {
                            $html += 'value="' + _actualData[k].actualValue + '"';
                        }
                        //updateBy = _actualData[k].UpdateBy;
                        stat = _actualData[k].IsUpdate;
                    }
                    $html += ' ></input></td>';
                }
                $html += '</tr>';
            }

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            $html += '<tr id=' + "tr" + _id + "Cost" + ' TacticId=' + _id + '>';
            for (var j = 1; j <= (12 * parseInt(_YearDiffrence + 1)) ; j = j + 1) {
                var newCounterTactic = j - 1;
                var tdId = _id + "-" + "Cost" + "-Y" + j;
                var divId = _id + "Cost-Y" + j;
                $html += '<td>';
                if (_LineItemsData.length <= 0) {
                    $html += '<input id="' + tdId + '" placeholder="---" '; // Modified by Sohel Pathan on 02/09/2014 for Internal Review Point
                    $html += ' class="currency_dollar "  maxlength="@RevenuePlanner.Helpers.Common.maxLengthDollar"';
                    $html += 'value="' + FormatCurrency(_costActualData[newCounterTactic].Cost, true) + '"';
                    $html += ' ></input>';
                }
                else {
                    $html += '<div id="' + divId + '" class="table-info-actual-left addFormatterActualCurrency " style="float: right;">' + FormatCurrency(_costActualData[newCounterTactic].Cost, true) + '</div>';
                }
                $html += '</td>';
            }
            $html += '</tr>';

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
            for (var p = 0; p < _LineItemsData.length; p = p + 1) {
                //// Modified by Arpita Soni on 01/12/2015 for ticket #1093
                var TacticId = _id;
                var idtr = "tr" + _LineItemsData[p].id + TacticId;
                $html += '<tr id=' + idtr + ' TacticId=' + _id + '>';
                for (var j = 1; j <= (12 * parseInt(_YearDiffrence + 1)) ; j = j + 1) {
                    var tdId = _LineItemsData[p].id + "-" + TacticId + "-Y" + j;
                    var ClassName = "currency_dollar" + " " + _id + "Line-Y" + j;
                    ClassName = _id + "_Line " + ClassName;
                    $html += '<td><input id="' + tdId + '" placeholder="---" '; // Modified by Sohel Pathan on 02/09/2014 for Internal Review Point
                    $html += ' class="' + ClassName + '"  maxlength="@RevenuePlanner.Helpers.Common.maxLengthPriceValue"';

                    var newCounter = j - 1;
                    var Data = _LineItemsData[p].LineItemActual[newCounter];

                    if (typeof Data != 'undefined') {
                        var val = _LineItemsData[p].LineItemActual[newCounter].Cost;
                        if (val != null && val != 'undefined' && val.length > 0) {
                            $html += 'value="' + FormatCurrency(_LineItemsData[p].LineItemActual[newCounter].Cost, true) + '"';
                        }
                        //$html += 'value="' +  + '"';
                    }
                    else {
                        $html += 'value="' + 0 + '"';
                    }

                    $html += ' ></input></td>';
                }
                $html += '</tr>';
            }

            $html += '</tbody>' +
                '</table>' +
                '</div>' +
                '</div>' +
                '<div class="shadow-scroll-table-mask-right"></div>' +
                '</div>' +
                '</div>' +
            '</div>' +
        '</div>' +
    '<div id="collapse' + _id + '" class="accordion-body collapse colTitle' + _id + '" style="height: auto" Tactitle="' + _title + '">' +
          '<div class="accordion-inner">';
            //Modified by Bhumika for #1755 on 4/3/2016 for UI issues.
            for (var i = 0; i < arrStage.length; i++) {
                if (arrStage[i] == '@Enums.InspectStageValues[Enums.InspectStage.ProjectedStageValue.ToString()].ToString()') {
                    $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">' + tacticStageTitle + '</span><input type="hidden" id="hdnProjectedStageValueTitle' + _id + '" value="' + tacticStageTitle + '" /><span class="table-info-actual-left-wraper">' +
                                                                      '<span class="table-info-actual-left truncate addFormatterActualNumber" id="lblProjectedStageValue' + _id + '">' +
                                                    _projectedStageValue +
                                            '</span>' +
                                                '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber" id="ActuallblPProjectedStageValue' + _id + '">' +
                                                    _projectedStageValueActual +
                                            '</span>' +
                                            '<input type="hidden" id="hdnActuallblPProjectedStageValue' + _id + '" value=" ' + _projectedStageValueActual + ' " />' +   //// Added by Sohel Pathan on 27/08/2014 for Internal Review Points
                                        '</span>' +
                                    '</div></div>';
                }
                else if (arrStage[i].toLowerCase() == '@Common.StageCodeMQL') {
                    MQlTitle = '@Html.LabelForMQL("MQL")';
                    $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">' + MQlTitle + '</span><span class="table-info-actual-left-wraper">' +
                                                    '<span class="table-info-actual-left truncate addFormatterActualNumber" id="ProjectedlblPMQL' + _id + '">' +
                                                        _mqlProjected +
                                                    '</span>' +
                                                    '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber" id="ActuallblPMQL' + _id + '">' +
                                                        _mqlActual +
                                                    '</span>' +
                                                    '<input type="hidden" id="hdnActuallblPMQL' + _id + '" value=" ' + _mqlActual + ' " />' +       //// Added by Sohel Pathan on 27/08/2014 for Internal Review Points
                                                '</span>' +
                                            '</div></div>';
                }
        }

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">@Html.LabelForCW("CW")</span><span class="table-info-actual-left-wraper">' +
                                        '<span class="table-info-actual-left truncate addFormatterActualNumber" id="ProjectedlblValueCW' + _id + '">' +
                                            number_format(_cwProjected, 0, 0, ',') +    // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                        '</span>' +
                                        '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber" id="ActuallblPCW' + _id + '">' +
                                            _cwActual +
                                        '</span>' +
                                    '</span>' +
                                '</div></div>';

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">Revenue</span><span class="table-info-actual-left-wraper">' +
                                        '<span class="table-info-actual-left truncate setBudget" id="ProjectedlblValueRevenue' + _id + '">' +    // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                            FormatCurrency(_revenueProjected, true) +   // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                        '</span>' +
                                        '<span orignal-value="' + _revenueActual + '" class="table-info-actual-left table-info-actual-width truncate setBudget" id="ActuallblCRevenue' + _id + '">' +    // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                            FormatCurrency(_revenueActual, true) +  // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                        '</span>' +
                                        '<input type="hidden" id="hdnProjectedlblValueRevenue' + _id + '" value=" ' + _revenueProjected + ' " />' +       //// Added by Sohel Pathan on 10/09/2014 for Internal Review Points
                                    '</span>' +
                                '</div></div>';

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">Cost</span>' +
                            '<span id="border-right" class="table-info-actual-left-wraper">' +
                                '<span class="table-info-actual-left truncate setBudget" id="ProjectedlblCCost' + _id + '">' +   // Modified by Sohel Pathan on 15/09/2014 for PL ticket #760
                                    FormatCurrency(_costProjected, true) +  // Modified by Sohel Pathan on 15/09/2014 for PL ticket #760
                                '</span>';

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        $html += '<span orignal-value="' + _costActual + '" id="ActuallblCCost' + _id + '" class="table-info-actual-left table-info-actual-width truncate setBudget">' + FormatCurrency(_costActual, true) + '</span>';   // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
        $html += '<input type="hidden" id="hdnProjectedlblCCost' + _id + '" value=" ' + _costProjected + ' " />';       //// Added by Sohel Pathan on 10/09/2014 for Internal Review Points
        $html += '</span>' +
                        '</div></div>';

        //Added By : Kalpesh Sharma #735 Actual cost - Changes to add actuals screen 
        for (line in _LineItemsData) {
            //// Modified by Arpita Soni on 01/12/2015 for ticket #1093
            var TacticId = _id;
            $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="inner-lineItem truncate testTacticTitle"  title="' + _LineItemsData[line].Title + '">' + _LineItemsData[line].Title +
                                         '</span><span id="border-right" class="table-info-actual-left-wraper">' +
                                             '<span class="table-info-actual-left truncate setBudget" id="lineItemProjectedCost' + _LineItemsData[line].id + '">' +  // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                                 FormatCurrency(_LineItemsData[line].LineItemCost, true) +  // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                             '</span>' +
                                             '<span lineValue="' + _LineItemsData[line].LineItemActualCost + '" class="table-info-actual-left table-info-actual-width setBudget lineItemActualsValues' + TacticId + '" style="float: right;" id="ActuallblP' + TacticId + _LineItemsData[line].id + '">' +  // Modified by Arpita Soni on 01/12/2015 for PL ticket #1093
                                              FormatCurrency(_LineItemsData[line].LineItemActualCost, true) +   // Modified by Sohel Pathan on 12/09/2014 for PL ticket #760
                                '</span>' +
                            '</span>' +
                        '</div></div>';
        }

        $html += '<div class="body-toogle-actual"><div class="body-toogle-left"><span class="testTacticTitle">ROI</span>' +
                                '<span id="border-right" class="table-info-actual-left-wraper">' +
                                    '<span class="table-info-actual-left truncate" id="ProjectedROI' + _id + '">' +
                                        _roiProjected.toFixed(2) +
                                    '</span>' +
                                    '<span class="table-info-actual-left table-info-actual-width truncate addFormatterActualNumber " id="ActualROI' + _id + '">' +
                                        _roiActual.toFixed(2) +
                                    '</span>' +
                                '</span>' +
                            '</div></div>';

        $html += '<div class="body-toogle-actual">' +
                        '<div class="wrapper-toogle-actual-buttons">' +
                        '<div class="pull-left" style="width:315px;">' +
                        '<label id="last-synced" class="pull-left margin-top6 margin-bottom0" style="line-height:10px;">' + _LastSync + '</label>' +
                        '<label id="last-updated" class="pull-left margin-bottom0">' + _modifiedBy + '</label></div>';

        if (IsTacticEditable) {
            $html += '<button id="BtnShareTactic' + _id + '" tacticId="' + _id + '" class="btn btn-blue text-shadow-blue source-sans-proregular share-tactic-icon button-inspect-result-modal pull-right" type="button"><span class="flag-icon"></span>Share Tactic</button>' +
                     '<button id="UpdateResult" stageId="' + tacticStageId + '" tacticId="' + _id + '" class="btn btn-blue text-shadow-blue source-sans-proregular button-inspect-result-modal pull-right margin-right20" type="button"><span class="flag-icon"></span>Update Actuals</button>';
        }

        $html += '</div>' +
                   '</div>' +
                   '</div>' +
               '</div>' +
             '</div>';
            
        $tableActuals.append($html);

    }//addRowActual
    function maskWidht() {
        var widthHeader = $("#accordion2").width(),
            //#598 Added by Kalpesh Sharma : Add Actuals: Inappropriate Display of Add Actuals Tactics
            widthRigth = widthHeader - 662;

        $(".header-toogle-actual-right").width(widthRigth);
        $(".table-actual-mask").width(widthRigth);
        $('.table-actual-mask').scrollLeft(0);
        $(".accordion-actuals .accordion-heading").find('.table-actual-mask').next().css({ "margin-left": widthRigth });
        return this;
    };
    function animateMask(mask, value) {
        $(mask).animate({
            height: value
        }, 300, function () {
            // Animation complete
        });
    };

    //Added by Mitesh Vaishnav for PL ticket #972 - Add Actuals - Filter section formatting
    var SelectedCustomFieldOption;
    function toggleTacticType(obj) {
        var id = $(obj).attr('id').replace("Cb", "");
        if ($(obj).is(':checked')) {
            $("#li" + id).addClass("close-list");
        }
        else {
            $("#li" + id).removeClass("close-list");
        }
        filters.TacticTypeids = [];
        $("#ulTacticType li input[type=checkbox]").each(function () {
            var chkid = $(this).attr("id");
            if ($(this).is(':checked')) {
                filters.TacticTypeids.push(chkid.replace("CbTT", ""));
            }
        });
        checkedTTcount = $("#ulTacticType li input:checkbox:checked").length;
        $('#cTTcount').text(checkedTTcount);
    }

    function removeByValue(arr, val) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i] == val) {
                arr.splice(i, 1);
                break;
            }
        }
    }

    var SavePresetValue = false;
    function UpdateResult() {
        if (SavePresetValue == false) {
            SaveLastSetofViews();
        }
        displayConfirmCommon("CallAjax();");
        SavePresetValue = false;
        UpdateSelectedFilters();
        //CallAjax();
    }
    ////Added to set filters count and selected filters name : 1853 By Maitri Gandhi
    function UpdateSelectedFilters() {
        //Set Custom Field Filters
        $("#ulSelectedFilter").find("li #CustomFields .sidebarliwidthSelected-right").text("");
        var CheckedCounter = 0, AllCounter = 0, CurrentText = "", id = null;
        $("#divCustomFieldsFilter").find("div.accordion").each(function () {
            CheckedCounter = 0; AllCounter = 0; CurrentText = ""; id = null;
            if ($(this).find("input[type=checkbox]") != null || $(this).find("input[type=checkbox]") != "") {
                AllCounter = $(this).find("input[type=checkbox]").length;
                CheckedCounter = $(this).find("input[type=checkbox]:checked").length;
                $(this).find("input[type=checkbox]:checked").each(function () {

                    CurrentText = CurrentText + ", " + $($(this).parent()).find("span.sidebarliwidth").text();
                });
            }
            id = this.id;
            if (id != null && id != "" && id.indexOf("-") > -1) {
                id = this.id.split("-")[1];
            }
            if (CheckedCounter == AllCounter) {
                $("#ulSelectedFilter").find("#lstCustomFieldSelected_" + id).text(FiltersAll);
            }
            else {
                if (CheckedCounter == 0) {
                    $("#ulSelectedFilter").find("#lstCustomFieldSelected_" + id).text(FiltersNone);
                    $("#SelectedCustomFilter_" + id).text("0");

                }
                else {
                    CurrentText = CurrentText.substring(1);
                    $("#ulSelectedFilter").find("#lstCustomFieldSelected_" + id).text(CurrentText);
                }
            }
        });
        //Set Static-Default Field Filters
        //$("#lstPlanSelected").text($(".plantitle div a").text());
        selectedFilters.StatusIds = [];
        selectedFilters.ownerName = [];
        selectedFilters.tacticTypeTitle = [];
        selectedFilters.yearIds = [];
        selectedFilters.planName = [];
        $("#ulSelectedOwner li input[type=checkbox]:checked").each(function () {
            selectedFilters.ownerName.push($(this).attr('ownertitle').toString());

        });
        if (selectedFilters.ownerName.length == 0) {
            $('#lstOwner').text(FiltersNone);
        }
        else if ($("#ulSelectedOwner li").length == selectedFilters.ownerName.length) {
            $('#lstOwner').text(FiltersAll);
        }
        else {
            $('#lstOwner').text(selectedFilters.ownerName.join(", "));
        }

        $("#ulTacticType li input[type=checkbox]:checked").each(function () {

            selectedFilters.tacticTypeTitle.push($(this).attr('tactictypetitle').toString());
        });
        if (selectedFilters.tacticTypeTitle.length == 0) {
            $('#lstTType').text(FiltersNone);
        }
        else if ($("#ulTacticType li").length == selectedFilters.tacticTypeTitle.length) {

            $('#lstTType').text(FiltersAll);
        }
        else {
            $('#lstTType').text(selectedFilters.tacticTypeTitle.join(", "));
        }

        checkedTTcount = selectedFilters.tacticTypeTitle.length;
        $('#cTTcount').text(checkedTTcount);

        checkedOwnercount = selectedFilters.ownerName.length;
        $('#cOwnercount').text(checkedOwnercount);
    }

    function toggleCustomFields(obj, CustFieldId, count) {
        var id = $(obj).attr('id');
        var SelectedCustomFields = parseInt($("#SelectedCustomFilter_" + CustFieldId).text());
        if ($(obj).is(':checked')) {
            $("#li_" + id).addClass("close-list");
            SelectedCustomFields++;
            $("#SelectedCustomFilter_" + CustFieldId).text(SelectedCustomFields);
        }
        else {
            $("#li_" + id).removeClass("close-list");
            SelectedCustomFields--;
            $("#SelectedCustomFilter_" + CustFieldId).text(SelectedCustomFields);
        }
    }

    function toggleOwner(obj) {
        var id = $(obj).attr('id');
        if ($(obj).is(':checked')) {
            $("#liOwner" + id).addClass("close-list");
        }
        else {
            $("#liOwner" + id).removeClass("close-list");
        }

        filters.OwnerIds = [];
        $("#ulSelectedOwner li input[type=checkbox]").each(function () {
            var chkid = $(this).attr("id");
            if ($(this).is(':checked')) {
                filters.OwnerIds.push(chkid);
            }
        });
        checkedOwnercount = $("#ulSelectedOwner li input:checkbox:checked").length;
        $('#cOwnercount').text(checkedOwnercount);
    }

    function BulkOwnerOperation(selection) {
        if (selection) {
            $("#ulSelectedOwner li").each(function (i) {
                $(this).addClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).attr("checked", "checked");
            });
        }
        else {
            $("#ulSelectedOwner li").each(function (i) {
                $(this).removeClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).removeAttr("checked");
            });
        }
        checkedOwnercount = $("#ulSelectedOwner li input:checkbox:checked").length;
        $('#cOwnercount').text(checkedOwnercount);
    }

    function BulkCustomFieldOperation(selection, customFieldId, TotalCount) {
        if (selection) {
            $('#ulSelected-' + customFieldId + ' li').each(function () {
                $(this).addClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).attr("checked", "checked");
            });
            $("#SelectedCustomFilter_" + customFieldId).text(TotalCount);
        }
        else {
            $('#ulSelected-' + customFieldId + ' li').each(function (i) {
                $(this).removeClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).removeAttr("checked");
            });
            $("#SelectedCustomFilter_" + customFieldId).text("0");
        }
    }
    //  var TacticDeselectAll = false;
    function BulkTTOperation(selection) {
        if (selection) {
            $("#ulTacticType li").each(function (i) {
                $(this).addClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).attr("checked", "checked");
            });
        }
        else {
            //    TacticDeselectAll = true;
            $("#ulTacticType li").each(function (i) {
                $(this).removeClass("close-list");
                var chkid = $(this).find("input[type=checkbox]").attr("id");
                $("#" + chkid).removeAttr("checked");
            });
        }
        checkedTTcount = $("#ulTacticType li input:checkbox:checked").length;
        $('#cTTcount').text(checkedTTcount);
    }

    function SaveAsPreset() {

        var IsAnyPlanSelected = $('#ulSelectedPlans').find("li").hasClass("close-list");
        var IsAnyCustomFieldSelected = $('#divCustomFieldsFilter').find("li").hasClass("close-list");
        var IsAnyTTSelected = $('#ulTacticType').find("li").hasClass("close-list");
        var IsAnyStatusSelected = $('#ulStatus').find("li").hasClass("close-list");
        var IsAnyOwnerSelected = $('#ulSelectedOwner').find("li").hasClass("close-list");
        if (!IsAnyCustomFieldSelected && !IsAnyPlanSelected && !IsAnyTTSelected && !IsAnyStatusSelected && !IsAnyOwnerSelected) {
            alert('Please select at least one filter');
            return false;
        }
        else {
            $("#content_SaveFilters").css("display", "block");
            $("#DivButtonsHome").css("display", "none");
            $("#Filtersidebar").css("display", "none");


        }

    }

    function ClearAllPreset() {

        BulkTTOperation(false);
        //Added by kausha for ticket no #1836
        BulkOwnerOperation(false);
        //Commented by kausha for ticket no #1836
        // BulkPlanOperation(false);
        //BulkStatusOperation(false);
        $('#divCustomFieldsFilter').find("li").each(function (i) {
            $(this).removeClass("close-list");
            var chkid = $(this).find("input[type=checkbox]").attr("id");
            $("#" + chkid).removeAttr("checked");
        });

        UpdateSelectedFilters();
    }

    function LoadPreset() {

        var isLoadPreset = true;
        $.ajax({
            type: 'POST',
            url: '@Url.Action("LastSetOfViews", "Home")',
            data: {
                isLoadPreset: isLoadPreset,
            },
            //dataType: "json",
            async: false,
            success: function (data) {
                if (data != null) {
                    $('#DefaultFilters').css('display', 'block');
                    $('#DefaultFilters').html(data);

                }
                else {
                    $('#DefaultFilters').css('display', 'none');
                }


            }

        });
        $("#successMessageSidebar").css("display", "none");
        $("#DefaultFilters").css("display", "block");
        $("#DivButtonsHome").css("display", "none");
        $("#Filtersidebar").css("display", "none");
        //  $("#displaydata").css("display", "none");

    }

    function SavePreset() {

        var ViewName = $("#txtPresetName").val();
        if (ViewName.trim() == null || ViewName.trim() == "") {
            $("#successMessageSidebar").css("display", "none");
            $('div[id=errorMessageMainSidebar]').each(function () {
                if ($(this).parent().is(':visible')) {
                    $(this).show();
                    $(this).find("span[id=spanErrorMessageRole]").text('@Common.objCached.ProvidePresetName');
                    // $(this).slideDown(600);
                    //$(this).slideDown(600).delay(3000).slideUp(600);
                }
            });
            $("#txtPresetName").val("");
        }
        else {
            SavePresetValue = true;
            SaveLastSetofViews(ViewName.trim());
            UpdateResult()
        }


    }

    function CancelSavePreset() {
        $("#txtPresetName").val("");
        $("#errorMessageMainSidebar").css("display", "none");
        $("#successMessageSidebar").css("display", "none");
        $("#successMessageLoadPreset").css("display", "none");
        $("#content_SaveFilters").css("display", "none");
        $("#DefaultFilters").css("display", "none");
        $("#DivButtonsHome").css("display", "block");
        $("#Filtersidebar").css("display", "block");
    }


</script>
