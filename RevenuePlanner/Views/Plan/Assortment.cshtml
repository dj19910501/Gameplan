@using RevenuePlanner.Helpers
@{
    ViewBag.Title = ViewBag.ActiveMenu;
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Campaigns";
    string Planid = Convert.ToString(RevenuePlanner.Helpers.Sessions.PlanId);
    bool IsPlanCreateAuthorized = (bool)ViewBag.IsPlanCreateAuthorized;
    ViewBag.PageTitle = "Assortment";//Added by Mitesh Vaishnav on 11/07/2014 for functional review point 49   
}
<!--<link rel="stylesheet" href="@Url.Content("~/Content/css/NaturalLanguageForm/default.css")" type="text/css" />-->
<link rel="stylesheet" href="@Url.Content("~/Content/css/NaturalLanguageForm/component.css")" type="text/css" />
<script type="text/javascript" src="@Url.Content("~/Scripts/js/NaturalLanguageForm/modernizr.custom.js")"></script>
@section Sidebar
{
    @Html.Partial("~/Views/Plan/_plan.cshtml")
}
@{
    var pm = (RevenuePlanner.Models.PlanModel)ViewBag.PlanDefinition;
}
<!--success message-->
<div id="successMessageDuplicatePlan" class="alert hide alert-success message-position-small">
    <a class="close">×</a>
    <div id="cSuccessDuplicatePlan"></div>
</div>
<!--success message-->
<!--error message-->
<div id="errorMessageDuplicatePlan" class="alert hide alert-error message-position-small">
    <a class="close">×</a>
    <div id="cErrorDuplicatePlan"></div>
</div>
@Html.Hidden("hdnYear", pm.Year, new { id = "hdnYear" })
<!--error message-->
<table class="light-blue-background margin5 element-disable">
    <tbody>
        <tr>
            <td>
                <div id="nl-form" class="nl-form nomargin pull-left form-plan-mini padding-assortment">
                    <div class="gray-title-steps source-sans-probold">1.Plan definition</div>
                    <div class="spanPlanDefinition">
                        I'm using the <span>@pm.ModelTitle</span> model to create a new plan called <span id="spanTitle">@pm.Title</span> in <span>@pm.Year</span> that generates <span id="spanMQl">@pm.MQLDisplay</span> @Html.LabelForMQL("MQL") with a budget of <span id="spanBudget">@pm.Budget</span>.
                    </div>
                </div>
            </td>
            @*	<td class="width100px bg-content-blue">
									<button class="btn btn-blue text-shadow-blue source-sans-proregular padding-side20" type="button">Next </button>
								</td>*@
        </tr>
    </tbody>
</table>
<script type="text/javascript" src="@Url.Content("~/Scripts/js/NaturalLanguageForm/nlform.js")"></script>
<script>
    var nlform = new NLForm(document.getElementById('nl-form'));
</script>
<div class="light-blue-background close-icon margin5 padding15 padding-bottom0">
    <div class="gray-title-steps source-sans-probold cf">
        <span class="pull-left width55">2.Marketing Activities</span>
        <span class="pull-right width100px text-right margin-right50">Programs</span>
        <span class="pull-right width150px text-right tipsyclass">Cost</span>
        <span class="pull-right width100px text-right ">@Html.LabelForMQL("MQL")</span>


    </div>
    <!--Second Accordion-->
    <div id="accordion" class="accordion-campaign">

        <div class='accordion-group' id="campaignAccordion">

            <!--elements are add dynamically with javascript (view script.js file)-->

        </div>
        <!--accordion-group-->
    </div>
    <!--end accordion-->
</div>
<div class="stripe-border improvement-area margin5">
<div class="light-blue-background close-icon  padding15 padding-bottom0">
    <div class="gray-title-steps source-sans-probold cf">
        <span class="pull-left width55">3.Improvement Activities</span>
        <span class="pull-right width100px text-right margin-right50">Programs</span>
        <span class="pull-right width150px text-right">Cost</span>
        <span class="pull-right width100px text-right">@Html.LabelForMQL("MQL")</span>


    </div>
    <!--Second Accordion-->
    <div id="improvementaccordion" class="accordion-campaign">

        <div class='accordion-group' id="improvementAccordionGroup">

            <!--elements are add dynamically with javascript (view script.js file)-->

        </div>
        <!--accordion-group-->
    </div>
    <!--end accordion-->
</div>
    </div>
<div class="padding-content" style="padding-bottom:150px;" id="divSuggestionBox"> <!-- added by kapil - added padding for #415 -->
    <button class="btn btn-blue btn-large text-shadow-blue source-sans-proregular pull-left font-size14" type="button" id="btnSaveAndContinue">Save & Continue</button>
</div>
<div id="DivPartialViewForDeleteImpTactic">
</div>
<div id="divBackground" class="modal-backdrop fade in" style="display: none"></div>
@Html.Hidden("hdnMsg", (string)ViewBag.Msg, new { id = "hdnMsg" })
@Html.Hidden("hdnisError", (bool)ViewBag.isError, new { id = "hdnisError" })
<script type="text/javascript">
    var campaign = null;
    var ImprovementTactic = null;
    // Added By Bhavesh
    // PL Ticket 289,377,378
    var RecommendedImprovementTacticType = null;
    var SuggestionIMPTacticIdList = [];
    var sortText = null;
    var isasc = true;
    var isADS = false;
    var isConversion = true;
    var isLoadSuggestion = false;
    var isImprovementTacticExits = false;
    var isMarketingTacticExits = false;
    var mqlTotal = 0;
    var costTotal = 0;
    var programTotal = 0;
    var isApply = false;
    CampaignID = @ViewBag.CampaignID
    ProgramID = @ViewBag.ProgramID
    ImprovementPlanProgramId = @ViewBag.ImprovementPlanProgramId
    $("#spanMQl").text(FormatCommas($("#spanMQl").text(), false));

    //Added By : Kalpesh Sharma
    //PL #508 Set format for label in tool tip
    SetLabelFormaterWithTipsy("#spanBudget");

    $("#spanBudget").text(FormatCurrency($("#spanBudget").text(), false));
    var spantitle = $("#spanTitle").html();
    if (spantitle.length >= 70) {
        $("#spanTitle").html($("#spanTitle").html().substring(0, 70) + "..");
        $("#spanTitle").prop('title', spantitle);
    }

    

    var ismsg = $("#hdnMsg").val();
    var hdnisError = $("#hdnisError").val();
    
    /*close x event on message*/
    $("#successMessageDuplicatePlan").find(".close").click(function (e) {
        e.stopPropagation();
        e.preventDefault();
        $(this).closest(".alert").slideUp(300);   /*SlideUp value change 1200 to 300 by Mitesh Vaishnav on 07 july 2014*/
    });

    $("#errorMessageDuplicatePlan").find(".close").click(function (e) {
        e.stopPropagation();
        e.preventDefault();
        $(this).closest(".alert").slideUp(300);/*SlideUp value change 1200 to 300 by Mitesh Vaishnav on 07 july 2014*/
    });

    function DuplicatePlan() {
        $.ajax({
            type: 'POST',
            url: '@Url.Content("~/Plan/DuplicatePlan/")',
            dataType: "json",
            success: function (data) {
                if (data.isSuccess == true) {
                    var url = '@Url.Content("~/Plan/Assortment")';
                    window.location.href = url;
                }
                else {
                    alert('Error');
                }
            }
        });
    }

    $(document).ready(function () {
        $('.grey-container-full .gray-container-button a.more').click(function () {
            $('.grey-container-content').slideDown();
            $(this).hide();
            $('.grey-container-full .gray-container-button a.less').show();
        });
        $('.grey-container-full .gray-container-button a.less').click(function () {
            $('.grey-container-content').slideUp();
            $(this).hide();
            $('.grey-container-full .gray-container-button a.more').show();
        });

        $('.changes').html('');
        var url = '@Url.Content("~/Home/LoadChangeLog")';
        $('.changes').load(url + '?objectId=' + "@RevenuePlanner.Helpers.Sessions.PlanId");


        $('#BtnGroup').click(function (e) {
            if ($(this).html().toLowerCase() == "duplicate") {
                //CheckUserSession("#BtnGroup", true);
                //if (reason == 'user') {
                //    return false;
                //}
                //else {
                //DuplicatePlan();
                //Dharmraj 11July2014 : 547 (Warning of data loss during make duplicate plan)
                displayConfirmCommon('DuplicatePlan();');

                //}
            }
            else {
                //Dharmraj 11July2014 : 547 (Warning of data loss during new plan creation)
                @*var url = '@Url.Content("~/Plan/Create/0")';
                window.location.href = url;*@
                displayconfirm('@Url.Content("~/Plan/Create/0")');

            }
        });

        var Assortment = 'Assortment';
        //slidepanel animation
        $('[data-slidepanel]').slidepanel({
            orientation: 'right',
            mode: 'overlay'
        });

        //function to change arrows on accordions 
        $('.accordion').collapse({
            toggle: false
        }).on('show', function (e) {

            $(e.target).parent().find(".chevron-right").removeClass("chevron-right").addClass("chevron-down");
        }).on('hide', function (e) {

            $(e.target).parent().find(".chevron-down").removeClass("chevron-down").addClass("chevron-right");
        });

        //function to change arrows on accordions 
        $('.accordion-campaign').collapse({
            toggle: false
        }).on('show', function (e) {
            $(e.target).prev().find(".chevron-right").removeClass("chevron-right").addClass("chevron-down");
        }).on('hide', function (e) {

            $(e.target).prev().find(".chevron-down").removeClass("chevron-down").addClass("chevron-right");
        });

        //click event on accordion-toggle elements to verify height of slimScrollDiv container and show or hidden shadow in the bottom of nav.
        $('.colors .accordion-toggle').click(function () {
            var h = $(".slimScrollDiv").height();
            if (h >= 225 && h < 230) {
                $(".shadow-scroll").css('visibility', 'visible');
            } else {
                $(".shadow-scroll").css('visibility', 'hidden');
            }
        });

        //scroll right sidebar form
        // commented by kapil to remove extra space from bottom
        /*$(function () {
            $('.scrolled_div_form').slimScroll({
                height: 'auto',
                alwaysVisible: true,
                distance: '-10px',
                wheelStep: 3,
                allowPageScroll: false,
                disableFadeOut: false
            });
        });*/

        /*change color on input title tactic when input has a value*/
        $('#t_title').change(function () {
            if ($(this).val() == "") {
                $(this).addClass("error");
            }
            else {
                $(this).removeClass("error");
            }
        });

        $(document).on("click", ".add-icon.campaign", function (e) {
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            $("#slidepanel").css("display", "block");
            //$('#slidepanel').load('@Url.Content("~/Plan/CreateCampaign")');
            $('#slidepanel-container').load('@Url.Content("~/Plan/CreateCampaign")', AssignDefaultValue);
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
            e.preventDefault(); //// Added by :- Sohel Pathan on 24/24/2014 for Intenal Review Points #8 to solve scrolling issue 
        });

        $(document).on("click", ".blue-bg-text", function (e) {
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            var idCampaing = $(this).parent().parent().attr('id');
            //displayconfirmForCampaignEvent(idCampaing);
            displayConfirmCommon('campaignCommonClick(' + idCampaing + ');');

            @*$("#slidepanel").css("display", "block");
            var idCampaing = $(this).parent().parent().attr('id');
            if (idCampaing == 0) {
                $('#slidepanel-container').load('@Url.Content("~/Plan/CreateCampaign")', AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditCampaign")';
                //$('#slidepanel').load(url + '?id=' + idCampaing + '&RedirectType=' + Assortment);
                $('#slidepanel-container').load(url + '?id=' + idCampaing + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();*@
            e.preventDefault(); //// Added by :- Sohel Pathan on 24/24/2014 for Intenal Review Points #8 to solve scrolling issue
        });


        //Dharmraj Start 8July2014 Common function to handle tactic click event
        function campaignCommonClick(id) {
            $("#slidepanel").css("display", "block");
            if (id == 0) {
                $('#slidepanel-container').load('@Url.Content("~/Plan/CreateCampaign")', AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditCampaign")';
                //$('#slidepanel').load(url + '?id=' + idCampaing + '&RedirectType=' + Assortment);
                $('#slidepanel-container').load(url + '?id=' + id + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
        }

        //Dharmraj Start 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        //function displayconfirmForCampaignEvent(id) {
        //    if (isDataChanged()) {
        //        $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?<br><a id='btnConfirmOK' class='CursorHand' style='font-weight:bold;color:gray;'>Ok</a>&nbsp;&nbsp;<a style='font-weight:bold;color:gray;' id='confirmClose' href='#'>Cancel</a>");
        //        $("#errorMessageDuplicatePlan").slideDown(3000);
        //        $("#btnConfirmOK").click(function () {
        //            //alert(id);
        //            $('#cErrorDuplicatePlan').html("");
        //            $("#errorMessageDuplicatePlan").hide();
        //            campaignCommonClick(id);
        //        });
        //    }
        //    else {
        //        campaignCommonClick(id);
        //    }
        //}

        //Manoj Start 28Jan2014 : Bug-12 (User can lose data via navigation in application)
        function AssignDefaultValue() {
            $('#slidepanel').find("input[type=text],textarea,select").each(function () {
                $(this).attr("myValue", $(this).val());
                $(this).attr("title", $(this).val());//uday 2-7-2014
            });
        }
        //function to check myValue attribute values and input values that any changes made?
        function isDataChanged() {
            var changed = false;
            $('#slidepanel').find("input[type=text],textarea,select").each(function () {
                var iv = $(this).attr("myValue");
                if ($(this).val() != iv) {
                    changed = true;
                }
            });
            return changed;
        }
        $(document).on("click", "#confirmClose, .confirmClose", function (e) {
            $("#errorMessageDuplicatePlan").slideUp(3000);
        });
        $(document).on("click", "#aApplyToCalender", function (e) {
            displayconfirm('@Url.Action("ApplyToCalendar", "Plan")');
        });
        $(document).on("click", "#LeftNavInput", function (e) {
            displayconfirm('@Url.Action("Create", "Plan", new { id = Planid })');
        });
        $(document).on("click", "#LeftNavAddActivity", function (e) {
            displayconfirm('@Url.Action("Assortment", "Plan")');
        });

        //Dharmraj Start 7July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        $("#header a").not("#ContactSupport").click(function () {
            //alert($(this).attr('href'));
            if (isDataChanged()) {
                displayconfirm($(this).attr('href'));
                return false;
            }
            else {
                return true;
            }
        });
        //Dharmraj End 7July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)

        function displayconfirm(strURL) {
            if (isDataChanged()) {
                $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;<a style='color:gray;' href='" + strURL + "' class='btn-gray'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
                $("#errorMessageDuplicatePlan").slideDown(3000);
            }
            else {
                window.location.href = strURL;
            }
        }
        //Manoj End 28Jan2014 : Bug-12 (User can lose data via navigation in application)

        function displayConfirmCommon(functionName) {
            if (isDataChanged()) {
                $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;<a id='btnConfirmOK' class='btn-gray CursorHand' style='color:gray;'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
                $("#errorMessageDuplicatePlan").slideDown(3000);
                $("#btnConfirmOK").click(function () {
                    //alert(id);
                    $('#cErrorDuplicatePlan').html("");
                    $("#errorMessageDuplicatePlan").hide();
                    eval(functionName);
                });
            }
            else {
                eval(functionName);
            }
        }
        

        //Modified by Dharmraj 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        $(document).on("click", ".gray-bg-text", function (e) {
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            //$("#slidepanel").css("display", "block");
            var idProgram = $(this).parent().parent().attr('id');

            if (idProgram == 0) {
                $("a#0 span.gray-bg-text").removeClass('1');
                $(this).addClass('1');
            }

            //displayconfirmForProgramEvent(idProgram);
            displayConfirmCommon('programCommonClick(' + idProgram + ');');

            @*if (idProgram == 0) {
                var idCampaing = $(this).parent().parent().attr('data-id-campaing');
                var url = '@Url.Content("~/Plan/CreateProgram")';
                //$('#slidepanel').load(url + '?id=' + idCampaing);
                $('#slidepanel-container').load(url + '?id=' + idCampaing, AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditProgram")';
                //$('#slidepanel').load(url + '?id=' + idProgram + '&RedirectType=' + Assortment);
                $('#slidepanel-container').load(url + '?id=' + idProgram + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();*@
            e.preventDefault(); //// Added by :- Sohel Pathan on 24/24/2014 for Intenal Review Points #8 to solve scrolling issue
        });

        //Dharmraj Start 8July2014 Common function to handle tactic click event
        function programCommonClick(id) {
            $("#slidepanel").css("display", "block");
            if (id == 0) {
                var idCampaing = $("a#" + id + " span.gray-bg-text.1").parent().parent().attr('data-id-campaing');
                var url = '@Url.Content("~/Plan/CreateProgram")';
                //$('#slidepanel').load(url + '?id=' + idCampaing);
                $('#slidepanel-container').load(url + '?id=' + idCampaing, AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditProgram")';
                //$('#slidepanel').load(url + '?id=' + idProgram + '&RedirectType=' + Assortment);
                $('#slidepanel-container').load(url + '?id=' + id + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
        }

        //Dharmraj Start 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        //function displayconfirmForProgramEvent(id) {
        //    if (isDataChanged()) {
        //        $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?<br><a id='btnConfirmOK' class='CursorHand' style='font-weight:bold;color:gray;'>Ok</a>&nbsp;&nbsp;<a style='font-weight:bold;color:gray;' id='confirmClose' href='#'>Cancel</a>");
        //        $("#errorMessageDuplicatePlan").slideDown(3000);
        //        $("#btnConfirmOK").click(function () {
        //            //alert(id);
        //            $('#cErrorDuplicatePlan').html("");
        //            $("#errorMessageDuplicatePlan").hide();
        //            programCommonClick(id);
        //        });
        //    }
        //    else {
        //        programCommonClick(id);
        //    }
        //}

        $(document).on("click", ".add-icon.program", function (e) {
            var idCampaing = $(this).parent().parent().attr('data-id-campaing');
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            $("#slidepanel").css("display", "block");
            var url = '@Url.Content("~/Plan/CreateProgram")';
            //$('#slidepanel').load(url + '?id=' + idCampaing);
            $('#slidepanel-container').load(url + '?id=' + idCampaing, AssignDefaultValue);
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
            e.preventDefault(); //// Added by :- Sohel Pathan on 24/24/2014 for Intenal Review Points #8 to solve scrolling issue
        });

        //Modified by Dharmraj 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        $(document).on("click", "#divTactic", function (e) {
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            var idTactic = $(this).attr("index");
            if (idTactic == 0) {
                $('div[index=0]').removeClass('1');
                $(this).addClass('1');
            }
            
            //displayconfirmForTacticEvent(idTactic);
            displayConfirmCommon('tacticCommonClick(' + idTactic + ');');

            @*$("#slidepanel").css("display", "block");
            if (idTactic == 0) {
                var idProgram = $(this).parent().attr('data-id-program');
                var url = '@Url.Content("~/Plan/CreateTactic")';
                $('#slidepanel-container').load(url + '?id=' + idProgram, AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditTactic")';
                $('#slidepanel-container').load(url + '?id=' + idTactic + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();*@
        });

        //Dharmraj Start 8July2014 Common function to handle tactic click event
        function tacticCommonClick(id) {
            $("#slidepanel").css("display", "block");
            if (id == 0) {
                var idProgram = $('div.1[index=' + id + ']').parent().attr('data-id-program');
                var url = '@Url.Content("~/Plan/CreateTactic")';
                $('#slidepanel-container').load(url + '?id=' + idProgram, AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditTactic")';
                $('#slidepanel-container').load(url + '?id=' + id + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
        }

        //Dharmraj Start 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        //function displayconfirmForTacticEvent(id) {
        //    if (isDataChanged()) {
        //        $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?<br><a id='btnConfirmOK' class='CursorHand' style='font-weight:bold;color:gray;'>Ok</a>&nbsp;&nbsp;<a style='font-weight:bold;color:gray;' id='confirmClose' href='#'>Cancel</a>");
        //        $("#errorMessageDuplicatePlan").slideDown(3000);
        //        $("#btnConfirmOK").click(function () {
        //            //alert(id);
        //            $('#cErrorDuplicatePlan').html("");
        //            $("#errorMessageDuplicatePlan").hide();
        //            tacticCommonClick(id);
        //        });
        //    }
        //    else {
        //        tacticCommonClick(id);
        //    }
        //}

        /*
          Changed for TFS Bug  255:Plan Campaign screen - Add delete icon for tactic and campaign in the grid
          changed by : Nirav Shah on 13 feb 2014
        */
        // Change by Dharmraj to handle Warning of data loss during campaign deletion, #547
        $(document).on('click', '#delCampaign', function (e) {

            e.stopPropagation();
            var idCampaing = $(this).parent().attr('id');
            displayconfirmForDeleteEvent(idCampaing, 'campaign');
            e.stopPropagation();

            @*var uId = $(window).attr('name');
            if (confirm('Are you sure you want to delete this campaign?')) {
                var idCampaing = $(this).parent().attr('id');
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Plan/DeleteCampaign")',
                    data: {
                        ID: idCampaing,
                        RedirectType: false,
                        UserId: uId 
                    },
                    success: function (data) {
                        if (data.returnURL != 'undefined' && data.returnURL == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else {
                            if (data.redirect) {
                                window.location.href = data.redirect;
                                return;
                            }
                            if (data.errormsg) {
                                ShowError(data.errormsg);
                                return;
                            }
                        }
                    }
                });
            }
            else {
                return false;
            }*@
        });
        
        // Change by Dharmraj to handle Warning of data loss during program deletion, #547
        $(document).on('click', '.program-level a.accordion-toggle .delete-program', function (e) {
            //CheckUserSession(".program-level a.accordion-toggle .delete-program", true);
            //if (reason == 'user') {
            //    return false;
            //}

            e.stopPropagation();
            var idProgram = $(this).parent().attr('id');
            displayconfirmForDeleteEvent(idProgram, 'program');
            e.stopPropagation();

            @*var uId = $(window).attr('name');
            if (confirm('Are you sure you want to delete this program?')) {
                e.stopPropagation();
                var idProgram = $(this).parent().attr('id');
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Plan/DeleteProgram")',
                    data: {
                        ID: idProgram, UserId: uId
                    },
                    success: function (data) {
                        if (data.returnURL != 'undefined' && data.returnURL == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else {
                            if (data.redirect) {
                                window.location.href = data.redirect;
                                return;
                            }
                            if (data.errormsg) {
                                alert(data.errormsg);
                                return;
                            }
                        }
                    }
                });
            }
            else {
                return false;
            }*@
        });
        /*Changed for TFS Bug  255:Plan Campaign screen - Add delete icon for tactic and campaign in the grid
          changed by : Nirav Shah on 13 feb 2014
        */
        // Change by Dharmraj to handle Warning of data loss during tactic deletion, #547
        $(document).on('click', '.tactic-level #divTactic .delete-program', function (e) {
            //CheckUserSession(".tactic-level #divTactic .delete-program", true);
            //if (reason == 'user') {
            //    return false;
            //}

            e.stopPropagation();
            var idTactic = $(this).parent().attr('index');
            displayconfirmForDeleteEvent(idTactic, 'tactic');
            
            e.stopPropagation();
            @*var uId = $(window).attr('name');
            if (confirm('Are you sure you want to delete this tactic?')) {
                e.stopPropagation();
                var idTactic = $(this).parent().attr('index');
                $.ajax({
                    type: 'POST',
                    url: '@Url.Content("~/Plan/DeleteTactic")',
                    data: {
                        ID: idTactic,
                        RedirectType: false, UserId: uId
                    },
                    success: function (data) {
                        if (data.returnURL != 'undefined' && data.returnURL == '#') {
                            window.location = '@Url.Content("~/Login/Index")';
                        }
                        else {
                            if (data.redirect) {
                                window.location.href = data.redirect;
                                return;
                            }
                            if (data.errormsg) {
                                alert(data.errormsg);
                                return;
                            }
                        }
                    }
                });
                $("#slidepanel").css("display", "none");
            }
            else {
                $("#slidepanel").css("display", "none");
                e.stopPropagation();
                return false;
            }*@
        });
      
        // Added By Bhavesh for Delete Improvement Tactic: Date 13-March-2014
        // Change by Dharmraj to handle Warning of data loss during imp tactic deletion, #547
        $(document).on('click', '#divimpTactic #delimpTactic', function (e) {
            //CheckUserSession("#divimpTactic #delimpTactic", true);
            //if (reason == 'user') {
            //    return false;
            //}

            e.stopPropagation();
            var idTactic = $(this).parent().attr('index');
            displayconfirmForDeleteEvent(idTactic, 'impTactic');
            e.stopPropagation();

            @*var idTactic = $(this).parent().attr('index');
            var AssortmentType = true;
            $("#DivPartialViewForDeleteImpTactic").empty();
            $("#divBackground").css("display", "block");
            var url = '@Url.Content("~/Plan/ShowDeleteImprovementTactic/")';
            $("#DivPartialViewForDeleteImpTactic").load(url + '?id=' + idTactic + '&AssortmentType=' + AssortmentType + '&RedirectType=' + false);*@
        });



        //Dharmraj Start 8July2014 Common function to handle tactic/program/campaign delete event
        function deleteCommonClick(id, type) {
            if (type == "tactic") {
                //alert("tactic");
                var uId = $(window).attr('name');
                if (confirm('Are you sure you want to delete this tactic?')) {
                    //var idTactic = $(this).parent().attr('index');
                    var idTactic = id;
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/DeleteTactic")',
                        data: {
                            ID: idTactic,
                            RedirectType: false, UserId: uId
                        },
                        success: function (data) {
                            if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                window.location = '@Url.Content("~/Login/Index")';
                            }
                            else {
                                if (data.redirect) {
                                    window.location.href = data.redirect;
                                    return;
                                }
                                if (data.errormsg) {
                                    alert(data.errormsg);
                                    return;
                                }
                            }
                        }
                    });
                    $("#slidepanel").css("display", "none");
                }
                else {
                    $("#slidepanel").css("display", "none");
                    return false;
                }
            }

            if (type == "program") {
                var uId = $(window).attr('name');
                if (confirm('Are you sure you want to delete this program?')) {
                    //e.stopPropagation();
                    //var idProgram = $(this).parent().attr('id');
                    var idProgram = id;
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/DeleteProgram")',
                        data: {
                            ID: idProgram, UserId: uId
                        },
                        success: function (data) {
                            if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                window.location = '@Url.Content("~/Login/Index")';
                            }
                            else {
                                if (data.redirect) {
                                    window.location.href = data.redirect;
                                    return;
                                }
                                if (data.errormsg) {
                                    alert(data.errormsg);
                                    return;
                                }
                            }
                        }
                    });
                }
                else {
                    return false;
                }
            }

            if (type == "campaign") {
                var uId = $(window).attr('name');
                if (confirm('Are you sure you want to delete this campaign?')) {
                    //var idCampaing = $(this).parent().attr('id');
                    var idCampaing = id;
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/DeleteCampaign")',
                        data: {
                            ID: idCampaing,
                            RedirectType: false,
                            UserId: uId
                        },
                        success: function (data) {
                            if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                window.location = '@Url.Content("~/Login/Index")';
                            }
                            else {
                                if (data.redirect) {
                                    window.location.href = data.redirect;
                                    return;
                                }
                                if (data.errormsg) {
                                    ShowError(data.errormsg);
                                    return;
                                }
                            }
                        }
                    });
                }
                else {
                    return false;
                }
            }

            if (type == "impTactic") {
                //var idTactic = $(this).parent().attr('index');
                var idTactic = id;
                var AssortmentType = true;
                $("#DivPartialViewForDeleteImpTactic").empty();
                $("#divBackground").css("display", "block");
                var url = '@Url.Content("~/Plan/ShowDeleteImprovementTactic/")';
                $("#DivPartialViewForDeleteImpTactic").load(url + '?id=' + idTactic + '&AssortmentType=' + AssortmentType + '&RedirectType=' + false);
            }
        }

        //Dharmraj Start 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign deletion)
        function displayconfirmForDeleteEvent(id, type) {
            if (isDataChanged()) {
                $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;<a id='btnConfirmOK' class='btn-gray CursorHand' style='color:gray;'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
                $("#errorMessageDuplicatePlan").slideDown(3000);

                $("#btnConfirmOK").click(function () {
                    //alert(id);
                    //$("#slidepanel").is(':visible')
                    $('#cErrorDuplicatePlan').html("");
                    $("#errorMessageDuplicatePlan").hide();
                    $("#slidepanel").css("display", "none");
                    $("#slidepanel-container").empty();
                    deleteCommonClick(id, type);
                });
            }
            else {
                deleteCommonClick(id, type);
            }
        }

        $("#btnSaveAndContinue").click(function () {
            //CheckUserSession("#btnSaveAndContinue", true);
            //if (reason == 'user') {
            //    return false;
            //}
            displayconfirmForSaveContinueEvent();
            @*if (isApply) {
            $('#cErrorDuplicatePlan').html('<strong>Error! </strong> Please add at least one campaign.');
            $("#errorMessageDuplicatePlan").slideDown(3000);
        }
        else {
            // Added By Bhavesh
            // PL Ticket 289,377,378
            if (SuggestionIMPTacticIdList.length != 0) {
                if (confirm('Are you sure you want to delete the un-deployed improvement tactic? Please note that any changes to the improvement tactic owned by others won\'t be saved.')) {
                    var uId = $(window).attr('name');
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/DeleteSuggestedBoxImprovementTactic/")',
                        data: {
                            SuggestionIMPTacticIdList: SuggestionIMPTacticIdList.toString(),
                            UserId: uId
                        },
                        success: function (data) {
                            if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                window.location = '@Url.Content("~/Login/Index")';
                            }
                            else {
                                var url = '@Url.Action("ApplyToCalendar", "Plan")';
                                window.location.href = url;
                            }
                        }
                    });
                    }
                    else {
                        return false;
                    }
                }
                else {
                    var url = '@Url.Action("ApplyToCalendar", "Plan")';
                window.location.href = url;
            }
        }*@
        });


        //Dharmraj Start 11July2014 : 547 (Warning of data loss during save and comtinue)
        function displayconfirmForSaveContinueEvent() {
            if (isDataChanged()) {
                $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?&nbsp;&nbsp;&nbsp;<a id='btnConfirmOK' class='btn-gray CursorHand' style='color:gray;'>Continue</a>&nbsp;&nbsp;<a style='color:gray;' id='confirmClose' href='#' class='underline'>Cancel</a>");
                $("#errorMessageDuplicatePlan").slideDown(3000);
                $("#btnConfirmOK").click(function () {
                    //alert(id);
                    $('#cErrorDuplicatePlan').html("");
                    $("#errorMessageDuplicatePlan").hide();
                    saveAndContinueClick();
                });
            }
            else {
                saveAndContinueClick();
            }
        }

        function saveAndContinueClick() {
            //CheckUserSession("#btnSaveAndContinue", true);
            //if (reason == 'user') {
            //    return false;
            //}
            if (isApply) {
                $('#cErrorDuplicatePlan').html('<strong>Error! </strong> Please add at least one campaign.');
                $("#errorMessageDuplicatePlan").slideDown(3000);
            }
            else {
                // Added By Bhavesh
                // PL Ticket 289,377,378
                if (SuggestionIMPTacticIdList.length != 0) {
                    if (confirm('Are you sure you want to delete the un-deployed improvement tactic? Please note that any changes to the improvement tactic owned by others won\'t be saved.')) {
                        var uId = $(window).attr('name');
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Content("~/Plan/DeleteSuggestedBoxImprovementTactic/")',
                            data: {
                                SuggestionIMPTacticIdList: SuggestionIMPTacticIdList.toString(),
                                UserId: uId
                            },
                            success: function (data) {
                                if (data.returnURL != 'undefined' && data.returnURL == '#') {
                                    window.location = '@Url.Content("~/Login/Index")';
                                }
                                else {
                                    var url = '@Url.Action("ApplyToCalendar", "Plan")';
                                    window.location.href = url;
                                }
                            }
                        });
                    }
                    else {
                        return false;
                    }
                }
                else {
                    var url = '@Url.Action("ApplyToCalendar", "Plan")';
                    window.location.href = url;
                }
            }
        }
        //Dharmraj End 11July2014 : 547 (Warning of data loss during save and comtinue)

        $.ajax({
            type: 'POST',
            url: '@Url.Content("~/Plan/GetCampaign/")',
            data: {
            },
            success: function (r) {
                campaign = r;
                fillCampaignsTable();
                // call load improvement tactic beacuase it execute after campaign activity process over.
                LoadImprovementTactic();
                NumberFormatterTipsyTitle(".tipsyclassTitle", 40);
                Showmsg();
            }
        });

        function LoadClickEvents() {
            if ('@ViewBag.EditOjbect' == "Tactic" && '@ViewBag.TacticId' != 0) {
                $("[id=divTactic][index=" + @ViewBag.TacticId + "]").click();
                return false;
            }
            else if ('@ViewBag.EditOjbect' == "Program" && '@ViewBag.ProgramId' != 0) {
                //alert("Hi");
                $('.gray-bg-text').each(function () {
                    if ($(this).parent().parent().attr('id') == '@ViewBag.ProgramId') {
                            $(this).click();
                            return false;
                        }
                    });
                }
                else if ('@ViewBag.EditOjbect' == "Campaign" && '@ViewBag.CampaignId' != 0) {
                    $('.blue-bg-text').each(function () {
                        if ($(this).parent().parent().attr('id') == '@ViewBag.CampaignId') {
                            $(this).click();
                            return false;
                        }
                    });
                }
                else if ('@ViewBag.EditOjbect' == "ImprovementTactic" && '@ViewBag.TacticId' != 0) {
                    $("[id=divimpTactic][index=" + @ViewBag.TacticId + "]").find("#divPanelImp").click();
                return false;
            }
        }

        function LoadImprovementTactic() {
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/GetImprovementTactic/")',
                data: {
                },
                success: function (r) {
                    ImprovementTactic = r;
                    fillImprovementTacticTable();
                    var isImp = false;
                    if (typeof ImprovementTactic != 'undefined') {
                        if (ImprovementTactic.length) {
                            isImp = true;
                            FillGrayImprovementContainer(ImprovementTactic.length);
                            LoadClickEvents();
                        }
                    }
                    if (!isImp) {
                        FillGrayImprovementContainerEmpty();
                        LoadClickEvents();
                    }
                     NumberFormatterTipsy(".tipsyclass", 9);
                     
                    loadscript();
                }
            });
        }

        $(document).on("click", ".add-icon.impTactic", function (e) {
            
            if (!isMarketingTacticExits) {
                $("#slidepanel").css("display", "none");
                ismsg = 'Before adding any improvement tactic please add marketing activities.';
                hdnisError = 'True';
                Showmsg();
                return false;
            }
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            $("#slidepanel").css("display", "block");
            var idProgram = $(this).attr('data-id-program');
            var url = '@Url.Content("~/Plan/CreateImprovementTactic")';
             $('#slidepanel-container').load(url + '?id=' + idProgram, AssignDefaultValue);
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
        });

        //Modified by Dharmraj 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        $(document).on("click", "#divimpTactic #divPanelImp", function (e) {
            if (!isMarketingTacticExits) {
                ismsg = 'Before adding any improvement tactic please add marketing activities.';
                hdnisError = 'True';
                Showmsg();
                return false;
            }
            e.stopPropagation();
            $.ajaxSetup({ cache: false });
            var idTactic = $(this).parent().attr("index");
            //$("#slidepanel").css("display", "block");

            if (idTactic == 0) {
                $("a#divimpTactic").removeClass('1');
                $(this).parent().addClass('1');
            }
            //displayconfirmForImpTacticEvent(idTactic);
            displayConfirmCommon('impTacticCommonClick(' + idTactic + ');');

            @*if (idTactic == 0) {
                var idProgram = $(this).parent().attr('data-id-program');
                var url = '@Url.Content("~/Plan/CreateImprovementTactic")';
                $('#slidepanel-container').load(url + '?id=' + idProgram, AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditImprovementTactic")';
                $('#slidepanel-container').load(url + '?id=' + idTactic + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
             $("#slidepanel").css("right", "0px");*@
             //myApp.hidePleaseWait();
        });

        //Dharmraj Start 8July2014 Common function to handle tactic click event
        function impTacticCommonClick(id) {
            $("#slidepanel").css("display", "block");
            if (id == 0) {
                var idProgram = $("a#divimpTactic.1").attr('data-id-program');
                var url = '@Url.Content("~/Plan/CreateImprovementTactic")';
                $('#slidepanel-container').load(url + '?id=' + idProgram, AssignDefaultValue);
            }
            else {
                var url = '@Url.Content("~/Plan/EditImprovementTactic")';
                $('#slidepanel-container').load(url + '?id=' + id + '&RedirectType=' + Assortment, AssignDefaultValue);
            }
            $("#slidepanel").css("right", "0px");
            myApp.hidePleaseWait();
        }

        //Dharmraj Start 8July2014 : 547 (Warning of data loss during tactic/Program/Campaign creation)
        //function displayconfirmForImpTacticEvent(id) {
        //    if (isDataChanged()) {
        //        $('#cErrorDuplicatePlan').html("<strong>Error! </strong> You have unsaved changes. Do you wish to leave this page and lose your work?<br><a id='btnConfirmOK' class='CursorHand' style='font-weight:bold;color:gray;'>Ok</a>&nbsp;&nbsp;<a style='font-weight:bold;color:gray;' id='confirmClose' href='#'>Cancel</a>");
        //        $("#errorMessageDuplicatePlan").slideDown(3000);
        //        $("#btnConfirmOK").click(function () {
        //            //alert(id);
        //            $('#cErrorDuplicatePlan').html("");
        //            $("#errorMessageDuplicatePlan").hide();
        //            impTacticCommonClick(id);
        //        });
        //    }
        //    else {
        //        impTacticCommonClick(id);
        //    }
        //}

        function Showmsg() {
            if (ismsg != '') {
                if (hdnisError == 'True') {
                    $('#cErrorDuplicatePlan').html('<strong>Error! </strong> ' + ismsg);
                    $("#errorMessageDuplicatePlan").slideDown(3000);
                }
                else {
                    $('#cSuccessDuplicatePlan').html('<strong>Success. </strong> ' + ismsg);
                    $("#successMessageDuplicatePlan").slideDown(3000);
                    //$("#successMessageDuplicatePlan").slideUp(1200);
                }
            }
        }

        function CallForRedirectToApplyToCalender() {
            //add css class to disable hover on left navigation link when no data found
            //Start : date : 01/21/2014
            $("#aApplyToCalender").parent().parent().addClass("navdisable");
            $("#aApplyToCalender").css('cssText', 'cursor: default !important');
            //End : date : 01/21/2014
            $("#aApplyToCalender").removeAttr("onclick");
            isApply = true;
        }
        //fill campaign table with data from json
        function fillCampaignsTable() {
            if (typeof campaign != 'undefined') {
                var $html = '';
                
                if (campaign.length) {
                    for (i in campaign) {
                        mqlTotal = mqlTotal + parseFloat(campaign[i].mqls);
                        costTotal = costTotal + parseFloat(campaign[i].cost);
                        programTotal = programTotal + parseFloat(campaign[i].programs.length);
                        /*Changed for TFS Bug  255:Plan Campaign screen - Add delete icon for tactic and campaign in the grid
                         changed by : Nirav Shah on 13 feb 2014
                         before changed : 
                        */
                        addRowCampaign(i, campaign[i].id, campaign[i].title, campaign[i].description, campaign[i].cost, campaign[i].mqls, campaign[i].isOwner, campaign[i].programs, campaign[i].programs.length);
                    }
                } else {

                    $html += '<div class="accordion-header campaign-default">' +
                            '<a id="0" class="accordion-toggle chevron-right" data-toggle="collapse">' +
                                '<span class="pull-left width55"><span class="pull-left font-black">1.</span><span class="blue-bg-text campaign-name campaign-name-span">Campaign Title</span></span>' +
                                '<span class="pull-right width50px"><div class="add-icon campaign"></div></span>' +
                                '<span class="pull-right width100px text-right font-black">' + 0 + '</span>' +
                                '<span class="pull-right width150px text-right font-black tipsyclass">$' + 0 + '</span>' +
                                '<span class="pull-right width100px text-right font-black tipsyclass">' + 0 + '</span>' +
                            '</a>' +
                        '</div>';
                    CallForRedirectToApplyToCalender();

                }
                $html += '<div class="cf padding-left20">' +
                                '<div class="pull-left width55"></div>' +
                                '<div class="height40 pull-right width50px"></div>' +
                                //'<div class="total height40 pull-right width3"></div>' +
                                '<div class="total markTotal pull-right width100px text-right">' + FormatCommas(programTotal.toString(), false) + '</div>' +
                                '<div class="total markTotal pull-right width150px text-right tipsyclass costAssotment">$' + FormatCommas(costTotal.toString(), false) + '</div>' +
                                '<div class="total markTotal pull-right width100px text-right tipsyclass">' + FormatCommas(mqlTotal.toString(), false) + '</div>' +
                            '</div>';

                var $tableCampaigns = $('.accordion-campaign > #campaignAccordion');

                $tableCampaigns.append($html);

                addEventTriggerSlidepanel();

                //Fetch all the row values from the tables
                $('.costAssotment').each(function () {
                    //Added By : Kalpesh Sharma
                    //PL #508 Set format for label in tool tip
                    SetLabelFormaterWithTipsy($(this));
                });

            }
        }

        //add row in campaign table
        /*Changed for TFS Bug  255:Plan Campaign screen - Add delete icon for tactic and campaign in the grid
                     changed by : Nirav Shah on 13 feb 2014
                     before changed :        function addRowCampaign(_index, _id, _title, _description, _cost, _inqs, _mqls, _programs, _programCount) {
                    */
        function addRowCampaign(_index, _id, _title, _description, _cost, _mqls, _isOwner, _programs, _programCount) {
            var $tableCampaigns = $('.accordion-campaign > #campaignAccordion');
            var num = parseInt(_index) + 1;
            var $html = '<div class="accordion-header">' +
                        '<a id="' + _id + '" class="accordion-toggle';
            if (CampaignID == _id) {
                $html += ' chevron-down'
            }
            else {
                $html += ' chevron-right'
            }
            /*Changed for TFS Bug  255:Plan Campaign screen - Add delete icon for tactic and campaign in the grid
                     changed by : Nirav Shah on 13 feb 2014
                    */
            $html += '" data-toggle="collapse" data-parent="#accordion" href="#collapse' + _index + '">';
            if (_isOwner == 0) {
                $html += '<span class="delete-program width5" id="delCampaign"></span>';
            }
            $html += '<span class="pull-left width55"><span class="pull-left font-black">' + num + '.</span><span class="blue-bg-text campaign-name campaign-name-span tipsyclassTitle">' + _title + '</span></span>' +
                               '<span class="pull-right width50px"><div class="add-icon campaign" ></div></span>' +
                                '<span class="pull-right width100px text-right font-black ">' + FormatCommas(_programCount.toString(), false) + '</span>' +
                                '<span class="pull-right width150px text-right font-black tipsyclass costAssotment">$' + FormatCommas(_cost.toString(), false) + '</span>' +
                                '<span class="pull-right width100px text-right font-black tipsyclass">' + FormatCommas(_mqls.toString(), false) + '</span>' +
                            '</a>' +
                        '</div>' +
                        '<div id="collapse' + _index + '" class="accordion-body';
            if (CampaignID == _id) {
                $html += ' in'
            }
            $html += ' collapse program-level">' +
                            '<div class="accordion-inner">' +
                                '<div class="accordion-group">';


            if (typeof _programs != 'undefined') {

                if (_programs.length > 0) {
                    for (i in _programs) {
                        //collapseOne
                        $html += '<div class="accordion-header">' +
                                    '<a id="' + _programs[i].id + '" data-id-campaing="' + _id + '" class="accordion-toggle font-black';
                        if (ProgramID == _programs[i].id) {
                            $html += ' chevron-down'
                        }
                        else {
                            $html += ' chevron-right'
                        }
                        $html += '" data-toggle="collapse" href="#collapseTwo' + _programs[i].id + '">';
                        if (_programs[i].isOwner == 0) {
                            $html += '<span class="delete-program width5"></span>';
                        }
                        $html += '<span class="pull-left width55"><span class="gray-bg-text campaign-name campaign-name-span tipsyclassTitle">' + _programs[i].title + '</span></span>' +
                         '<span class="pull-right width50px"><div class="add-icon program" ></div></span>' +
                         '<span class="pull-right width100px text-right font-black">-</span>' +
                         '<span class="pull-right width150px text-right font-black tipsyclass costAssotment">$' + FormatCommas(_programs[i].cost.toString(), false) + '</span>' +
                         '<span class="pull-right width100px text-right font-black tipsyclass">' + FormatCommas(_programs[i].mqls.toString(), false) + '</span>' +
                     '</a>' +
                 '</div>' +

                 '<div id="collapseTwo' + _programs[i].id + '" class="accordion-body';
                        if (ProgramID == _programs[i].id) {
                            $html += ' in'
                        }
                        $html += ' collapse tactic-level">' +
                     '<div class="accordion-inner">' +
                         '<div class="accordion-group">';
                        var pid = _programs[i].id;
                        if (typeof _programs[i].tactics != 'undefined') {
                            if (_programs[i].tactics.length > 0) {
                                isMarketingTacticExits = true;
                                for (k in _programs[i].tactics) {
                                    //collapseThree
                                    /*Changed for TFS Bug  255:Plan Campaign screen - Add delete icon for tactic and campaign in the grid
                  changed by : Nirav Shah on 13 feb 2014
                  before changed : 
                        $html += '<div id="' + _programs[i].tactics[k].id + '" class="accordion-body collapse in">' +
                                               '<div id="divTactic" class="accordion-inner tactic" index="' + _programs[i].tactics[k].id + '" data-slidepanel="panel">' +
                                                  '<span class="underline">' + _programs[i].tactics[k].title + '</span>' +
                                                 '<span class="pull-right width100px text-right font-black">&nbsp;</span>' +
                                              '<span class="pull-right width100px text-right font-black">&nbsp;</span>' +
                                            '<span class="pull-right width100px text-right font-black tipsyclass">$' + FormatCommas(_programs[i].tactics[k].cost.toString(), false) + '</span>' +
                                            '<span class="pull-right text-right font-black">' + FormatCommas(_programs[i].tactics[k].mqls.toString(), false) + '</span>' +
                                                '</div>' +
                                            '</div>';
                */
                                    $html += '<div id="' + _programs[i].tactics[k].id + '" class="accordion-body collapse in">' +
                                            '<div id="divTactic" class="accordion-inner tactic CursorHand" index="' + _programs[i].tactics[k].id + '" data-slidepanel="panel">';
                                    if (_programs[i].tactics[k].isOwner == 0) {
                                        $html += '<span class="delete-program width5" id="delTactic"></span>';
                                    }
                                    $html += '<span class="underline tipsyclassTitle">' + _programs[i].tactics[k].title + '</span>' +
                                                    '<span class="pull-right width50px text-right font-black">&nbsp;</span>' +
                                              '<span class="pull-right width100px text-right font-black">&nbsp;</span>' +
                                              '<span class="pull-right width150px text-right font-black tipsyclass costAssotment">$' + FormatCommas(_programs[i].tactics[k].cost.toString(), false) + '</span>' +
                                              '<span class="pull-right width100px text-right font-black tipsyclass">' + displayTacticMQL(_programs[i].tactics[k].mqls.toString()) + '</span>' +
                                                '</div>' +
                                            '</div>';
                              
                                }
                            }
                            $html += '<div class="accordion-body collapse in" data-id-program="' + pid + '" >' +
                                        '<div id="divTactic" class="accordion-inner CursorHand" index="0">' +
                                            '<span class="underline">Select Tactic</span>' +
                                        '</div>' +
                                    '</div>';

                        }

                        $html += '</div>' +
                                '</div>' +
                            '</div>';
                    }
                } else {

                    $html += '<div class="accordion-header">' +
                                '<a id="0" class="accordion-toggle" data-id-campaing="' + _id + '" font-black" data-toggle="collapse">' +
                                    '<span class="pull-left width40"><span class="gray-bg-text campaign-name underline">Add Programs</span></span>' +
                                    '<span class="pull-right width100px"><div class="add-icon program" ></div></span>' +
                                '</a>' +
                            '</div>';
                }
                $html += '</div>' +
                            '</div>' +
                        '</div>';
            }
            $tableCampaigns.append($html);

        }

        function displayTacticMQL(MQL)
        {
            if (MQL == 'N/A') {
                return 'N/A';
            }
            else {
                return FormatCommas(MQL, false);
            }
        }

        function addEventTriggerSlidepanel() {

            $('[data-slidepanel]').unbind('slidepanel');
            $('[data-slidepanel]').slidepanel({
                orientation: 'right',
                mode: 'overlay'
            });
        }

        //fill campaign table with data from json
        function fillImprovementTacticTable() {
            var isImpCount = false;
            if (typeof ImprovementTactic != 'undefined') {
                var $html = '';
                if (ImprovementTactic.length) {
                    isImprovementTacticExits = true;
                    isImpCount = true;
                    $(".markTotal").each(function () {
                        $(this).css("color", "#D4D4D4");
                    });
                    for (i in ImprovementTactic) {
                        costTotal = costTotal + parseFloat(ImprovementTactic[i].cost);
                        addRowImprovementTactic(i, ImprovementTactic[i].id, ImprovementTactic[i].title, ImprovementTactic[i].cost, ImprovementTactic[i].isOwner, ImprovementTactic[i].ImprovementProgramId);
                    }
                } 
            }

            $html += '<div class="accordion-header campaign-default">' +
                           '<a class="accordion-toggle" data-toggle="collapse" data-id-program="' + ImprovementPlanProgramId  + '" id="divimpTactic" index="0">' +
                               '<span class="pull-left width55" id="divPanelImp"><span class="pull-left font-black"></span><span class="font-black underline">Select Improvement Tactic</span></span>' +
                               '<span class="pull-right width50px"><div class="add-icon impTactic" data-slidepanel="panel"></div></span>' +
                               '<span class="pull-right width100px text-right font-black">&nbsp;</span>' +
                               '<span class="pull-right width150px text-right font-black tipsyclass">$' + 0 + '</span>' +
                               '<span class="pull-right width100px text-right font-black">&nbsp;</span>' +
                           '</a>' +
                       '</div>';

            $html += '<div class="cf border-cf improvement-activities">' +
                                    '<div class="pull-left first-columns font_size16 border-cf-right suggested-tactics" data-id="1"><span class="cf-arrow">SUGGESTED</span><span class="border-bottom"></span></div>' +
									'<div class="pull-left first-columns font_size16 border-cf-right" data-id="2"><span class="cf-arrow"><span class="cf-icon ads-icon"></span><span id="spanSuggestedADS">+$0</span></span><span class="border-bottom"></span></div>' +
									'<div class="pull-left first-columns font_size16 border-cf-right" data-id="3"><span class="cf-arrow"><span class="cf-icon velocity-icon"></span><span id="spanSuggestedCW">+0</span> CWs</span><span class="border-bottom"></span></div>' +
									'<div class="pull-left first-columns font_size16" data-id="4"><span class="cf-arrow"><span class="cf-icon conversion-icon"></span><span id="spanSuggestedVelocity">-0</span> DAYS</span><span class="border-bottom"></span></div>' +
                                    '<div class="pull-right-assortment width50px total"><span class="cf-arrow cf-arrow-blue pull-right"></span></div>' +
                                //'<div class="pull-left width55"></div>' +
                                //'<div class="height40 pull-right width50px"></div>' +
                                '<div class="total improvementTotal pull-right width100px text-right tipsyclass">' + FormatCommas(programTotal.toString(), false) + '</div>' +
                                '<div class="total improvementTotal pull-right width150px text-right tipsyclass Cost_Improvement_Activities">$' + FormatCommas(costTotal.toString(), false) + '</div>' +
                                '<div class="total improvementTotal pull-right width100px text-right border-cf-left" id="DivImprovementTotal">' + FormatCommas(mqlTotal.toString(), false) + '</div>' +
                                '<div class="gray-add-container border-cf" id="grayImprovementContainer"></div>' +
                                '<div class="grey-container-full" id="grayFullContainer">' +
										                    '</div>' +
                            '</div>';

                var $tableImprovementCampaigns = $('.accordion-campaign > #improvementAccordionGroup');

                $tableImprovementCampaigns.append($html);
                if (!isImpCount) {
                    $(".improvementTotal").each(function () {
                        $(this).css("color", "#D4D4D4");
                    });
                }
                addEventTriggerSlidepanel();

            //Fetch all the row values from the tables
                $('.Cost_Improvement_Activities').each(function () {
                    //Added By : Kalpesh Sharma
                    //PL #508 Set format for label in tool tip
                    SetLabelFormaterWithTipsy($(this));
                });
            
        }


        function loadscript() {
            $('.total .cf-arrow').click(function () {
                $('.grey-container-full').fadeOut();
                $('.first-columns').removeClass('active-column');
                $(this).toggleClass('cf-arrow-blue');
                $('.gray-add-container').slideDown(200);
                $("#btnSaveAndContinue").css("display", "block");
                $("#divSuggestionBox").css("padding-bottom", "150px");
                /*if($('.grey-container-full').is(':visible')){
                    $('.gray-add-container').slideDown();
                }*/
            });

            $('.first-columns').click(function () {
                $("#btnSaveAndContinue").css("display", "none");
                var dataId = $(this).attr('data-id');
                FillFullContainer(dataId);
                $('.gray-add-container').slideUp();

                $('.improvement-activities').find('.active-column').each(function () {
                    $(this).removeClass('active-column');
                });
                $(this).addClass('active-column');
                /*$(this).toggleClass('cf-arrow-blue');*/
                $('.grey-container-full').slideDown(200);
                $(this).find('.border-bottom').css('display', 'block');

                var dataId = $(this).attr('data-id');
                $('.grey-container-content > div').fadeOut(50);
                $('.grey-container-content > div').fadeIn(200);

                /*if ($('.gray-add-container').is(':visible')) {
                    //alert('small DIV');
                    $(this).toggleClass('cf-arrow-blue');
                    $('.gray-add-container').slideUp();
                }
                else if($('.grey-container-full').is(':visible')){
                    $(this).toggleClass('cf-arrow-blue');
                    $('.gray-add-container').slideDown();
                }*/

            });
        }

        function addRowImprovementTactic(_index, _id, _title, _cost, _isOwner, _programId) {
            var $tableImprovementCampaigns = $('.accordion-campaign > #improvementAccordionGroup');
            var $html = '';
            $html += '<div class="accordion-header campaign-default">' +
                            '<a class="accordion-toggle" id="divimpTactic" index="' + _id + '" data-id-program="' + _programId  + '">';
            if (_isOwner == 0) {
                $html += '<span class="delete-Improvement width5" id="delimpTactic"></span>';
            }
            $html += '<span class="pull-left width55" id="divPanelImp"><span class="pull-left font-black"></span><span class="font-black underline">' + _title + '</span></span>' +
                                '<span class="pull-right width50px"><div class="add-icon impTactic" data-slidepanel="panel"></div></span>' +
                                '<span class="pull-right width100px text-right font-black tipsyclass">&nbsp;</span>' +
                                '<span id="spncostAssotment" class="pull-right width150px text-right font-black tipsyclass Cost_Improvement_Activities">$' + FormatCommas(_cost.toString(), false) + '</span>' +
                                '<span class="pull-right width100px text-right font-black">&nbsp;</span>' +
                            '</a>' +
                        '</div>';

            $tableImprovementCampaigns.append($html);

        }

        function FillGrayImprovementContainerEmpty() {
            var $html = '<p class="text1">Adding improvement tactics can boost your planned efforts.</p>' +
											'<p class="text2">Add your marketing activities first, then add</br> improvement tactics.' +
											'The impact of improvement tactics across Average Deal Size,' +
											'Stage Velocity and Funnel Conversion can be seen here.</p>';
            var $ContainerImprovement = $('#grayImprovementContainer');

            $ContainerImprovement.append($html);
        }

        function FillGrayImprovementContainer(impcount) {

            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/GetImprovementContainerValue/")',
                data: {
                },
                success: function (data) {
                    if (typeof data != 'undefined') {
                        var $html = '<p class="text1">Executing ';
                        if (impcount > 1) {
                            $html += 'these improvement tactics';
                        }
                        else {
                            $html += 'this improvement tactic';
                        }
                        $html +=' could deliver...</p>' +
                            '<p class="text2"><strong>';
                        var mqlValue = parseFloat(data.MQL);
                        if (mqlValue < 0) {
                            $html += FormatCommas(Math.abs(mqlValue).toString(), false) + '</strong> less';
                        }
                        else {
                            $html += FormatCommas(mqlValue.toString(), false) + '</strong> more';
                        }

                        var withImprovedMQL = mqlTotal + mqlValue;
                        $('#DivImprovementTotal').html(FormatCommas(withImprovedMQL.toString(), false))


                        //Added by : Kalpesh Sharma
                        SetLabelFormaterWithTipsyNumbers("#DivImprovementTotal");

                        var mqltext = "@ViewBag.MQLLabel"
                        $html += ' ' + mqltext +' yielding <strong>';
                        var cwValue = parseFloat(data.CW);
                        if (cwValue < 0) {
                            $html += FormatCommas(Math.abs(cwValue).toString(), true) + '</strong> less';
                            $("#spanSuggestedCW").text("-" + Math.abs(cwValue).toString());
                        }
                        else {
                            $html += FormatCommas(cwValue.toString(), true) + '</strong> more';
                            $("#spanSuggestedCW").text("+" + Math.abs(cwValue).toString());
                        }
                        if (cwValue <= 1) {
                            $html += ' CW,<br><strong>';
                        }
                        else {
                            $html += ' CWs,<br><strong>';
                        }
                        var adsValue = parseFloat(data.ADS);
                        if (adsValue < 0) {
                            $html += FormatCurrency(Math.abs(adsValue).toString(), false) + '</strong> less';
                            $("#spanSuggestedADS").text("-$" + Math.abs(adsValue).toString());
                        }
                        else {
                            $html += FormatCurrency(adsValue.toString(), false) + '</strong> larger';
                            $("#spanSuggestedADS").text("+$" + Math.abs(adsValue).toString());
                        }

                        $html += ' Average Deal Size and<br><strong>';
                        var velocityValue = parseFloat(data.Velocity);
                        if (velocityValue <= 0) {
                            $html += FormatCommas(Math.abs(velocityValue).toString(), false) + '</strong> less';
                            $("#spanSuggestedVelocity").text("-" + Math.abs(velocityValue).toString());
                        }
                        else {
                            $html += FormatCommas(velocityValue.toString(), false) + '</strong> more';
                            $("#spanSuggestedVelocity").text("+" + Math.abs(velocityValue).toString());
                        }

                        $html += ' days in the funnel with</p>' +
                            '<p class="text3">Net Revenue Impact of ';
                        
                        var revenueValue = parseFloat(data.Revenue);
                        if (revenueValue < 0) {
                            //Modified by : Kalpesh Sharma
                            //PL #508 Set format for label in tool tip
                            $html += '<span id="spanRevenueImpact" >' + '-' + FormatCurrency(Math.abs(revenueValue).toString(), true) + '</span>';
                            //$html += '-' + FormatCurrency(Math.abs(revenueValue).toString(), true);
                        }
                        else {
                            $html += '<span id="spanRevenueImpact" >' + '' + FormatCurrency(revenueValue.toString(), true) + '</span>';
                            //$html += '' + FormatCurrency(revenueValue.toString(), true);
                        }

                        $html += '<br> on ';

                        var costValue = parseFloat(data.Cost);
                        if (costValue < 0) {
                            //$html += FormatCurrency(Math.abs(costValue).toString(), false) + ' decreased';
                            $html += '<span id="spanRevenuecostValue" >' + '-' + FormatCurrency(Math.abs(costValue).toString(), false) + '</span>' + ' decreased';
                        }
                        else {
                            $html += '<span id="spanRevenuecostValue" >' + FormatCurrency(costValue.toString(), false) + '</span>' + ' decreased';
                            //$html += FormatCurrency(costValue.toString(), false) + ' increased';
                        }

                        $html += ' spend.</p>';

                        var $ContainerImprovement = $('#grayImprovementContainer');

                        $ContainerImprovement.append($html);

                        //Fetch all the row values from the tables
                        //Added By : Kalpesh Sharma
                        //PL #508 Set format for label in tool tip
                        SetLabelFormaterWithTipsy("#spanRevenuecostValue");
                        SetLabelFormaterWithTipsy("#spanRevenueImpact");

                    }

                }
            });

            
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadRecommendedGrid() {
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/GetRecommendedImprovementTacticType/")',
                data: {
                },
                success: function (data) {
                    RecommendedImprovementTacticType = data;
                    fillRecommendedImprovementTacticType(false);
                    if (!isLoadSuggestion) {
                        LoadScriptForSuggestion();
                    }
                    var divsuggstedheight = $(".grey-container-content").outerHeight();
                    var finalheight = 50 + parseFloat(divsuggstedheight);
                    $("#divSuggestionBox").css("padding-bottom", finalheight);
                    //divSuggestionBox
                    //padding-bottom:250px;
                    //$("#defaultSortingId").focus().click();
                }
    });
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function fillRecommendedImprovementTacticType() {
            $('#tableImprovementTypeSuggested > tbody').empty();
            if (typeof RecommendedImprovementTacticType != 'undefined') {
                //alert('1');
                var $html = '';
                //alert(JSON.stringify(RecommendedImprovementTacticType));
                if (RecommendedImprovementTacticType.data.length) {
                    for (i in RecommendedImprovementTacticType.data) {
                        addRowRecommendedImprovementTacticType(RecommendedImprovementTacticType.data[i].ImprovementPlanTacticId, RecommendedImprovementTacticType.data[i].ImprovementTacticTypeTitle, RecommendedImprovementTacticType.data[i].ProjectedRevenueWithoutTactic, RecommendedImprovementTacticType.data[i].Cost, RecommendedImprovementTacticType.data[i].ProjectedRevenueWithTactic, RecommendedImprovementTacticType.data[i].ProjectedRevenueLift, RecommendedImprovementTacticType.data[i].RevenueToCostRatio, RecommendedImprovementTacticType.data[i].ImprovementTacticTypeId, RecommendedImprovementTacticType.data[i].IsExits, RecommendedImprovementTacticType.data[i].IsOwner);
                    }
                }
            }
            if (!isADS) {
                LoadScriptForTableRow();
            }
            if (isADS) {
                LoadScriptForADS(1);
            }

            //Fetch all the row values from the tables
            $('.SuggestedSection').each(function () {
                //Added By : Kalpesh Sharma
                //PL #508 Set format for label in tool tip
                SetLabelFormaterWithTipsy($(this));
            });


        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function addRowRecommendedImprovementTacticType(ImprovementPlanTacticId, ImprovementTacticTypeTitle, ProjectedRevenueWithoutTactic, Cost, ProjectedRevenueWithTactic, ProjectedRevenueLift, RevenueToCostRatio, ImprovementTacticTypeId, IsExits, IsOwner) {
            var $tableImprovementTactic = $('#tableImprovementTypeSuggested > tbody');
            var $html = '<tr';
            if (IsExits) {
                $html += ' class="added"';
            }
            $html += '><td data-column="1" class="left-text">' + ImprovementTacticTypeTitle + '</td>'
                                + '	<td class="SuggestedSection" data-column="2"';
            
            if (!isADS) {
                $html += ' class="noRightBorder SuggestedSection"';
            }
            $html += ' >$' + FormatCommas(Cost.toString(), false) + '</td>';
            var isDashedDisplay = false;
            if (isADS) {
                if (ProjectedRevenueWithoutTactic == ProjectedRevenueWithTactic) {
                    isDashedDisplay = true;
                }
            }

            if (isDashedDisplay) {
                $html += '<td data-column="3" class="noRightBorder">---  </td>'
                                + '	<td data-column="4" >---  </td>';
            }
            else {
                $html += '<td data-column="3" class="noRightBorder SuggestedSection">$' + FormatCommas(ProjectedRevenueWithoutTactic.toString(), true) + '</td>'
                             + '	<td class="SuggestedSection" data-column="4" >$' + FormatCommas(ProjectedRevenueWithTactic.toString(), true) + '</td>';
            }

            $html += '	<td data-column="5">' + ProjectedRevenueLift + '%</td>'
                                + '	<td data-column="6">' + RevenueToCostRatio + '</td>'
                                + '	<td data-column="7" class="text-center noRightBorder addToPlan"><span';

            if (IsExits) {
                $html += ' IMPTacticTypeId="' + ImprovementPlanTacticId + '"';
                if(IsOwner || isADS)
                {
                    $html += ' class="circle-check-icon-blue"';
                }
            }
            else {
                if (isADS) {
                    $html += ' IMPTacticTypeId="' + ImprovementPlanTacticId + '" class="circle-check-icon-gray"';
                }
                else {
                    $html += ' IMPTacticTypeId="' + ImprovementTacticTypeId + '" class="circle-check-icon-gray"';
                }

            }
            $html += '></span></td>'
									+ '</tr>';
            $tableImprovementTactic.append($html);

        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadADSGrid() {
            // SuggestionIMPTacticIdList = JSON.stringify({ 'SuggestionIMPTacticIdList': SuggestionIMPTacticIdList });
            // alert(SuggestionIMPTacticIdList);
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/GetADSImprovementTacticType/")',
                data: {
                    SuggestionIMPTacticIdList: SuggestionIMPTacticIdList.toString()
                },
                success: function (data) {
                    RecommendedImprovementTacticType = data;
                    fillRecommendedImprovementTacticType();
                    if (!isLoadSuggestion) {
                        LoadScriptForSuggestion();
                    }
                   // $("#defaultSortingId").focus().click();

                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/GetHeaderValueForSuggestedImprovement/")',
                        data: {
                            SuggestionIMPTacticIdList: SuggestionIMPTacticIdList.toString()
                        },
                        success: function (data) {
                            if (typeof data != 'undefined') {
                                var adsValue = parseFloat(data.ADS);
                                if (adsValue < 0) {
                                    $("#spanSuggestedADS").text("-$" + Math.abs(adsValue).toString());
                                }
                                else {
                                    $("#spanSuggestedADS").text("+$" + Math.abs(adsValue).toString());
                                }

                                var cwValue = parseFloat(data.CW);
                                if (cwValue < 0) {
                                    $("#spanSuggestedCW").text("-" + Math.abs(cwValue).toString());
                                }
                                else {
                                    $("#spanSuggestedCW").text("+" + Math.abs(cwValue).toString());
                                }


                                var velocityValue = parseFloat(data.Velocity);
                                if (velocityValue <= 0) {
                                    $("#spanSuggestedVelocity").text("-" + Math.abs(velocityValue).toString());
                                }
                                else {
                                    $("#spanSuggestedVelocity").text("+" + Math.abs(velocityValue).toString());
                                }

                            }

                        }
                    });

                    var divsuggstedheight = $(".grey-container-content").outerHeight();
                    var finalheight = 50 + parseFloat(divsuggstedheight);
                    $("#divSuggestionBox").css("padding-bottom", finalheight);
                }
            });
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadConversionGrid() {
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/GetConversionImprovementTacticType/")',
                data: {
                    SuggestionIMPTacticIdList: SuggestionIMPTacticIdList.toString(),
                    isConversion: isConversion
                },
                success: function (data) {
                    RecommendedImprovementTacticType = data;
                    fillRecommendedConversionImprovement();
                    //  fillRecommendedImprovementTacticType();

                    //  $("#defaultSortingId").focus().click();

                    $.ajax({
                        type: 'POST',
                        url: '@Url.Content("~/Plan/GetHeaderValueForSuggestedImprovement/")',
                        data: {
                            SuggestionIMPTacticIdList: SuggestionIMPTacticIdList.toString()
                        },
                        success: function (data) {
                            if (typeof data != 'undefined') {
                                var adsValue = parseFloat(data.ADS);
                                if (adsValue < 0) {
                                    $("#spanSuggestedADS").text("-$" + Math.abs(adsValue).toString());
                                }
                                else {
                                    $("#spanSuggestedADS").text("+$" + Math.abs(adsValue).toString());
                                }

                                var cwValue = parseFloat(data.CW);
                                if (cwValue < 0) {
                                    $("#spanSuggestedCW").text("-" + Math.abs(cwValue).toString());
                                }
                                else {
                                    $("#spanSuggestedCW").text("+" + Math.abs(cwValue).toString());
                                }


                                var velocityValue = parseFloat(data.Velocity);
                                if (velocityValue <= 0) {
                                    $("#spanSuggestedVelocity").text("-" + Math.abs(velocityValue).toString());
                                }
                                else {
                                    $("#spanSuggestedVelocity").text("+" + Math.abs(velocityValue).toString());
                                }

                            }

                        }
                    });
                    var divsuggstedheight = $(".grey-container-content").outerHeight();
                    var finalheight = 50 + parseFloat(divsuggstedheight);
                    $("#divSuggestionBox").css("padding-bottom", finalheight);
                }
            });
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function fillRecommendedConversionImprovement() {
            $('#conversion').empty();
            if (typeof RecommendedImprovementTacticType != 'undefined') {
                var html = '';
                html += '<h2 class="source-sans-probold">';
                if (isConversion) {
                    html += 'Conversion Improvement</h2>';
                }
                else {
                    html += 'Velocity Improvement</h2>';
                }
                html += '<table class="source-sans-proregular grayContent-tacticTable text-right" id="tableImprovementTypeSuggested">';

                html += '<thead><tr>' +
								'<th class="left-text">Improvement Tactic Type</th>' +
								'<th class="tacticTable-arrow-icon arrow-bottom" width="9%" data-column="2" sortText="Cost">Cost</th>';

                if (RecommendedImprovementTacticType.datametriclist.length) {
                    var maxLength = RecommendedImprovementTacticType.datametriclist.length;
                    for (i in RecommendedImprovementTacticType.datametriclist) {
                        var title = RecommendedImprovementTacticType.datametriclist[i].Title.toString();
                        if (isConversion) {
                            var arrTitle = title.split("->");
                            if (i == 0) {
                                html += '<th class="noRightBorder" width="10%">Weight<br>' + arrTitle[0] + '<span class="arrow-right-icon"></span>' + arrTitle[1] + '</th>';
                            }
                            else if (i == maxLength - 1) {
                                html += '<th width="9%">' + arrTitle[0] + '<span class="arrow-right-icon"></span>' + arrTitle[1] + '</th>';
                            }
                            else {
                                html += '<th class="noRightBorder" width="9%">' + arrTitle[0] + '<span class="arrow-right-icon"></span>' + arrTitle[1] + '</th>';
                            }
                        }
                        else {
                            if (i == 0) {
                                html += '<th class="noRightBorder" width="8%">Weight<br>' + title + '</th>';
                            }
                            else if (i == maxLength - 1) {
                                html += '<th width="8%">' + title + '</th>';
                            }
                            else {
                                html += '<th class="noRightBorder" width="8%">' + title + '</th>';
                            }
                        }
                    }
                }

                html += '<th class="text-center noRightBorder" width="7%">Add to Plan</th>' +
								'						</tr></thead><tbody>';

                if (RecommendedImprovementTacticType.data.length) {
                    for (i in RecommendedImprovementTacticType.data) {
                        var htmlOut = addRowRecommendedConversion(RecommendedImprovementTacticType.data[i].ImprovementPlanTacticId, RecommendedImprovementTacticType.data[i].ImprovementTacticTypeTitle, RecommendedImprovementTacticType.data[i].Cost, RecommendedImprovementTacticType.data[i].MetricList, RecommendedImprovementTacticType.data[i].IsExits);
                        html += htmlOut;
                    }
                }

                html += '<tr>' +
                    '<th class="noRightBorder left-text"></th>' +
                    '<th></th>';
                if (RecommendedImprovementTacticType.datafinalmetriclist.length) {
                    var maxLength = RecommendedImprovementTacticType.datafinalmetriclist.length;
                    for (i in RecommendedImprovementTacticType.datafinalmetriclist) {
                        var mvalue;
                        if (isConversion) {
                            mvalue = FormatNumber((Math.round(parseFloat(RecommendedImprovementTacticType.datafinalmetriclist[i].Value) * 100) / 100), true);
                        }
                        else {
                            mvalue = (Math.round(parseFloat(RecommendedImprovementTacticType.datafinalmetriclist[i].Value) * 100) / 100) + " Days";
                        }

                        if (i == maxLength - 1) {
                            html += '<th>' + mvalue + '</th>';
                        }
                        else {
                            html += '<th class="noRightBorder">' + mvalue + '</th>';
                        }
                    }
                }
                html += '<th class="text-center noRightBorder"></th>' +
                    '</tr>';
                html += '</tbody></table>';
                var $htmlFinal = html;
                $('#conversion').append($htmlFinal);
                //$('#tableImprovementTypeConversion').appendTo('</tbody>');
            }
            LoadScriptForConversion();
            LoadScriptForADS();


            //Fetch all the row values from the tables
            $('.SuggestedSection').each(function () {
                //Added By : Kalpesh Sharma
                //PL #508 Set format for label in tool tip
                SetLabelFormaterWithTipsy($(this));
            });


        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function addRowRecommendedConversion(ImprovementPlanTacticId, ImprovementTacticTypeTitle, Cost, MetricList, IsExits) {
            var htmlInner = '<tr';
            if (IsExits) {
                htmlInner += ' class="added"';
            }
            htmlInner += '><td data-column="1" class="left-text">' + ImprovementTacticTypeTitle + '</td>'
                                 + '	<td class="SuggestedSection" data-column="2">$' + FormatCommas(Cost.toString(), false) + '</td>';
            if (typeof MetricList != 'undefined') {

                if (MetricList.length > 0) {
                    var metricMax = MetricList.length - 1;
                    for (i in MetricList) {
                        var mvalue = MetricList[i].Value;
                        var displayMvalue;
                        if (mvalue == 0) {
                            displayMvalue = "---";
                        }
                        else {
                            displayMvalue = mvalue;
                        }
                        if (i == metricMax) {
                            htmlInner += '<td>' + displayMvalue + '</td>';
                        }
                        else {
                            htmlInner += '<td class="noRightBorder">' + displayMvalue + '</td>';
                        }
                    }
                }
            }
            htmlInner += '<td data-column="7" class="text-center noRightBorder addToPlan"><span';
            if (IsExits) {
                htmlInner += ' IMPTacticTypeId="' + ImprovementPlanTacticId + '" class="circle-check-icon-blue"';
            }
            else {
                htmlInner += ' IMPTacticTypeId="' + ImprovementPlanTacticId + '" class="circle-check-icon-gray"';
            }
            htmlInner += '></span></td>'
									+ '</tr>';
            return htmlInner;
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        var globledataid = 0;
        function FillFullContainer(dataid) {
            // alert('1');
            var $html = '';
            if (dataid == 1) {
                $html += '<div class="grey-container-content">' +
                                               '<div id="suggested-tactics">' +
                                                   '<h2 class="source-sans-probold">Suggested Improvement Activities</h2>' +
                                                   '<table class="source-sans-proregular grayContent-tacticTable text-right" id="tableImprovementTypeSuggested">' +
                                                   '<thead>' +
                                                       '<tr>' +
                                                           '<th data-column="1" class="left-text">Improvement Tactic Type</th>' +
                                                           '<th data-column="2" class="noRightBorder tacticTable-arrow-icon arrow-bottom" width="9%" sortText="Cost">Cost</th>' +
                                                           '<th data-column="3" class="noRightBorder" width="15%">Projected Revenue Without Tactic</th>' +
                                                           '<th data-column="4" class="tacticTable-arrow-icon arrow-bottom" width="17%" sortText="ProjectedRevenueWithTactic">Projected Revenue With Tactic<!--<span class="tacticTable-arrow-icon arrow-bottom"></span> --></th>' +
                                                           '<th id="defaultSortingId" data-column="5" class="tacticTable-arrow-icon arrow-bottom" width="13%" sortText="ProjectedRevenueLift">Projected Revenue Lift</th>' +
                                                           '<th data-column="6" class="tacticTable-arrow-icon arrow-bottom" width="13%" sortText="RevenueToCostRatio">Revenue to Cost Ratio</th>' +
                                                           '<th data-column="7" class="text-center noRightBorder" width="7%">Add to Plan</th>' +
                                                       '</tr>' +
                                                       '</thead>' +
                                                       '<tbody>' +
                                                       '</tbody>' +
                                                   '</table>' +
                                               '</div></div>';
            }
            else if (dataid == 2) {
                $html += '<div class="grey-container-content">' +
                                             '<div id="ads">' +
                                                 '<h2 class="source-sans-probold">Average Dollor Sale Improvement</h2>' +
                                                 '<table class="source-sans-proregular grayContent-tacticTable text-right" id="tableImprovementTypeSuggested">' +
                                                 '<thead>' +
                                                     '<tr>' +
                                                         '<th data-column="1" class="left-text">Improvement Tactic Type</th>' +
                                                         '<th data-column="2" class="tacticTable-arrow-icon arrow-bottom" width="9%" sortText="Cost">Cost</th>' +
                                                         '<th data-column="3" class="noRightBorder" width="15%">Projected ADS Without Tactic</th>' +
                                                         '<th data-column="4" class="tacticTable-arrow-icon arrow-bottom" width="17%" sortText="ProjectedRevenueWithTactic">Projected ADS With Tactic</th>' +
                                                         '<th id="defaultSortingId" data-column="5" class="tacticTable-arrow-icon arrow-bottom" width="13%" sortText="ProjectedRevenueLift">Projected Revenue Lift</th>' +
                                                         '<th data-column="6" class="tacticTable-arrow-icon arrow-bottom" width="13%" sortText="RevenueToCostRatio">Revenue to Cost Ratio</th>' +
                                                         '<th data-column="7" class="text-center noRightBorder" width="7%">Add to Plan</th>' +
                                                     '</tr>' +
                                                     '</thead>' +
                                                     '<tbody>' +
                                                     '</tbody>' +
                                                 '</table>' +
                                             '</div></div>';
            }
            else if (dataid == 3) {
                $html += '<div class="grey-container-content">' +
                                            '<div id="conversion">' +
                                            '</div></div>';
            }
            else if (dataid == 4) {
                $html += '<div class="grey-container-content">' +
                                            '<div id="conversion">' +
                                            '</div></div>';
            }

            var $ContainerGreyFullImprovement = $('#grayFullContainer');
            $ContainerGreyFullImprovement.empty();
            $ContainerGreyFullImprovement.append($html);
            isADS = false;
            isLoadSuggestion = false;
            globledataid = dataid;
            if (dataid == 1) {
                if (!isMarketingTacticExits) {
                    $("#suggested-tactics").empty();
                    $("#suggested-tactics").html('<h2 class="source-sans-probold">No marketing activities exits.</h2>');
                }
                else {
                    LoadRecommendedGrid();
                }
            }
            else if (dataid == 2) {
                if (!isImprovementTacticExits) {
                    $("#ads").empty();
                    $("#ads").html('<h2 class="source-sans-probold">No improvement tactic(s) exits.</h2>');
                }
                else {
                    isADS = true;
                    LoadADSGrid();
                }
            }
            else if (dataid == 3) {
                if (!isImprovementTacticExits) {
                    $("#conversion").empty();
                    $("#conversion").html('<h2 class="source-sans-probold">No improvement tactic(s) exits.</h2>');
                }
                else {
                    isConversion = true;
                    LoadConversionGrid();
                }
            }
            else if (dataid == 4) {
                if (!isImprovementTacticExits) {
                    $("#conversion").empty();
                    $("#conversion").html('<h2 class="source-sans-probold">No improvement tactic(s) exits.</h2>');
                }
                else {
                    isConversion = false;
                    LoadConversionGrid();
                }
            }
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadScriptForADS(tabvalue) {
            //SuggestionIMPTacticIdList
            $("#tableImprovementTypeSuggested").find(".addToPlan span").click(function () {
                if ($(this).hasClass('circle-check-icon-gray')) {
                    // Add in plan
                    $(this).removeClass('circle-check-icon-gray');
                    $(this).addClass('circle-check-icon-blue');
                    var impTacticId = $(this).attr('IMPTacticTypeId');
                    SuggestionIMPTacticIdList = $.grep(SuggestionIMPTacticIdList, function (value) {
                        return value != parseFloat(impTacticId);
                    });
                }
                else {
                    // Remove from Plan
                    $(this).removeClass('circle-check-icon-blue');
                    $(this).addClass('circle-check-icon-gray');
                    var impTacticId = $(this).attr('IMPTacticTypeId');
                    SuggestionIMPTacticIdList.push(parseFloat(impTacticId));
                }
                //alert(sortText);
                //alert(isasc);
                //alert(SuggestionIMPTacticIdList);
                if (tabvalue == 1) {
                    LoadADSGrid();
                }
                else {
                    LoadConversionGrid();
                }
                LoadTableImprovementSort();
            });
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadScriptForTableRow() {

            $("#tableImprovementTypeSuggested").find(".addToPlan span").click(function () {
                if ($(this).hasClass('circle-check-icon-gray')) {
                    // Add in plan
                    $(this).removeClass('circle-check-icon-gray');
                    $(this).addClass('circle-check-icon-blue');
                    var impTacticId = $(this).attr('IMPTacticTypeId');
                    AddImprovementTactic(impTacticId);
                }
                else {
                    // Remove from Plan
                    //$(this).removeClass('circle-check-icon-blue');
                    //$(this).addClass('circle-check-icon-gray');
                    var impTacticId = $(this).attr('IMPTacticTypeId');
                    var idTactic = impTacticId;
                    $("#DivPartialViewForDeleteImpTactic").empty();
                    var AssortmentType = true;
                    $("#divBackground").css("display", "block");
                    var url = '@Url.Content("~/Plan/ShowDeleteImprovementTactic/")';
                    $("#DivPartialViewForDeleteImpTactic").load(url + '?id=' + idTactic + '&AssortmentType=' + AssortmentType + '&RedirectType=' + false);
                }
                //LoadTableImprovementSort();
                //alert(sortText);
                //alert(isasc);
            });

        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function AddImprovementTactic(impTacticId) {
            $.ajax({
                type: 'POST',
                url: '@Url.Content("~/Plan/AddSuggestedImprovementTactic")',
                data:
                    {
                        improvementPlanProgramId: ImprovementPlanProgramId,
                        improvementTacticTypeId: impTacticId
                    },
                success: function (data) {
                    if (data.redirect) {
                        window.location.href = data.redirect;
                        return;
                    }
                    if (data.errormsg) {
                        ismsg = data.errormsg;
                        hdnisError = true;
                        Showmsg();
                    }
                }
            });
        }

        function LoadTableImprovementSort() {
            $("#tableImprovementTypeSuggested").find(".arrow-blue-top").each(function () {
                $(this).removeClass('arrow-blue-top');
            });
            $("#tableImprovementTypeSuggested").find(".arrow-blue-bottom").each(function () {
                $(this).removeClass('arrow-blue-bottom');
            });
            $("#tableImprovementTypeSuggested").find(".tacticTable-arrow-icon").each(function () {
                if ($(this).hasClass('blueHighlight')) {
                    $(this).removeClass('blueHighlight');
                }
                if (!$(this).hasClass('arrow-bottom')) {
                    $(this).addClass('arrow-bottom');
                }
            });
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadScriptForConversion() {
            
            $("#tableImprovementTypeSuggested").find(".tacticTable-arrow-icon").click(function () {
                //blueHighlight
                // Grab the column number
                var column = $(this).attr('data-column');
                var isTop = false;
                if ($(this).hasClass('arrow-blue-top')) {
                    isTop = false;
                }
                if ($(this).hasClass('arrow-blue-bottom')) {
                    isTop = true;
                }
                $("#tableImprovementTypeSuggested").find(".arrow-top").each(function () {
                    $(this).removeClass('arrow-top');
                });
                $("#tableImprovementTypeSuggested").find(".arrow-bottom").each(function () {
                    $(this).removeClass('arrow-bottom');
                });
                $("#tableImprovementTypeSuggested").find(".arrow-blue-top").each(function () {
                    $(this).removeClass('arrow-blue-top');
                });
                $("#tableImprovementTypeSuggested").find(".arrow-blue-bottom").each(function () {
                    $(this).removeClass('arrow-blue-bottom');
                });
                $("#tableImprovementTypeSuggested").find(".tacticTable-arrow-icon").each(function () {
                    if ($(this).hasClass('blueHighlight')) {
                        $(this).removeClass('blueHighlight');
                    }
                    if (!$(this).hasClass('arrow-bottom')) {
                        $(this).addClass('arrow-bottom');
                    }
                });
                if ($(this).hasClass('arrow-bottom')) {
                    $(this).removeClass('arrow-bottom');
                }


                sortText = $(this).attr('sortText');
                isasc = true;

                if (isTop) {
                    isasc = false;
                }
                else {
                    isasc = true;
                }
                sortResults(sortText, isasc);
                $('.tacticTable-arrow-icon').removeClass('arrow-bottom');
                $('.tacticTable-arrow-icon').addClass('blueHighlight');
                if (isTop) {
                    $('.tacticTable-arrow-icon').addClass('arrow-blue-top');
                }
                else {
                    $('.tacticTable-arrow-icon').addClass('arrow-blue-bottom');
                }
                // Set all columns with the same column number to have the highlight class
                $('#tableImprovementTypeSuggested td[data-column=' + column + ']').addClass('blueHighlight');
            });
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function LoadScriptForSuggestion() {
            isLoadSuggestion = true;

            $("#tableImprovementTypeSuggested").find(".tacticTable-arrow-icon").each(function () {
                $(this).click(function () {
                    //blueHighlight
                    // Grab the column number
                    var column = $(this).attr('data-column');
                    var isTop = false;
                    if ($(this).hasClass('arrow-blue-top')) {
                        isTop = false;
                    }
                    if ($(this).hasClass('arrow-blue-bottom')) {
                        isTop = true;
                    }
                    $("#tableImprovementTypeSuggested").find(".arrow-top").each(function () {
                        $(this).removeClass('arrow-top');
                    });
                    $("#tableImprovementTypeSuggested").find(".arrow-bottom").each(function () {
                        $(this).removeClass('arrow-bottom');
                    });
                    $("#tableImprovementTypeSuggested").find(".arrow-blue-top").each(function () {
                        $(this).removeClass('arrow-blue-top');
                    });
                    $("#tableImprovementTypeSuggested").find(".arrow-blue-bottom").each(function () {
                        $(this).removeClass('arrow-blue-bottom');
                    });
                    $("#tableImprovementTypeSuggested").find(".tacticTable-arrow-icon").each(function () {
                        if ($(this).hasClass('blueHighlight')) {
                            $(this).removeClass('blueHighlight');
                        }
                        if (!$(this).hasClass('arrow-bottom')) {
                            $(this).addClass('arrow-bottom');
                        }
                    });
                    if ($(this).hasClass('arrow-bottom')) {
                        $(this).removeClass('arrow-bottom');
                    }

                    $(this).addClass('blueHighlight');
                    sortText = $(this).attr('sortText');
                    isasc = true;
                    if (isTop) {
                        $(this).addClass('arrow-blue-top');
                        isasc = false;
                    }
                    else {
                        $(this).addClass('arrow-blue-bottom');
                        isasc = true;
                    }
                    sortResults(sortText, isasc);
                    // Set all columns with the same column number to have the highlight class
                    $('#tableImprovementTypeSuggested td[data-column=' + column + ']').addClass('blueHighlight');
                });
            });
                
        }

        // Added By Bhavesh
        // PL Ticket 289,377,378
        function sortResults(prop, asc, dataid) {
            RecommendedImprovementTacticType.data = RecommendedImprovementTacticType.data.sort(function (a, b) {
                if (asc) return (a[prop] > b[prop]) ? 1 : ((a[prop] < b[prop]) ? -1 : 0);
                else return (b[prop] > a[prop]) ? 1 : ((b[prop] < a[prop]) ? -1 : 0);
            });
            if (globledataid == 1) {
                fillRecommendedImprovementTacticType();
            }
            else if (globledataid == 2) {
                fillRecommendedImprovementTacticType();
            }
            else if (globledataid == 3) {
                fillRecommendedConversionImprovement();
            }
            else if (globledataid == 4) {
                fillRecommendedConversionImprovement();
            }
        }

    });

</script>
