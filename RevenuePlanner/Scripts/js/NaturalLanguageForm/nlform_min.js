!function(a){"use strict";function c(a){this.el=a,this.overlay=this.el.querySelector(".nl-overlay"),this.fields=[],this.fldOpen=-1,this._init()}function d(a,b,c,d){this.form=a,this.elOriginal=b,this.pos=d,this.type=c,this._create(),this._initEvents()}var b=a.document;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),c.prototype={_init:function(){var a=this;Array.prototype.slice.call(this.el.querySelectorAll("select")).forEach(function(b,c){a.fldOpen++,a.fields.push(new d(a,b,"dropdown",a.fldOpen))}),Array.prototype.slice.call(this.el.querySelectorAll("input")).forEach(function(b,c){a.fldOpen++,a.fields.push(new d(a,b,"input",a.fldOpen))});try{this.overlay.addEventListener("click",function(b){a._closeFlds()}),this.overlay.addEventListener("touchstart",function(b){a._closeFlds()})}catch(a){}$(".priceValue").priceFormat({prefix:"",centsSeparator:"",thousandsSeparator:",",centsLimit:0}),$(".currency_dollar").priceFormat({prefix:htmlDecode(CurrencySybmol),centsSeparator:"",thousandsSeparator:",",centsLimit:0,allowNegative:!0}),$(".dollarValue").priceFormat({prefix:"",centsSeparator:"",thousandsSeparator:",",centsLimit:0}),$(".percentValue").priceFormat({prefix:"",suffix:"%",centsSeparator:"",thousandsSeparator:",",centsLimit:0,isDouble:!0})},_closeFlds:function(){this.fldOpen!==-1&&this.fields[this.fldOpen].close()}},d.prototype={_create:function(){"dropdown"===this.type?this._createDropDown():"input"===this.type&&this._createInput()},_createDropDown:function(){var a=this;if(this.fld=b.createElement("div"),this.fld.className="nl-field nl-dd",this.toggle=b.createElement("a"),this.toggle.innerHTML=this.elOriginal.options[this.elOriginal.selectedIndex].innerHTML,this.elOriginal.hasAttribute("maxlength")){var c=this.elOriginal.getAttribute("maxlength");c.length>0&&this.toggle.innerHTML.length>c&&(this.toggle.title=$("<div/>").html(this.toggle.innerHTML).text(),this.toggle.innerHTML=this.toggle.innerHTML.substring(0,c)+"...")}this.toggle.className="nl-field-toggle",this.optionsList=b.createElement("ul");var d="";Array.prototype.slice.call(this.elOriginal.querySelectorAll("option")).forEach(function(b,c){var e;b.hasAttribute("value")&&(e=b.getAttribute("value"));var f=b.innerHTML,g=!1;f.length>30&&(g=!0,f=b.innerHTML.substring(0,30)+"..."),d+="<li",a.elOriginal.selectedIndex===c&&(d+=' class="nl-dd-checked"',a.selectedIdx=c),g&&(d+=' title="'+b.innerHTML+'"'),d+=' value="'+e+'" originalValue="'+b.innerHTML+'" TextValue="'+e+'">'+f+"</li>"}),this.optionsList.innerHTML=d,this.optionsList.setAttribute("style","overflow:auto; max-height: 350px;"),this.fld.appendChild(this.toggle),this.fld.appendChild(this.optionsList),this.elOriginal.parentNode.insertBefore(this.fld,this.elOriginal),this.elOriginal.style.display="none"},_createInput:function(){this.fld=b.createElement("div"),this.fld.className="nl-field nl-ti-text",this.toggle=b.createElement("a");var c=this.elOriginal.getAttribute("placeholder"),d=c,e=this.elOriginal.getAttribute("formatType");"priceValue"!=e&&"dollarValue"!=e||(d=FormatCommas(c,!1)),"currency_dollar"==e&&(d=FormatCurrency(c,!1)),"percentValue"==e&&(d=FormatPercent(c,!0)),d=htmlDecode(d);var f=d;f.length>15?(this.toggle.setAttribute("title",f),f=f.substring(0,15)+"..."):this.toggle.removeAttribute("title"),this.toggle.innerHTML=f,this.toggle.className="nl-field-toggle",this.optionsList=b.createElement("ul"),this.getinput=b.createElement("input"),this.getinput.setAttribute("type","text"),this.getinput.setAttribute("placeholder",d),this.getinput.setAttribute("maxlength",this.elOriginal.getAttribute("maxlength"));var g=this.elOriginal.getAttribute("isedit");null!=g&&"undefined"!=g&&""!=g&&"true"==g.toLowerCase()?this.getinput.setAttribute("value",d):this.getinput.setAttribute("value",""),this.getinput.setAttribute("onblur","getblurvalue(this);"),this.getinput.setAttribute("onfocus","OnNLTextFocus(this);"),this.getinput.setAttribute("class",e),this.getinputWrapper=b.createElement("li"),this.getinputWrapper.className="nl-ti-input",this.inputsubmit=b.createElement("button"),this.inputsubmit.className="nl-field-go",this.inputsubmit.innerHTML="Go",this.getinputWrapper.appendChild(this.getinput),this.getinputWrapper.appendChild(this.inputsubmit),this.example=b.createElement("li"),this.example.className="nl-ti-example",this.example.innerHTML=this.elOriginal.getAttribute("datasubline"),this.optionsList.appendChild(this.getinputWrapper),this.optionsList.appendChild(this.example),this.fld.appendChild(this.toggle),this.fld.appendChild(this.optionsList),this.elOriginal.parentNode.insertBefore(this.fld,this.elOriginal),this.elOriginal.style.display="none"},_initEvents:function(){var a=this;if(this.toggle.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),a._open()}),this.toggle.addEventListener("touchstart",function(b){b.preventDefault(),b.stopPropagation(),a._open()}),"dropdown"===this.type){var b=Array.prototype.slice.call(this.optionsList.querySelectorAll("li"));b.forEach(function(c,d){c.addEventListener("click",function(d){d.preventDefault(),a.close(c,b.indexOf(c))}),c.addEventListener("touchstart",function(d){d.preventDefault(),a.close(c,b.indexOf(c))})})}else"input"===this.type&&(this.getinput.addEventListener("keydown",function(b){13==b.keyCode&&a.close()}),this.inputsubmit.addEventListener("click",function(b){b.preventDefault(),a.close()}),this.inputsubmit.addEventListener("touchstart",function(b){b.preventDefault(),a.close()}))},_open:function(){if(this.open)return!1;this.open=!0,this.form.fldOpen=this.pos;this.fld.className+=" nl-field-open"},close:function(a,b){if(!this.open)return!1;if(this.open=!1,this.form.fldOpen=-1,this.fld.className=this.fld.className.replace(/\b nl-field-open\b/,""),"dropdown"===this.type){if(a){var c=this.optionsList.children[this.selectedIdx];if(c.className="",a.className="nl-dd-checked",this.toggle.innerHTML=a.getAttribute("originalValue"),this.selectedIdx=b,this.elOriginal.value=this.elOriginal.children[this.selectedIdx].value,this.toggle.removeAttribute("title"),this.elOriginal.hasAttribute("maxlength")){var d=this.elOriginal.getAttribute("maxlength");d.length>0&&this.toggle.innerHTML.length>d&&(this.toggle.title=this.toggle.innerHTML,this.toggle.innerHTML=this.toggle.innerHTML.substring(0,d)+"...")}}}else if("input"===this.type){this.getinput.blur(),this.elOriginal.value=this.getinput.value;var e=this.getinput.value;e.length>15?(this.toggle.setAttribute("title",e),e=e.substring(0,15)+"..."):this.toggle.removeAttribute("title"),this.toggle.innerHTML=""!==this.getinput.value.trim()?e:this.getinput.getAttribute("placeholder")}}},a.NLForm=c}(window);