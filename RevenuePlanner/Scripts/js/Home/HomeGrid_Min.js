function SetTooltip(){SetTooltipFirstTime&&(SetTooltipFirstTime=!1,$(document.body).tooltip({container:"body",placement:"bottom",selector:".grid_Search,.grid_add,.honeycombbox-icon-gantt"}))}function GridHideColumn(){StartDateColIndex=HomeGrid.getColIndexById(StartDateId),EndDateColIndex=HomeGrid.getColIndexById(EndDateId),TaskNameColIndex=HomeGrid.getColIndexById(TaskNameId),PlannedCostColIndex=HomeGrid.getColIndexById(PlannedCostId),AssetTypeColIndex=HomeGrid.getColIndexById(AssetTypeId),TypeColIndex=HomeGrid.getColIndexById(TacticTypeId),OwnerColIndex=HomeGrid.getColIndexById(OwnerId),TargetStageGoalColIndex=HomeGrid.getColIndexById(TargetStageGoalId),MQLColIndex=HomeGrid.getColIndexById(MQLId),RevenueColIndex=HomeGrid.getColIndexById(RevenueId),GridHiddenId=HomeGrid.getColIndexById("id"),ActivitypeHidden=HomeGrid.getColIndexById(ActivityTypeId),MachineNameHidden=HomeGrid.getColIndexById(MachineNameId),HomeGrid.setColumnHidden(GridHiddenId,!0),HomeGrid.setColumnHidden(ActivitypeHidden,!0),HomeGrid.setColumnHidden(MachineNameHidden,!0)}function MoveColumn(){HomeGrid.attachEvent("onAfterCMove",function(){for(var e=HomeGrid.getColumnCount(),t=[],a="Common",d=0;e>d;d++){a="Common";var i=HomeGrid.getColWidth(d),o=""+HomeGrid.getColumnId(d);0!=i&&t.push({AttributeId:o,AttributeType:a,ColumnOrder:parseInt(d)})}null!=t&&t.length>0&&void 0!=t&&(t=JSON.stringify(t),$.ajax({url:urlContent+"ColumnView/SaveColumnView",type:"post",dataType:"json",contentType:"application/json",data:"{'AttributeDetail':"+t+"}",success:function(){}}))})}function LoadAfterParsing(){0!=eventidonedit&&HomeGrid.detachEvent(eventidonedit),eventidonedit=HomeGrid.attachEvent("onEditCell",doOnEditCell),0!=eventiddrag&&HomeGrid.detachEvent(eventiddrag),eventiddrag=HomeGrid.attachEvent("onDrag",doOnDrag),0!=eventidonscroll&&HomeGrid.detachEvent(eventidonscroll),eventidonscroll=HomeGrid.attachEvent("onScroll",function(){$(".dhx_combo_select").css("display","none"),$(".dhtmlxcalendar_dhx_skyblue").css("display","none"),$("#popupType").css("display","none"),$(".dhx_clist").css("display","none")}),0!=eventidonbeforedrag&&HomeGrid.detachEvent(eventidonbeforedrag),eventidonbeforedrag=HomeGrid.attachEvent("onBeforeDrag",function(e){if(""!=e&&void 0!=e){var t=HomeGrid.cells(e,GridHiddenId).getValue(),a=HomeGrid.cells(e,ActivitypeHidden).getValue();if(t.length>0){if(a.toLowerCase()!=secTactic)return!1;var d=HomeGrid.cells(e,TaskNameColIndex).getAttribute("lo");return null!=d&&""!=d&&"1"==d?!1:!0}}}),SetselectedRow(),0!=editidonOpenEnd&&HomeGrid.detachEvent(editidonOpenEnd),editidonOpenEnd=HomeGrid.attachEvent("onOpenEnd",function(){SetTooltip()})}function sort_Owner(e,t,a,d,i){return e=HomeGrid.cells(d,OwnerColIndex).getText(),t=HomeGrid.cells(i,OwnerColIndex).getText(),"asc"==a?e>t?1:-1:e>t?-1:1}function sort_TacticType(e,t,a,d,i){var o=HomeGrid.cells(d,ActivitypeHidden).getValue(),l=HomeGrid.cells(i,ActivitypeHidden).getValue();return o.toLowerCase()==secTactic.toLowerCase()&&l.toLowerCase()==secTactic.toLowerCase()?(e=HomeGrid.cells(d,TypeColIndex).getText(),t=HomeGrid.cells(i,TypeColIndex).getText(),"asc"==a?e>t?1:-1:e>t?-1:1):0}function convertNumber(e){var t=0,a=parseFloat(e.replace(CurrencySybmol,""));return t=e.toLowerCase().match(/k/)?Math.round(1e3*a):e.toLowerCase().match(/m/)?Math.round(1e6*a):e.toLowerCase().match(/b/)?Math.round(1e9*a):numb.replace(CurrencySybmol,"")}function ResizeGrid(e){$("#gridbox").attr("width",e),HomeGrid.setSizes(),LoadAfterParsing()}function doOnDrag(e,t){var d="",i="",o="";if(""!=e&&""!=t&&void 0!=e&&void 0!=t){var l=HomeGrid.cells(e,GridHiddenId).getValue(),r=HomeGrid.cells(t,GridHiddenId).getValue(),n=HomeGrid.getParentId(e),s=HomeGrid.cells(n,GridHiddenId).getValue();if(s.length>0&&l.length>0&&r.length>0){if(d=HomeGrid.cells(n,ActivitypeHidden).getValue(),i=HomeGrid.cells(e,ActivitypeHidden).getValue(),o=HomeGrid.cells(t,ActivitypeHidden).getValue(),i.toLowerCase()==secTactic){if(d==o){var c=HomeGrid.getParentId(HomeGrid.getParentId(HomeGrid.getParentId(e))),m=HomeGrid.getParentId(HomeGrid.getParentId(t)),u=HomeGrid.getParentId(e);if(m==c)if(u!=t){var p=[];p=HomeGrid.getAllSubItems(t).split(",");var C=HomeGrid.cells(e,HomeGrid.getColIndexById("id")).getValue(),I=HomeGrid.cells(t,HomeGrid.getColIndexById("id")).getValue(),g=HomeGrid.cells(e,TaskNameColIndex).getValue(),f="";for(a in p)if(""+p[a]!=""&&""+p[a]!=null&&(f=HomeGrid.cells(""+p[a],TaskNameColIndex).getValue(),f==g))return alert("Tactic with same title already exist in Targeted Program."),!1;ProgarmName=HomeGrid.cells(t,TaskNameColIndex).getValue(),$("#lipname").html(ProgarmName),$("#hdnsourceid").val(C),$("#hdndestid").val(I),$("#divMovetacticPopup").modal("show"),RemoveAllHoneyCombData()}else ProgarmName=HomeGrid.cells(t,TaskNameColIndex).getValue(),alert("Tactic is already in "+ProgarmName+".");else alert("Tactic can move only to same plan program.");return!1}return alert(i+" can not move to "+o),!1}return alert("Only tactic can Move."),!1}}}function SaveMoveTactic(){var e=$("#hdnsourceid").val(),t=$("#hdndestid").val();$.ajax({type:"POST",url:urlContent+"Plan/SaveGridDetail",data:{UpdateType:"tactic",UpdateColumn:"ParentID",UpdateVal:t,Id:parseInt(e)},dataType:"json",success:function(){HomeGrid.saveOpenStates("plangridState"),LoadPlanGrid()}})}function formatDate(e){function t(e){return 10>e?"0"+e:""+e}return e=new Date(e),t(e.getMonth()+1)+"/"+t(e.getDate())+"/"+e.getFullYear()}function SetColumUpdatedValue(e,t){progActVal=HomeGrid.cells(progid,e).getValue(),CampActVal=HomeGrid.cells(campid,e).getValue(),PlanActVal=HomeGrid.cells(planid,e).getValue(),newProgVal=parseInt(ReplaceCC(""+progActVal))+parseInt(t),newCampVal=parseInt(ReplaceCC(""+CampActVal))+parseInt(t),newPlanVal=parseInt(ReplaceCC(""+PlanActVal))+parseInt(t)}function doOnEditCell(e,t,a,d,i){updatetype=HomeGrid.cells(t,ActivitypeHidden).getValue();var o,l,r,n=this.cell.cellIndex,s=HomeGrid.getColType(a);if($(".popover").removeClass("in").addClass("out"),0==e){var c=HomeGrid.cells(t,a).getValue();c.indexOf("</div>")>-1&&(c.split("</div>").length>2?(value=c.split("</div>")[0]+"</div>"+c.split("</div>")[1],TacticName=c.split("</div>")[2]):(value=c.split("</div>")[0],TacticName=c.split("</div>")[1]))}else void 0!=d&&(TacticName=d);AssignParentIds(t),l=HomeGrid.getColumnId(n,0);var s=HomeGrid.getColType(a),m=HomeGrid.cells(planid,GridHiddenId).getValue();if(0==e){var u=HomeGrid.cells(t,a).getAttribute("lo");if(null!=u&&""!=u&&"1"==u)return!1;if("newRow_0"==t)return!1;if(n==TypeColIndex)if(updatetype.toLowerCase()==secLineItem){var p=HomeGrid.getCombo(a);p.clear(),lineItemTypefieldOptionList.length>0&&$.each(lineItemTypefieldOptionList,function(e,t){t.PlanId==m&&p.put(t.id,t.value)})}else{var p=HomeGrid.getCombo(a);p.clear(),tacticTypefieldOptionList.length>0&&$.each(tacticTypefieldOptionList,function(e,t){t.PlanId==m&&p.put(t.id,t.value)})}var C=HomeGrid.getColumnId(a);if(C.indexOf("custom_")>=0){var I=C.replace("custom_",""),g=I.split(":")[0],f=HomeGrid.cells(t,GridHiddenId).getValue();if(GetCustomfieldOptionlist(g,f,a,s),IsDependentTextBox)return!1}opencombobox()}if(1==e){if("clist"==s&&1==$(".dhx_clist input").length)return $(".dhx_clist").css("display","none"),!1;if(IsDependentTextBox)return!1;if(updatetype.toLowerCase()==secLineItem.toLowerCase()||updatetype.toLowerCase()==secTactic.toLowerCase()){var G=HomeGrid.cells(t,a).getValue(),H=HomeGrid.cells(t,a).getAttribute("actval");if(isNaN(parseInt(G))){var v;v=updatetype.toLowerCase()==secLineItem?lineItemTypefieldOptionList:tacticTypefieldOptionList;var y=v.filter(function(e){return e.PlanId==m&&""+e.value.trim().toLowerCase()==""+G.trim().toLowerCase()?e.id:void 0});y.length>0&&(H=y[0].id)}else H=G;if(1!=a)if(""==G)$('.dhx_combo_select option[value="'+G+'"]').remove();else{var x=parseInt(G);isNaN(x)?($('.dhx_combo_select option[value="'+G+'"]').remove(),$(".dhx_combo_select").val(H)):$(".dhx_combo_select").val(H)}}if($(".dhx_combo_edit").off("keydown"),(l==PlannedCostId||l==TargetStageGoalId)&&($(".dhx_combo_edit").on("keydown",function(e){GridPriceFormatKeydown(e)}),HomeGrid.editor.obj.onkeypress=function(e){if(e=e||window.event,e.keyCode>=47||0==e.keyCode){var t=this.value;if(t.length>10)return!1}}),l==TargetStageGoalId){var T=HomeGrid.cells(t,TargetStageGoalColIndex).getValue().split(" ");this.editor.obj.value=ReplaceCC(T[0])}if(l==PlannedCostId){var D=HomeGrid.cells(t,PlannedCostColIndex).getValue().replace(CurrencySybmol,"");this.editor.obj.value=ReplaceCC(""+D)}}if(2==e&&(null!=d.trim()&&""!=d.trim()||(""+l).trim().indexOf("custom_")>=0)){var h="",V=htmlDecode(d),P=HomeGrid.cells(t,GridHiddenId).getValue();if(void 0!=AssetTypeColIndex&&(h=HomeGrid.cells(t,AssetTypeColIndex).getValue()),(""==l||null==l)&&(l=HomeGrid.getColumnId(n,0)),l==TaskNameId&&0==CheckHtmlTag(d))return alert(TitleContainHTMLString),!1;if(1==a&&$("div[taskId='"+P+"']").attr("taskname",V),ExportSelectedIds.TaskID.length>0){var w=ExportSelectedIds.Title.indexOf(i);0>w||(ExportSelectedIds.Title[w]=V)}if(o=HomeGrid.cells(t,GridHiddenId).getValue(),l==StartDateId){var S=new Date(HomeGrid.cells(planid,StartDateColIndex).getValue()).getFullYear(),b=HomeGrid.cells(t,EndDateColIndex).getValue();if(!CheckDateYear(d,S,StartDateCurrentYear))return!1;if(!validateDateCompare(d,b,DateComapreValidation))return!1;if(updatetype.toLowerCase()==secProgram.toLowerCase()){var L=HomeGrid.getUserData(t,"tsdate");if(!validateDateCompare(d,L,TacticStartDateCompareWithParentStartDate))return!1}if(updatetype.toLowerCase()==secCampaign.toLowerCase()){var O=HomeGrid.getUserData(t,"psdate"),L=HomeGrid.getUserData(t,"tsdate");if(!validateDateCompare(d,O,ProgramStartDateCompareWithParentStartDate))return!1;if(!validateDateCompare(d,L,TacticStartDateCompareWithParentStartDate))return!1}d=formatDate(d),i=formatDate(i)}if(l==PlannedCostId&&(d=d.replace(CurrencySybmol,""),i=i.replace(CurrencySybmol,"")),l==EndDateId){var k=new Date(HomeGrid.cells(planid,StartDateColIndex).getValue()).getFullYear(),N=HomeGrid.cells(t,StartDateColIndex).getValue();if(!CheckDateYear(d,k,EndDateCurrentYear))return!1;if(!validateDateCompare(N,d,DateComapreValidation))return!1;if(updatetype.toLowerCase()==secProgram.toLowerCase()){var A=HomeGrid.getUserData(t,"tedate");if(!validateDateCompare(A,d,TacticEndDateCompareWithParentEndDate))return!1}if(updatetype.toLowerCase()==secCampaign.toLowerCase()){var M=HomeGrid.getUserData(t,"pedate"),A=HomeGrid.getUserData(t,"tedate");if(!validateDateCompare(M,d,ProgramEndDateCompareWithParentEndDate))return!1;if(!validateDateCompare(A,d,TacticEndDateCompareWithParentEndDate))return!1}d=formatDate(d),i=formatDate(i)}if((""+l).trim()==TargetStageGoalId){var E=i.split(" ");if(d!=ReplaceCC(E[0])){var U=(HomeGrid.getColIndexById("tactictype"),HomeGrid.getUserData(t,"tactictype"));return GetConversionRate(o,U,l,d,t,d,null),!0}return!1}if((""+l).trim().indexOf("custom_")>=0){var C=l,I=C.replace("custom_",""),g=I.split(":")[0];if(null==d||void 0==d||d==i)return!1;var _=d.split(",");if(_customFieldValues=[],_.length>0){var B=_.length,R=parseInt(100/B),F=parseInt(100%B),j=B-F,W=0;$.each(_,function(e){W+=1,weight=W>j||j==_customFieldValues.length-1?R+1:R,_customFieldValues.push({customFieldId:g,Value:htmlEncode(_[e]),Weight:weight,CostWeight:weight})})}_customFieldValues=JSON.stringify(_customFieldValues)}if(l==TacticTypeId&&updatetype.toLowerCase()==secTactic.toLowerCase()){var y=tacticTypefieldOptionList.filter(function(e){return e.PlanId==m&&""+e.value.trim().toLowerCase()==""+i.trim().toLowerCase()?e.id:void 0});y.length>0&&(i=y[0].id);var U=d,Q=$(HomeGrid.getRowById(t)).find("div.honeycombbox-icon-gantt"),Y=tacticTypefieldOptionList,q=Y.filter(function(e){return e.id==U});if(null!=q&&q.length>0&&(q=q[0].Type),void 0!=Q&&null!=Q){var z=Q.attr("anchortacticid");if(null!=z&&"0"!=z&&null!=h&&""!=h&&h!=q&&h.toLowerCase()==AssetTypeAsset.toLowerCase()){var J=confirm("Package associated to this tactic will be deleted. Do you wish to continue?");if(!J)return!1}}if("true"==IsMediaCodePermission&&null!=q&&""!=q&&h!=q&&q.toLowerCase()==AssetTypeAsset.toLowerCase()){var J=confirm("Media code associated to this tactic will be deleted. Do you wish to continue?");if(!J)return!1}if(d!=i)return $.ajax({type:"POST",url:urlContent+"Plan/LoadTacticTypeValue",data:{tacticTypeId:U},success:function(e){var a=HomeGrid.cells(t,GridHiddenId).getValue();if(ExportSelectedIds.TaskID.length>0){var i=$("div[taskId='"+a+"']").attr("TacticType"),r=ExportSelectedIds.TacticType.indexOf(i);0>r||""==e.TacticTypeName||(ExportSelectedIds.TacticType[r]=e.TacticTypeName)}""!=e.TacticTypeName&&null!=e.TacticTypeName&&($("div[taskId='"+a+"']").attr("tactictype",e.TacticTypeName),$("div[taskId='"+a+"']").attr("roitactictype",q)),pcost=e.revenue;var n=e.stageTitle,s=e.projectedStageValue;HomeGrid.cells(t,TargetStageGoalColIndex).setValue(parseFloat(s)>0?FormatCommas(""+s,!1)+" "+n:s+" "+n),HomeGrid.setUserData(t,"stage",n),HomeGrid.setUserData(t,"tactictype",U),GetConversionRate(o,U,l,s,t,d,e.stageId)}}),!0}if(updatetype.toLowerCase()==secLineItem.toLowerCase()){if(l==TacticTypeId){var K=lineItemTypefieldOptionList.filter(function(e){return e.PlanId==m&&""+e.value.trim().toLowerCase()==""+i.trim().toLowerCase()?e.id:void 0});K.length>0&&(i=K[0].id)}var H=HomeGrid.cells(t,a).getAttribute("actval");if((null==H||""==H)&&(H=i),d!=i&&d!=H){r=d;var X=HomeGrid.getAllSubItems(tactid);$.ajax({type:"POST",url:urlContent+"Plan/SaveGridDetail",data:{UpdateType:updatetype,UpdateColumn:l.trim(),UpdateVal:r,Id:parseInt(o),CustomFieldInput:_customFieldValues,ColumnType:""+s,oValue:""+i},dataType:"json",success:function(e){if(HomeGrid.saveOpenStates("plangridState"),null!=e.errormsg&&""!=e.errormsg.trim())return alert(e.errormsg.trim()),HomeGrid.cells(t,a).setValue(i),!1;if(l==PlannedCostId){diff=parseInt(e.lineItemCost)-parseInt(ReplaceCC(i));for(var o=0;o<X.split(",").length;o++)"False"!=HomeGrid.getUserData(X.split(",")[o],"IsOther")&&HomeGrid.cells(X.split(",")[o],PlannedCostColIndex).setValue(CurrencySybmol+(e.tacticCost-e.lineItemCost));RefershPlanHeaderCalc(),ItemIndex=HomeGrid.getRowIndex(tactid),state0=ItemIndex,HomeGrid.cells(t,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(d))}if((l==PlannedCostId||l==TaskNameId)&&e.linkTacticId>0&&LoadPlanGrid(),(""+l).trim().indexOf("custom_")>=0){var r=e.DependentCustomfield;if(null!=r&&void 0!=r)for(var o=0;o<r.length;o++){var n=HomeGrid.getColIndexById(r[o].CustomFieldId);void 0!=n&&""!=n&&HomeGrid.cells(t,n).setValue(r[o].OptionValue)}}}})}return!0}if(htmlDecode(d)!=i){if(l!=TacticTypeId&&(""+l).trim()!=TargetStageGoalId){progid=HomeGrid.getParentId(t),campid=HomeGrid.getParentId(progid),planid=HomeGrid.getParentId(campid);var X=HomeGrid.getAllSubItems(t);r=d,$.ajax({type:"POST",url:urlContent+"Plan/SaveGridDetail",data:{UpdateType:updatetype,UpdateColumn:l.trim(),UpdateVal:r,Id:parseInt(o),CustomFieldInput:_customFieldValues,ColumnType:""+s,oValue:""+i},dataType:"json",success:function(e){HomeGrid.saveOpenStates("plangridState");var r=HomeGrid.cells(t,GridHiddenId).getValue(),n=$("div[taskId='"+r+"']").attr("OwnerName");if(ExportSelectedIds.TaskID.length>0){var s=ExportSelectedIds.OwnerName.indexOf(n);0>s||""==e.OwnerName||(ExportSelectedIds.OwnerName[s]=e.OwnerName)}if(""!=e.OwnerName&&null!=e.OwnerName&&$("div[taskId='"+r+"']").attr("ownername",e.OwnerName),null!=e.errormsg&&""!=e.errormsg.trim())return alert(e.errormsg.trim()),HomeGrid.cells(t,a).setValue(i),!1;if(l==StartDateId){if(e.IsExtended)return alert("Since the Tactic is link to another Plan, it cannot be extended"),HomeGrid.cells(t,a).setValue(i),!1;var c=HomeGrid.cells(t,EndDateColIndex).getValue(),m=new Date(c).getFullYear(),u=new Date(d).getFullYear(),p=m-u,C=new Date(i).getFullYear(),I=C-u;if(p>0){var g=HomeGrid.cells(t,TaskNameColIndex).getValue(),f=g.indexOf("unlink-icon");if(-1>=f){var G="<div class='unlink-icon unlink-icon-grid'><i class='fa fa-chain-broken'></i></div>";HomeGrid.cells(t,TaskNameColIndex).setValue(G+g),$("div[tacticaddId='"+r+"']").attr("linktacticper","True")}}else{if(0==I)return!1;var g=HomeGrid.cells(t,TaskNameColIndex).getValue(),f=g.indexOf("</div>");f>-1&&(HomeGrid.cells(t,TaskNameColIndex).setValue(g.split("</div>")[1]),$("div[tacticaddId='"+r+"']").attr("linktacticper","False"))}ComapreDate(updatetype,t,StartDateColIndex,d,l)}if(l==EndDateId){if(e.IsExtended)return alert("Since the Tactic is link to another Plan, it cannot be extended"),HomeGrid.cells(t,a).setValue(i),!1;var H=HomeGrid.cells(t,StartDateColIndex).getValue(),u=new Date(H).getFullYear(),m=new Date(d).getFullYear(),p=m-u,C=new Date(i).getFullYear(),I=C-u;if(p>0){var g=HomeGrid.cells(t,TaskNameColIndex).getValue(),f=g.indexOf("unlink-icon");if(-1>=f){var G="<div class='unlink-icon unlink-icon-grid'><i class='fa fa-chain-broken'></i></div>";HomeGrid.cells(t,TaskNameColIndex).setValue(G+g),$("div[tacticaddId='"+r+"']").attr("linktacticper","True")}}else{if(0==I)return!1;var g=HomeGrid.cells(t,TaskNameColIndex).getValue(),f=g.indexOf("</div>");f>-1&&(HomeGrid.cells(t,TaskNameColIndex).setValue(g.split("</div>")[1]),$("div[tacticaddId='"+r+"']").attr("linktacticper","False"))}ComapreDate(updatetype,t,EndDateColIndex,d,l)}if(l==PlannedCostId){var v=parseInt(ReplaceCC(d).replace(CurrencySybmol,"")),y=parseInt(ReplaceCC(i).replace(CurrencySybmol,""));if(diff=v-y,SetColumUpdatedValue(PlannedCostColIndex,diff),HomeGrid.cells(progid,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(newProgVal)),HomeGrid.cells(campid,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(newCampVal)),HomeGrid.cells(planid,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(newPlanVal)),HomeGrid.cells(t,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(v)),null!=X&&""!=X&&X.length>0)for(var x=0;x<X.split(",").length;x++)"False"!=HomeGrid.getUserData(X.split(",")[x],"IsOther")&&HomeGrid.cells(X.split(",")[x],PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(v-e.lineItemCost))}if((l==PlannedCostId||l==TaskNameId)&&(e.linkTacticId>0&&LoadPlanGrid(),RefershPlanHeaderCalc(),ItemIndex=HomeGrid.getRowIndex(t),state0=ItemIndex),l==OwnerId&&(""+n!=""+e.OwnerName&&""!=e.OwnerName&&null!=e.OwnerName&&0!=planid&&null!=planid&&void 0!=planid&&(GetTacticTypelist(filters.PlanIDs),GetOwnerListForFilter(filters.PlanIDs),SaveLastSetofViews()),CheckPermissionByOwner(t,d,updatetype,parseInt(o))),l==TaskNameId&&($("#txtGlobalSearch").val(""),$("#ExpClose").css("display","none"),$("#ExpSearch").css("display","block"),GlobalSearch()),(""+l).trim().indexOf("custom_")>=0){var T=e.DependentCustomfield;if(null!=T&&void 0!=T)for(var x=0;x<T.length;x++){var D=HomeGrid.getColIndexById(T[x].CustomFieldId);void 0!=D&&""!=D&&HomeGrid.cells(t,D).setValue(T[x].OptionValue)}}}})}return a==TaskNameColIndex&&HomeGrid.cells(t,a).setValue(void 0!=value&&"undefined"!=value&&null!=value?value+"</div>"+TacticName:TacticName),value="",$("div[id^='LinkIcon']").each(function(){bootstrapetitle($(this),"This tactic is linked to <U>"+htmlDecode($(this).attr("linkedplanname")+"</U>"),"tipsy-innerWhite")}),!0}return a==TaskNameColIndex&&HomeGrid.cells(t,a).setValue(void 0!=value&&"undefined"!=value&&null!=value?value+"</div>"+TacticName:TacticName),value="",$("div[id^='LinkIcon']").each(function(){bootstrapetitle($(this),"This tactic is linked to <U>"+htmlDecode($(this).attr("linkedplanname")+"</U>"),"tipsy-innerWhite")}),!0}}function AssignParentIds(e){updatetype.toLowerCase()==secTactic?(tactid=e,progid=HomeGrid.getParentId(e),campid=HomeGrid.getParentId(progid),planid=HomeGrid.getParentId(campid)):updatetype.toLowerCase()==secLineItem?(tactid=HomeGrid.getParentId(e),progid=HomeGrid.getParentId(tactid),campid=HomeGrid.getParentId(progid),planid=HomeGrid.getParentId(campid)):updatetype.toLowerCase()==secProgram?(campid=HomeGrid.getParentId(e),planid=HomeGrid.getParentId(campid)):updatetype.toLowerCase()==secCampaign?planid=HomeGrid.getParentId(e):updatetype.toLowerCase()==secPlan&&(planid=e)}function CheckPermissionByOwner(e,t,a,d){$.ajax({type:"POST",url:urlContent+"Plan/CheckPermissionByOwner",data:{NewOwnerID:t,UpdateType:a,updatedid:parseInt(d)},dataType:"json",success:function(t){"1"==t.IsLocked&&(HomeGrid.cells(e,TaskNameColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,StartDateColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,EndDateColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,PlannedCostColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,AssetTypeColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,TypeColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,OwnerColIndex).setAttribute("lo",t.IsLocked),HomeGrid.cells(e,TargetStageGoalColIndex).setAttribute("lo",t.IsLocked),HomeGrid.setCellTextStyle(e,TaskNameColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,StartDateColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,EndDateColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,PlannedCostColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,AssetTypeColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,TypeColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,OwnerColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,TargetStageGoalColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,MQLColIndex,t.cellTextColor),HomeGrid.setCellTextStyle(e,RevenueColIndex,t.cellTextColor))},error:function(){}})}function GetConversionRate(e,t,a,d,i,o,l){var r=!0,n=0,s=0;progid=HomeGrid.getParentId(i),campid=HomeGrid.getParentId(progid),planid=HomeGrid.getParentId(campid),n=d,$.ajax({type:"POST",url:urlContent+"Plan/CalculateMQL",data:{tactictid:parseInt(e),TacticTypeId:parseInt(t),projectedStageValue:n,RedirectType:r,isTacticTypeChange:!0,StageID:l},success:function(t){if(void 0!=MQLColIndex&&null!=MQLColIndex){var d=HomeGrid.cells(i,MQLColIndex).getValue(),l=0;if(null!=t.revenue&&(s=t.revenue),"N/A"==t.mql)HomeGrid.setCellExcellType(i,MQLColIndex,"ro"),HomeGrid.cells(i,MQLColIndex).setValue(t.mql),diff=parseInt(-d),SetColumUpdatedValue(MQLColIndex,diff);else{null!=t.mql&&(l=t.mql);var r=""+l;HomeGrid.cells(i,MQLColIndex).setValue(numberWithCommas(r)),diff=parseInt(l)-parseInt(ReplaceCC(""+d)),SetColumUpdatedValue(MQLColIndex,diff)}HomeGrid.cells(progid,MQLColIndex).setValue(numberWithCommas(newProgVal),!1),HomeGrid.cells(campid,MQLColIndex).setValue(numberWithCommas(newCampVal),!1),HomeGrid.cells(planid,MQLColIndex).setValue(numberWithCommas(newPlanVal),!1);var n=HomeGrid.cells(i,RevenueColIndex).getValue();HomeGrid.cells(i,RevenueColIndex).setValue(CurrencySybmol+numberWithCommas(""+parseInt(s))),diff=parseInt(s)-parseInt(ReplaceCC(""+n).replace(CurrencySybmol,"")),SetColumUpdatedValue(RevenueColIndex,diff),HomeGrid.cells(progid,RevenueColIndex).setValue(CurrencySybmol+numberWithCommas(newProgVal)),HomeGrid.cells(campid,RevenueColIndex).setValue(CurrencySybmol+numberWithCommas(newCampVal)),HomeGrid.cells(planid,RevenueColIndex).setValue(CurrencySybmol+numberWithCommas(newPlanVal))}$.ajax({type:"POST",url:urlContent+"Plan/SaveGridDetail",data:{UpdateType:"Tactic",UpdateColumn:a.trim(),UpdateVal:o,Id:parseInt(e)},dataType:"json",success:function(e){if(HomeGrid.saveOpenStates("plangridState"),a==TargetStageGoalId){var t=HomeGrid.getUserData(i,"stage");HomeGrid.cells(i,TargetStageGoalColIndex).setValue(FormatCommas(""+o)+" "+t),RefershPlanHeaderCalc()}if(a==TacticTypeId){{HomeGrid.cells(planid,GridHiddenId).getValue()}$("#ulTacticType li input[type=checkbox]").each(function(){var e=$(this).attr("id");"checked"!=$(this).attr("checked")&&filters.tempTacticTypeIds.push(e.replace("CbTT",""))}),GetTacticTypelist(filters.PlanIDs,!1),SaveLastSetofViews();var d=HomeGrid.getAllSubItems(i),l=0;null!=e.TacticCost&&"undefined"!=e.TacticCost&&(l=e.TacticCost),PlannedCostColIndex=HomeGrid.getColIndexById(PlannedCostId);var r=HomeGrid.cells(i,PlannedCostColIndex).getValue();if(diff=parseInt(l)-parseInt(ReplaceCC(""+r)),SetColumUpdatedValue(PlannedCostColIndex,diff),HomeGrid.cells(progid,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(newProgVal)),HomeGrid.cells(campid,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(newCampVal)),HomeGrid.cells(planid,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(newPlanVal)),HomeGrid.cells(i,PlannedCostColIndex).setValue(CurrencySybmol+numberWithCommas(l)),null!=d&&""!=d&&d.length>0)for(var n=0;n<d.split(",").length;n++)"False"!=HomeGrid.getUserData(d.split(",")[n],"IsOther")&&HomeGrid.cells(d.split(",")[n],PlannedCostColIndex).setValue(CurrencySybmol+(l-e.lineItemCost));e.linkTacticId>0&&LoadPlanGrid(),RefershPlanHeaderCalc(),ItemIndex=HomeGrid.getRowIndex(i),state0=ItemIndex}}})}})}function ComapreDate(e,t,a,d,i){var o=new Date(formatDate(d));if(e.toLowerCase()==secTactic){progid=HomeGrid.getParentId(t),campid=HomeGrid.getParentId(progid),planid=HomeGrid.getParentId(campid);var l=HomeGrid.cells(progid,GridHiddenId).getValue(),r=HomeGrid.cells(campid,GridHiddenId).getValue(),n=new Date(formatDate(HomeGrid.cells(progid,a).getValue())),s=new Date(formatDate(HomeGrid.cells(campid,a).getValue())),c=new Date(formatDate(HomeGrid.cells(planid,a).getValue()));if(i==StartDateId){n>o&&HomeGrid.cells(progid,a).setValue(formatDate(d)),s>o&&HomeGrid.cells(campid,a).setValue(formatDate(d)),c>o&&HomeGrid.cells(planid,a).setValue(formatDate(d));var m=HomeGrid.getUserData(progid,"tsdate"),u=HomeGrid.getUserData(campid,"psdate");$.ajax({type:"POST",url:urlContent+"GetMinMaxDate",data:{Parentid:parseInt(r),UpdateType:"Tactic",updatedid:parseInt(l)},dataType:"json",success:function(e){formatDate(e.TactMinDate)!=formatDate(m)&&HomeGrid.setUserData(progid,"tsdate",formatDate(e.TactMinDate)),formatDate(e.TactMinDate)!=formatDate(m)&&HomeGrid.setUserData(campid,"tsdate",formatDate(e.TactMinDate)),formatDate(e.ProgMinDate)!=formatDate(u)&&HomeGrid.setUserData(campid,"psdate",formatDate(e.ProgMinDate))},error:function(){}})}else if(i==EndDateId){o>n&&HomeGrid.cells(progid,a).setValue(formatDate(d)),o>s&&HomeGrid.cells(campid,a).setValue(formatDate(d)),o>c&&HomeGrid.cells(planid,a).setValue(formatDate(d));var p=HomeGrid.getUserData(progid,"tedate"),C=HomeGrid.getUserData(campid,"pedate");$.ajax({type:"POST",url:urlContent+"Plan/GetMinMaxDate",data:{Parentid:parseInt(r),UpdateType:"Tactic",updatedid:parseInt(l)},dataType:"json",success:function(e){formatDate(e.TactMaxDate)!=formatDate(p)&&HomeGrid.setUserData(progid,"tedate",formatDate(e.TactMaxDate)),formatDate(e.TactMaxDate)!=formatDate(p)&&HomeGrid.setUserData(campid,"tedate",formatDate(e.TactMaxDate)),formatDate(e.ProgMaxDate)!=formatDate(C)&&HomeGrid.setUserData(campid,"psdate",formatDate(e.ProgMaxDate))}})}}else if(e.ToLower()==secProgram){campid=HomeGrid.getParentId(t),planid=HomeGrid.getParentId(campid);var l=HomeGrid.cells(t,3).getValue(),r=HomeGrid.cells(campid,3).getValue(),s=new Date(formatDate(HomeGrid.cells(campid,a).getValue())),c=new Date(formatDate(HomeGrid.cells(planid,a).getValue()));if(i==StartDateId){s>o&&HomeGrid.cells(campid,a).setValue(formatDate(d)),c>o&&HomeGrid.cells(planid,a).setValue(formatDate(d));var u=HomeGrid.getUserData(campid,"psdate"),I=HomeGrid.getUserData(campid,"tsdate");$.ajax({type:"POST",url:urlContent+"Plan/GetMinMaxDate",data:{Parentid:parseInt(r),UpdateType:"Program",updatedid:parseInt(l)},dataType:"json",success:function(e){formatDate(e.TactMinDate)!=formatDate(I)&&HomeGrid.setUserData(campid,"tsdate",formatDate(e.TactMinDate)),formatDate(e.ProgMinDate)!=formatDate(u)&&HomeGrid.setUserData(campid,"psdate",formatDate(e.ProgMinDate))},error:function(){}})}else if(i==EndDateId){o>s&&HomeGrid.cells(campid,a).setValue(formatDate(d)),o>c&&HomeGrid.cells(planid,a).setValue(formatDate(d));var C=HomeGrid.getUserData(campid,"pedate"),g=HomeGrid.getUserData(campid,"tedate");$.ajax({type:"POST",url:urlContent+"Plan/GetMinMaxDate",data:{Parentid:parseInt(r),UpdateType:"Program",updatedid:parseInt(l)},dataType:"json",success:function(e){formatDate(e.TactMaxDate)!=formatDate(g)&&HomeGrid.setUserData(campid,"tedate",formatDate(e.TactMaxDate)),formatDate(e.ProgMaxDate)!=formatDate(C)&&HomeGrid.setUserData(campid,"pedate",formatDate(e.ProgMaxDate))},error:function(){}})}}else if(e.toLowerCase()==secCampaign){planid=HomeGrid.getParentId(t);var c=new Date(formatDate(HomeGrid.cells(planid,a).getValue()));i==StartDateId?c>o&&HomeGrid.cells(planid,a).setValue(formatDate(d)):i==EndDateId&&o>c&&HomeGrid.cells(planid,a).setValue(formatDate(d))}}function ExportToExcel(e){var t=[],a=[],d=HomeGrid.getColIndexById("Add"),o=HomeGrid.getColIndexById("ColourCode"),l=(HomeGrid.getColIndexById("MachineName"),HomeGrid.getColIndexById("Type")),r=HomeGrid.getColIndexById("ActivityId");"budget"==gridname.toLowerCase()&&(d=HomeGrid.getColIndexById("Buttons"),o=HomeGrid.getColIndexById("colourcode")),e&&HomeGrid.forEachRow(function(e){var i=HomeGrid.cells(e,d).getValue();i.indexOf("honeycombbox-icon-gantt-Active")>-1?a.push(e):(HomeGrid.setRowHidden(e,!0),t.push(e))}),HomeGrid.saveOpenStates("plangridState"),HomeGrid.expandAll();HomeGrid.getColIndexById("ActivityId");if("home"==gridname.toLowerCase())HomeGrid.setColumnHidden(d,!0),HomeGrid.setColumnHidden(o,!0);else{HomeGrid.setColumnHidden(r,!1),HomeGrid.setColumnHidden(l,!1);var n=ColumnIds.split(","),s="";for(i=0;i<n.length;++i)s+=0==i?"MachineName"==n[i]||"LineItemTypeId"==n[i]||"Buttons"==n[i]||"colourcode"==n[i]?"false":"true":"MachineName"==n[i]||"LineItemTypeId"==n[i]||"Buttons"==n[i]||"colourcode"==n[i]?",false":",true";HomeGrid.setSerializableColumns(s)}HomeGrid.toExcel("https://dhtmlxgrid.appspot.com/export/excel"),HomeGrid.collapseAll(),HomeGrid.loadOpenStates("plangridState"),"home"==gridname.toLowerCase()?(HomeGrid.setColumnHidden(d,!1),HomeGrid.setColumnHidden(o,!1)):(HomeGrid.setColumnHidden(r,!0),HomeGrid.setColumnHidden(l,!0)),void 0!=t&&$.each(t,function(e){HomeGrid.setRowHidden(t[e],!1)}),void 0!=a&&$.each(a,function(e){var t=HomeGrid.cells(a[e],d).getValue();t.indexOf("honeycombbox-icon-gantt-Active")>-1||HomeGrid.cells(a[e],d).setValue(t.replace("honeycombbox-icon-gantt","honeycombbox-icon-gantt honeycombbox-icon-gantt-Active"))})}function GetCustomfieldOptionlist(e,t,a,i){function o(t){return t.customFieldId==e&&null!=t.ParentOptionId&&t.ParentOptionId.length>0?!0:!1}function l(t){return t.customFieldId==e?!0:!1}var r,n=customfieldOptionList,s=[];if(d=n.filter(o),IsDependentTextBox=!1,null!=d&&d.length>0){var c=[];$.each(d,function(e,t){c.indexOf(t.ParentOptionId[0])<0&&c.push(t.ParentOptionId[0])}),$.ajax({url:urlContent+"Plan/GetdependantOptionlist/",traditional:!0,async:!1,data:{customfieldId:e,entityid:t,parentoptionId:c,Customfieldtype:i},success:function(e){return"ed"==i&&"true"==(""+e.IstextBoxDependent).toLowerCase()?(IsDependentTextBox=!0,!1):(null!=e&&null!=e.optionlist&&e.optionlist.length>0&&(r=e.optionlist),void(null!=r&&r.length>0&&void 0!=r?($.each(r,function(e,t){-1==s.indexOf(t.value)&&s.push(t.value)}),HomeGrid.registerCList(a,s)):HomeGrid.registerCList(a,s)))}})}else r=n.filter(l),$.each(r,function(e,t){s.push(t.value)}),HomeGrid.registerCList(a,s)}function opencombobox(){var e=$(".rowselected td").offset().top,t=$(".objbox").height(),a=e-t;a>200?$("body").addClass("reverse"):$("body").removeClass("reverse")}var eventiddrag=0,eventidonedit=0,eventidonbeforedrag=0,eventidonscroll=0,editidonOpenEnd=0,updatetype=0,progid=0,campid=0,planid=0,tactid=0,progActVal=0,CampActVal=0,PlanActVal=0,TactActVal=0,diff=0,newProgVal=0,newCampVal=0,newPlanVal=0,newTactVal=0,value,TacticName,ExportToCsv=!1,_customFieldValues=[],IsDependentTextBox=!1,NodatawithfilterGrid='<div id="NodatawithfilterGrid" style="display:none;"><span class="pull-left margin_t30 bold " style="margin-left: 20px;">No data exists. Please check the filters or grouping applied.</span><br/></div>',SetTooltipFirstTime=!0;SetTooltip();var $doc=$(document);$doc.click(function(){$("#popupType").css("display","none"),$("#dhx_combo_select").css("display","none"),$(".dhx_clist").css("display","none")
}),$(document).mouseup(function(){$("#popupType").css("display","none"),$("#dhx_combo_select").css("display","none")}),$(".grid_ver_scroll").scroll(function(){$("#popupType").css("display","none"),$(".dhx_clist").css("display","none")});