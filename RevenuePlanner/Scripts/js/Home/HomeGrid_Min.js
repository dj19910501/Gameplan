function SetTooltip() { SetTooltipFirstTime && (SetTooltipFirstTime = !1, $(document.body).tooltip({ container: "body", placement: "bottom", selector: ".grid_Search,.grid_add,.honeycombbox-icon-gantt" })) } function GridHideColumn() { StartDateColIndex = HomeGrid.getColIndexById(StartDateId), EndDateColIndex = HomeGrid.getColIndexById(EndDateId), TaskNameColIndex = HomeGrid.getColIndexById(TaskNameId), PlannedCostColIndex = HomeGrid.getColIndexById(PlannedCostId), AssetTypeColIndex = HomeGrid.getColIndexById(AssetTypeId), TypeColIndex = HomeGrid.getColIndexById(TacticTypeId), OwnerColIndex = HomeGrid.getColIndexById(OwnerId), TargetStageGoalColIndex = HomeGrid.getColIndexById(TargetStageGoalId), MQLColIndex = HomeGrid.getColIndexById(MQLId), RevenueColIndex = HomeGrid.getColIndexById(RevenueId), GridHiddenId = HomeGrid.getColIndexById("id"), ActivitypeHidden = HomeGrid.getColIndexById(ActivityTypeId), MachineNameHidden = HomeGrid.getColIndexById(MachineNameId), HomeGrid.setColumnHidden(GridHiddenId, !0), HomeGrid.setColumnHidden(ActivitypeHidden, !0), HomeGrid.setColumnHidden(MachineNameHidden, !0) } function MoveColumn() { HomeGrid.attachEvent("onAfterCMove", function (e, t) { for (var a = HomeGrid.getColumnCount(), i = [], o = "Common", l = 0; a > l; l++) { o = "Common"; var d = HomeGrid.getColWidth(l), r = HomeGrid.getColumnId(l).toString(); 0 != d && i.push({ AttributeId: r, AttributeType: o, ColumnOrder: parseInt(l) }) } null != i && i.length > 0 && void 0 != i && (i = JSON.stringify(i), $.ajax({ url: urlContent + "ColumnView/SaveColumnView", type: "post", dataType: "json", contentType: "application/json", data: "{'AttributeDetail':" + i + "}", success: function (e) { } })) }) } function LoadAfterParsing() { 0 != eventidonedit && HomeGrid.detachEvent(eventidonedit), eventidonedit = HomeGrid.attachEvent("onEditCell", doOnEditCell), 0 != eventiddrag && HomeGrid.detachEvent(eventiddrag), eventiddrag = HomeGrid.attachEvent("onDrag", doOnDrag), 0 != eventidonscroll && HomeGrid.detachEvent(eventidonscroll), eventidonscroll = HomeGrid.attachEvent("onScroll", function (e, t) { $(".dhx_combo_select").css("display", "none"), $(".dhtmlxcalendar_dhx_skyblue").css("display", "none"), $("#popupType").css("display", "none"), $(".dhx_clist").css("display", "none") }), 0 != eventidonbeforedrag && HomeGrid.detachEvent(eventidonbeforedrag), eventidonbeforedrag = HomeGrid.attachEvent("onBeforeDrag", function (e) { if ("" != e && void 0 != e) { var t = HomeGrid.cells(e, GridHiddenId).getValue(), a = HomeGrid.cells(e, ActivitypeHidden).getValue(); if (t.length > 0) { if (a.toLowerCase() != secTactic) return !1; var i = HomeGrid.cells(e, TaskNameColIndex).getAttribute("lo"); return null != i && "" != i && "1" == i ? !1 : !0 } } }), SetselectedRow() } function sort_Owner(e, t, a, i, o) { return e = HomeGrid.cells(i, OwnerColIndex).getText(), t = HomeGrid.cells(o, OwnerColIndex).getText(), "asc" == a ? e > t ? 1 : -1 : e > t ? -1 : 1 } function sort_TacticType(e, t, a, i, o) { var l = HomeGrid.cells(i, ActivitypeHidden).getValue(), d = HomeGrid.cells(o, ActivitypeHidden).getValue(); return l.toLowerCase() == secTactic.toLowerCase() && d.toLowerCase() == secTactic.toLowerCase() ? (e = HomeGrid.cells(i, TypeColIndex).getText(), t = HomeGrid.cells(o, TypeColIndex).getText(), "asc" == a ? e > t ? 1 : -1 : e > t ? -1 : 1) : 0 } function convertNumber(e) { var t = 0, a = parseFloat(e.replace(CurrencySybmol, "")); return t = e.toLowerCase().match(/k/) ? Math.round(1e3 * a) : e.toLowerCase().match(/m/) ? Math.round(1e6 * a) : e.toLowerCase().match(/b/) ? Math.round(1e9 * a) : numb.replace(CurrencySybmol, "") } function ResizeGrid(e) { $("#gridbox").attr("width", e), HomeGrid.setSizes(), LoadAfterParsing() } function doOnDrag(e, t) { var i = "", o = "", l = ""; if ("" != e && "" != t && void 0 != e && void 0 != t) { var d = HomeGrid.cells(e, GridHiddenId).getValue(), r = HomeGrid.cells(t, GridHiddenId).getValue(), n = HomeGrid.getParentId(e), s = HomeGrid.cells(n, GridHiddenId).getValue(); if (s.length > 0 && d.length > 0 && r.length > 0) { if (i = HomeGrid.cells(n, ActivitypeHidden).getValue(), o = HomeGrid.cells(e, ActivitypeHidden).getValue(), l = HomeGrid.cells(t, ActivitypeHidden).getValue(), o.toLowerCase() == secTactic) { if (i == l) { var c = HomeGrid.getParentId(HomeGrid.getParentId(HomeGrid.getParentId(e))), m = HomeGrid.getParentId(HomeGrid.getParentId(t)), u = HomeGrid.getParentId(e); if (m == c) if (u != t) { var p = new Array; p = HomeGrid.getAllSubItems(t).split(","); var C = HomeGrid.cells(e, HomeGrid.getColIndexById("id")).getValue(), I = HomeGrid.cells(t, HomeGrid.getColIndexById("id")).getValue(), g = HomeGrid.cells(e, TaskNameColIndex).getValue(), f = ""; for (a in p) if ("" != p[a].toString() && null != p[a].toString() && (f = HomeGrid.cells(p[a].toString(), TaskNameColIndex).getValue(), f == g)) return alert("Tactic with same title already exist in Targeted Program."), !1; ProgarmName = HomeGrid.cells(t, TaskNameColIndex).getValue(), $("#lipname").html(ProgarmName), $("#hdnsourceid").val(C), $("#hdndestid").val(I), $("#divMovetacticPopup").modal("show"), RemoveAllHoneyCombData() } else ProgarmName = HomeGrid.cells(t, TaskNameColIndex).getValue(), alert("Tactic is already in " + ProgarmName + "."); else alert("Tactic can move only to same plan program."); return !1 } return alert(o + " can not move to " + l), !1 } return alert("Only tactic can Move."), !1 } } } function SaveMoveTactic() { var e = $("#hdnsourceid").val(), t = $("#hdndestid").val(); $.ajax({ type: "POST", url: urlContent + "Plan/SaveGridDetail", data: { UpdateType: "tactic", UpdateColumn: "ParentID", UpdateVal: t, Id: parseInt(e) }, dataType: "json", success: function (e) { HomeGrid.saveOpenStates("plangridState"), LoadPlanGrid() } }) } function formatDate(e) { function t(e) { return 10 > e ? "0" + e : "" + e } return e = new Date(e), t(e.getMonth() + 1) + "/" + t(e.getDate()) + "/" + e.getFullYear() } function SetColumUpdatedValue(e, t) { progActVal = HomeGrid.cells(progid, e).getValue(), CampActVal = HomeGrid.cells(campid, e).getValue(), PlanActVal = HomeGrid.cells(planid, e).getValue(), newProgVal = parseInt(ReplaceCC(progActVal.toString())) + parseInt(t), newCampVal = parseInt(ReplaceCC(CampActVal.toString())) + parseInt(t), newPlanVal = parseInt(ReplaceCC(PlanActVal.toString())) + parseInt(t) } function doOnEditCell(e, t, a, i, o) { updatetype = HomeGrid.cells(t, ActivitypeHidden).getValue(); var l, d, r, n = this.cell.cellIndex, s = HomeGrid.getColType(a); if ($(".popover").removeClass("in").addClass("out"), 0 == e) { var c = HomeGrid.cells(t, a).getValue(); c.indexOf("</div>") > -1 && (c.split("</div>").length > 2 ? (value = c.split("</div>")[0] + "</div>" + c.split("</div>")[1], TacticName = c.split("</div>")[2]) : (value = c.split("</div>")[0], TacticName = c.split("</div>")[1])) } else void 0 != i && (TacticName = i); AssignParentIds(t), d = HomeGrid.getColumnId(n, 0); var s = HomeGrid.getColType(a), m = HomeGrid.cells(planid, GridHiddenId).getValue(); if (0 == e) { var u = HomeGrid.cells(t, a).getAttribute("lo"); if (null != u && "" != u && "1" == u) return !1; if ("newRow_0" == t) return !1; if (n == TypeColIndex) if (updatetype.toLowerCase() == secLineItem) { var p = HomeGrid.getCombo(a); p.clear(), lineItemTypefieldOptionList.length > 0 && $.each(lineItemTypefieldOptionList, function (e, t) { t.PlanId == m && p.put(t.id, t.value) }) } else { var p = HomeGrid.getCombo(a); p.clear(), tacticTypefieldOptionList.length > 0 && $.each(tacticTypefieldOptionList, function (e, t) { t.PlanId == m && p.put(t.id, t.value) }) } var C = HomeGrid.getColumnId(a); if (C.indexOf("custom_") >= 0) { var I = C.replace("custom_", ""), g = I.split(":")[0], f = HomeGrid.cells(t, GridHiddenId).getValue(); if (GetCustomfieldOptionlist(g, f, a, s), IsDependentTextBox) return !1 } opencombobox() } if (1 == e) { if ("clist" == s && 1 == $(".dhx_clist input").length) return $(".dhx_clist").css("display", "none"), !1; if (IsDependentTextBox) return !1; if (updatetype.toLowerCase() == secLineItem.toLowerCase() || updatetype.toLowerCase() == secTactic.toLowerCase()) { var G = HomeGrid.cells(t, a).getValue(), H = HomeGrid.cells(t, a).getAttribute("actval"); if (isNaN(parseInt(G))) { var v; v = updatetype.toLowerCase() == secLineItem ? lineItemTypefieldOptionList : tacticTypefieldOptionList; var x = v.filter(function (e) { return e.PlanId == m && e.value.trim().toLowerCase().toString() == G.trim().toLowerCase().toString() ? e.id : void 0 }); x.length > 0 && (H = x[0].id) } else H = G; if (1 != a) if ("" == G) $('.dhx_combo_select option[value="' + G + '"]').remove(); else { var y = parseInt(G); isNaN(y) ? ($('.dhx_combo_select option[value="' + G + '"]').remove(), $(".dhx_combo_select").val(H)) : $(".dhx_combo_select").val(H) } } if ($(".dhx_combo_edit").off("keydown"), (d == PlannedCostId || d == TargetStageGoalId) && ($(".dhx_combo_edit").on("keydown", function (e) { GridPriceFormatKeydown(e) }), HomeGrid.editor.obj.onkeypress = function (e) { if (e = e || window.event, e.keyCode >= 47 || 0 == e.keyCode) { var t = this.value; if (t.length > 10) return !1 } }), d == TargetStageGoalId) { var T = HomeGrid.cells(t, TargetStageGoalColIndex).getValue().split(" "); this.editor.obj.value = ReplaceCC(T[0]) } if (d == PlannedCostId) { var h = HomeGrid.cells(t, PlannedCostColIndex).getValue().replace(CurrencySybmol, ""); this.editor.obj.value = ReplaceCC(h.toString()) } } if (2 == e && (null != i.trim() && "" != i.trim() || d.toString().trim().indexOf("custom_") >= 0)) { var D = "", S = htmlDecode(i), P = HomeGrid.cells(t, GridHiddenId).getValue(); if (void 0 != AssetTypeColIndex && (D = HomeGrid.cells(t, AssetTypeColIndex).getValue()), ("" == d || null == d) && (d = HomeGrid.getColumnId(n, 0)), d == TaskNameId && 0 == CheckHtmlTag(i)) return alert(TitleContainHTMLString), !1; if (1 == a && $("div[taskId='" + P + "']").attr("taskname", S), ExportSelectedIds.TaskID.length > 0) { var V = ExportSelectedIds.Title.indexOf(o); V >= 0 && (ExportSelectedIds.Title[V] = S) } if (l = HomeGrid.cells(t, GridHiddenId).getValue(), d == StartDateId) { var w = new Date(HomeGrid.cells(planid, StartDateColIndex).getValue()).getFullYear(), b = HomeGrid.cells(t, EndDateColIndex).getValue(); if (!CheckDateYear(i, w, StartDateCurrentYear)) return !1; if (!validateDateCompare(i, b, DateComapreValidation)) return !1; if (updatetype.toLowerCase() == secProgram.toLowerCase()) { var L = HomeGrid.getUserData(t, "tsdate"); if (!validateDateCompare(i, L, TacticStartDateCompareWithParentStartDate)) return !1 } if (updatetype.toLowerCase() == secCampaign.toLowerCase()) { var O = HomeGrid.getUserData(t, "psdate"), L = HomeGrid.getUserData(t, "tsdate"); if (!validateDateCompare(i, O, ProgramStartDateCompareWithParentStartDate)) return !1; if (!validateDateCompare(i, L, TacticStartDateCompareWithParentStartDate)) return !1 } i = formatDate(i), o = formatDate(o) } if (d == PlannedCostId && (i = i.replace(CurrencySybmol, ""), o = o.replace(CurrencySybmol, "")), d == EndDateId) { var k = new Date(HomeGrid.cells(planid, StartDateColIndex).getValue()).getFullYear(), N = HomeGrid.cells(t, StartDateColIndex).getValue(); if (!CheckDateYear(i, k, EndDateCurrentYear)) return !1; if (!validateDateCompare(N, i, DateComapreValidation)) return !1; if (updatetype.toLowerCase() == secProgram.toLowerCase()) { var A = HomeGrid.getUserData(t, "tedate"); if (!validateDateCompare(A, i, TacticEndDateCompareWithParentEndDate)) return !1 } if (updatetype.toLowerCase() == secCampaign.toLowerCase()) { var E = HomeGrid.getUserData(t, "pedate"), A = HomeGrid.getUserData(t, "tedate"); if (!validateDateCompare(E, i, ProgramEndDateCompareWithParentEndDate)) return !1; if (!validateDateCompare(A, i, TacticEndDateCompareWithParentEndDate)) return !1 } i = formatDate(i), o = formatDate(o) } if (d.toString().trim() == TargetStageGoalId) { var M = o.split(" "); if (i != ReplaceCC(M[0])) { var U = (HomeGrid.getColIndexById("tactictype"), HomeGrid.getUserData(t, "tactictype")); return GetConversionRate(l, U, d, i, t, i, null), !0 } return !1 } if (d.toString().trim().indexOf("custom_") >= 0) { var C = d, I = C.replace("custom_", ""), g = I.split(":")[0]; if (null == i || void 0 == i || i == o) return !1; var _ = i.split(","); if (_customFieldValues = [], _.length > 0) { var F = _.length, B = parseInt(100 / F), R = parseInt(100 % F), j = F - R, W = 0; $.each(_, function (e) { W += 1, j >= W && j != _customFieldValues.length - 1 ? weight = B : weight = B + 1, _customFieldValues.push({ customFieldId: g, Value: htmlEncode(_[e]), Weight: weight, CostWeight: weight }) }) } _customFieldValues = JSON.stringify(_customFieldValues) } if (d == TacticTypeId && updatetype.toLowerCase() == secTactic.toLowerCase()) { var x = tacticTypefieldOptionList.filter(function (e) { return e.PlanId == m && e.value.trim().toLowerCase().toString() == o.trim().toLowerCase().toString() ? e.id : void 0 }); x.length > 0 && (o = x[0].id); var U = i, Q = $(HomeGrid.getRowById(t)).find("div.honeycombbox-icon-gantt"), Y = tacticTypefieldOptionList, q = Y.filter(function (e) { return e.id == U }); if (null != q && q.length > 0 && (q = q[0].Type), void 0 != Q && null != Q) { var z = Q.attr("anchortacticid"); if (null != z && "0" != z && null != D && "" != D && D != q && D.toLowerCase() == AssetTypeAsset.toLowerCase()) { var J = confirm("Package associated to this tactic will be deleted. Do you wish to continue?"); if (!J) return !1 } } if ("true" == IsMediaCodePermission && null != q && "" != q && D != q && q.toLowerCase() == AssetTypeAsset.toLowerCase()) { var J = confirm("Media code associated to this tactic will be deleted. Do you wish to continue?"); if (!J) return !1 } if (i != o) return $.ajax({ type: "POST", url: urlContent + "Plan/LoadTacticTypeValue", data: { tacticTypeId: U }, success: function (e) { var a = HomeGrid.cells(t, GridHiddenId).getValue(); if (ExportSelectedIds.TaskID.length > 0) { var o = $("div[taskId='" + a + "']").attr("TacticType"), r = ExportSelectedIds.TacticType.indexOf(o); r >= 0 && "" != e.TacticTypeName && (ExportSelectedIds.TacticType[r] = e.TacticTypeName) } "" != e.TacticTypeName && null != e.TacticTypeName && ($("div[taskId='" + a + "']").attr("tactictype", e.TacticTypeName), $("div[taskId='" + a + "']").attr("roitactictype", q)), pcost = e.revenue; var n = e.stageTitle, s = e.projectedStageValue; parseFloat(s) > 0 ? HomeGrid.cells(t, TargetStageGoalColIndex).setValue(FormatCommas(s.toString(), !1) + " " + n) : HomeGrid.cells(t, TargetStageGoalColIndex).setValue(s + " " + n), HomeGrid.setUserData(t, "stage", n), HomeGrid.setUserData(t, "tactictype", U), GetConversionRate(l, U, d, s, t, i, e.stageId) } }), !0 } if (updatetype.toLowerCase() == secLineItem.toLowerCase()) { if (d == TacticTypeId) { var K = lineItemTypefieldOptionList.filter(function (e) { return e.PlanId == m && e.value.trim().toLowerCase().toString() == o.trim().toLowerCase().toString() ? e.id : void 0 }); K.length > 0 && (o = K[0].id) } var H = HomeGrid.cells(t, a).getAttribute("actval"); if ((null == H || "" == H) && (H = o), i != o && i != H) { r = i; var X = HomeGrid.getAllSubItems(tactid); $.ajax({ type: "POST", url: urlContent + "Plan/SaveGridDetail", data: { UpdateType: updatetype, UpdateColumn: d.trim(), UpdateVal: r, Id: parseInt(l), CustomFieldInput: _customFieldValues, ColumnType: s.toString(), oValue: o.toString() }, dataType: "json", success: function (e) { if (HomeGrid.saveOpenStates("plangridState"), null != e.errormsg && "" != e.errormsg.trim()) return alert(e.errormsg.trim()), HomeGrid.cells(t, a).setValue(o), !1; if (d == PlannedCostId) { diff = parseInt(e.lineItemCost) - parseInt(ReplaceCC(o)); for (var l = 0; l < X.split(",").length; l++) "False" != HomeGrid.getUserData(X.split(",")[l], "IsOther") && HomeGrid.cells(X.split(",")[l], PlannedCostColIndex).setValue(CurrencySybmol + (e.tacticCost - e.lineItemCost)); RefershPlanHeaderCalc(), ItemIndex = HomeGrid.getRowIndex(tactid), state0 = ItemIndex, HomeGrid.cells(t, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(i)) } if ((d == PlannedCostId || d == TaskNameId) && e.linkTacticId > 0 && LoadPlanGrid(), d.toString().trim().indexOf("custom_") >= 0) { var r = e.DependentCustomfield; if (null != r && void 0 != r) for (var l = 0; l < r.length; l++) { var n = HomeGrid.getColIndexById(r[l].CustomFieldId); void 0 != n && "" != n && HomeGrid.cells(t, n).setValue(r[l].OptionValue) } } } }) } return !0 } if (htmlDecode(i) != o) { if (d != TacticTypeId && d.toString().trim() != TargetStageGoalId) { progid = HomeGrid.getParentId(t), campid = HomeGrid.getParentId(progid), planid = HomeGrid.getParentId(campid); var X = HomeGrid.getAllSubItems(t); r = i, $.ajax({ type: "POST", url: urlContent + "Plan/SaveGridDetail", data: { UpdateType: updatetype, UpdateColumn: d.trim(), UpdateVal: r, Id: parseInt(l), CustomFieldInput: _customFieldValues, ColumnType: s.toString(), oValue: o.toString() }, dataType: "json", success: function (e) { HomeGrid.saveOpenStates("plangridState"); var r = HomeGrid.cells(t, GridHiddenId).getValue(), n = $("div[taskId='" + r + "']").attr("OwnerName"); if (ExportSelectedIds.TaskID.length > 0) { var s = ExportSelectedIds.OwnerName.indexOf(n); s >= 0 && "" != e.OwnerName && (ExportSelectedIds.OwnerName[s] = e.OwnerName) } if ("" != e.OwnerName && null != e.OwnerName && $("div[taskId='" + r + "']").attr("ownername", e.OwnerName), null != e.errormsg && "" != e.errormsg.trim()) return alert(e.errormsg.trim()), HomeGrid.cells(t, a).setValue(o), !1; if (d == StartDateId) { if (e.IsExtended) return alert("Since the Tactic is link to another Plan, it cannot be extended"), HomeGrid.cells(t, a).setValue(o), !1; var c = HomeGrid.cells(t, EndDateColIndex).getValue(), m = new Date(c).getFullYear(), u = new Date(i).getFullYear(), p = m - u, C = new Date(o).getFullYear(), I = C - u; if (p > 0) { var g = HomeGrid.cells(t, TaskNameColIndex).getValue(), f = g.indexOf("unlink-icon"); if (-1 >= f) { var G = "<div class='unlink-icon unlink-icon-grid'><i class='fa fa-chain-broken'></i></div>"; HomeGrid.cells(t, TaskNameColIndex).setValue(G + g), $("div[tacticaddId='" + r + "']").attr("linktacticper", "True") } } else { if (0 == I) return !1; var g = HomeGrid.cells(t, TaskNameColIndex).getValue(), f = g.indexOf("</div>"); f > -1 && (HomeGrid.cells(t, TaskNameColIndex).setValue(g.split("</div>")[1]), $("div[tacticaddId='" + r + "']").attr("linktacticper", "False")) } ComapreDate(updatetype, t, StartDateColIndex, i, d) } if (d == EndDateId) { if (e.IsExtended) return alert("Since the Tactic is link to another Plan, it cannot be extended"), HomeGrid.cells(t, a).setValue(o), !1; var H = HomeGrid.cells(t, StartDateColIndex).getValue(), u = new Date(H).getFullYear(), m = new Date(i).getFullYear(), p = m - u, C = new Date(o).getFullYear(), I = C - u; if (p > 0) { var g = HomeGrid.cells(t, TaskNameColIndex).getValue(), f = g.indexOf("unlink-icon"); if (-1 >= f) { var G = "<div class='unlink-icon unlink-icon-grid'><i class='fa fa-chain-broken'></i></div>"; HomeGrid.cells(t, TaskNameColIndex).setValue(G + g), $("div[tacticaddId='" + r + "']").attr("linktacticper", "True") } } else { if (0 == I) return !1; var g = HomeGrid.cells(t, TaskNameColIndex).getValue(), f = g.indexOf("</div>"); f > -1 && (HomeGrid.cells(t, TaskNameColIndex).setValue(g.split("</div>")[1]), $("div[tacticaddId='" + r + "']").attr("linktacticper", "False")) } ComapreDate(updatetype, t, EndDateColIndex, i, d) } if (d == PlannedCostId) { var v = parseInt(ReplaceCC(i).replace(CurrencySybmol, "")), x = parseInt(ReplaceCC(o).replace(CurrencySybmol, "")); if (diff = v - x, SetColumUpdatedValue(PlannedCostColIndex, diff), HomeGrid.cells(progid, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(newProgVal)), HomeGrid.cells(campid, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(newCampVal)), HomeGrid.cells(planid, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(newPlanVal)), HomeGrid.cells(t, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(v)), null != X && "" != X && X.length > 0) for (var y = 0; y < X.split(",").length; y++) "False" != HomeGrid.getUserData(X.split(",")[y], "IsOther") && HomeGrid.cells(X.split(",")[y], PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(v - e.lineItemCost)) } if ((d == PlannedCostId || d == TaskNameId) && (e.linkTacticId > 0 && LoadPlanGrid(), RefershPlanHeaderCalc(), ItemIndex = HomeGrid.getRowIndex(t), state0 = ItemIndex), d == OwnerId && (n.toString() != e.OwnerName.toString() && "" != e.OwnerName && null != e.OwnerName && 0 != planid && null != planid && void 0 != planid && (GetTacticTypelist(filters.PlanIDs), GetOwnerListForFilter(filters.PlanIDs), SaveLastSetofViews()), CheckPermissionByOwner(t, i, updatetype, parseInt(l))), d == TaskNameId && ($("#txtGlobalSearch").val(""), $("#ExpClose").css("display", "none"), $("#ExpSearch").css("display", "block"), GlobalSearch()), d.toString().trim().indexOf("custom_") >= 0) { var T = e.DependentCustomfield; if (null != T && void 0 != T) for (var y = 0; y < T.length; y++) { var h = HomeGrid.getColIndexById(T[y].CustomFieldId); void 0 != h && "" != h && HomeGrid.cells(t, h).setValue(T[y].OptionValue) } } } }) } return a == TaskNameColIndex && (void 0 != value && "undefined" != value && null != value ? HomeGrid.cells(t, a).setValue(value + "</div>" + TacticName) : HomeGrid.cells(t, a).setValue(TacticName)), value = "", $("div[id^='LinkIcon']").each(function () { bootstrapetitle($(this), "This tactic is linked to <U>" + htmlDecode($(this).attr("linkedplanname") + "</U>"), "tipsy-innerWhite") }), !0 } return a == TaskNameColIndex && (void 0 != value && "undefined" != value && null != value ? HomeGrid.cells(t, a).setValue(value + "</div>" + TacticName) : HomeGrid.cells(t, a).setValue(TacticName)), value = "", $("div[id^='LinkIcon']").each(function () { bootstrapetitle($(this), "This tactic is linked to <U>" + htmlDecode($(this).attr("linkedplanname") + "</U>"), "tipsy-innerWhite") }), !0 } } function AssignParentIds(e) { updatetype.toLowerCase() == secTactic ? (tactid = e, progid = HomeGrid.getParentId(e), campid = HomeGrid.getParentId(progid), planid = HomeGrid.getParentId(campid)) : updatetype.toLowerCase() == secLineItem ? (tactid = HomeGrid.getParentId(e), progid = HomeGrid.getParentId(tactid), campid = HomeGrid.getParentId(progid), planid = HomeGrid.getParentId(campid)) : updatetype.toLowerCase() == secProgram ? (campid = HomeGrid.getParentId(e), planid = HomeGrid.getParentId(campid)) : updatetype.toLowerCase() == secCampaign ? planid = HomeGrid.getParentId(e) : updatetype.toLowerCase() == secPlan && (planid = e) } function CheckPermissionByOwner(e, t, a, i) { $.ajax({ type: "POST", url: urlContent + "Plan/CheckPermissionByOwner", data: { NewOwnerID: t, UpdateType: a, updatedid: parseInt(i) }, dataType: "json", success: function (t) { "1" == t.IsLocked && (HomeGrid.cells(e, TaskNameColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, StartDateColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, EndDateColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, PlannedCostColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, AssetTypeColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, TypeColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, OwnerColIndex).setAttribute("lo", t.IsLocked), HomeGrid.cells(e, TargetStageGoalColIndex).setAttribute("lo", t.IsLocked), HomeGrid.setCellTextStyle(e, TaskNameColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, StartDateColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, EndDateColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, PlannedCostColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, AssetTypeColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, TypeColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, OwnerColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, TargetStageGoalColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, MQLColIndex, t.cellTextColor), HomeGrid.setCellTextStyle(e, RevenueColIndex, t.cellTextColor)) }, error: function (e) { } }) } function GetConversionRate(e, t, a, i, o, l, d) { var r = !0, n = 0, s = 0; progid = HomeGrid.getParentId(o), campid = HomeGrid.getParentId(progid), planid = HomeGrid.getParentId(campid), n = i, $.ajax({ type: "POST", url: urlContent + "Plan/CalculateMQL", data: { tactictid: parseInt(e), TacticTypeId: parseInt(t), projectedStageValue: n, RedirectType: r, isTacticTypeChange: !0, StageID: d }, success: function (t) { if (void 0 != MQLColIndex && null != MQLColIndex) { var i = HomeGrid.cells(o, MQLColIndex).getValue(), d = 0; if (null != t.revenue && (s = t.revenue), "N/A" == t.mql) HomeGrid.setCellExcellType(o, MQLColIndex, "ro"), HomeGrid.cells(o, MQLColIndex).setValue(t.mql), diff = parseInt(-i), SetColumUpdatedValue(MQLColIndex, diff); else { null != t.mql && (d = t.mql); var r = d.toString(); HomeGrid.cells(o, MQLColIndex).setValue(numberWithCommas(r)), diff = parseInt(d) - parseInt(ReplaceCC(i.toString())), SetColumUpdatedValue(MQLColIndex, diff) } HomeGrid.cells(progid, MQLColIndex).setValue(numberWithCommas(newProgVal), !1), HomeGrid.cells(campid, MQLColIndex).setValue(numberWithCommas(newCampVal), !1), HomeGrid.cells(planid, MQLColIndex).setValue(numberWithCommas(newPlanVal), !1); var n = HomeGrid.cells(o, RevenueColIndex).getValue(); HomeGrid.cells(o, RevenueColIndex).setValue(CurrencySybmol + numberWithCommas(parseInt(s).toString())), diff = parseInt(s) - parseInt(ReplaceCC(n.toString()).replace(CurrencySybmol, "")), SetColumUpdatedValue(RevenueColIndex, diff), HomeGrid.cells(progid, RevenueColIndex).setValue(CurrencySybmol + numberWithCommas(newProgVal)), HomeGrid.cells(campid, RevenueColIndex).setValue(CurrencySybmol + numberWithCommas(newCampVal)), HomeGrid.cells(planid, RevenueColIndex).setValue(CurrencySybmol + numberWithCommas(newPlanVal)) } $.ajax({ type: "POST", url: urlContent + "Plan/SaveGridDetail", data: { UpdateType: "Tactic", UpdateColumn: a.trim(), UpdateVal: l, Id: parseInt(e) }, dataType: "json", success: function (e) { if (HomeGrid.saveOpenStates("plangridState"), a == TargetStageGoalId) { var t = HomeGrid.getUserData(o, "stage"); HomeGrid.cells(o, TargetStageGoalColIndex).setValue(FormatCommas(l.toString()) + " " + t), RefershPlanHeaderCalc() } if (a == TacticTypeId) { HomeGrid.cells(planid, GridHiddenId).getValue(); $("#ulTacticType li input[type=checkbox]").each(function () { var e = $(this).attr("id"); "checked" != $(this).attr("checked") && filters.tempTacticTypeIds.push(e.replace("CbTT", "")) }), GetTacticTypelist(filters.PlanIDs, !1), SaveLastSetofViews(); var i = HomeGrid.getAllSubItems(o), d = 0; null != e.TacticCost && "undefined" != e.TacticCost && (d = e.TacticCost), PlannedCostColIndex = HomeGrid.getColIndexById(PlannedCostId); var r = HomeGrid.cells(o, PlannedCostColIndex).getValue(); if (diff = parseInt(d) - parseInt(ReplaceCC(r.toString())), SetColumUpdatedValue(PlannedCostColIndex, diff), HomeGrid.cells(progid, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(newProgVal)), HomeGrid.cells(campid, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(newCampVal)), HomeGrid.cells(planid, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(newPlanVal)), HomeGrid.cells(o, PlannedCostColIndex).setValue(CurrencySybmol + numberWithCommas(d)), null != i && "" != i && i.length > 0) for (var n = 0; n < i.split(",").length; n++) "False" != HomeGrid.getUserData(i.split(",")[n], "IsOther") && HomeGrid.cells(i.split(",")[n], PlannedCostColIndex).setValue(CurrencySybmol + (d - e.lineItemCost)); e.linkTacticId > 0 && LoadPlanGrid(), RefershPlanHeaderCalc(), ItemIndex = HomeGrid.getRowIndex(o), state0 = ItemIndex } } }) } }) } function ComapreDate(e, t, a, i, o) { var l = new Date(formatDate(i)); if (e.toLowerCase() == secTactic) { progid = HomeGrid.getParentId(t), campid = HomeGrid.getParentId(progid), planid = HomeGrid.getParentId(campid); var d = HomeGrid.cells(progid, GridHiddenId).getValue(), r = HomeGrid.cells(campid, GridHiddenId).getValue(), n = new Date(formatDate(HomeGrid.cells(progid, a).getValue())), s = new Date(formatDate(HomeGrid.cells(campid, a).getValue())), c = new Date(formatDate(HomeGrid.cells(planid, a).getValue())); if (o == StartDateId) { n > l && HomeGrid.cells(progid, a).setValue(formatDate(i)), s > l && HomeGrid.cells(campid, a).setValue(formatDate(i)), c > l && HomeGrid.cells(planid, a).setValue(formatDate(i)); var m = HomeGrid.getUserData(progid, "tsdate"), u = HomeGrid.getUserData(campid, "psdate"); $.ajax({ type: "POST", url: urlContent + "GetMinMaxDate", data: { Parentid: parseInt(r), UpdateType: "Tactic", updatedid: parseInt(d) }, dataType: "json", success: function (e) { formatDate(e.TactMinDate) != formatDate(m) && HomeGrid.setUserData(progid, "tsdate", formatDate(e.TactMinDate)), formatDate(e.TactMinDate) != formatDate(m) && HomeGrid.setUserData(campid, "tsdate", formatDate(e.TactMinDate)), formatDate(e.ProgMinDate) != formatDate(u) && HomeGrid.setUserData(campid, "psdate", formatDate(e.ProgMinDate)) }, error: function (e) { } }) } else if (o == EndDateId) { l > n && HomeGrid.cells(progid, a).setValue(formatDate(i)), l > s && HomeGrid.cells(campid, a).setValue(formatDate(i)), l > c && HomeGrid.cells(planid, a).setValue(formatDate(i)); var p = HomeGrid.getUserData(progid, "tedate"), C = HomeGrid.getUserData(campid, "pedate"); $.ajax({ type: "POST", url: urlContent + "Plan/GetMinMaxDate", data: { Parentid: parseInt(r), UpdateType: "Tactic", updatedid: parseInt(d) }, dataType: "json", success: function (e) { formatDate(e.TactMaxDate) != formatDate(p) && HomeGrid.setUserData(progid, "tedate", formatDate(e.TactMaxDate)), formatDate(e.TactMaxDate) != formatDate(p) && HomeGrid.setUserData(campid, "tedate", formatDate(e.TactMaxDate)), formatDate(e.ProgMaxDate) != formatDate(C) && HomeGrid.setUserData(campid, "psdate", formatDate(e.ProgMaxDate)) } }) } } else if (e.ToLower() == secProgram) { campid = HomeGrid.getParentId(t), planid = HomeGrid.getParentId(campid); var d = HomeGrid.cells(t, 3).getValue(), r = HomeGrid.cells(campid, 3).getValue(), s = new Date(formatDate(HomeGrid.cells(campid, a).getValue())), c = new Date(formatDate(HomeGrid.cells(planid, a).getValue())); if (o == StartDateId) { s > l && HomeGrid.cells(campid, a).setValue(formatDate(i)), c > l && HomeGrid.cells(planid, a).setValue(formatDate(i)); var u = HomeGrid.getUserData(campid, "psdate"), I = HomeGrid.getUserData(campid, "tsdate"); $.ajax({ type: "POST", url: urlContent + "Plan/GetMinMaxDate", data: { Parentid: parseInt(r), UpdateType: "Program", updatedid: parseInt(d) }, dataType: "json", success: function (e) { formatDate(e.TactMinDate) != formatDate(I) && HomeGrid.setUserData(campid, "tsdate", formatDate(e.TactMinDate)), formatDate(e.ProgMinDate) != formatDate(u) && HomeGrid.setUserData(campid, "psdate", formatDate(e.ProgMinDate)) }, error: function (e) { } }) } else if (o == EndDateId) { l > s && HomeGrid.cells(campid, a).setValue(formatDate(i)), l > c && HomeGrid.cells(planid, a).setValue(formatDate(i)); var C = HomeGrid.getUserData(campid, "pedate"), g = HomeGrid.getUserData(campid, "tedate"); $.ajax({ type: "POST", url: urlContent + "Plan/GetMinMaxDate", data: { Parentid: parseInt(r), UpdateType: "Program", updatedid: parseInt(d) }, dataType: "json", success: function (e) { formatDate(e.TactMaxDate) != formatDate(g) && HomeGrid.setUserData(campid, "tedate", formatDate(e.TactMaxDate)), formatDate(e.ProgMaxDate) != formatDate(C) && HomeGrid.setUserData(campid, "pedate", formatDate(e.ProgMaxDate)) }, error: function (e) { } }) } } else if (e.toLowerCase() == secCampaign) { planid = HomeGrid.getParentId(t); var c = new Date(formatDate(HomeGrid.cells(planid, a).getValue())); o == StartDateId ? c > l && HomeGrid.cells(planid, a).setValue(formatDate(i)) : o == EndDateId && l > c && HomeGrid.cells(planid, a).setValue(formatDate(i)) } } function ExportToCsvSp() { if (void 0 != $("#txtGlobalSearch").val().trim() && "" != $("#txtGlobalSearch").val().trim()) { var e = new Array; $(HomeGrid.rowsBuffer).find("td div.honeycombbox-icon-gantt").each(function () { e.push($(this).attr("csvid")) }); var t = e.toString(); $.ajax({ type: "POST", url: urlContent + "Plan/ExportToCsv/", data: { HoneycombIds: t, PlanId: filters.PlanIDs.toString() }, success: function (e) { window.location = urlContent + "Plan/ExportCsvDataTable/" } }) } else { var a = 0, i = 0, o = null, l = 0; $("#divCustomFieldsFilter").find("div.accordion").each(function () { if (null != $(this).find("input[type=checkbox]") || "" != $(this).find("input[type=checkbox]")) if (i = $(this).find("input[type=checkbox]").length, a = $(this).find("input[type=checkbox]:checked").length, l = i - a, i == l) { var e = $(this).attr("id"); if (e.indexOf("-") >= 0) { e = e.split("-")[1]; var t = e + "_null"; filters.customFieldIds.push(t) } } else if (i == a) { o = this.id, null != o && "" != o && o.indexOf("-") > -1 && (o = this.id.split("-")[1]); var d, r = 0; for (r = 0; r < filters.customFieldIds.length; r++) filters.customFieldIds[r].indexOf("_") > -1 && (d = filters.customFieldIds[r].split("_")[0], o == d && (filters.customFieldIds.splice(r, 1), r--)) } }); var d = filters.OwnerIds.toString(), r = filters.TacticTypeids.toString(), n = filters.StatusIds.toString(), s = filters.customFieldIds.toString(); $.ajax({ type: "POST", url: urlContent + "Plan/ExportToCsv/", data: { ownerIds: d, TacticTypeid: r, StatusIds: n, customFieldIds: s, PlanId: filters.PlanIDs.toString() }, success: function (e) { window.location = urlContent + "Plan/ExportCsvDataTable/" } }) } } function ExportCSVHoneyCombSp() { var e = ExportSelectedIds.CsvId.toString(); $.ajax({ type: "POST", url: urlContent + "Plan/ExportToCsv/", data: { HoneycombIds: e, PlanId: filters.PlanIDs.toString() }, success: function (e) { window.location = urlContent + "Plan/ExportCsvDataTable/" } }) } function ExportToExcel(e) {
    if ("home" == gridname.toLowerCase()) filters.PlanIDs.length > 1 ? alert("You can export only one plan at a time. Please select the correct plan and try to export again") : e ? ExportCSVHoneyCombSp() : ExportToCsvSp(); else {
        var t = [], a = [], o = (HomeGrid.getColIndexById("MachineName"), HomeGrid.getColIndexById("Type")), l = HomeGrid.getColIndexById("ActivityId"); "budget" == gridname.toLowerCase() && (iconColumnIndex = HomeGrid.getColIndexById("Buttons"), colourCodeIndex = HomeGrid.getColIndexById("colourcode")), e && HomeGrid.forEachRow(function (e) { var i = HomeGrid.cells(e, iconColumnIndex).getValue(); i.indexOf("honeycombbox-icon-gantt-Active") <= -1 ? (HomeGrid.setRowHidden(e, !0), t.push(e)) : a.push(e) }), HomeGrid.saveOpenStates("plangridState"), HomeGrid.expandAll(); HomeGrid.getColIndexById("ActivityId"); HomeGrid.setColumnHidden(l, !1), HomeGrid.setColumnHidden(o, !1); var d = ColumnIds.split(","), r = ""; for (i = 0; i < d.length; ++i) r += 0 == i ? "MachineName" == d[i] || "LineItemTypeId" == d[i] || "Buttons" == d[i] || "colourcode" == d[i] ? "false" : "true" : "MachineName" == d[i] || "LineItemTypeId" == d[i] || "Buttons" == d[i] || "colourcode" == d[i] ? ",false" : ",true"; HomeGrid.setSerializableColumns(r), HomeGrid.toExcel("https://dhtmlxgrid.appspot.com/export/excel"), HomeGrid.collapseAll(), HomeGrid.loadOpenStates("plangridState"), HomeGrid.setColumnHidden(l, !0), HomeGrid.setColumnHidden(o, !0), void 0 != t && $.each(t, function (e) { HomeGrid.setRowHidden(t[e], !1) }), void 0 != a && $.each(a, function (e) {
            var t = HomeGrid.cells(a[e], iconColumnIndex).getValue(); t.indexOf("honeycombbox-icon-gantt-Active") <= -1 && HomeGrid.cells(a[e], iconColumnIndex).setValue(t.replace("honeycombbox-icon-gantt", "honeycombbox-icon-gantt honeycombbox-icon-gantt-Active"));
        })
    }
} function GetCustomfieldOptionlist(e, t, a, i) { function o(t) { return t.customFieldId == e && null != t.ParentOptionId && t.ParentOptionId.length > 0 ? !0 : !1 } function l(t) { return t.customFieldId == e ? !0 : !1 } var r, n = customfieldOptionList, s = []; if (d = n.filter(o), IsDependentTextBox = !1, null != d && d.length > 0) { var c = []; $.each(d, function (e, t) { c.indexOf(t.ParentOptionId[0]) < 0 && c.push(t.ParentOptionId[0]) }), $.ajax({ url: urlContent + "Plan/GetdependantOptionlist/", traditional: !0, async: !1, data: { customfieldId: e, entityid: t, parentoptionId: c, Customfieldtype: i }, success: function (e) { return "ed" == i && "true" == e.IstextBoxDependent.toString().toLowerCase() ? (IsDependentTextBox = !0, !1) : (null != e && null != e.optionlist && e.optionlist.length > 0 && (r = e.optionlist), void (null != r && r.length > 0 && void 0 != r ? ($.each(r, function (e, t) { -1 == s.indexOf(t.value) && s.push(t.value) }), HomeGrid.registerCList(a, s)) : HomeGrid.registerCList(a, s))) } }) } else r = n.filter(l), $.each(r, function (e, t) { s.push(t.value) }), HomeGrid.registerCList(a, s) } function opencombobox() { var e = $(".rowselected td").offset().top, t = $(".objbox").height(), a = e - t; a > 200 ? $("body").addClass("reverse") : $("body").removeClass("reverse") } var eventiddrag = 0, eventidonedit = 0, eventidonbeforedrag = 0, eventidonscroll = 0, updatetype = 0, progid = 0, campid = 0, planid = 0, tactid = 0, progActVal = 0, CampActVal = 0, PlanActVal = 0, TactActVal = 0, diff = 0, newProgVal = 0, newCampVal = 0, newPlanVal = 0, newTactVal = 0, value, TacticName, ExportToCsv = !1, _customFieldValues = [], IsDependentTextBox = !1, NodatawithfilterGrid = '<div id="NodatawithfilterGrid" style="display:none;"><span class="pull-left margin_t30 bold " style="margin-left: 20px;">No data exists. Please check the filters or grouping applied.</span><br/></div>', SetTooltipFirstTime = !0; SetTooltip(); var $doc = $(document); $doc.click(function () { $("#popupType").css("display", "none"), $("#dhx_combo_select").css("display", "none"), $(".dhx_clist").css("display", "none") }), $(document).mouseup(function (e) { $("#popupType").css("display", "none"), $("#dhx_combo_select").css("display", "none") }), $(".grid_ver_scroll").scroll(function () { $("#popupType").css("display", "none"), $(".dhx_clist").css("display", "none") }); var IsExportToCsv = !1;